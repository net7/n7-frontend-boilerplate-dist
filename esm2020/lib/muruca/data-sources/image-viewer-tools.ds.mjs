import { DataSource } from '@n7-frontend/core';
export class MrImageViewerToolsDS extends DataSource {
    transform(data) {
        if (!data)
            return null;
        const { thumbs } = data;
        const images = data.images.map(({ caption }, thumbindex) => ({
            caption,
            thumb: thumbs[thumbindex],
            payload: { thumbindex }
        }));
        return {
            images,
            classes: '',
            navigation: data.images.length > 7 ? {
                prev: {
                    payload: 'prev',
                    classes: 'n7-image-viewer-tools__thumbs-scroll-left'
                },
                next: {
                    payload: 'next',
                    classes: 'n7-image-viewer-tools__thumbs-scroll-right'
                },
            } : null,
            controls: {
                description: images[0].caption ? {
                    icon: 'n7-icon-info1',
                    anchor: { payload: 'toggle-description' },
                    isActive: false,
                } : null,
                thumbs: {
                    icon: 'n7-icon-images',
                    anchor: { payload: 'toggle-thumbs' },
                    isActive: false,
                },
                closedescription: {
                    icon: 'n7-icon-close-circle',
                    anchor: { payload: 'close-description' }
                }
            },
            isVisible: {
                description: false,
                thumbnails: false,
            },
            description: images[0].caption,
            initial: 0
        };
    }
    toggleDescription() {
        this.output.isVisible.description = !this.output.isVisible.description;
        this.output.isVisible.thumbnails = false;
        this.output.controls.description.isActive = !this.output.controls.description.isActive;
        this.output.controls.thumbs.isActive = false;
    }
    toggleThumbs() {
        this.output.isVisible.thumbnails = !this.output.isVisible.thumbnails;
        this.output.isVisible.description = false;
        this.output.controls.thumbs.isActive = !this.output.controls.thumbs.isActive;
        if (this.output.controls.description) {
            this.output.controls.description.isActive = false;
        }
    }
    handleThumbs(index) {
        this.output.initial = index;
        this.updateDescription();
    }
    //
    scrollRight() {
        const thumbsStrip = document.querySelectorAll('div.n7-image-viewer-tools__thumbs-strip')[0];
        const rightArrow = document.querySelectorAll(`div.${this.output.navigation.next.classes}`)[0];
        const leftArrow = document.querySelectorAll(`div.${this.output.navigation.prev.classes}`)[0];
        const maxStrip = thumbsStrip.scrollWidth - thumbsStrip.clientWidth;
        const { scrollLeft } = thumbsStrip;
        if ((scrollLeft + 400) >= maxStrip) { // mettere value da config e.g. scrollStrength
            thumbsStrip.scrollBy({
                top: 0,
                left: +400,
                behavior: 'smooth'
            });
            rightArrow.style.opacity = '0.5';
        }
        else {
            thumbsStrip.scrollBy({
                top: 0,
                left: +400,
                behavior: 'smooth'
            });
        }
        if (((scrollLeft + 400) > 0)) {
            leftArrow.style.opacity = '1.0';
        }
    }
    scrollLeft() {
        const thumbsStrip = document.querySelectorAll('div.n7-image-viewer-tools__thumbs-strip')[0];
        const rightArrow = document.querySelectorAll(`div.${this.output.navigation.next.classes}`)[0];
        const leftArrow = document.querySelectorAll(`div.${this.output.navigation.prev.classes}`)[0];
        const maxStrip = thumbsStrip.scrollWidth - thumbsStrip.clientWidth;
        const { scrollLeft } = thumbsStrip;
        if ((scrollLeft - 400) <= 0) { // mettere value da config e.g. scrollStrength
            thumbsStrip.scrollBy({
                top: 0,
                left: -400,
                behavior: 'smooth'
            });
            leftArrow.style.opacity = '0.5';
        }
        else {
            thumbsStrip.scrollBy({
                top: 0,
                left: -400,
                behavior: 'smooth'
            });
        }
        if (((scrollLeft - 400) < maxStrip)) {
            rightArrow.style.opacity = '1.0';
        }
    }
    //
    handlePageChange(payload) {
        this.handleThumbs(payload.page);
    }
    updateDescription() {
        const index = this.output.initial;
        const { images } = this.output;
        this.output.description = images[index].caption;
        if (!this.output.description) {
            this.output.controls.description = null;
        }
        else {
            this.output.controls.description = {
                icon: 'n7-icon-info1',
                anchor: { payload: 'toggle-description' }
            };
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2Utdmlld2VyLXRvb2xzLmRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbjctYm9pbGVycGxhdGUtbGliL3NyYy9saWIvbXVydWNhL2RhdGEtc291cmNlcy9pbWFnZS12aWV3ZXItdG9vbHMuZHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBVy9DLE1BQU0sT0FBTyxvQkFBcUIsU0FBUSxVQUFVO0lBR3hDLFNBQVMsQ0FBQyxJQUF5QjtRQUMzQyxJQUFJLENBQUMsSUFBSTtZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRXZCLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDeEIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxFQUFFLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUMzRCxPQUFPO1lBQ1AsS0FBSyxFQUFFLE1BQU0sQ0FBQyxVQUFVLENBQUM7WUFDekIsT0FBTyxFQUFFLEVBQUUsVUFBVSxFQUFFO1NBQ3hCLENBQUMsQ0FBQyxDQUFDO1FBRUosT0FBTztZQUNMLE1BQU07WUFDTixPQUFPLEVBQUUsRUFBRTtZQUNYLFVBQVUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNuQyxJQUFJLEVBQUU7b0JBQ0osT0FBTyxFQUFFLE1BQU07b0JBQ2YsT0FBTyxFQUFFLDJDQUEyQztpQkFDckQ7Z0JBQ0QsSUFBSSxFQUFFO29CQUNKLE9BQU8sRUFBRSxNQUFNO29CQUNmLE9BQU8sRUFBRSw0Q0FBNEM7aUJBQ3REO2FBQ0YsQ0FBQyxDQUFDLENBQUMsSUFBSTtZQUNSLFFBQVEsRUFBRTtnQkFDUixXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9B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QyxJQUFJLEVBQUUsZUFBZTtnQkFDckIsTUFBTSxFQUFFLEVBQUUsT0FBTyxFQUFFLG9CQUFvQixFQUFFO2FBQzFDLENBQUM7U0FDSDtJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEltYWdlVmlld2VyVG9vbHNEYXRhIH0gZnJvbSAnQG43LWZyb250ZW5kL2NvbXBvbmVudHMnO1xuaW1wb3J0IHsgRGF0YVNvdXJjZSB9IGZyb20gJ0BuNy1mcm9udGVuZC9jb3JlJztcblxudHlwZSBJbWFnZVZpZXdlclJlc3BvbnNlID0ge1xuICB0aHVtYnM6IHN0cmluZ1tdO1xuICBpbWFnZXM6IHtcbiAgICB1cmw6IHN0cmluZztcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgY2FwdGlvbj86IHN0cmluZztcbiAgfVtdO1xufTtcblxuZXhwb3J0IGNsYXNzIE1ySW1hZ2VWaWV3ZXJUb29sc0RTIGV4dGVuZHMgRGF0YVNvdXJjZSB7XG4gIGlkOiBzdHJpbmc7XG5cbiAgcHJvdGVjdGVkIHRyYW5zZm9ybShkYXRhOiBJbWFnZVZpZXdlclJlc3BvbnNlKTogSW1hZ2VWaWV3ZXJUb29sc0RhdGEge1xuICAgIGlmICghZGF0YSkgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCB7IHRodW1icyB9ID0gZGF0YTtcbiAgICBjb25zdCBpbWFnZXMgPSBkYXRhLmltYWdlcy5tYXAoKHsgY2FwdGlvbiB9LCB0aHVtYmluZGV4KSA9PiAoe1xuICAgICAgY2FwdGlvbixcbiAgICAgIHRodW1iOiB0aHVtYnNbdGh1bWJpbmRleF0sXG4gICAgICBwYXlsb2FkOiB7IHRodW1iaW5kZXggfVxuICAgIH0pKTtcblxuICAgIHJldHVybiB7XG4gICAgICBpbWFnZXMsXG4gICAgICBjbGFzc2VzOiAnJyxcbiAgICAgIG5hdmlnYXRpb246IGRhdGEuaW1hZ2VzLmxlbmd0aCA+IDcgPyB7XG4gICAgICAgIHByZXY6IHtcbiAgICAgICAgICBwYXlsb2FkOiAncHJldicsXG4gICAgICAgICAgY2xhc3NlczogJ243LWltYWdlLXZpZXdlci10b29sc19fdGh1bWJzLXNjcm9sbC1sZWZ0J1xuICAgICAgICB9LFxuICAgICAgICBuZXh0OiB7XG4gICAgICAgICAgcGF5bG9hZDogJ25leHQnLCAvLyAnbmV4dCdcbiAgICAgICAgICBjbGFzc2VzOiAnbjctaW1hZ2Utdmlld2VyLXRvb2xzX190aHVtYnMtc2Nyb2xsLXJpZ2h0J1xuICAgICAgICB9LFxuICAgICAgfSA6IG51bGwsXG4gICAgICBjb250cm9sczoge1xuICAgICAgICBkZXNjcmlwdGlvbjogaW1hZ2VzWzBdLmNhcHRpb24gPyB7XG4gICAgICAgICAgaWNvbjogJ243LWljb24taW5mbzEnLFxuICAgICAgICAgIGFuY2hvcjogeyBwYXlsb2FkOiAndG9nZ2xlLWRlc2NyaXB0aW9uJyB9LFxuICAgICAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICAgICAgfSA6IG51bGwsXG4gICAgICAgIHRodW1iczoge1xuICAgICAgICAgIGljb246ICduNy1pY29uLWltYWdlcycsXG4gICAgICAgICAgYW5jaG9yOiB7IHBheWxvYWQ6ICd0b2dnbGUtdGh1bWJzJyB9LFxuICAgICAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAgY2xvc2VkZXNjcmlwdGlvbjoge1xuICAgICAgICAgIGljb246ICduNy1pY29uLWNsb3NlLWNpcmNsZScsXG4gICAgICAgICAgYW5jaG9yOiB7IHBheWxvYWQ6ICdjbG9zZS1kZXNjcmlwdGlvbicgfVxuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICBpc1Zpc2libGU6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IGZhbHNlLFxuICAgICAgICB0aHVtYm5haWxzOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBkZXNjcmlwdGlvbjogaW1hZ2VzWzBdLmNhcHRpb24sXG4gICAgICBpbml0aWFsOiAwXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyB0b2dnbGVEZXNjcmlwdGlvbigpIHtcbiAgICB0aGlzLm91dHB1dC5pc1Zpc2libGUuZGVzY3JpcHRpb24gPSAhdGhpcy5vdXRwdXQuaXNWaXNpYmxlLmRlc2NyaXB0aW9uO1xuICAgIHRoaXMub3V0cHV0LmlzVmlzaWJsZS50aHVtYm5haWxzID0gZmFsc2U7XG4gICAgdGhpcy5vdXRwdXQuY29udHJvbHMuZGVzY3JpcHRpb24uaXNBY3RpdmUgPSAhdGhpcy5vdXRwdXQuY29udHJvbHMuZGVzY3JpcHRpb24uaXNBY3RpdmU7XG4gICAgdGhpcy5vdXRwdXQuY29udHJvbHMudGh1bWJzLmlzQWN0aXZlID0gZmFsc2U7XG4gIH1cblxuICBwdWJsaWMgdG9nZ2xlVGh1bWJzKCkge1xuICAgIHRoaXMub3V0cHV0LmlzVmlzaWJsZS50aHVtYm5haWxzID0gIXRoaXMub3V0cHV0LmlzVmlzaWJsZS50aHVtYm5haWxzO1xuICAgIHRoaXMub3V0cHV0LmlzVmlzaWJsZS5kZXNjcmlwdGlvbiA9IGZhbHNlO1xuICAgIHRoaXMub3V0cHV0LmNvbnRyb2xzLnRodW1icy5pc0FjdGl2ZSA9ICF0aGlzLm91dHB1dC5jb250cm9scy50aHVtYnMuaXNBY3RpdmU7XG4gICAgaWYgKHRoaXMub3V0cHV0LmNvbnRyb2xzLmRlc2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLm91dHB1dC5jb250cm9scy5kZXNjcmlwdGlvbi5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVUaHVtYnMoaW5kZXgpIHtcbiAgICB0aGlzLm91dHB1dC5pbml0aWFsID0gaW5kZXg7XG4gICAgdGhpcy51cGRhdGVEZXNjcmlwdGlvbigpO1xuICB9XG5cbiAgLy9cblxuICBwdWJsaWMgc2Nyb2xsUmlnaHQoKSB7XG4gICAgY29uc3QgdGh1bWJzU3RyaXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PignZGl2Lm43LWltYWdlLXZpZXdlci10b29sc19fdGh1bWJzLXN0cmlwJylbMF07XG4gICAgY29uc3QgcmlnaHRBcnJvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGw8SFRNTEVsZW1lbnQ+KGBkaXYuJHt0aGlzLm91dHB1dC5uYXZpZ2F0aW9uLm5leHQuY2xhc3Nlc31gKVswXTtcbiAgICBjb25zdCBsZWZ0QXJyb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PihgZGl2LiR7dGhpcy5vdXRwdXQubmF2aWdhdGlvbi5wcmV2LmNsYXNzZXN9YClbMF07XG4gICAgY29uc3QgbWF4U3RyaXAgPSB0aHVtYnNTdHJpcC5zY3JvbGxXaWR0aCAtIHRodW1ic1N0cmlwLmNsaWVudFdpZHRoO1xuICAgIGNvbnN0IHsgc2Nyb2xsTGVmdCB9ID0gdGh1bWJzU3RyaXA7XG5cbiAgICBpZiAoKHNjcm9sbExlZnQgKyA0MDApID49IG1heFN0cmlwKSB7IC8vIG1ldHRlcmUgdmFsdWUgZGEgY29uZmlnIGUuZy4gc2Nyb2xsU3RyZW5ndGhcbiAgICAgIHRodW1ic1N0cmlwLnNjcm9sbEJ5KHtcbiAgICAgICAgdG9wOiAwLFxuICAgICAgICBsZWZ0OiArNDAwLFxuICAgICAgICBiZWhhdmlvcjogJ3Ntb290aCdcbiAgICAgIH0pO1xuICAgICAgcmlnaHRBcnJvdy5zdHlsZS5vcGFjaXR5ID0gJzAuNSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRodW1ic1N0cmlwLnNjcm9sbEJ5KHtcbiAgICAgICAgdG9wOiAwLFxuICAgICAgICBsZWZ0OiArNDAwLFxuICAgICAgICBiZWhhdmlvcjogJ3Ntb290aCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICgoKHNjcm9sbExlZnQgKyA0MDApID4gMCkpIHtcbiAgICAgIGxlZnRBcnJvdy5zdHlsZS5vcGFjaXR5ID0gJzEuMCc7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHNjcm9sbExlZnQoKSB7XG4gICAgY29uc3QgdGh1bWJzU3RyaXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PignZGl2Lm43LWltYWdlLXZpZXdlci10b29sc19fdGh1bWJzLXN0cmlwJylbMF07XG4gICAgY29uc3QgcmlnaHRBcnJvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGw8SFRNTEVsZW1lbnQ+KGBkaXYuJHt0aGlzLm91dHB1dC5uYXZpZ2F0aW9uLm5leHQuY2xhc3Nlc31gKVswXTtcbiAgICBjb25zdCBsZWZ0QXJyb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PihgZGl2LiR7dGhpcy5vdXRwdXQubmF2aWdhdGlvbi5wcmV2LmNsYXNzZXN9YClbMF07XG4gICAgY29uc3QgbWF4U3RyaXAgPSB0aHVtYnNTdHJpcC5zY3JvbGxXaWR0aCAtIHRodW1ic1N0cmlwLmNsaWVudFdpZHRoO1xuICAgIGNvbnN0IHsgc2Nyb2xsTGVmdCB9ID0gdGh1bWJzU3RyaXA7XG5cbiAgICBpZiAoKHNjcm9sbExlZnQgLSA0MDApIDw9IDApIHsgLy8gbWV0dGVyZSB2YWx1ZSBkYSBjb25maWcgZS5nLiBzY3JvbGxTdHJlbmd0aFxuICAgICAgdGh1bWJzU3RyaXAuc2Nyb2xsQnkoe1xuICAgICAgICB0b3A6IDAsXG4gICAgICAgIGxlZnQ6IC00MDAsXG4gICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJ1xuICAgICAgfSk7XG4gICAgICBsZWZ0QXJyb3cuc3R5bGUub3BhY2l0eSA9ICcwLjUnO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHVtYnNTdHJpcC5zY3JvbGxCeSh7XG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogLTQwMCxcbiAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoKChzY3JvbGxMZWZ0IC0gNDAwKSA8IG1heFN0cmlwKSkge1xuICAgICAgcmlnaHRBcnJvdy5zdHlsZS5vcGFjaXR5ID0gJzEuMCc7XG4gICAgfVxuICB9XG5cbiAgLy9cblxuICBwdWJsaWMgaGFuZGxlUGFnZUNoYW5nZShwYXlsb2FkKSB7XG4gICAgdGhpcy5oYW5kbGVUaHVtYnMocGF5bG9hZC5wYWdlKTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVEZXNjcmlwdGlvbigpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMub3V0cHV0LmluaXRpYWw7XG4gICAgY29uc3QgeyBpbWFnZXMgfSA9IHRoaXMub3V0cHV0O1xuICAgIHRoaXMub3V0cHV0LmRlc2NyaXB0aW9uID0gaW1hZ2VzW2luZGV4XS5jYXB0aW9uO1xuICAgIGlmICghdGhpcy5vdXRwdXQuZGVzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMub3V0cHV0LmNvbnRyb2xzLmRlc2NyaXB0aW9uID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vdXRwdXQuY29udHJvbHMuZGVzY3JpcHRpb24gPSB7XG4gICAgICAgIGljb246ICduNy1pY29uLWluZm8xJyxcbiAgICAgICAgYW5jaG9yOiB7IHBheWxvYWQ6ICd0b2dnbGUtZGVzY3JpcHRpb24nIH1cbiAgICAgIH07XG4gICAgfVxuICB9XG59XG4iXX0=