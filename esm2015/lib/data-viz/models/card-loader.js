import { TextItemDS, DataWidgetItemDS, ApexChartItemDS, TableItemDS, InnerTitleItemDS, SelectItemDS, MapItemDS, } from '../data-sources';
import { CardEH } from '../event-handlers';
const DATASOURCE_MAP = {
    text: TextItemDS,
    table: TableItemDS,
    select: SelectItemDS,
    map: MapItemDS,
    'inner-title': InnerTitleItemDS,
    'data-widget': DataWidgetItemDS,
    'apex-bar-chart': ApexChartItemDS,
    'apex-line-chart': ApexChartItemDS,
    'apex-pie-chart': ApexChartItemDS,
    'apex-radialbar-chart': ApexChartItemDS,
    'apex-radar-chart': ApexChartItemDS,
};
export class CardLoader {
    constructor(layout, config) {
        this.layout = layout;
        this.config = config;
        this.itemsInitialized = false;
        this.addLayoutWidgets();
    }
    getCards() {
        const { cards } = this.config;
        const cardsWithWidgets = [];
        // initialize items
        if (cards && !this.itemsInitialized) {
            const { widgets } = this.layout.lb;
            this.itemsInitialized = true;
            cards.forEach(({ header, content, footer }, index) => {
                const cardWidgets = {};
                const cardSections = content.sections
                    .concat((header === null || header === void 0 ? void 0 : header.sections) || [])
                    .concat((footer === null || footer === void 0 ? void 0 : footer.sections) || []);
                cardSections.forEach(({ items }) => {
                    items.forEach(({ id, type: itemType, initialData }) => {
                        const { ds } = widgets[id];
                        const { eh } = widgets[id];
                        ds.id = id;
                        ds.type = itemType;
                        const emit = (type, payload) => eh.emitInner(type, payload);
                        cardWidgets[id] = { ds, emit };
                        // with initialData
                        if (initialData) {
                            ds.update(initialData);
                        }
                    });
                });
                // add widgets to card
                cardsWithWidgets[index] = Object.assign(Object.assign({}, cards[index]), { widgets: cardWidgets });
            });
        }
        return cardsWithWidgets;
    }
    addLayoutWidgets() {
        const { cards } = this.config;
        if (cards) {
            this.layout.widgets = this.layout.widgets || [];
            cards.forEach(({ header, content, footer }) => {
                const cardSections = content.sections
                    .concat((header === null || header === void 0 ? void 0 : header.sections) || [])
                    .concat((footer === null || footer === void 0 ? void 0 : footer.sections) || []);
                cardSections.forEach(({ items }) => {
                    items.forEach(({ id, type, options }) => {
                        this.layout.widgets.push({
                            id,
                            options,
                            dataSource: DATASOURCE_MAP[type],
                            eventHandler: CardEH
                        });
                    });
                });
            });
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyZC1sb2FkZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AbjctZnJvbnRlbmQvYm9pbGVycGxhdGUvIiwic291cmNlcyI6WyJsaWIvZGF0YS12aXovbW9kZWxzL2NhcmQtbG9hZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFDTCxVQUFVLEVBQ1YsZ0JBQWdCLEVBQ2hCLGVBQWUsRUFDZixXQUFXLEVBQ1gsZ0JBQWdCLEVBQ2hCLFlBQVksRUFDWixTQUFTLEdBQ1YsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFM0MsTUFBTSxjQUFjLEdBQUc7SUFDckIsSUFBSSxFQUFFLFVBQVU7SUFDaEIsS0FBSyxFQUFFLFdBQVc7SUFDbEIsTUFBTSxFQUFFLFlBQVk7SUFDcEIsR0FBRyxFQUFFLFNBQVM7SUFDZCxhQUFhLEVBQUUsZ0JBQWdCO0lBQy9CLGFBQWEsRUFBRSxnQkFBZ0I7SUFDL0IsZ0JBQWdCLEVBQUUsZUFBZTtJQUNqQyxpQkFBaUIsRUFBRSxlQUFlO0lBQ2xDLGdCQUFnQixFQUFFLGVBQWU7SUFDakMsc0JBQXNCLEVBQUUsZUFBZTtJQUN2QyxrQkFBa0IsRUFBRSxlQUFlO0NBQ3BDLENBQUM7QUFFRixNQUFNLE9BQU8sVUFBVTtJQUdyQixZQUNVLE1BQVcsRUFDWCxNQUVQO1FBSE8sV0FBTSxHQUFOLE1BQU0sQ0FBSztRQUNYLFdBQU0sR0FBTixNQUFNLENBRWI7UUFOSyxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFRL0IsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVNLFFBQVE7UUFDYixNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUM5QixNQUFNLGdCQUFnQixHQUFHLEVBQTJCLENBQUM7UUFDckQsbUJBQW1CO1FBQ25CLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixF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QUFFOzRCQUNGLE9BQU87NEJBQ1AsVUFBVSxFQUFFLGNBQWMsQ0FBQyxJQUFJLENBQUM7NEJBQ2hDLFlBQVksRUFBRSxNQUFNO3lCQUNyQixDQUFDLENBQUM7b0JBQ0wsQ0FBQyxDQUFDLENBQUM7Z0JBQ0wsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2FyZERhdGEsIENhcmREYXRhV2l0aFdpZGdldHMgfSBmcm9tICcuLi90eXBlcy9jYXJkLnR5cGVzJztcclxuaW1wb3J0IHtcclxuICBUZXh0SXRlbURTLFxyXG4gIERhdGFXaWRnZXRJdGVtRFMsXHJcbiAgQXBleENoYXJ0SXRlbURTLFxyXG4gIFRhYmxlSXRlbURTLFxyXG4gIElubmVyVGl0bGVJdGVtRFMsXHJcbiAgU2VsZWN0SXRlbURTLFxyXG4gIE1hcEl0ZW1EUyxcclxufSBmcm9tICcuLi9kYXRhLXNvdXJjZXMnO1xyXG5pbXBvcnQgeyBDYXJkRUggfSBmcm9tICcuLi9ldmVudC1oYW5kbGVycyc7XHJcblxyXG5jb25zdCBEQVRBU09VUkNFX01BUCA9IHtcclxuICB0ZXh0OiBUZXh0SXRlbURTLFxyXG4gIHRhYmxlOiBUYWJsZUl0ZW1EUyxcclxuICBzZWxlY3Q6IFNlbGVjdEl0ZW1EUyxcclxuICBtYXA6IE1hcEl0ZW1EUyxcclxuICAnaW5uZXItdGl0bGUnOiBJbm5lclRpdGxlSXRlbURTLFxyXG4gICdkYXRhLXdpZGdldCc6IERhdGFXaWRnZXRJdGVtRFMsXHJcbiAgJ2FwZXgtYmFyLWNoYXJ0JzogQXBleENoYXJ0SXRlbURTLFxyXG4gICdhcGV4LWxpbmUtY2hhcnQnOiBBcGV4Q2hhcnRJdGVtRFMsXHJcbiAgJ2FwZXgtcGllLWNoYXJ0JzogQXBleENoYXJ0SXRlbURTLFxyXG4gICdhcGV4LXJhZGlhbGJhci1jaGFydCc6IEFwZXhDaGFydEl0ZW1EUyxcclxuICAnYXBleC1yYWRhci1jaGFydCc6IEFwZXhDaGFydEl0ZW1EUyxcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBDYXJkTG9hZGVyIHtcclxuICBwcml2YXRlIGl0ZW1zSW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGxheW91dDogYW55LFxyXG4gICAgcHJpdmF0ZSBjb25maWc6IHtcclxuICAgICAgY2FyZHM6IENhcmREYXRhW107XHJcbiAgICB9XHJcbiAgKSB7XHJcbiAgICB0aGlzLmFkZExheW91dFdpZGdldHMoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDYXJkcygpOiBDYXJkRGF0YVdpdGhXaWRnZXRzW10ge1xyXG4gICAgY29uc3QgeyBjYXJkcyB9ID0gdGhpcy5jb25maWc7XHJcbiAgICBjb25zdCBjYXJkc1dpdGhXaWRnZXRzID0gW10gYXMgQ2FyZERhdGFXaXRoV2lkZ2V0c1tdO1xyXG4gICAgLy8gaW5pdGlhbGl6ZSBpdGVtc1xyXG4gICAgaWYgKGNhcmRzICYmICF0aGlzLml0ZW1zSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgY29uc3QgeyB3aWRnZXRzIH0gPSB0aGlzLmxheW91dC5sYjtcclxuICAgICAgdGhpcy5pdGVtc0luaXRpYWxpemVkID0gdHJ1ZTtcclxuICAgICAgY2FyZHMuZm9yRWFjaCgoeyBoZWFkZXIsIGNvbnRlbnQsIGZvb3RlciB9LCBpbmRleCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNhcmRXaWRnZXRzID0ge307XHJcbiAgICAgICAgY29uc3QgY2FyZFNlY3Rpb25zID0gY29udGVudC5zZWN0aW9uc1xyXG4gICAgICAgICAgLmNvbmNhdChoZWFkZXI/LnNlY3Rpb25zIHx8IFtdKVxyXG4gICAgICAgICAgLmNvbmNhdChmb290ZXI/LnNlY3Rpb25zIHx8IFtdKTtcclxuXHJcbiAgICAgICAgY2FyZFNlY3Rpb25zLmZvckVhY2goKHsgaXRlbXMgfSkgPT4ge1xyXG4gICAgICAgICAgaXRlbXMuZm9yRWFjaCgoeyBpZCwgdHlwZTogaXRlbVR5cGUsIGluaXRpYWxEYXRhIH0pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeyBkcyB9ID0gd2lkZ2V0c1tpZF07XHJcbiAgICAgICAgICAgIGNvbnN0IHsgZWggfSA9IHdpZGdldHNbaWRdO1xyXG4gICAgICAgICAgICBkcy5pZCA9IGlkO1xyXG4gICAgICAgICAgICBkcy50eXBlID0gaXRlbVR5cGU7XHJcbiAgICAgICAgICAgIGNvbnN0IGVtaXQgPSAodHlwZTogc3RyaW5nLCBwYXlsb2FkPzogYW55KSA9PiBlaC5lbWl0SW5uZXIodHlwZSwgcGF5bG9hZCk7XHJcbiAgICAgICAgICAgIGNhcmRXaWRnZXRzW2lkXSA9IHsgZHMsIGVtaXQgfTtcclxuICAgICAgICAgICAgLy8gd2l0aCBpbml0aWFsRGF0YVxyXG4gICAgICAgICAgICBpZiAoaW5pdGlhbERhdGEpIHtcclxuICAgICAgICAgICAgICBkcy51cGRhdGUoaW5pdGlhbERhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gYWRkIHdpZGdldHMgdG8gY2FyZFxyXG4gICAgICAgIGNhcmRzV2l0aFdpZGdldHNbaW5kZXhdID0ge1xyXG4gICAgICAgICAgLi4uY2FyZHNbaW5kZXhdLFxyXG4gICAgICAgICAgd2lkZ2V0czogY2FyZFdpZGdldHNcclxuICAgICAgICB9O1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gY2FyZHNXaXRoV2lkZ2V0cztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYWRkTGF5b3V0V2lkZ2V0cygpIHtcclxuICAgIGNvbnN0IHsgY2FyZHMgfSA9IHRoaXMuY29uZmlnO1xyXG4gICAgaWYgKGNhcmRzKSB7XHJcbiAgICAgIHRoaXMubGF5b3V0LndpZGdldHMgPSB0aGlzLmxheW91dC53aWRnZXRzIHx8IFtdO1xyXG4gICAgICBjYXJkcy5mb3JFYWNoKCh7IGhlYWRlciwgY29udGVudCwgZm9vdGVyIH0pID0+IHtcclxuICAgICAgICBjb25zdCBjYXJkU2VjdGlvbnMgPSBjb250ZW50LnNlY3Rpb25zXHJcbiAgICAgICAgICAuY29uY2F0KGhlYWRlcj8uc2VjdGlvbnMgfHwgW10pXHJcbiAgICAgICAgICAuY29uY2F0KGZvb3Rlcj8uc2VjdGlvbnMgfHwgW10pO1xyXG5cclxuICAgICAgICBjYXJkU2VjdGlvbnMuZm9yRWFjaCgoeyBpdGVtcyB9KSA9PiB7XHJcbiAgICAgICAgICBpdGVtcy5mb3JFYWNoKCh7XHJcbiAgICAgICAgICAgIGlkLCB0eXBlLCBvcHRpb25zXHJcbiAgICAgICAgICB9KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubGF5b3V0LndpZGdldHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgaWQsXHJcbiAgICAgICAgICAgICAgb3B0aW9ucyxcclxuICAgICAgICAgICAgICBkYXRhU291cmNlOiBEQVRBU09VUkNFX01BUFt0eXBlXSxcclxuICAgICAgICAgICAgICBldmVudEhhbmRsZXI6IENhcmRFSFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19