import { DataSource } from '@n7-frontend/core';
export class MrImageViewerToolsDS extends DataSource {
    transform(data) {
        if (!data)
            return null;
        const { thumbs } = data;
        const images = data.images.map(({ caption }, thumbindex) => ({
            caption,
            thumb: thumbs[thumbindex],
            payload: { thumbindex }
        }));
        return {
            images,
            classes: '',
            navigation: data.images.length > 7 ? {
                prev: {
                    payload: 'prev',
                    classes: 'n7-image-viewer-tools__thumbs-scroll-left'
                },
                next: {
                    payload: 'next',
                    classes: 'n7-image-viewer-tools__thumbs-scroll-right'
                },
            } : null,
            controls: {
                description: images[0].caption ? {
                    icon: 'n7-icon-info1',
                    anchor: { payload: 'toggle-description' },
                    isActive: false,
                } : null,
                thumbs: {
                    icon: 'n7-icon-images',
                    anchor: { payload: 'toggle-thumbs' },
                    isActive: false,
                },
                closedescription: {
                    icon: 'n7-icon-close-circle',
                    anchor: { payload: 'close-description' }
                }
            },
            isVisible: {
                description: false,
                thumbnails: false,
            },
            description: images[0].caption,
            initial: 0
        };
    }
    toggleDescription() {
        this.output.isVisible.description = !this.output.isVisible.description;
        this.output.isVisible.thumbnails = false;
        this.output.controls.description.isActive = !this.output.controls.description.isActive;
        this.output.controls.thumbs.isActive = false;
    }
    toggleThumbs() {
        this.output.isVisible.thumbnails = !this.output.isVisible.thumbnails;
        this.output.isVisible.description = false;
        this.output.controls.thumbs.isActive = !this.output.controls.thumbs.isActive;
        if (this.output.controls.description) {
            this.output.controls.description.isActive = false;
        }
    }
    handleThumbs(index) {
        this.output.initial = index;
        this.updateDescription();
    }
    //
    scrollRight() {
        const thumbsStrip = document.querySelectorAll('div.n7-image-viewer-tools__thumbs-strip')[0];
        const rightArrow = document.querySelectorAll(`div.${this.output.navigation.next.classes}`)[0];
        const leftArrow = document.querySelectorAll(`div.${this.output.navigation.prev.classes}`)[0];
        const maxStrip = thumbsStrip.scrollWidth - thumbsStrip.clientWidth;
        const { scrollLeft } = thumbsStrip;
        if ((scrollLeft + 400) >= maxStrip) { // mettere value da config e.g. scrollStrength
            thumbsStrip.scrollBy({
                top: 0,
                left: +400,
                behavior: 'smooth'
            });
            rightArrow.style.opacity = '0.5';
        }
        else {
            thumbsStrip.scrollBy({
                top: 0,
                left: +400,
                behavior: 'smooth'
            });
        }
        if (((scrollLeft + 400) > 0)) {
            leftArrow.style.opacity = '1.0';
        }
    }
    scrollLeft() {
        const thumbsStrip = document.querySelectorAll('div.n7-image-viewer-tools__thumbs-strip')[0];
        const rightArrow = document.querySelectorAll(`div.${this.output.navigation.next.classes}`)[0];
        const leftArrow = document.querySelectorAll(`div.${this.output.navigation.prev.classes}`)[0];
        const maxStrip = thumbsStrip.scrollWidth - thumbsStrip.clientWidth;
        const { scrollLeft } = thumbsStrip;
        if ((scrollLeft - 400) <= 0) { // mettere value da config e.g. scrollStrength
            thumbsStrip.scrollBy({
                top: 0,
                left: -400,
                behavior: 'smooth'
            });
            leftArrow.style.opacity = '0.5';
        }
        else {
            thumbsStrip.scrollBy({
                top: 0,
                left: -400,
                behavior: 'smooth'
            });
        }
        if (((scrollLeft - 400) < maxStrip)) {
            rightArrow.style.opacity = '1.0';
        }
    }
    //
    handlePageChange(payload) {
        this.handleThumbs(payload.page);
    }
    updateDescription() {
        const index = this.output.initial;
        const { images } = this.output;
        this.output.description = images[index].caption;
        if (!this.output.description) {
            this.output.controls.description = null;
        }
        else {
            this.output.controls.description = {
                icon: 'n7-icon-info1',
                anchor: { payload: 'toggle-description' }
            };
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2Utdmlld2VyLXRvb2xzLmRzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQG43LWZyb250ZW5kL2JvaWxlcnBsYXRlLyIsInNvdXJjZXMiOlsibGliL211cnVjYS9kYXRhLXNvdXJjZXMvaW1hZ2Utdmlld2VyLXRvb2xzLmRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQVcvQyxNQUFNLE9BQU8sb0JBQXFCLFNBQVEsVUFBVTtJQUd4QyxTQUFTLENBQUMsSUFBeUI7UUFDM0MsSUFBSSxDQUFDLElBQUk7WUFBRSxPQUFPLElBQUksQ0FBQztRQUV2QixNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsRUFBRSxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDM0QsT0FBTztZQUNQLEtBQUssRUFBRSxNQUFNLENBQUMsVUFBVSxDQUFDO1lBQ3pCLE9BQU8sRUFBRSxFQUFFLFVBQVUsRUFBRTtTQUN4QixDQUFDLENBQUMsQ0FBQztRQUVKLE9BQU87WUFDTCxNQUFNO1lBQ04sT0FBTyxFQUFFLEVBQUU7WUFDWCxVQUFVLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbkMsSUFBSSxFQUFFO29CQUNKLE9BQU8sRUFBRSxNQUFNO29CQUNmLE9BQU8sRUFBRSwyQ0FBMkM7aUJBQ3JEO2dCQUNELElBQUksRUFBRTtvQkFDSixPQUFPLEVBQUUsTUFBTTtvQkFDZixPQUFPLEVBQUUsNENBQTRDO2lCQUN0RDthQUNGLENBQUMsQ0FBQyxDQUFDLElBQUk7WUFDUixRQUFRLEVBQUU7Z0JBQ1IsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO29C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Q3JCLE1BQU0sRUFBRSxFQUFFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRTthQUMxQyxDQUFDO1NBQ0g7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbWFnZVZpZXdlclRvb2xzRGF0YSB9IGZyb20gJ0BuNy1mcm9udGVuZC9jb21wb25lbnRzJztcbmltcG9ydCB7IERhdGFTb3VyY2UgfSBmcm9tICdAbjctZnJvbnRlbmQvY29yZSc7XG5cbnR5cGUgSW1hZ2VWaWV3ZXJSZXNwb25zZSA9IHtcbiAgdGh1bWJzOiBzdHJpbmdbXTtcbiAgaW1hZ2VzOiB7XG4gICAgdXJsOiBzdHJpbmc7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIGNhcHRpb24/OiBzdHJpbmc7XG4gIH1bXTtcbn07XG5cbmV4cG9ydCBjbGFzcyBNckltYWdlVmlld2VyVG9vbHNEUyBleHRlbmRzIERhdGFTb3VyY2Uge1xuICBpZDogc3RyaW5nO1xuXG4gIHByb3RlY3RlZCB0cmFuc2Zvcm0oZGF0YTogSW1hZ2VWaWV3ZXJSZXNwb25zZSk6IEltYWdlVmlld2VyVG9vbHNEYXRhIHtcbiAgICBpZiAoIWRhdGEpIHJldHVybiBudWxsO1xuXG4gICAgY29uc3QgeyB0aHVtYnMgfSA9IGRhdGE7XG4gICAgY29uc3QgaW1hZ2VzID0gZGF0YS5pbWFnZXMubWFwKCh7IGNhcHRpb24gfSwgdGh1bWJpbmRleCkgPT4gKHtcbiAgICAgIGNhcHRpb24sXG4gICAgICB0aHVtYjogdGh1bWJzW3RodW1iaW5kZXhdLFxuICAgICAgcGF5bG9hZDogeyB0aHVtYmluZGV4IH1cbiAgICB9KSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaW1hZ2VzLFxuICAgICAgY2xhc3NlczogJycsXG4gICAgICBuYXZpZ2F0aW9uOiBkYXRhLmltYWdlcy5sZW5ndGggPiA3ID8ge1xuICAgICAgICBwcmV2OiB7XG4gICAgICAgICAgcGF5bG9hZDogJ3ByZXYnLFxuICAgICAgICAgIGNsYXNzZXM6ICduNy1pbWFnZS12aWV3ZXItdG9vbHNfX3RodW1icy1zY3JvbGwtbGVmdCdcbiAgICAgICAgfSxcbiAgICAgICAgbmV4dDoge1xuICAgICAgICAgIHBheWxvYWQ6ICduZXh0JywgLy8gJ25leHQnXG4gICAgICAgICAgY2xhc3NlczogJ243LWltYWdlLXZpZXdlci10b29sc19fdGh1bWJzLXNjcm9sbC1yaWdodCdcbiAgICAgICAgfSxcbiAgICAgIH0gOiBudWxsLFxuICAgICAgY29udHJvbHM6IHtcbiAgICAgICAgZGVzY3JpcHRpb246IGltYWdlc1swXS5jYXB0aW9uID8ge1xuICAgICAgICAgIGljb246ICduNy1pY29uLWluZm8xJyxcbiAgICAgICAgICBhbmNob3I6IHsgcGF5bG9hZDogJ3RvZ2dsZS1kZXNjcmlwdGlvbicgfSxcbiAgICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICAgIH0gOiBudWxsLFxuICAgICAgICB0aHVtYnM6IHtcbiAgICAgICAgICBpY29uOiAnbjctaWNvbi1pbWFnZXMnLFxuICAgICAgICAgIGFuY2hvcjogeyBwYXlsb2FkOiAndG9nZ2xlLXRodW1icycgfSxcbiAgICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICAgIGNsb3NlZGVzY3JpcHRpb246IHtcbiAgICAgICAgICBpY29uOiAnbjctaWNvbi1jbG9zZS1jaXJjbGUnLFxuICAgICAgICAgIGFuY2hvcjogeyBwYXlsb2FkOiAnY2xvc2UtZGVzY3JpcHRpb24nIH1cbiAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgaXNWaXNpYmxlOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBmYWxzZSxcbiAgICAgICAgdGh1bWJuYWlsczogZmFsc2UsXG4gICAgICB9LFxuICAgICAgZGVzY3JpcHRpb246IGltYWdlc1swXS5jYXB0aW9uLFxuICAgICAgaW5pdGlhbDogMFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgdG9nZ2xlRGVzY3JpcHRpb24oKSB7XG4gICAgdGhpcy5vdXRwdXQuaXNWaXNpYmxlLmRlc2NyaXB0aW9uID0gIXRoaXMub3V0cHV0LmlzVmlzaWJsZS5kZXNjcmlwdGlvbjtcbiAgICB0aGlzLm91dHB1dC5pc1Zpc2libGUudGh1bWJuYWlscyA9IGZhbHNlO1xuICAgIHRoaXMub3V0cHV0LmNvbnRyb2xzLmRlc2NyaXB0aW9uLmlzQWN0aXZlID0gIXRoaXMub3V0cHV0LmNvbnRyb2xzLmRlc2NyaXB0aW9uLmlzQWN0aXZlO1xuICAgIHRoaXMub3V0cHV0LmNvbnRyb2xzLnRodW1icy5pc0FjdGl2ZSA9IGZhbHNlO1xuICB9XG5cbiAgcHVibGljIHRvZ2dsZVRodW1icygpIHtcbiAgICB0aGlzLm91dHB1dC5pc1Zpc2libGUudGh1bWJuYWlscyA9ICF0aGlzLm91dHB1dC5pc1Zpc2libGUudGh1bWJuYWlscztcbiAgICB0aGlzLm91dHB1dC5pc1Zpc2libGUuZGVzY3JpcHRpb24gPSBmYWxzZTtcbiAgICB0aGlzLm91dHB1dC5jb250cm9scy50aHVtYnMuaXNBY3RpdmUgPSAhdGhpcy5vdXRwdXQuY29udHJvbHMudGh1bWJzLmlzQWN0aXZlO1xuICAgIGlmICh0aGlzLm91dHB1dC5jb250cm9scy5kZXNjcmlwdGlvbikge1xuICAgICAgdGhpcy5vdXRwdXQuY29udHJvbHMuZGVzY3JpcHRpb24uaXNBY3RpdmUgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlVGh1bWJzKGluZGV4KSB7XG4gICAgdGhpcy5vdXRwdXQuaW5pdGlhbCA9IGluZGV4O1xuICAgIHRoaXMudXBkYXRlRGVzY3JpcHRpb24oKTtcbiAgfVxuXG4gIC8vXG5cbiAgcHVibGljIHNjcm9sbFJpZ2h0KCkge1xuICAgIGNvbnN0IHRodW1ic1N0cmlwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbDxIVE1MRWxlbWVudD4oJ2Rpdi5uNy1pbWFnZS12aWV3ZXItdG9vbHNfX3RodW1icy1zdHJpcCcpWzBdO1xuICAgIGNvbnN0IHJpZ2h0QXJyb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PihgZGl2LiR7dGhpcy5vdXRwdXQubmF2aWdhdGlvbi5uZXh0LmNsYXNzZXN9YClbMF07XG4gICAgY29uc3QgbGVmdEFycm93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbDxIVE1MRWxlbWVudD4oYGRpdi4ke3RoaXMub3V0cHV0Lm5hdmlnYXRpb24ucHJldi5jbGFzc2VzfWApWzBdO1xuICAgIGNvbnN0IG1heFN0cmlwID0gdGh1bWJzU3RyaXAuc2Nyb2xsV2lkdGggLSB0aHVtYnNTdHJpcC5jbGllbnRXaWR0aDtcbiAgICBjb25zdCB7IHNjcm9sbExlZnQgfSA9IHRodW1ic1N0cmlwO1xuXG4gICAgaWYgKChzY3JvbGxMZWZ0ICsgNDAwKSA+PSBtYXhTdHJpcCkgeyAvLyBtZXR0ZXJlIHZhbHVlIGRhIGNvbmZpZyBlLmcuIHNjcm9sbFN0cmVuZ3RoXG4gICAgICB0aHVtYnNTdHJpcC5zY3JvbGxCeSh7XG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogKzQwMCxcbiAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnXG4gICAgICB9KTtcbiAgICAgIHJpZ2h0QXJyb3cuc3R5bGUub3BhY2l0eSA9ICcwLjUnO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHVtYnNTdHJpcC5zY3JvbGxCeSh7XG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogKzQwMCxcbiAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoKChzY3JvbGxMZWZ0ICsgNDAwKSA+IDApKSB7XG4gICAgICBsZWZ0QXJyb3cuc3R5bGUub3BhY2l0eSA9ICcxLjAnO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzY3JvbGxMZWZ0KCkge1xuICAgIGNvbnN0IHRodW1ic1N0cmlwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbDxIVE1MRWxlbWVudD4oJ2Rpdi5uNy1pbWFnZS12aWV3ZXItdG9vbHNfX3RodW1icy1zdHJpcCcpWzBdO1xuICAgIGNvbnN0IHJpZ2h0QXJyb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PihgZGl2LiR7dGhpcy5vdXRwdXQubmF2aWdhdGlvbi5uZXh0LmNsYXNzZXN9YClbMF07XG4gICAgY29uc3QgbGVmdEFycm93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbDxIVE1MRWxlbWVudD4oYGRpdi4ke3RoaXMub3V0cHV0Lm5hdmlnYXRpb24ucHJldi5jbGFzc2VzfWApWzBdO1xuICAgIGNvbnN0IG1heFN0cmlwID0gdGh1bWJzU3RyaXAuc2Nyb2xsV2lkdGggLSB0aHVtYnNTdHJpcC5jbGllbnRXaWR0aDtcbiAgICBjb25zdCB7IHNjcm9sbExlZnQgfSA9IHRodW1ic1N0cmlwO1xuXG4gICAgaWYgKChzY3JvbGxMZWZ0IC0gNDAwKSA8PSAwKSB7IC8vIG1ldHRlcmUgdmFsdWUgZGEgY29uZmlnIGUuZy4gc2Nyb2xsU3RyZW5ndGhcbiAgICAgIHRodW1ic1N0cmlwLnNjcm9sbEJ5KHtcbiAgICAgICAgdG9wOiAwLFxuICAgICAgICBsZWZ0OiAtNDAwLFxuICAgICAgICBiZWhhdmlvcjogJ3Ntb290aCdcbiAgICAgIH0pO1xuICAgICAgbGVmdEFycm93LnN0eWxlLm9wYWNpdHkgPSAnMC41JztcbiAgICB9IGVsc2Uge1xuICAgICAgdGh1bWJzU3RyaXAuc2Nyb2xsQnkoe1xuICAgICAgICB0b3A6IDAsXG4gICAgICAgIGxlZnQ6IC00MDAsXG4gICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKCgoc2Nyb2xsTGVmdCAtIDQwMCkgPCBtYXhTdHJpcCkpIHtcbiAgICAgIHJpZ2h0QXJyb3cuc3R5bGUub3BhY2l0eSA9ICcxLjAnO1xuICAgIH1cbiAgfVxuXG4gIC8vXG5cbiAgcHVibGljIGhhbmRsZVBhZ2VDaGFuZ2UocGF5bG9hZCkge1xuICAgIHRoaXMuaGFuZGxlVGh1bWJzKHBheWxvYWQucGFnZSk7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlRGVzY3JpcHRpb24oKSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLm91dHB1dC5pbml0aWFsO1xuICAgIGNvbnN0IHsgaW1hZ2VzIH0gPSB0aGlzLm91dHB1dDtcbiAgICB0aGlzLm91dHB1dC5kZXNjcmlwdGlvbiA9IGltYWdlc1tpbmRleF0uY2FwdGlvbjtcbiAgICBpZiAoIXRoaXMub3V0cHV0LmRlc2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLm91dHB1dC5jb250cm9scy5kZXNjcmlwdGlvbiA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub3V0cHV0LmNvbnRyb2xzLmRlc2NyaXB0aW9uID0ge1xuICAgICAgICBpY29uOiAnbjctaWNvbi1pbmZvMScsXG4gICAgICAgIGFuY2hvcjogeyBwYXlsb2FkOiAndG9nZ2xlLWRlc2NyaXB0aW9uJyB9XG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuIl19