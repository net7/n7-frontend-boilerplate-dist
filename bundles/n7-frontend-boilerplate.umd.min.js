!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("@n7-frontend/components"),require("rxjs"),require("rxjs/operators"),require("@angular/router"),require("@angular/platform-browser"),require("@n7-frontend/core"),require("tippy.js"),require("lodash"),require("slugify"),require("ngx-extended-pdf-viewer"),require("leaflet"),require("moment"),require("leaflet.markercluster")):"function"==typeof define&&define.amd?define("@n7-frontend/boilerplate",["exports","@angular/core","@angular/common","@angular/common/http","@n7-frontend/components","rxjs","rxjs/operators","@angular/router","@angular/platform-browser","@n7-frontend/core","tippy.js","lodash","slugify","ngx-extended-pdf-viewer","leaflet","moment","leaflet.markercluster"],e):e(((t=t||self)["n7-frontend"]=t["n7-frontend"]||{},t["n7-frontend"].boilerplate={}),t.ng.core,t.ng.common,t.ng.common.http,t.components,t.rxjs,t.rxjs.operators,t.ng.router,t.ng.platformBrowser,t.core$1,t.tippy,t.lodash,t.slugify,t.ngxExtendedPdfViewer,t.leaflet,t.moment)}(this,(function(t,e,n,a,i,r,o,s,c,l,u,d,p,h,f,g){"use strict";var m="default"in u?u.default:u;p=p&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function v(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var b=function(){return(b=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function w(t,e,n,a){var i,r=arguments.length,o=r<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,a);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function S(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function _(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var a,i,r=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(a=r.next()).done;)o.push(a.value)}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return o}function k(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(_(arguments[e]));return t}var I,E=function(){function t(){var t=this;this.defaults={},this.get=function(e){return t.defaults[e]},this.set=function(e,n){t.defaults[e]=n}}return t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"})],t)}(),x=function(){function t(t){var e=this;this.config=t,this.defaults={},this.get=function(t){return e.defaults[t]},this.set=function(t,n){e.defaults[t]=n},this.config.layouts&&Object.keys(this.config.layouts).forEach((function(t){e.set(t,e.config.layouts[t])}))}var n,a;return t.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:["config"]}]}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject("config"))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),(n=0,a=e.Inject("config"),function(t,e){a(t,e,n)}),S("design:paramtypes",[Object])],t)}(),C=function(){function t(){var t=this;this.custom={},this.default={headTitle:new r.ReplaySubject,pageTitle:new r.ReplaySubject,subnav:new r.ReplaySubject,breadcrumbs:new r.ReplaySubject,filters:new r.ReplaySubject,header:new r.ReplaySubject},this.get$=function(e){return t._get("default",e)},this.getCustom$=function(e){return t._get("custom",e)},this.update=function(e,n){return t._update("default",e,n)},this.updateCustom=function(e,n){return t._update("custom",e,n)},this.has=function(e){return!!t.default[e]},this.hasCustom=function(e){return!!t.custom[e]}}return t.prototype.addCustom=function(t,e){if(this.custom[t])throw Error("custom stream "+t+" exists!");this.custom[t]=e},t.prototype._update=function(t,e,n){if(!this[t])throw Error(t+" stream group does not exists!");if(!this[t][e])throw Error(t+" stream "+e+" does not exists!");this[t][e].next(n)},t.prototype._get=function(t,e){if(!this[t])throw Error(t+" stream group does not exists!");if(!this[t][e])throw Error(t+" stream "+e+" does not exists!");return this[t][e]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"})],t)}(),D=function(){function t(t,e){this.http=t,this.configuration=e}return t.prototype.request$=function(t,e,n){var a,i=n.params,r=n.method,s=n.httpOptions,c=this.configuration.get("treeDepth")||15,l=t.config?t.config(c):{};l&&l[e]&&(a=l[e]);var u=(a=a||{}).queryName,d=a.queryBody;if(!u||!d)throw Error("No config found for requestId '"+e+"'");if(i){var p=this.makeParamsStr(i);d=d.replace("__PARAMS__",p)}else d=d.replace("(__PARAMS__)","");return(r&&"GET"===r?this.http.get(t.baseUrl):this.http.post(t.baseUrl,{query:d},s)).pipe(o.map((function(t){return t.data[u]})))},t.prototype.makeParamsStr=function(t){var e=this,n=[];return Object.keys(t).forEach((function(a){if(Array.isArray(t[a])){var i=[];t[a].forEach((function(t){if("object"==typeof t){var n=e.makeParamsStr(t);i.push("{ "+n+" }")}else"number"==typeof t||"boolean"==typeof t||null===t?i.push(""+t):i.push('"'+t+'"')})),n.push(a+": ["+i.join(",")+"]")}else if("object"==typeof t[a]&&t[a]){var r=e.makeParamsStr(t[a]);n.push(a+": { "+r+" }")}else"string"==typeof t[a]&&0===a.indexOf("$")?n.push(a.replace("$","")+": "+t[a]):"number"==typeof t[a]||"boolean"==typeof t[a]||null===t[a]?n.push(a+": "+t[a]):n.push(a+': "'+t[a]+'"')})),n.join(" ")},t.ctorParameters=function(){return[{type:a.HttpClient},{type:E}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(a.HttpClient),e.ɵɵinject(E))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),S("design:paramtypes",[a.HttpClient,E])],t)}(),O=function(){function t(t){this.http=t}return t.prototype.request$=function(t,e,n){void 0===n&&(n={});var a,i=n.params,r=n.httpOptions,o=n.urlParams,s=void 0===o?"":o,c=n.method;if(c||(c=t.defaultMethod||"GET"),t.config&&t.config[e]&&(a=t.config[e]),!a)throw Error('No config found for requestId "'+e+'"');if("POST"===c||"PUT"===c)return this.http[c.toLowerCase()](t.baseUrl+a+s,i,r);if("GET"===c||"DELETE"===c)return this.http[c.toLowerCase()](t.baseUrl+a+s,r);throw Error("Rest method "+c+" not supported")},t.ctorParameters=function(){return[{type:a.HttpClient}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(a.HttpClient))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),S("design:paramtypes",[a.HttpClient])],t)}(),T=function(){function t(t,e,n){this.config=t,this.apollo=e,this.rest=n;try{this.communicationConfig=this.config.get("communication"),this.defaultProvider=this.communicationConfig.defaultProvider}catch(t){throw Error("No communications.defaultProvider setted in config")}}return t.prototype.request$=function(t,e,n){var a=this;void 0===e&&(e={});var i=n||this.defaultProvider,r=this.communicationConfig.providers[i];if(!r)throw Error('There is no config for "'+i+'" provider');var s=r.type||i;if(!this[s])throw Error('There is no "'+s+'" provider type');var c=e.onError;return this[s].request$(r,t,e).pipe(o.catchError((function(t){return a.handleError(t,c)})))},t.prototype.handleError=function(t,e){return e?e(t):console.warn("No error handler for communication request",t),r.empty()},t.ctorParameters=function(){return[{type:E},{type:D},{type:O}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(E),e.ɵɵinject(D),e.ɵɵinject(O))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),S("design:paramtypes",[E,D,O])],t)}(),P=function(){function t(t){this.config=t,this.widgets=this.config.widgets,this.lb=new l.LayoutBuilder(this.config.layoutId)}return t.prototype.onInit=function(){var t=this;this.lb.ready$.subscribe((function(){t.lb.eventHandler.emitInner("init",t.initPayload())}));var e=this.config.layoutDS,n=this.config.layoutEH;this.lb.init({widgetsConfig:this.widgets,widgetsDataSources:this.config.widgetsDataSources,widgetsEventHandlers:this.config.widgetsEventHandlers,dataSource:new e,eventHandler:new n})},t.prototype.onDestroy=function(){this.lb.eventHandler.emitInner("destroy")},t}(),R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.onInit=function(t){var e=this,n=t.configuration,a=t.mainState,i=t.router,r=t.options,o=t.titleService,s=t.route;this.configuration=n,this.mainState=a,this.router=i,this.route=s,this.titleService=o,this.options=r,this.configuration.get("header")&&this.one("header").update(this.configuration.get("header")),this.configuration.get("footer")&&this.one("footer").update(this.configuration.get("footer")),this.mainState.get$("headTitle").subscribe((function(t){e.titleService.setTitle(t)})),this.mainState.get$("pageTitle").subscribe((function(t){e.pageTitle=t})),this.mainState.get$("subnav").subscribe((function(t){e.one("subnav").update(t)})),this.mainState.get$("breadcrumbs").subscribe((function(t){e.one("breadcrumbs").update(t)})),this.mainState.get$("header").subscribe((function(t){e.one("header").update(t)}))},e.prototype.onNavigate=function(t){if("router"===t.handler){var e=t.path,n=t.queryParams;if(!e)throw Error("onNavigate: no path for router navigate");n?this.router.navigate(e,{relativeTo:this.route,queryParams:n,queryParamsHandling:"merge"}):this.router.navigate(e),this._onRouterNavigate()}},e.prototype.onRouterChanged=function(){u.hideAll()},e.prototype._onRouterNavigate=function(){u.hideAll()},e}(l.LayoutDataSource),$=function(){function t(e){var n=this;this.isEmpty=!1,this.update=function(){n.output=n.transform()},this.getId=function(){return n.id},this.getData=function(){return n.data},this.getConfig=function(){return n.config},this.getFacetId=function(){return n.config.facetId},this.getInputIndex=function(){return n.config.inputIndex},this.getSectionIndex=function(){return n.config.sectionIndex},this.getContext=function(){return n.config.filterConfig.context||"external"},this.getTarget=function(){return n.config.filterConfig.target||null},this.getSearchIn=function(){return n.config.filterConfig.searchIn||null},this.getType=function(){return n.config.type},this.getOutput=function(){return n.output},this.setIsEmpty=function(t){n.isEmpty=t},this.setData=function(t){n.data=t},this.config=e,this._setId(),t.index+=1}return t.prototype.clear=function(){return null},t.prototype._setId=function(){this.id="facet-input-"+this.getType()+"-"+t.index},t.index=0,t}(),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){var t=this,e=this.getFacetId();return this.data.map((function(n,a){var i=n.label,r=n.value;return{type:"checkbox",id:t.getId()+"-"+a,label:i,payload:{facetId:e,source:"input-checkbox",value:""+r},_meta:{facetId:e,value:""+r}}}))},e.prototype.setActive=function(t){var e=this.config.filterConfig.isArray;this.output.forEach((function(n){e&&Array.isArray(t)&&-1!==t.indexOf(n._meta.value)||t===n._meta.value?n.checked=!0:n.checked=!1}))},e}($),M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){var t=this,e=this.getFacetId(),n=[],a=0;this.data.forEach((function(i){var r=i.label,o=i.counter,s=i.hidden,c=i.value,l=i.options;if(!(s||(a+=1)>2e3)){var u=""+c,d=l||{},p=[];d.classes&&p.push(d.classes),t._isActive(t.facetValue,u)&&p.push("is-active"),"__loading__"===u&&p.push("loader-link"),n.push({type:"link",id:t.getId(),text:r,counter:o,payload:{facetId:e,source:"input-link",value:u},icon:d.icon||null,classes:p.join(" "),_meta:{facetId:e,value:u}})}}));var i=n.filter((function(t){return"empty"===t.id}))[0];if(this.isEmpty)if(i)i.classes="empty-text-link";else{var r=this.getConfig().emptyState.label;n.push({type:"link",id:"empty-link",text:r,classes:"empty-text-link",_meta:{facetId:"empty-link",value:null}})}else i&&(i.classes="empty-text-link is-hidden");return n},e.prototype.setActive=function(t){var e=this;this.output.forEach((function(n){var a=e._isActive(t,n._meta.value),i=n.classes?n.classes.split(" "):[];a?-1===i.indexOf("is-active")&&i.push("is-active"):i=i.filter((function(t){return"is-active"!==t})),n.classes=i.join(" ")}))},e.prototype._isActive=function(t,e){return this.facetValue=t,Array.isArray(t)&&-1!==t.indexOf(e)||t===e},e.prototype.clear=function(){this.facetValue=[]},e}($),H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){var t=this.getFacetId();return{type:"select",id:this.getId(),label:this.config.label,disabled:this.config.disabled,options:this.data?this.data.map((function(t){return{value:""+t.value,label:t.label}})):[],payload:{facetId:t,source:"input-select"},_meta:{facetId:t}}},e.prototype.setActive=function(t){this.output.options.filter((function(e){return e.value===t})).forEach((function(t){t.selected=!0}))},e}($),j=new DOMParser,F={prettifySnakeCase:function(t,e){var n=this;return"string"==typeof e?e:(t||"").split("_").map((function(t,e){return 0===e?n.ucFirst(t):t})).join(" ")},ucFirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},slugify:function(t){if(!t)return"";var e=j.parseFromString(t,"text/html").body.textContent||"";return e=e.replace(/\//g,"-"),p(e,{remove:/[*+~.()'"!:@,]/g,lower:!0})},browserIsIE:function(){return window.navigator.userAgent.match(/(MSIE|Trident)/)},escapeQuotes:function(t){return"string"!=typeof t?"":t.replace(/"/g,'\\\\\\"').replace(/'/g,"\\\\'")},unescapeQuotes:function(t){return"string"!=typeof t?"":t.replace(/\\\\\\"/g,'"').replace(/\\\\'/g,"'")},escapeDoubleQuotes:function(t){return t.search(/\\?(")([\w\s]+)\\?(")/g)>=0?t.replace(/\\?(")([\w\s]+)\\?(")/g,"\\$1$2\\$3"):t.replace(/\\([\s\S])|(")/g,"\\\\\\$1$2")},unescapeDoubleQuotes:function(t){return t&&""!==t?t.replace(/\\*(")/g,"$1"):t},striptags:function(t){return"string"!=typeof t?"":t.replace(/(<([^>]+)>)/gi,"")},isElementInViewport:function(t){if(!t)throw Error("There is no element");var e=t.getBoundingClientRect();return e.bottom>0&&e.right>0&&e.left<(window.innerWidth||document.documentElement.clientWidth)&&e.top<(window.innerHeight||document.documentElement.clientHeight)},isEmpty:function(t){return"object"==typeof t&&0===Object.keys(t).length}},q={checkbox:A,text:function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){var t=this.getFacetId(),e={facetId:t,source:"input-text"};return{type:"text",id:this.getId(),label:this.config.label,disabled:this.config.disabled,placeholder:this.config.placeholder,icon:this.config.icon,inputPayload:b(b({},e),{trigger:"input"}),enterPayload:b(b({},e),{trigger:"enter"}),iconPayload:b(b({},e),{trigger:"icon"}),_meta:{facetId:t}}},e.prototype.setActive=function(t){this.output.value=F.unescapeQuotes(t)||null},e}($),link:M,select:H},B={"=":"_filterDataEquals",">":"_filterDataGreaterThan","<":"_filterDataLessThan",">=":"_filterDataGreaterOrEquals","<=":"_filterDataLessOrEquals","<>":"_filterDataNotEqual",LIKE:"_filterDataLike"},N=function(){function t(e,n){var a=this;this._filters=[],this._facets=[],this._inputs=[],this._results$=new r.Subject,this.getId=function(){return a._id},this.getFilters=function(){return a._filters},this.getFacets=function(){return a._facets},this.getInputs=function(){return a._inputs},this.getConfig=function(){return a._config},this.getTotalCount=function(){return a._totalCount},this.getFields=function(){return a._config.fields},this.getResults$=function(){return a._results$},this.setResults=function(t){return a._results$.next(t)},this._id=e,this._config=n,this._setFilters(),this._setFacets(),this._setPage(),this._setInputs(),this._setInputsData(),this._setTotalCount(),t.queryParams&&(this.updateFiltersFromQueryParams(t.queryParams),t.queryParams=null)}return t.prototype.updateFilter=function(t,e,n){this.getFiltersByFacetId(t).forEach((function(t){Array.isArray(t.value)&&n?t.value=t.value.filter((function(t){return t!==e})):Array.isArray(t.value)&&-1===t.value.indexOf(e)?t.value.push(e):t.value=n?null:F.escapeQuotes(e)}))},t.prototype.clear=function(){this.updateFiltersFromQueryParams({},!0),this._clearInputs()},t.prototype.updateFiltersFromQueryParams=function(t,e){var n=this;void 0===e&&(e=!1),this._facets.forEach((function(a){var i=a.id,r=n.getFiltersByFacetId(i),o=t[i];"internal"===n.getInputByFacetId(i).getContext()&&!e||r.forEach((function(t){t.isArray?t.value=o?o.split(","):[]:t.value=o||null}))}))},t.prototype.updateInputsFromFilters=function(){var t=this;this._filters.forEach((function(e){var n=e.facetId,a=e.value;t.getInputByFacetId(n).setActive(a)}))},t.prototype.updateFacets=function(t){var e=this;t.forEach((function(t){var n=t.id,a=t.data;return e.updateFacet(n,a)})),this._setInputsData()},t.prototype.updateTotalCount=function(t){this._totalCount=t},t.prototype.updateFacet=function(t,e){var n=this._facets.filter((function(e){return e.id===t}));if(!n.length)throw Error("Facet with id '"+t+"' does not exists");n.forEach((function(t){t.data=e}))},t.prototype.reset=function(){this._filters.forEach((function(t){t.value=null}))},t.prototype.getRequestParams=function(){return{facets:this._getRequestFacets(),page:this._page,results:this._config.results,filters:this._filters.filter((function(t){return"internal"!==t.context})).map((function(t){var e=t.facetId,n=t.value,a=t.searchIn,i=t.pagination;return i?{facetId:e,value:n,searchIn:a,pagination:i}:{facetId:e,value:n,searchIn:a}}))}},t.prototype.getInternalFilters=function(){return this._filters.filter((function(t){return"internal"===t.context&&!d.isEmpty(t.value)})).map((function(t){return{facetId:t.facetId,value:t.value,searchIn:t.searchIn}}))},t.prototype.filtersAsQueryParams=function(t){var e={};return t.forEach((function(t){e[t.facetId]=Array.isArray(t.value)?t.value.join(","):t.value})),e},t.prototype.getFiltersByFacetId=function(t){return this._filters.filter((function(e){return e.facetId===t}))},t.prototype.getInputByFacetId=function(t){return this._inputs.filter((function(e){return e.getFacetId()===t}))[0]},t.prototype.setInputData=function(t,e){this.getInputByFacetId(t).setData(e)},t.prototype.filterTarget=function(t){var e=this,n=this._inputs.filter((function(e){return e.getTarget()===t})),a=this.getInputByFacetId(t),i=this._facets.filter((function(e){return e.id===t}))[0].data,r=[];if(n.forEach((function(t){var n=e.getFiltersByFacetId(t.getFacetId())[0],a=t.getSearchIn(),i=n.value;r.push([a,i])})),i.forEach((function(t){return e._filterData(r,t)})),a.setData(i),a.getConfig().emptyState){var o=!i.filter((function(t){return!t.hidden})).length;a.setIsEmpty(o)}a.update()},t.prototype.setSearchConfigOrderBy=function(t){this._config.results.order.key=t},t.prototype.setSearchConfigDirection=function(t){this._config.results.order.direction=t},t.prototype.setSearchConfigType=function(t){this._config.results.order.type=t},t.prototype.setPageConfigOffset=function(t){this._config.page.offset=t},t.prototype.setPageConfigLimit=function(t){this._config.page.limit=t},t.prototype._clearInputs=function(){},t.prototype._filterData=function(t,e){var n=this;e.hidden=!1,t.forEach((function(t){var a=_(t,2),i=a[0],r=a[1];i.forEach((function(t){var a=t.key,i=t.operator;if(!e.hidden){var o=d.get(e,a,null);if(-1!==a.indexOf("searchData")&&Array.isArray(e.searchData)){var s=a.replace("searchData.","");e.searchData.forEach((function(t){var e=t.key,n=t.value;e===s&&(o=n)}))}null===o?e.hidden=!0:B[i]?e.hidden=n[B[i]](r,o):console.warn("SearchIn: operator "+i+" not supported")}}))}))},t.prototype._filterDataEquals=function(t,e){if(Array.isArray(e)){if(Array.isArray(t)){var n=0===t.length;return e.forEach((function(e){-1!==t.indexOf(e)&&(n=!0)})),!n}return!(t&&-1!==e.indexOf(t))}return Array.isArray(t)?!(!t.length||-1!==t.indexOf(e)):!(t&&t===e)},t.prototype._filterDataGreaterThan=function(t,e){return!Array.isArray(t)&&!(t&&t>e)},t.prototype._filterDataLessThan=function(t,e){return!Array.isArray(t)&&!(t&&t<e)},t.prototype._filterDataGreaterOrEquals=function(t,e){return!Array.isArray(t)&&!(t&&t>=e)},t.prototype._filterDataLessOrEquals=function(t,e){return!Array.isArray(t)&&!(t&&t<=e)},t.prototype._filterDataNotEqual=function(t,e){return!Array.isArray(t)&&!(t&&t!==e)},t.prototype._filterDataLike=function(t,e){if(t&&"string"==typeof t&&"string"==typeof e){var n=e.toLowerCase(),a=t.toLocaleLowerCase();return!(-1!==n.indexOf(a))}return!1},t.prototype._setFilters=function(){var t=this;this._config.fields.forEach((function(e){e.inputs.forEach((function(e){return t._filters.push(b(b({},e.filterConfig),{facetId:e.facetId,value:e.filterConfig.isArray?[]:null}))}))}))},t.prototype._setFacets=function(){this._facets=this._config.facets},t.prototype._setPage=function(){this._page=this._config.page},t.prototype._setTotalCount=function(){this._totalCount=this._config.totalCount},t.prototype._setInputs=function(){var t=this;this._config.fields.forEach((function(e,n){e.inputs.forEach((function(e,a){var i=q[e.type];if(!i)throw Error("Input type "+e.type+" not supported");t._inputs.push(new i(b(b({},e),{inputIndex:a,sectionIndex:n})))}))}))},t.prototype._setInputsData=function(){var t=this;this._facets.forEach((function(e){return t.setInputData(e.id,e.data)}))},t.prototype._getRequestFacets=function(){var t=[];return this._facets.forEach((function(e){var n=b({},e);e.hasStaticData||delete n.data,delete n.hasStaticData,Array.isArray(n.data)&&n.data.filter((function(t){return void 0!==t.searchData})).forEach((function(t){delete t.searchData})),t.push(n)})),t},t.queryParams=null,t}(),V=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"main-layout.init":t.dataSource.onInit(a),t.mainState=a.mainState,t.route=a.route,t.router=a.router,t._listenRouterChanges(),t._listenMainStateChanges();break;case"main-layout.destroy":t.destroyed$.next()}})),l.EventHandler.globalEvents$.pipe(o.takeUntil(this.destroyed$)).subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"global.navigate":t.dataSource.onNavigate(a)}}))},e.prototype._listenRouterChanges=function(){var t=this;this.route.queryParams.pipe(o.filter((function(t){return!!Object.keys(t).length}))).subscribe((function(e){t.emitGlobal("queryparams",e),N.queryParams=e})),this.router.events.pipe(o.filter((function(t){return t instanceof s.NavigationStart}))).subscribe((function(){t.emitOuter("routerchange"),t.dataSource.onRouterChanged()}))},e.prototype._listenMainStateChanges=function(){var t=this;this.mainState.addCustom("currentNav",new r.Subject),this.mainState.getCustom$("currentNav").subscribe((function(e){t.emitOuter("currentnavchange",e)}))},e}(l.EventHandler),z="is-mobile-nav-displayed",U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t?b(b({},t),{menuToggle:{open:{payload:"mobile-open"},close:{payload:"mobile-close"}}}):null},e.prototype.onCurrentNavChange=function(t){var e=this;this.output.nav.items.forEach((function(n){e.updateItemClass(n,t),n.subnav&&n.subnav.forEach((function(n){e.updateItemClass(n,t)}))}))},e.prototype.onRouterChange=function(){if(this.output){var t=this.output.classes;(t=(t=t||"").split(" ")).includes(z)&&(t.splice(t.indexOf(z),1),this.output.classes=t.join(" "))}},e.prototype.onClick=function(t){if(["mobile-open","mobile-close"].includes(t)){var e=this.output.classes;(e=(e=e||"").split(" ")).includes(z)?e.splice(e.indexOf(z),1):e.push(z),this.output.classes=e.join(" ")}},e.prototype.updateItemClass=function(t,e){var n=[];t.classes&&(n=n.concat(t.classes.split(" "))),t._meta.id!==e||n.includes("is-active")?n.includes("is-active")&&n.splice(n.indexOf("is-active",1)):n.push("is-active"),t.classes=n.join(" ")},e}(l.DataSource),G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return{classes:"main-subnav",items:t}},e.prototype.setActive=function(t){this.output.items.forEach((function(e){e._meta.id===t?(e.classes="is-current",e._meta.isActive=!0):(e.classes="",e._meta.isActive=!1)}))},e.prototype.getActive=function(){return this.output.items.filter((function(t){return t._meta.isActive}))[0]||null},e}(l.DataSource),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=t.fields,n=this.options.searchModel;return this.searchModel=n,e},e}(l.DataSource),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t||null},e}(l.DataSource),Y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.paginationBuilder=function(t,n,a,i,r,o){var s=[],c=a;if(t<=c&&(c=t-1),c){var l=void 0,u=void 0;n>Math.floor(c/2)?2===t?(l=t,u=1):n<t-Math.floor(c/2)?(l=n/1+Math.floor(c/2),u=n/1-Math.floor(c/2)):(l=t,u=n-c+(t-n)):(l=c+1,u=1);for(var d=u;d<=l;d+=1)s.push({text:String(d),classes:n===d?"is-active":"",anchor:n!==d?e._getPaginationAnchor(d,i,r,o):null})}else{s.push({text:"1",classes:1===n?"is-active":"",anchor:1!==n?e._getPaginationAnchor(1,i,r,o):null});for(d=1;d<t;d+=1)s.push({text:String(d+1),classes:n===d+1?"is-active":"",anchor:n!==d+1?e._getPaginationAnchor(d+1,i,r,o):null})}return{links:s,first:{classes:1===n?"is-disabled":"",anchor:1!==n?e._getPaginationAnchor(1,i,r,o):null},prev:{classes:1===n?"is-disabled":"",anchor:1!==n?e._getPaginationAnchor(n/1-1,i,r,o):null},next:{classes:n===t?"is-disabled":"",anchor:n!==t?e._getPaginationAnchor(n/1+1,i,r,o):null},last:{classes:n===t?"is-disabled":"",anchor:n!==t?e._getPaginationAnchor(t,i,r,o):null}}},e}return v(e,t),e.prototype.transform=function(t){var e=t.totalPages,n=t.currentPage,a=t.pageLimit,i=t.sizes,r=this.options,o=r.mode,s=r.href,c=r.queryParams;["href","payload"].includes(o)||console.warn('(smart-pagination) The "mode" option is incorrect. Please specify "href" or "payload" as the mode option.');var u=this.paginationBuilder(e,+n,a,o,s,c),d=u.links;return{first:u.first,prev:u.prev,next:u.next,last:u.last,links:d,select:i?{label:i.label||l._t("search#resultsamount"),options:i.list.map((function(t){return{text:t,selected:t===i.active}})),payload:"select-size"}:null}},e.prototype._getPaginationAnchor=function(t,e,n,a){switch(e){case"payload":return{payload:{source:"pagination",page:t}};case"href":return{href:a?n:n+t,queryParams:a?b(b({},a),{page:t}):null}}return{}},e}(l.DataSource),X=Object.freeze({__proto__:null,HeaderDS:U,SubnavDS:G,BreadcrumbsDS:W,FacetsDS:K,FooterDS:Q,SmartPaginationDS:Y}),Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"header.click":t.dataSource.onClick(a)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"main-layout.currentnavchange":t.dataSource.onCurrentNavChange(a);break;case"main-layout.routerchange":t.dataSource.onRouterChange()}}))},e}(l.EventHandler),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"subnav.click":"navigate"===a.source&&t.emitGlobal("navigate",a),t.emitGlobal(n,a)}}))},e}(l.EventHandler),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"breadcrumbs.click":"navigate"===a.source&&t.emitGlobal("navigate",a),t.emitGlobal(n,a)}}))},e}(l.EventHandler),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){},e}(l.EventHandler),nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"n7-smart-pagination.change":t.emitOuter("change",a);break;case"n7-smart-pagination.click":t.emitOuter("click",a);break;default:console.warn("unhandled inner event of type",n)}}))},e}(l.EventHandler),at=Object.freeze({__proto__:null,HeaderEH:Z,SubnavEH:J,BreadcrumbsEH:tt,FooterEH:et,SmartPaginationEH:nt}),it={layoutId:"main-layout",widgets:[{id:"header"},{id:"subnav"},{id:"breadcrumbs"},{id:"footer"}],layoutDS:R,layoutEH:V,widgetsDataSources:X,widgetsEventHandlers:at,options:{}},rt=function(t){function n(e,n,a,i,r,o){var s=t.call(this,i.get("MainLayoutConfig")||it)||this;return s.router=e,s.route=n,s.configuration=a,s.layoutsConfiguration=i,s.mainState=r,s.titleService=o,s}return v(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,router:this.router,route:this.route,titleService:this.titleService,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:s.Router},{type:s.ActivatedRoute},{type:E},{type:x},{type:C},{type:c.Title}]},n=w([e.Component({selector:"main-layout",template:'<div class="n7-main-layout" id="main-layout">\r\n    <div class="n7-page-content">\r\n        <n7-header\r\n            [data]="lb.widgets[\'header\'].ds.out$ | async"\r\n            [emit]="lb.widgets[\'header\'].emit">\r\n        </n7-header>\r\n        <main class="n7-content">\r\n            <div class="n7-top-page-bar">\r\n                <div class="n7-top-page-bar__main"></div>\r\n            </div>\r\n            <div class="n7-alert-bar">\r\n                \x3c!--<n7-alert\r\n                [attr.id]="\'main-layout-alert\'"\r\n                [data]="lb.dataSource.alertData$ | async"\r\n                [emit]="lb.dataSource.closeAlert.bind(lb.dataSource)"></n7-alert>--\x3e\r\n            </div>\r\n            <ng-content></ng-content>\r\n        </main>\r\n    </div>\r\n    <n7-footer\r\n        [data]="lb.widgets[\'footer\'].ds.out$ | async"\r\n        [emit]="lb.widgets[\'footer\'].emit">\r\n    </n7-footer>\r\n</div>\r\n'}),S("design:paramtypes",[s.Router,s.ActivatedRoute,E,x,C,c.Title])],n)}(P),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.onInit=function(t){var e=t.options;this.options=e},e}(l.LayoutDataSource),st=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"n7-page404-layout.init":t.dataSource.onInit(a);break;case"n7-page404-layout.destroy":t.destroyed$.next()}}))},e}(l.EventHandler),ct={layoutId:"n7-page404-layout",widgets:[],layoutDS:ot,layoutEH:st,widgetsDataSources:X,widgetsEventHandlers:at,options:{}},lt=function(t){function n(e){return t.call(this,e.get("Page404LayoutConfig")||ct)||this}return v(n,t),n.prototype.initPayload=function(){return{options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:x}]},n=w([e.Component({selector:"n7-page404-layout",template:'<div class="n7-page404-layout">\r\n    404 - Resource not found\r\n</div>'}),S("design:paramtypes",[x])],n)}(P),ut=function(){function t(){this.handlePaginationEvent.bind(this)}return t.prototype.handlePaginationEvent=function(t,e){this.emit&&this.emit("change",e)},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"emit",void 0),t=w([e.Component({selector:"n7-smart-pagination",template:'<div class="n7-smart-pagination" *ngIf="data">\r\n  <n7-pagination\r\n    [data]="data"\r\n    [emit]="emit">\r\n  </n7-pagination>\r\n</div>'}),S("design:paramtypes",[])],t)}(),dt=[rt,lt,ut],pt=function(){function t(){}var r;return r=t,t.forRoot=function(t){return{ngModule:r,providers:[C,E,x,T,{provide:"config",useValue:t}]}},t=r=w([e.NgModule({declarations:dt,imports:[n.CommonModule,a.HttpClientModule,i.DvComponentsLibModule],providers:[],entryComponents:dt,exports:dt})],t)}(),ht=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingData=!1,e.checkForMore=function(t){e.loadedData.actions&&(void 0===t?e.loadedData.result.length>=e.totalObjects?e.loadedData.actions[1].disabled=!0:e.loadedData.actions[1].disabled=!1:e.loadedData.actions[1].disabled=!t)},e.handleIncomingData=function(t){e.currentPage+=1;var n=e.unpackData(t.itemsPagination);e.loadedData.result=e.loadedData.result.concat(n.result),e.checkForMore(),e.loadedData.isLoading=!1},e.unpackData=function(t){var n,a,i=e.options.config,r=i.get("item-preview"),o=t.totalCount,s=e.currentPage,c=e.context,l=e.pageSize,u=i.get("labels"),p=e.options.dynamicPagination,h=i?i.get("config-keys"):{},f=t.items?t.items:t.relatedItems;i&&i.get(c+"-layout")&&(n=i.get(c+"-layout")["max-item-length"],a=i.get(c+"-layout")["results-limit"]),!p&&l&&s&&f.length>l?f=f.slice(s*l-l,s*l):l&&(f=f.slice(0,l));var g=[],m=r.metadata.info.selection.map((function(t){return t.key}));return f.forEach((function(t){var e=t.item?t.item:t,n=d.get(t,r.metadata.info.data,e.fields),a=d.get(t,r.metadata.toe.data,e.relatedTypesOfEntity),o=d.get(t,r.metadata.breadcrumbs.data,e.breadcrumbs),s=n?n.filter((function(t){return-1!==m.indexOf(t.key)})):[];(s=s.map((function(t){return b(b({},t),{order:m.indexOf(t.key)})}))).sort((function(t,e){return t.order-e.order})),["entita","search","gallery"].includes(c)&&e.typeOfEntity&&""!==e.typeOfEntity&&s.push({key:"Tipo di entità",value:h[e.typeOfEntity]["singular-label"]});var l=["entita","search","oggetti-collegati"].includes(c)?"is-fullwidth":"";l+=e.typeOfEntity?" is-"+i.get("config-keys")[e.typeOfEntity]["class-name"]:" is-oggetto-culturale","gallery"===c&&(l+=" is-vertical has-image");var p=d.get(t,r.title,e.label).match(/<em>/g)?9*d.get(t,r.title,e.label).match(/<em>/g).length:0,f=+r.title.maxLength&&d.get(t,r.title,e.label).length>+r.title.maxLength+p?d.get(t,r.title,e.label).slice(0,+r.title.maxLength+p)+"…":d.get(t,r.title,e.label),y=d.get(t,r.payload,e.id),v=[e.typeOfEntity?i.get("paths").entitaBasePath:i.get("paths").schedaBasePath,y,F.slugify(f)].join("/"),w={text:r.text?+r.text.maxLength&&d.get(t,r.text.data,e.text).length>+r.text.maxLength?d.get(t,r.text.data,e.text).slice(0,+r.text.maxLength)+"…":d.get(t,r.text.data,e.text):null,classes:l,breadcrumbs:o,image:d.get(t,r.image,e.image),title:f,anchor:{href:v,target:["gallery","search"].includes(c)?"_blank":"_self"},relation:{key:t.relationName,value:t.relation},metadata:s.length||a?[]:null};s.length&&w.metadata.push({classes:"aw-item-preview_metadata",items:s.map((function(t){return{label:F.prettifySnakeCase(t.key,u[t.key]),value:t.value}}))}),a&&w.metadata.push({classes:"aw-item-preview-entities",items:a.map((function(t){return{value:d.get(t,r.metadata.toe.value,t.count),icon:h[d.get(t,r.metadata.toe.icon,t.type)]?h[d.get(t,r.metadata.toe.icon,t.type)].icon:"",classes:"color-"+h[d.get(t,r.metadata.toe.icon,t.type)]["class-name"]}}))}),o&&(w.breadcrumbs={items:d.get(t,r.metadata.breadcrumbs.data,t.item.breadcrumbs).map((function(t){return{label:d.get(t,r.metadata.breadcrumbs.label,t.label),anchor:{href:v}}}))}),g.push(w)})),"home"===c?{result:g,actions:[{label:"Mostra Tutti ("+o+")"},n?{label:"Mostra Altri ("+a+")",disabled:!1}:null],isLoading:!1,fallback:i.get("home-layout")["linked-objects-fallback"]}:{previews:g}},e}return v(e,t),e.prototype.transform=function(t){return this.paths=this.options.config.get("item-preview"),this.pageSize=this.options.size,this.totalObjects=t.totalCount,this.currentPage=this.options.page?+this.options.page:1,this.options.dynamicPagination&&this.options.dynamicPagination.total?this.totalPages=Math.ceil(this.options.dynamicPagination.total/this.pageSize):t.items?this.totalPages=Math.ceil(t.items.length/this.pageSize):t.relatedItems&&(this.totalPages=Math.ceil(t.relatedItems.length/this.pageSize)),this.context=this.options.context,this.loadedData=this.unpackData(t),this.checkForMore(),this.loadedData.loaderData={},this.loadedData},e}(l.DataSource),ft=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stringTrim=function(t,e){return t.length>e?t.slice(0,e)+"…":t},e}return v(e,t),e.prototype.transform=function(t){var e=this,n=t.response;if(!n)return{suggestion:[],loading:!0};var a=[],i=this.options.config.get("home-layout")["max-item-length"]||20;return n.results.filter((function(t){return"object"==typeof t.entity})).forEach((function(t){if("fallback"===t.entity.id)return a.push({text:t.entity.label,payload:"fallback-simple-autocomplete"}),{suggestion:a};var n=e.stringTrim(t.entity.label,i);a.push({text:n,anchor:{payload:t.entity.id}})})),{suggestion:a}},e}(l.DataSource),gt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.chartData=[],e.draw=null,e.selected=[],e.filters=[],e.closedEyes=[],e.tippyList=[],e.updateChart=function(t){var n=t;null===t?n=e.chartData:e.chartData=t,e.filters.length>0&&(n=e.chartData.filter((function(t){return!e.filters.includes(t.entity.typeOfEntity.replace(/ /g,"-"))}))),e.draw?(e.output.selected=e.selected,e.output.data=e.smartSlice(n),e.output.smallView.data=e.smartSlice(n,e.options.smallChartSize),e.draw()):e.update(e.smartSlice(n))},e.smartSlice=function(t,n){var a=n||e.options.limit;return a&&a<t.length?t.slice(0,a):t},e.handleBubbleClick=function(t){var n=t;e.selected.includes(n)?e.selected.splice(e.selected.indexOf(n),1):e.selected.push(n)},e}return v(e,t),e.prototype.transform=function(t){var e=this,n=this.options,a=n.config,i=n.smallChartSize,r=a.get("bubble-chart"),o=r.fontRendering,s=r.transition,c=r.shuffle,l=[],u=[],d=a.get("config-keys");Object.keys(d).forEach((function(t){l.push(t.replace(/-/g," ")),u.push(((d[t]||{}).color||{}).hex)}));var p={containerId:"bubbleChartContainer",setDraw:function(t){e.draw=t},colorMatch:{domain:l,range:u},selected:this.selected,sizeRange:[.5,500],fontRendering:o,height:500,width:500,transition:s,shuffle:c};return b(b({},p),{anchorData:{href:"/placeholder/"},data:this.smartSlice(t),smallView:b(b({},p),{data:this.smartSlice(t,i)})})},e}(l.DataSource),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=t.bubbles,n=t.selected,a=this.options,i=a.basePath,r=a.selectable;return e.map((function(t){var e=t.count,a=t.entity,o=a.id,s=a.label,c=a.relation,l=a.relationName;return{id:o,selectable:r,title:s,text:"È collegato a "+e+" risultati",isSelected:n.includes(o),anchorData:{href:""+i+o+"/"+F.slugify(s)},relation:{key:l,value:c}}}))},e}(l.DataSource),yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return{containerId:"carousel-root",classes:"aw-home__carousel-root",libOptions:{count:1,move:1,buttons:!0,dots:!0,rewind:!0,autoplay:4e3,animation:500},slides:t.map((function(t){var e,n,a=[];return t.title&&a.push({title:t.title}),t.text&&a.push({text:t.text}),t.ctaLabel&&t.ctaPayload&&(e={text:t.ctaLabel,anchor:{href:t.ctaPayload,target:"_blank"}}),t.background&&t.background.value?"color"===t.background.type?n={color:t.background.value}:"image"===t.background.type?n={image:t.background.value}:"video"===t.background.type&&(n={video:t.background.value}):n={color:"rgba(0, 0, 0, 0)"},{items:a,action:e,background:n}}))}},e}(l.DataSource),vt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentInputValue="",e}return v(e,t),e.prototype.transform=function(t){var e=t.title,n=t.text,a=t.button,i=t.backgroundImage,r=t.input,o=t.classes;return{title:e,text:n,backgroundImage:i,button:{text:a.text,anchor:{payload:"cerca"}},input:{placeholder:r.placeholder,payload:"cerca-in-maxxi"},classes:o}},e}(l.DataSource),bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){return i.TABLE_MOCK},e}(l.DataSource),wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),St=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.autoComplete={},e.lockedFacets={},e.lastData={},e.closedEyes=[],e.openTippy="",e.tippyMaker=function(t){var n,a=t.replace(/ /g,"-");if(!e.autoComplete[a]){e.autoComplete[a]={tippy:void 0,open:!0};var i=e.autoComplete[a];if(!i.tippy){var r=document.getElementsByClassName(a)[1];i.tippy=m(r,{content:(n=document.getElementsByClassName("aw-simple-autocomplete__template")[0],n.setAttribute("style","display: block"),n),trigger:"manual",interactive:!0,arrow:!1,flip:!1,appendTo:"parent",theme:"light-border aw-home__facet-tippy",placement:"bottom-start",maxWidth:"100%"})}}var o=e.autoComplete[a];o.tippy&&o.tippy.show()},e.tippyClose=function(t){var n=t.replace(/ /g,"-");if(e.autoComplete[n]){var a=e.autoComplete[n];a.tippy&&a.tippy.hide()}},e}return v(e,t),e.prototype.transform=function(t){var e=this;this.lastData=t;var n=[],a=[],i=t,r=this.lockedFacets,o=this.closedEyes;return Object.keys(this.autoComplete).forEach((function(t){e.autoComplete[t]&&e.autoComplete[t].tippy&&e.autoComplete[t].tippy.destroy()})),this.autoComplete={},i.forEach((function(t,e){if(Object.keys(r).forEach((function(t){var e=r[t].indexOf("LOCK_LAST");e>=0&&r[t].splice(e,1)})),o){if(o.length===i.length-1){var s=i.find((function(t){return!o.includes(t.type.replace(/ /g,"-"))}));s&&(o[s.type]?r[s.type].push("LOCK_LAST"):r[s.type]=["LOCK_LAST"])}o.includes(t.type.replace(/ /g,"-"))?t.enabled=!1:t.enabled=!0}Object.keys(r).length&&r[t.type]&&r[t.type].length>0?t.locked=!0:t.locked=!1;var c=[],l=[t.icon];t.enabled||c.push("is-disabled"),t["class-name"]&&(c.push("color-"+t["class-name"]),l.push("color-"+t["class-name"])),n.push({iconLeft:l.join(" "),text:t.label,additionalText:t.count,iconRight:t.enabled?"n7-icon-eye":"n7-icon-eye-slash",classes:c.join(" ")+(t.locked?" is-blocked":" not-blocked"),payload:!0===t.locked?null:t.type.replace(/ /g,"-")}),a.push({sections:[{inputs:[{id:t.type.replace(/ /g,"-")+"-"+e,type:"text",placeholder:t["input-placeholder"],icon:"n7-icon-search",disabled:!t.enabled,inputPayload:String(t.type.replace(/ /g,"-"))+"-search",iconPayload:String(t.type.replace(/ /g,"-"))+"-search",enterPayload:String(t.type.replace(/ /g,"-"))+"-search",classes:String(t.type.replace(" ","-"))+"-search"}]}]})})),n.map((function(t,e){return{header:t,input:a[e]}}))},e}(l.DataSource),_t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=t.response,n=t.query,a=e.results,i=e.totalCount,r=this.options,o=r.keys,s=r.config,c=r.paths,l=this.options.labels||{},u=[],d={};a.forEach((function(t){var e=t.item,n=t.entity,a=n?n.typeOfEntity:e.document_type,i=o[a],r=i["main-metadata"],s=e||n;if(!d[a]){var p=i.label,h=i.icon;d[a]={title:p,icon:h,classes:"color-"+i["class-name"],items:[],type:a}}if(-1===u.indexOf(s.id)){var f=[];s.fields&&s.fields.forEach((function(t){var e=t.key,n=t.value;r&&e===r&&f.push({key:F.prettifySnakeCase(e,l[e]),value:n})})),d[a].items.push({title:s.label,metadata:f,anchor:{href:c[n?"entitaBasePath":"schedaBasePath"]+"/"+s.id+"/"+F.slugify(s.label)}})}}));var p=Object.keys(d).map((function(t){return{group:{title:d[t].title,icon:d[t].icon,classes:d[t].classes},items:d[t].items}}));return{results:p,actions:p.length>0?{showMore:{text:"Visualizza tutti i "+i+" risultati",anchor:{href:c.searchBasePath,queryParams:{query:n}}}}:{showMore:{text:"Cerca in tutti i campi",anchor:{href:c.searchBasePath,queryParams:{query:n,"query-all":1}}}},fallback:((s.get("home-layout")||{})["top-hero"]||{}).fallback}},e}(l.DataSource),It=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){if(!t)return null;var e=t.data,n=t.selected,a={items:[],payload:"entita-nav"},i=this.options,r=i.hasMetadataFields,o=i.labels;return a.items.push({text:"INFORMAZIONI",anchor:{href:t.basePath+"/informazioni"},classes:"informazioni"===n?"is-selected":""}),e.relatedLa&&a.items.push({text:o["aggregazioni-logiche-collegate"],anchor:{href:t.basePath+"/fondi-collegati"},classes:"fondi-collegati"===n?"is-selected":""}),e.relatedItems&&a.items.push({text:"OGGETTI COLLEGATI",anchor:{href:t.basePath+"/oggetti-collegati",queryParams:{page:1}},classes:"oggetti-collegati"===n?"is-selected":""}),e.relatedEntities&&a.items.push({text:"ENTITÀ COLLEGATE",anchor:{href:t.basePath+"/entita-collegate"},classes:"entita-collegate"===n?"is-selected":""}),e.extraTab&&a.items.push({text:"MAXXI",anchor:{href:t.basePath+"/maxxi"},classes:"maxxi"===n?"is-selected":""}),e.wikiTab&&a.items.push({text:"WIKIPEDIA",anchor:{href:t.basePath+"/wiki"},classes:"wiki"===n?"is-selected":""}),2!==a.items.length||r||a.items.shift(),a},e}(l.DataSource),Et=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasFields=!1,e}return v(e,t),e.prototype.transform=function(t){return this.hasFields=!(!Array.isArray(t)||!t.length),{group:[{items:t||[]}]}},e}(l.DataSource),xt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.transform=function(t){var n=e.options.config.get("paths").entitaBasePath,a=e.options.title;return{previews:t?t.map((function(t){return{title:t.entity.label,anchor:{href:""+n+t.entity.id+"/"+t.entity.label},classes:"is-"+t.entity.typeOfEntity,metadata:[{items:[{label:"Tipo di entità",value:t.entity.typeOfEntity}]}],relation:{key:t.relationName||a,value:t.entity.relation||null}}})):[]}},e}return v(e,t),e}(l.DataSource),Ct=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.transform=function(t){return t},e}return v(e,t),e.prototype.toggleSidebar=function(){var t=this.output;"is-expanded"===t.classes?t.classes="is-collapsed":t.classes="is-expanded",this.update(t)},e}(l.DataSource),Dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=t.digitalObjects;return{header:{label:e[0].label,icon:{id:"n7-icon-caret-down"},payload:"toggle"},items:e.map((function(t,e){return{label:t.label,type:t.type,payload:e,selected:0===e}}))}},e.prototype.toggle=function(){var t=this.output.classes;this.output.classes=t?null:"is-open"},e.prototype.onChange=function(t){var e=this;"external"!==this.output.items[t].type&&this.output.items.forEach((function(n){n.selected=n.payload===t,n.selected&&(e.output.header.label=n.label)})),this.toggle()},e}(l.DataSource),Ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return{iconLeft:"n7-icon-tree-icon",text:t.text||"",iconRight:t.isExpanded?"n7-icon-angle-left":"n7-icon-angle-right",classes:t.isExpanded?"is-expanded":"is-collapsed",payload:"header"}},e.prototype.toggleSidebar=function(){var t=this.output;"is-expanded"===t.classes?(t.classes="is-collapsed",t.iconRight="n7-icon-angle-right"):(t.classes="is-expanded",t.iconRight="n7-icon-angle-left")},e}(l.DataSource),Tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=this,n=this.getTileSources(t.items);return{images:[],viewerId:t.id,libOptions:{tileSources:n,sequenceMode:!0,showReferenceStrip:!0,autoHideControls:!1,showNavigator:!1},_setViewer:function(t){e.instance=t}}},e.prototype.hasInstance=function(){return!!this.instance},e.prototype.updateImages=function(t){var e=this;this.instance&&r.interval(10).pipe(o.filter((function(){return!!document.getElementById(e.output.viewerId)})),o.first()).subscribe((function(){e.instance.world.removeAll(),setTimeout((function(){var n=e.getTileSources(t.items);e.instance.open(n)}))}))},e.prototype.reset=function(){this.instance&&this.instance.world.removeAll()},e.prototype.getTileSources=function(t){var e=[];return t.forEach((function(t){var n=t.type,a=t.url,i=t.iiifImages;"images-simple"===n?e.push({url:a,type:"image"}):"images-iip"===n?e.push(a.replace("FIF","Deepzoom").replace(".tif",".tif.dzi")):"images-iiif"===n&&i.forEach((function(t){e.push(t)}))})),e},e}(l.DataSource),Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),Rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return{group:[{items:t||[]}]}},e}(l.DataSource),$t={showToolbar:!0,showSidebarButton:!0,showFindButton:!0,showPagingButtons:!0,showZoomButtons:!0,showPresentationModeButton:!0,showOpenFileButton:!1,showPrintButton:!1,showDownloadButton:!1,showBookmarkButton:!1,showSecondaryToolbarButton:!0,showRotateButton:!1,showHandToolButton:!0,showScrollingButton:!1,showSpreadButton:!1,showPropertiesButton:!1},Lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=t.items,n=d.merge($t,this.options.libOptions||{});return Array.isArray(e)&&e.length?(this.items=e.map((function(t,e){return b(b({},t),{selected:0===e})})),console.log("libOptions-----------------------------\x3e",n),{libOptions:n,items:this.items,next:1,prev:null,currentUrl:e[0].url}):null},e.prototype.onChange=function(t){this.output.next=t<this.items.length-1?t+1:null,this.output.prev=t>0?t-1:null,this.output.currentUrl=this.items[t].url,this.items.forEach((function(e,n){e.selected=n===t}))},e.prototype.onLoaded=function(){this.output.classes="is-loaded"},e}(l.DataSource),At=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.transform=function(t){return t},n._getCachedData=function(){return e.dataCache[n.rootId]},n._normalize=function(t){var e=t.id,a=t.label,i=t.icon,r=t.img,o=t.branches,s=t.document_type,c=t.document_classification,l=!(!Array.isArray(o)||!o.length);n._getCachedData().flatData[e]={id:e,label:a,icon:i,img:r,hasBranches:l,type:s,classification:c},l&&o.forEach((function(t){n._getCachedData().flatIds.push([e,t.id]),n._normalize(t)}))},n._getParent=function(t){return n._getCachedData().flatIds.filter((function(e){return _(e,2)[1]===t})).map((function(t){return _(t,1)[0]}))[0]||null},n._getTreePath=function(t){for(var e=[t],a=t;a;){var i=n._getParent(a);i&&e.push(i),a=i}return e.reverse()},n._getTree=function(t){var e={},a=0,i=function(e,r){var o=t[a+=1];r.items=[],n._getCachedData().flatIds.filter((function(t){return _(t,1)[0]===e})).forEach((function(t,e){var a=_(t,2)[1],s=a===o,c=n._getTreeItem(a,s);r.items.push(c),s&&i(a,r.items[e])}))};return i(t[0],e),e},n._getTreeItem=function(t,e){var a=n._getCachedData().flatData[t],i=a.label,r=a.img,o=a.hasBranches,s=a.type,c=a.classification,l=(n.options.config[s]||{icon:null}).icon,u="",d=/.*\.(\w+)$/;if(c&&d.test(c)){var p=c.match(d)[1].toUpperCase();u=n.options.config[s].classifications[p].icon}var h=e?"n7-icon-angle-down":"n7-icon-angle-right",f=[];return e&&f.push("is-expanded"),n.activeId===t&&f.push("is-active"),{classes:f.join(" "),text:i||null,img:r||null,icon:u||l,toggle:o?{icon:h,payload:{source:"toggle",id:t}}:null,meta:t,anchor:{href:n.basePath+"/"+t+"/"+F.slugify(i)}}},n}return v(e,t),e.prototype.load=function(t){var n=t.tree,a=t.basePath;this.rootId=n.id,this.basePath=a,e.dataCache[this.rootId]||(e.dataCache[this.rootId]={flatIds:[],flatData:{}},this._normalize(n))},e.prototype.build=function(t){var e=this._getTreePath(t),n=this._getTreePath(this.currentId).indexOf(t);if(n>0)e.splice(n),this.currentId=null;else if(this.currentId===t){var a=e.indexOf(this.currentId);e.splice(a),this.currentId=null}else this.currentId=t;var i=this._getTree(e);this.update(i)},e.prototype.setActive=function(t){this.activeId=t},e.prototype.highlightActive=function(){var t=this,e=function(n){n.forEach((function(n){var a,i=n.meta===t.activeId;-1===n.classes.indexOf("is-active")||i||((a=n.classes.split(" ")).splice(a.indexOf("is-active"),1),n.classes=a.join(" "));i&&(-1===(a=n.classes.split(" ")).indexOf("is-active")&&a.push("is-active"),n.classes=a.join(" "));Array.isArray(n.items)&&n.items.length&&e(n.items)}))};e(this.output.items)},e.dataCache={},e}(l.DataSource),Mt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selected="list",e}return v(e,t),e.prototype.transform=function(){return{items:[{text:"LISTA",payload:"list",classes:"list"===this.selected?"is-selected":""},{text:"GRAFICO",payload:"chart",classes:"chart"===this.selected?"is-selected":""},{text:"TIMELINE",payload:"timeline",classes:"timeline"===this.selected?"is-selected":""}]}},e.prototype.setSelected=function(t){this.selected=t},e}(l.DataSource),Ht={counter:null,label:"Caricamento in corso...",searchData:[],value:"__loading__"},jt={paginationState:{},paginate$:new r.Subject,listenToChanges:function(t){var e=this,n=t.getWidgetEventHandler("facets-wrapper");return r.merge(n.internalFacetsChange$.pipe(o.mapTo(null)),this.paginate$).pipe(o.debounceTime(500),o.switchMap((function(n){var a=t.searchModel.getRequestParams(),i=t.searchModel.getInternalFilters();e.paginationState.offset=n?e.paginationState.offset:0,e.updateParamsOffset(a);var r=k(a.filters,i),o={searchParameters:b(b({totalCount:100,gallery:!("aw-gallery-layout"!==t.searchModel.getId())},a),{filters:r})};return 0===e.paginationState.offset&&e.addInitialLoader(t),t.getFacetsReq$(o)})))},onFacetsResponse:function(t,e){var n=e.find((function(t){return"entity-links"===t.id})),a=n.totalCount,i=this.paginationState,r=i.limit,o=i.offset;if(void 0===r&&(r=10),void 0===o&&(o=0),this.paginationState.totalCount=a,o>0){var s=t.getInputByFacetId("entity-links").getData()||[];s.length&&s.pop();var c=s.concat(n.data);n.data=c}if(this.paginationState.totalCount>r+o&&n.data.push(Ht),t.getInputByFacetId("entity-links").setIsEmpty(!a),0===o){var l=document.querySelector(".n7-facets-wrapper__group:last-child .n7-facet__section-input-links");l&&(l.scrollTop=0)}this.paginationState.loading=!1},initPagination:function(t){var e=this;t.getFilters().filter((function(t){return t.pagination})).forEach((function(t){var n=t.pagination;e.paginationState=b(b(b({},n),e.paginationState),{loading:!1})})),setTimeout((function(){var t=document.querySelector(".n7-facets-wrapper__group:last-child .n7-facet__section-input-links");r.fromEvent(t,"scroll").pipe(o.debounceTime(300)).subscribe((function(t){var n=t.target,a=n.scrollTop,i=n.clientHeight,r=n.scrollHeight,o=e.paginationState,s=o.offset,c=o.limit,l=o.totalCount,u=o.loading;a+i>=r-150&&s+c<l&&!1===u&&(e.paginationState.loading=!0,e.paginationState.offset=s+c,e.paginate$.next(e.paginationState))}))}))},updateParamsOffset:function(t){var e=t.filters.find((function(t){return"entity-links"===t.facetId}));e&&(e.pagination.offset=this.paginationState.offset)},resetOffset:function(){this.paginationState.offset=0},addInitialLoader:function(t){t.searchModel.setInputData("entity-links",[Ht]),t.getWidgetDataSource("facets-wrapper").updateInputLinks()}},Ft=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.getRequestParams=function(){return e.searchModel.getRequestParams()},e.filtersAsQueryParams=function(t){return e.searchModel.filtersAsQueryParams(t)},e.updateFiltersFromQueryParams=function(t){e.searchModel.updateFiltersFromQueryParams(t)},e.getInputByFacetId=function(t){return e.searchModel.getInputByFacetId(t)},e.filterTarget=function(t){e.searchModel.filterTarget(t)},e.updateInputsFromFilters=function(){e.searchModel.updateInputsFromFilters()},e}return v(e,t),e.prototype.transform=function(t){var e=this;this.searchModel||(this.searchModel=t.searchModel,jt.initPagination(this.searchModel));var n=this.searchModel.getId(),a=this.searchModel.getFields(),i=[];return a.forEach((function(t,a){var r="group-"+n+"-"+a,o=e._headerConfig(t.header,r),s=[];e.searchModel.getInputs().filter((function(t){return t.getSectionIndex()===a})).map((function(t){return t.update(),{facetId:t.getFacetId(),type:t.getType(),output:t.getOutput()}})).forEach((function(t){var n=t.type,a=t.output,i=t.facetId;s.push({classes:e._getSectionClasses(n),inputs:Array.isArray(a)?a:[a],_meta:{facetId:i}})})),i.push({header:o,facet:{sections:s},classes:"n7-facets-wrapper__"+r,isOpen:!0,_meta:{groupId:r}})})),{groups:i,classes:"n7-facets-wrapper__"+this.searchModel.getId()}},e.prototype.toggleGroup=function(t){var e=t.eventPayload;this.output.groups.forEach((function(t){t._meta.groupId===e.groupId&&(t.isOpen=!t.isOpen,t.header.iconRight=t.isOpen?"n7-icon-angle-down":"n7-icon-angle-right")}))},e.prototype.onFacetChange=function(t){var e=t.eventPayload,n=e.inputPayload,a=n.facetId,i=n.source,r=n.trigger,o=(this.searchModel.getFiltersByFacetId(a)[0]||{value:null}).value,s=!1,c=e.inputPayload.value||e.value;c=""+c,s=Array.isArray(o)?-1!==o.indexOf(c):o===c,"input-text"===i&&-1!==["enter","icon"].indexOf(r)||(this.searchModel.updateFilter(a,c,s),this.searchModel.updateInputsFromFilters())},e.prototype.updateFilteredTarget=function(t){if(this.searchModel){var e=this.searchModel.getInputByFacetId(t);this.output.groups.map((function(t){return t.facet})).map((function(t){return t.sections})).forEach((function(n){n.forEach((function(n){if(n._meta.facetId===t){var a=e.getOutput();n.inputs=Array.isArray(a)?a:[a]}}))}))}},e.prototype.updateInputLinks=function(){var t=this;if(this.searchModel){var e=this.searchModel.getInputs().filter((function(t){return"link"===t.getType()})).map((function(t){return t.getFacetId()}));this.output.groups.map((function(t){return t.facet})).map((function(t){return t.sections})).forEach((function(n){n.forEach((function(n){if(-1!==e.indexOf(n._meta.facetId)){var a=t.searchModel.getInputByFacetId(n._meta.facetId);a.update();var i=a.getOutput();n.inputs=Array.isArray(i)?i:[i]}}))}))}},e.prototype._getSectionClasses=function(t){return"n7-facet__section-input-"+{text:"text",checkbox:"checkboxes",link:"links",select:"select"}[t]},e.prototype._headerConfig=function(t,e){return t?{text:t.label,iconRight:"n7-icon-angle-down",classes:t.classes,payload:{source:"group-header",id:e+"-header",groupId:e},_meta:{id:e+"-header"}}:null},e}(l.DataSource),qt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.addPagination=function(t,n,a){e.pagination={first:{payload:"goto-1",classes:1===t?"is-disabled":""},prev:{payload:"goto-"+(t/1-1),classes:1===t?"is-disabled":""},next:{payload:"goto-"+(t/1+1),classes:t===n?"is-disabled":""},last:{payload:"goto-"+n,classes:t===n?"is-disabled":""},links:e.makePagination(n,t),select:{label:"Numero di risultati",options:[12,24,48].map((function(t){return{text:t,selected:t===a}})),payload:"select-size"}}},e.makePagination=function(t,e){var n=[],a=4;if(t<=a&&(a=t-1),a){var i=void 0,r=void 0;e>Math.floor(a/2)?2===t?(i=t,r=1):e<t-Math.floor(a/2)?(i=e/1+Math.floor(a/2),r=e/1-Math.floor(a/2)):(i=t,r=e-a+(t-e)):(i=a+1,r=1);for(var o=r;o<=i;o++)n.push({text:String(o),payload:"page-"+String(o),classes:e===o?"is-active":""})}else{n.push({text:"1",payload:"page-1",classes:1===e?"is-active":""});for(o=1;o<t;o++)n.push({text:String(o+1),payload:"page-"+String(o+1),classes:e===o+1?"is-active":""})}return n},e}return v(e,t),e.prototype.transform=function(t){if(!t)return null;var e=this.options,n=e.pageSize,a=e.currentPage;return t.length>n&&this.addPagination(a,Math.ceil(t.length/n),n),{res:t.slice(0,n),pagination:this.pagination}},e.prototype.chunks=function(t,e){for(var n=[];t.length;)n.push(t.splice(0,e));return n},e}(l.DataSource),Bt=f.icon({iconUrl:"/assets/pin.png",iconSize:[30,45.5],popupAnchor:[0,-25],className:"marker-icon"}),Nt=f.icon({iconUrl:"/assets/pin-selected.png",iconSize:[30,45.5],popupAnchor:[0,-25],className:"marker-icon-selected"}),Vt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.markerOpen$=new r.Subject,e.markerClose$=new r.Subject,e.transform=function(t){return{containerId:"map-canvas",tileLayers:[{url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",options:{}}],initialView:{center:[0,0],zoom:13},_setInstance:function(n){e.map=n;var a=new f.LatLngBounds(t.filter((function(t){return e.isValidMarker(t)})).map((function(t){return[t.lat,t.lon]})));e.map.fitBounds(a);var i=f.markerClusterGroup({showCoverageOnHover:!1});t.filter((function(t){return e.isValidMarker(t)})).forEach((function(t){var n=t.lat,a=t.lon,r=t.item,o=r.label,s=f.marker([n,a],{icon:Bt}).addTo(i).bindPopup(o).on("click",(function(t){"marker-icon-selected"===t.target.options.icon.options.className&&e.markerOpen$.next(r)}));s.getPopup().on("remove",(function(t){t.target._source.setIcon(Bt),e.markerClose$.next()})),s.getPopup().on("add",(function(t){t.target._source.setIcon(Nt)}))})),e.map.addLayer(i)}}},e}return v(e,t),e.prototype.isValidMarker=function(t){var e=t.lat,n=t.lon;return!!(e&&n&&/^-?\d+\.\d*$/.test(e)&&/^-?\d+\.\d*$/.test(n))||(console.error(e+", "+n+" is not a valid marker!"),!1)},e}(l.DataSource),zt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timelineLoaded$=new r.Subject,e.timelineControlsVisible=!1,e.transform=function(t){e.dataSet=t.map((function(t){var n=t.id,a=t.start,i=t.end,r=t.item,o=t.label;return{id:n,item:r,start:a?g(a).format("YYYY-MM-DD"):null,end:i&&i!==a?g(i).format("YYYY-MM-DD"):null,content:e.getItemTemplate(o,r.label),_meta:{dateText:o}}}));var n=e.getMax(),a=e.getMin();return{containerID:"timeline-component",libOptions:{max:n,min:a,start:a,end:n,align:"left",minHeight:"100px",locale:"it_IT",showCurrentTime:!1,showTooltips:!1,tooltip:{followMouse:!1,template:function(t,e){return'<div class="tooltip">'+e.title+"</div>"}},width:"100%",zoomMax:631152e8,zoomMin:26298e5},dataSet:e.dataSet,_setInstance:function(t){e.timeline=t,e.timelineLoaded$.next(),setTimeout((function(){e.timeline.fit()})),setTimeout((function(){e.timelineControlsVisible=!0}),1e3)}}},e}return v(e,t),e.prototype.getItemTemplate=function(t,e){return'\n      <div class="dates">\n        <em>'+t+'</em>\n      </div>\n      <div class="content">'+e+"</div>\n    "},e.prototype.getMax=function(){var t=new Date(d.max(this.getAllDates())),e=t.getFullYear(),n=t.getMonth(),a=t.getDate();return new Date(e+30,n,a)},e.prototype.getMin=function(){var t=new Date(d.min(this.getAllDates())),e=t.getFullYear(),n=t.getMonth(),a=t.getDate();return new Date(e-30,n,a)},e.prototype.getAllDates=function(){return k(this.dataSet.filter((function(t){return t.start})).map((function(t){return t.start})),this.dataSet.filter((function(t){return t.end})).map((function(t){return t.end})))},e}(l.DataSource),Ut=Object.freeze({__proto__:null,AwLinkedObjectsDS:ht,AwAutocompleteWrapperDS:ft,AwBubbleChartDS:gt,AwChartTippyDS:mt,AwCarouselDS:yt,AwHeroDS:vt,AwTableDS:bt,AwHomeHeroPatrimonioDS:wt,AwHomeFacetsWrapperDS:St,AwHomeItemTagsWrapperDS:_t,AwHomeAutocompleteDS:kt,AwEntitaNavDS:It,AwEntitaMetadataViewerDS:Et,AwRelatedEntitiesDS:xt,AwSchedaBreadcrumbsDS:Ct,AwSchedaDropdownDS:Dt,AwSidebarHeaderDS:Ot,AwSchedaImageDS:Tt,AwSchedaInnerTitleDS:Pt,AwSchedaMetadataDS:Rt,AwSchedaPdfDS:Lt,AwTreeDS:At,AwSearchLayoutTabsDS:Mt,AwFacetsWrapperDS:Ft,AwGalleryResultsDS:qt,AwMapDS:Vt,AwTimelineDS:zt}),Gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-hero.click":"cerca"===a&&t.dataSource.currentInputValue&&t.emitOuter("enter",t.dataSource.currentInputValue);break;case"aw-hero.change":t.dataSource.currentInputValue=a,t.emitOuter("change",a);break;case"aw-hero.enter":t.emitOuter("enter",a);break;default:console.warn("(hero) unhandled event of type",n)}}))},e}(l.EventHandler),Wt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.changedInput$=new r.Subject,e.handleEyeClick=function(t){if(e.dataSource.closedEyes){var n=e.dataSource.closedEyes.indexOf(t);n>=0?e.dataSource.closedEyes.splice(n,1):e.dataSource.closedEyes.push(t)}else e.dataSource.closedEyes=[t];e.dataSource.update(e.dataSource.lastData)},e.updateFilters=function(t){t.entity.id.replace(/ /g,"-");var n=t.entity,a=n.id,i=n.typeOfEntity;if(e.dataSource.lockedFacets[i]||(e.dataSource.lockedFacets[i]=[]),e.dataSource.lockedFacets[i].includes(a)){var r=e.dataSource.lockedFacets[i].indexOf(a);e.dataSource.lockedFacets[i].splice(r,1)}else e.dataSource.lockedFacets[i].push(a);e.dataSource.update(e.dataSource.lastData)},e}return v(e,t),e.prototype.listen=function(){var t=this;this.changedInput$.pipe(o.debounceTime(500)).subscribe((function(e){t.emitOuter("change",e)})),this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-home-facets-wrapper.click":if(null===a)break;t.emitOuter("click",a),t.handleEyeClick(a);break;case"aw-home-facets-wrapper.change":t.dataSource.openTippy=a.inputPayload.replace("-search",""),t.changedInput$.next(a);break;case"aw-home-facets-wrapper.enter":t.emitOuter("enter",a);break;default:console.warn("unhandled inner event of type:",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-home-layout.facetswrapperrequest":t.dataSource.tippyMaker(a.facetId.inputPayload);break;case"aw-home-layout.facetswrapperclose":t.dataSource.tippyClose(a.facetId.inputPayload);break;case"aw-home-layout.facetswrapperresponse":break;case"aw-home-layout.lockfilter":t.updateFilters(a);break;case"aw-home-layout.tagclick":Object.keys(t.dataSource.lockedFacets).forEach((function(e){t.dataSource.lockedFacets[e].includes(a)&&t.dataSource.lockedFacets[e].splice(t.dataSource.lockedFacets[e].indexOf(a),1)})),t.dataSource.update(t.dataSource.lastData);break;case"aw-home-layout.clearselection":t.dataSource.lockedFacets={},t.dataSource.closedEyes=[],t.dataSource.update(t.dataSource.lastData);break;case"aw-home-layout.facetclick":var i=t.dataSource.openTippy;t.dataSource.lockedFacets[i]?-1===t.dataSource.lockedFacets[i].indexOf(a)&&t.dataSource.lockedFacets[i].push(a):t.dataSource.lockedFacets[i]=[a],t.dataSource.update(t.dataSource.lastData)}}))},e}(l.EventHandler),Kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){},e}(l.EventHandler),Qt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){switch(e.type){case"aw-home-item-tags-wrapper.click":t.emitOuter("click",e.payload)}}))},e}(l.EventHandler),Yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-home-autocomplete.click":t.emitOuter("click",a)}}))},e}(l.EventHandler),Xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-entita-nav.click":t.emitOuter("click",a);break;default:console.warn("unhandled event type")}}))},e}(l.EventHandler),Zt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;"aw-sidebar-header.click"===n&&(t.dataSource.toggleSidebar(),t.emitOuter(n,a))}))},e}(l.EventHandler),Jt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;"aw-sidebar-header.click"===n&&t.emitOuter("click",a)}))},e}(l.EventHandler),te=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.targetOffset=new r.ReplaySubject,e.targetIsOpen=!1,e.scrollOpenedIntoView=function(){e.dataSource.out$.pipe(o.filter((function(t){return!!t})),o.first(),o.withLatestFrom(e.targetOffset)).subscribe((function(t){var e=_(t,2)[1];setTimeout((function(){var t=document.querySelector(".aw-scheda__tree-content"),n=document.getElementsByClassName("n7-tree__item is-expanded"),a=n.length?n[n.length-1]:null;if(a){var i=document.querySelector(".n7-tree"),r=t.getBoundingClientRect(),o=e-r.top;i.style.marginBottom="1000px",a.scrollIntoView(),t.scrollTop-=o,window.scrollTo(0,0),i.style.marginBottom="0px"}}),200)}))},e.scrollLeafIntoView=function(){setTimeout((function(){var t=document.querySelector("div.aw-scheda__tree").querySelector(".is-active .n7-tree__item-contents");t&&!e.isInViewport(t)&&(t.scrollIntoView(),window.scrollTo(0,0),e.isInViewport(t)||e.scrollLeafIntoView())}))},e.isInViewport=function(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-tree.click":"toggle"===a.source&&setTimeout((function(){t.dataSource.build(a.id),t.targetIsOpen&&t.scrollOpenedIntoView()}))}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-scheda-layout.selectItem":t.dataSource.build(a);break;case"aw-scheda-layout.navigationresponse":a.currentItem&&t.dataSource.setActive(a.currentItem);var i=a.currentItem||a.tree.id;t.dataSource.load(a),t.dataSource.build(i);break;case"aw-scheda-layout.routechanged":t.dataSource.output&&(t.dataSource.build(a),t.dataSource.setActive(a),t.dataSource.highlightActive(),t.scrollLeafIntoView());break;case"aw-scheda-layout.viewleaf":t.dataSource.out$.pipe(o.filter((function(t){return!!t})),o.first()).subscribe((function(){t.scrollLeafIntoView()}));break;case"aw-scheda-layout.treeposition":var r=a.target,s=r.getBoundingClientRect();t.targetIsOpen=-1!==r.className.indexOf("n7-icon-angle-right"),t.targetOffset.next(s.top)}}))},e}(l.EventHandler),ee=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;"aw-scheda-dropdown.click"===n&&("toggle"===a?t.dataSource.toggle():(t.dataSource.onChange(a),t.emitOuter("click",a)))}))},e}(l.EventHandler),ne=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;"aw-scheda-pdf.click"===n?t.dataSource.onChange(a):"aw-scheda-pdf.loaded"===n&&t.dataSource.onLoaded()}))},e}(l.EventHandler),ae=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){},e}(l.EventHandler),ie=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.internalFacetsChange$=new r.Subject,e.externalFacetsChange$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"facets-wrapper.facet":if(!a.eventPayload.inputPayload)return;var i=a.eventPayload.inputPayload,r=i.facetId;if("__loading__"===i.value)return;var o=t.dataSource.getInputByFacetId(r),s=o.getContext();t.dataSource.onFacetChange(a),"internal"===s?t.internalFacetsChange$.next(o.getTarget()):t.externalFacetsChange$.next(r);break;case"facets-wrapper.facetheader":t.dataSource.toggleGroup(a)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;-1!==n.indexOf("queryparamschange")&&t.dataSource.searchModel&&(t.dataSource.updateFiltersFromQueryParams(a),t.dataSource.updateInputsFromFilters())})),l.EventHandler.globalEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"global.searchresponse":if(t.dataSource.searchModel&&t.dataSource.searchModel.getId()===a)t.dataSource.updateInputLinks(),t.dataSource.searchModel.getInternalFilters().forEach((function(e){var n=t.dataSource.searchModel.getInputByFacetId(e.facetId).getTarget();t.dataSource.updateFilteredTarget(n)}))}})),this.externalFacetsChange$.pipe(o.debounceTime(500)).subscribe((function(e){var n=t.dataSource.getRequestParams(),a=t.dataSource.filtersAsQueryParams(n.filters);Object.keys(a).forEach((function(t){a[t]=a[t]||null})),t.emitOuter("facetschange",{facetId:e}),a.page=1,t.emitGlobal("navigate",{handler:"router",path:[],queryParams:a})}))},e}(l.EventHandler),re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-gallery-results.change":t.emitOuter("change",+a.value);break;case"aw-gallery-results.click":if("string"==typeof a){if(a.startsWith("page"))t.emitOuter("pagination",a);else if(a.startsWith("goto")){var i=+a.replace("goto-","");if(i>t.dataSource.totalPages)return;if(i<1||i===t.dataSource.currentPage)return;t.emitOuter("goto",a)}}else t.emitOuter("click",a);break;default:console.warn("(gallery-results) unhandled inner event of type",n)}}))},e}(l.EventHandler),oe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.outerEvents$.subscribe((function(e){switch(e.type){case"aw-map-layout.init":t.listenToMarkers()}}))},e.prototype.listenToMarkers=function(){var t=this;this.dataSource.markerOpen$.subscribe((function(e){t.emitOuter("markeropen",e)})),this.dataSource.markerClose$.subscribe((function(){t.emitOuter("markerclose")}))},e}(l.EventHandler),se=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.outerEvents$.subscribe((function(e){switch(e.type){case"aw-timeline-layout.init":t.listenToTimeline();break;case"aw-timeline-layout.zoomout":t.dataSource.timeline.zoomOut(.7);break;case"aw-timeline-layout.zoomin":t.dataSource.timeline.zoomIn(.7)}}))},e.prototype.listenToTimeline=function(){var t=this;this.dataSource.timelineLoaded$.pipe(o.first()).subscribe((function(){var e=t.dataSource,n=e.timeline,a=e.dataSet;n.on("click",(function(e){var n=e.item,i=a.find((function(t){var e=t.id;return n===e}));if(i){var r=i._meta.dateText,o=i.item,s=o.id,c=o.label;t.emitOuter("click",{id:s,label:c,dateText:r})}else t.emitOuter("click",{id:null})}))}))},e}(l.EventHandler),ce=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleScroll=function(t){var n=e.dataSource,a=n.totalObjects,i=n.loadedData;(Array.isArray(i.result)?i.result.length:0)>=a||t.scrollTop+t.clientHeight>=t.scrollHeight-150&&!1===e.dataSource.loadedData.isLoading&&(e.dataSource.loadedData.isLoading=!0,e.emitOuter("datarequest",{currentPage:e.dataSource.currentPage}))},e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-linked-objects.change":t.emitOuter("change",+a.value);break;default:console.warn("unhandled event type: ",n," with payload: ",a)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-home-layout.viewmore":t.dataSource.checkForMore(!1),t.emitOuter("datarequest",{currentPage:t.dataSource.currentPage});break;case"aw-home-layout.dataresponse":var i=a.res;t.dataSource.handleIncomingData(i);break;case"aw-home-layout.scroll":t.handleScroll(a)}}))},e}(l.EventHandler),le=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-autocomplete-wrapper.click":"fallback-simple-autocomplete"!==a&&t.emitOuter("clickresult",a);break;default:console.warn("unhandled event of type:",n)}}))},e}(l.EventHandler),ue=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.initialLoad=!1,e.toggleSelection=function(t){e.dataSource.handleBubbleClick(t),e.emitOuter("selection",e.dataSource.selected)},e.toggleFilter=function(t){e.dataSource.filters.includes(t)?e.dataSource.filters.splice(e.dataSource.filters.indexOf(t),1):e.dataSource.filters.push(t),e.dataSource.updateChart(null)},e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-bubble-chart.click":!1!==t.dataSource.options.selectable&&t.toggleSelection(a),t.emitOuter("lockfilter",t.dataSource.chartData.find((function(t){return a===t.entity.id})));break;case"aw-bubble-chart.d3end":var i=void 0;i=t.dataSource.filters.length>0?t.dataSource.chartData.filter((function(e){return!t.dataSource.filters.includes(e.entity.typeOfEntity.replace(/ /g,"-"))})):t.dataSource.chartData,t.emitOuter("d3end",{bubbles:t.dataSource.smartSlice(i),selected:t.dataSource.selected});break;default:console.warn("unhandled inner event of type",n,"with payload",a)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-home-layout.select":var i=a.id;t.toggleSelection(i);var r=t.dataSource.chartData.find((function(t){return i===t.entity.id}));r?t.emitOuter("lockfilter",r):console.warn("Unable to determine which bubble was selected.");break;case"aw-home-layout.tagclick":t.toggleSelection(a);break;case"aw-home-layout.facetclick":t.dataSource.selected.includes(a)||t.toggleSelection(a);break;case"aw-home-layout.togglefilter":t.toggleFilter(a);break;case"aw-home-layout.clearselection":t.dataSource.selected=[],t.emitOuter("selection",[]);break;case"aw-entita-layout.filterbubbleresponse":case"aw-home-layout.filterbubbleresponse":t.dataSource.updateChart(a)}}))},e}(l.EventHandler),de=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){},e}(l.EventHandler),pe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tippyList=[],e.tippyMaker=function(t){e.tippyList.forEach((function(t){t&&t.destroy()})),e.tippyList=[],t.forEach((function(t){var n=document.getElementById("g_"+t.entity.id);n&&e.tippyList.push(m(n,{content:document.getElementById("template__"+t.entity.id),interactive:!0,appendTo:document.body,arrow:!0,flip:!1,theme:"light-border no-padding",placement:"top",delay:150,updateDuration:400}))}))},e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-chart-tippy.select":t.emitOuter("select",a);break;default:console.warn("(chart-tippy) unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-home-layout.d3end":case"aw-entita-layout.d3end":case"aw-scheda-layout.d3end":t.dataSource.update(a),setTimeout((function(){t.tippyMaker(a.bubbles)}))}}))},e}(l.EventHandler),he=Object.freeze({__proto__:null,AwHeroEH:Gt,AwHomeFacetsWrapperEH:Wt,AwHomeHeroPatrimonioEH:Kt,AwHomeItemTagsWrapperEH:Qt,AwHomeAutocompleteEH:Yt,AwEntitaNavEH:Xt,AwSchedaSidebarEH:Zt,AwSidebarHeaderEH:Jt,AwTreeEH:te,AwSchedaDropdownEH:ee,AwSchedaPdfEH:ne,AwSearchLayoutTabsEH:ae,AwFacetsWrapperEH:ie,AwGalleryResultsEH:re,AwMapEH:oe,AwTimelineEH:se,AwLinkedObjectsEH:ce,AwAutocompleteWrapperEH:le,AwBubbleChartEH:ue,AwTableEH:de,AwChartTippyEH:pe}),fe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.classificationsMap={ff400:"fondo-fotografico",al:"aggregazione-logica",la:"libro-antico",veac301:"vestimento",f400:"fotografia",uasc:"cartografica",dc:"scheda-dublin-core",oa300:"scheda-oa",rmmus:"materiale-musicale",ua:"unita-archivistica",oac300:"opera-arte-contemporanea"},e.innerTitleData=new r.BehaviorSubject({title:{main:{text:""}}}),e.collectionDescription=new r.BehaviorSubject(""),e.pageSize=6,e.pageSizeList=[],e.currentOffset=0,e.loadMoreButton=new r.BehaviorSubject(!0),e.loading=!0,e}return v(e,t),e.prototype.onInit=function(t){this.communication=t.communication,this.route=t.route,this.configuration=t.configuration,this.loadedCollections=new r.BehaviorSubject([]),this.layoutOptions=this.configuration.get("collection-layout"),this.pageSizeList=new Array(this.pageSize)},e.prototype.onCollectionID=function(){this.pageSize=6,this.currentOffset=0,this.loadMore(!0)},e.prototype.loadMore=function(t){var e=this;void 0===t&&(t=!1),this.loading=!0;var n=this.loadedCollections.getValue(),a={id:this.collectionID,itemPagination:{limit:this.pageSize,offset:this.currentOffset}};this.communication.request$("getCollection",{onError:function(t){return console.error(t)},params:a}).pipe(o.first((function(t){return!!t})),o.map((function(t){return{response:t.items.map((function(t){return{title:e.stringLimiter(t.title,{maxLength:e.layoutOptions.item.title.maxLength,char:e.layoutOptions.item.title.char}),text:e.stringLimiter(t.content,{maxLength:e.layoutOptions.item.description.maxLength,char:e.layoutOptions.item.description.char}),classes:(t.image?"is-overlay has-image":"is-overlay has-image has-watermark")+" "+e.classMap(t.classification),image:t.image||e.layoutOptions.watermark,color:t.background,anchor:{href:t.url||e.urlBuilder(t.a4vId,t.title,t.type)},classification:t.classification}})),text:t.text,title:t.title,total:t.total}}))).subscribe({next:function(a){e.loading=!1,a.title&&e.setTitle(e.stringLimiter(a.title,{maxLength:e.layoutOptions.header.maxLength,char:e.layoutOptions.header.char})),e.collectionDescription.next(a.text?e.stringLimiter(a.text,{maxLength:e.layoutOptions.description.maxLength,char:e.layoutOptions.description.char}):""),e.currentOffset+=e.pageSize;var i=t?k(a.response):k(n,a.response);e.loadedCollections.next(i),e.loadMoreButton.next(a.total>e.loadedCollections.getValue().length)},error:function(t){console.error(t),e.loadMoreButton.next(!1)}})},e.prototype.urlBuilder=function(t,e,n){if(t&&e){var a=p(e),i=this.configuration.get("paths"),r=i.schedaBasePath,o=i.entitaBasePath;return"/"+("entity"===n?o:r)+"/"+t+"/"+a}},e.prototype.stringLimiter=function(t,e){var n=t;return t&&e.maxLength&&(n=t.slice(0,e.maxLength),e.char&&n!==t&&(n+=e.char)),n},e.prototype.setTitle=function(t){this.innerTitleData.next({title:{main:{text:t}}})},e.prototype.classMap=function(t){var e;if(!t||t.length<1)return"";var n=/\.(\w+)$/gi.exec(t);if(n){var a=null===(e=n[1])||void 0===e?void 0:e.toLocaleLowerCase(),i=this.classificationsMap[a];if(i)return"is-"+i}return"is-"+t.replace(".","-")},e}(l.LayoutDataSource),ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-collection-layout.init":t.dataSource.onInit(a),t.route=a.route,t.listenRoute();break;default:console.warn("unhandled inner event of type",n)}}))},e.prototype.listenRoute=function(){var t=this;this.route.paramMap.subscribe((function(e){e.get("id")&&(t.dataSource.collectionID=e.get("id"),t.dataSource.onCollectionID())}))},e}(l.EventHandler),me={layoutId:"aw-collection-layout",widgets:[],layoutDS:fe,layoutEH:ge,widgetsDataSources:Ut,widgetsEventHandlers:he,options:{}},ye=function(t){function n(e,n,a,i){var r=t.call(this,me)||this;return r.communication=e,r.layoutsConfiguration=n,r.configuration=a,r.route=i,r}return v(n,t),n.prototype.initPayload=function(){return{communication:this.communication,layoutsConfiguration:this.layoutsConfiguration,configuration:this.configuration,route:this.route}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:T},{type:x},{type:E},{type:s.ActivatedRoute}]},n=w([e.Component({selector:"n7-collection-layout",template:'<div class="aw-collection-layout"\r\n     *ngIf="lb.dataSource as dataSource">\r\n\r\n    <div class="aw-collection-layout__header">\r\n        <n7-inner-title [data]="dataSource.innerTitleData.getValue()">\r\n        </n7-inner-title>\r\n    </div>\r\n\r\n    <div class="aw-collection-layout__description"\r\n         *ngIf="dataSource.collectionDescription.getValue()">\r\n        <div class="aw-collection-layout__description-text">\r\n            {{ dataSource.collectionDescription.getValue() }}\r\n        </div>\r\n    </div>\r\n\r\n    <section class="n7-grid-3 aw-collection-layout__grid"\r\n            [ngClass]="{ \'is-loading\': dataSource.loading }"\r\n             *ngIf="dataSource.loadedCollections | async">\r\n        \r\n        <ng-container *ngFor="let item of (dataSource.loadedCollections | async)">\r\n            <n7-item-preview [data]="item">\r\n            </n7-item-preview>\r\n        </ng-container>\r\n        \r\n        <ng-container *ngIf="dataSource.loading">\r\n            <n7-content-placeholder *ngFor="let n of dataSource.pageSizeList"\r\n                                    [data]="{\r\n                blocks: [{ classes: \'collection-placeholder-item-preview\' }]\r\n            }"></n7-content-placeholder>\r\n        </ng-container>\r\n        \r\n    </section>\r\n\r\n    <section *ngIf="dataSource.loadMoreButton.getValue()">\r\n        <button class="n7-btn n7-btn-cta n7-btn-xl aw-collection-layout__btn-more"\r\n                (click)="dataSource.loadMore()"\r\n                [disabled]="dataSource.loading">\r\n            MOSTRA ALTRI\r\n        </button>\r\n    </section>\r\n</div>\r\n'}),S("design:paramtypes",[T,x,E,s.ActivatedRoute])],n)}(P),ve=function(t){return!t||"null"===t},be=function(t){return!!t.filter((function(t){return"isLink"===t.key})).length},we=function(t){return Array.isArray(t)},Se=function(t,e){var n=t.find((function(t){return"label"===t.key})).value,a=F.slugify(n),i=t.find((function(t){return"id"===t.key})).value,r=t.find((function(t){return"type"===t.key})).value,o=e.entitaBasePath;return["oggetto-culturale","aggregazione-logica"].includes(r)&&(o=e.schedaBasePath),'<a href="'+o+i+"/"+a+'">'+n+"</a>"},_e=function(t,e,n,a,i,r){var o=[];return t.filter((function(t){return t.fields})).forEach((function(t){var s=t.fields,c=[];be(s)&&(c.push("<div>"),c.push("<dd>"+Se(s,r)+"</dd>"),c.push("</div>")),s.filter((function(t){var e=t.key;return!be(s)||!["label","id","type","isLink"].includes(e)})).filter((function(t){var e=t.key,a=t.value;return n.includes(i+"."+e)&&!ve(a)})).map((function(t){var r=t.key;return{key:r,value:t.value,order:n.indexOf(i+"."+r),label:F.prettifySnakeCase(r,e[a+"."+i+"."+r])}})).sort((function(t,e){return t.order-e.order})).forEach((function(t){var e=t.label,n=t.value;c.push("<div>"),c.push("<dt>"+e+"</dt>"),c.push("<dd>"+n+"</dd>"),c.push("</div>")})),c.length&&o.push("<dl>"+c.join("")+"</dl>")})),o.length?o.join(""):null},ke=function(t){var e=t.fields,n=t.paths,a=t.labels,i=t.metadataToShow,r=t.type,o=[];return Array.isArray(e)&&e.forEach((function(t){var e=t.key,s=t.value,c=t.label,l=t.fields;l&&Array.isArray(l)?be(l)?o.push({key:c,value:Se(l,n)}):we(l)&&i.includes(c)&&o.push({key:c,value:_e(l,a,i,r,c,n)}):i.includes(e)&&o.push({key:e,value:s})})),o.filter((function(t){var e=t.value;return!ve(e)})).map((function(t){var e=t.key;return{key:e,value:t.value,order:i.indexOf(e),label:F.prettifySnakeCase(e,a[r+"."+e])}})).sort((function(t,e){return t.order-e.order}))},Ie=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasMetadataFields=!1,e.navHeader={},e.currentPage=1,e.pageSize=10,e.bubblesSize=10,e.fallbackText="",e.loading=!0,e.updateComponent=function(t,n,a){a&&e.one(t).updateOptions(a),e.one(t).update(n)},e.drawPagination=function(t,n){if(e.getLinkedObjectItems()){var a=e._getPaginationURL(),i=a.href,r=a.queryParams;e.one("n7-smart-pagination").updateOptions({mode:"href",href:i,queryParams:r}),e.one("n7-smart-pagination").update({totalPages:e.getPageCount(t,n),currentPage:+e.currentPage||1,pageLimit:5,sizes:{label:"Numero di risultati",list:[10,25,50],active:+e.pageSize}})}},e.handlePageNavigation=function(){e.myResponse&&e.getEntityDetailsPage(e.myResponse.id,+e.currentPage,+e.pageSize).pipe(o.first()).subscribe({next:function(t){e.myResponse=t;var n=e._getPaginationURL(),a=n.href,i=n.queryParams;e.pageSize=i.size,e.currentPage=i.page,e.drawPagination(e.getItemCount(),e.pageSize),e.one("aw-linked-objects").updateOptions({paginationParams:{href:a,queryParams:i},context:e.selectedTab,config:e.configuration,dynamicPagination:{total:e.getItemCount()},page:i.page,size:i.size,pagination:!0}),e.one("aw-linked-objects").update({items:e.getLinkedObjectItems()})},error:function(t){return o.catchError(t)}})},e.handleNavUpdate=function(t){e.selectedTab=t,e.updateWidgets(e.myResponse),e.one("aw-linked-objects").updateOptions({context:e.selectedTab,config:e.configuration,dynamicPagination:{total:e.getItemCount()},page:e.currentPage,size:e.pageSize,pagination:!0,paginationParams:e._getPaginationURL()}),e.one("aw-linked-objects").update({items:e.getLinkedObjectItems()});var n={page:e.currentPage,size:e.pageSize};e.router.navigate([],{relativeTo:e.route,queryParams:n,queryParamsHandling:"merge"})},e}return v(e,t),e.prototype.onInit=function(t){var e,n=t.configuration,a=t.mainState,i=t.router,r=t.route,o=t.options,s=t.titleService,c=t.communication;this.route=r,this.communication=c,this.configuration=n,this.mainState=a,this.options=o,this.router=i,this.titleService=s,this.currentId="",this.currentPage=null!==(e=+this.route.snapshot.queryParams.page)&&void 0!==e?e:1,this.one("aw-related-entities").updateOptions({config:this.configuration}),this.mainState.updateCustom("currentNav","entita"),this.mainState.update("headTitle","Arianna4View - Entità"),this.singleTabCheck()},e.prototype.singleTabCheck=function(){var t=this;this.getWidgetDataSource("aw-entita-nav").out$.pipe(o.filter((function(t){return!!t}))).subscribe((function(e){var n=e.items;1!==n.length||t.currentPage||t.router.navigate([n[0].anchor.href],{replaceUrl:!0})}))},e.prototype.updateWidgets=function(t){var e=this.selectedTab;Object.keys(t).forEach((function(e){Array.isArray(t[e])&&0===t[e].length&&(t[e]=null)})),this.one("aw-entita-nav").update({data:t,selected:e,basePath:this.getNavBasePath()}),this.updateComponent("aw-entita-metadata-viewer",this.getFields(this.myResponse)),this.one("aw-related-entities").update(this.myResponse.relatedEntities),this.drawPagination(this.getItemCount(),this.pageSize)},e.prototype.getEntityDetailsPage=function(t,e,n){var a=this;return this.communication.request$("getEntityDetails",{onError:function(t){return console.error(t)},params:{entityId:t,itemsPagination:{offset:((e||1)-1)*n,limit:+n},entitiesListSize:this.bubblesSize}}).pipe(o.tap((function(t){var e=t.fields,n=t.typeOfEntity;a.hasMetadataFields=!!ke({fields:e,paths:a.configuration.get("paths"),labels:a.configuration.get("labels"),metadataToShow:d.get(a.configuration.get("entita-layout"),"metadata-to-show",[]),type:n}).length})))},e.prototype.loadItem=function(t,e,n){return this.loading=!0,t&&n?(this.currentId=t,this.currentSlug=e,this.selectedTab=n,this.getEntityDetailsPage(t,this.currentPage,this.pageSize)):(this.pageTitle="Entità Test",r.of(null))},e.prototype.loadContent=function(t){this.loading=!1;var e=this.configuration.get("config-keys")[t.typeOfEntity];this.myResponse=t,this.navHeader={icon:e?e.icon:"",text:this.myResponse.label,color:e["class-name"]},this.one("aw-entita-nav").updateOptions({bubblesEnabled:this.bubblesEnabled,config:this.configuration.get("entita-layout"),hasMetadataFields:this.hasMetadataFields,labels:this.configuration.get("labels")}),this.one("aw-entita-metadata-viewer").update(this.getFields(t)),this.one("aw-linked-objects").updateOptions({context:this.selectedTab,config:this.configuration,page:this.currentPage,pagination:!0,dynamicPagination:{total:this.getItemCount()},paginationParams:this._getPaginationURL(),size:this.pageSize}),this.getLinkedObjectItems().forEach((function(e){e.relationName=t.label.length>30?t.label.substr(0,30)+"... ":t.label})),t.relatedEntities.forEach((function(e){e.relationName=t.label.length>30?t.label.substr(0,30)+"... ":t.label})),this.one("aw-linked-objects").update({items:this.getLinkedObjectItems()}),this.one("aw-related-entities").update(t.relatedEntities),this.hasMetadataFields||(this.fallbackText=this.configuration.get("entita-layout").fallback),this.mainState.update("headTitle","Arianna4View - Entità - "+this.myResponse.label)},e.prototype._getPaginationURL=function(){return{href:[this.configuration.get("paths").entitaBasePath,this.currentId+"/",this.currentSlug,"/"+this.selectedTab+"/"].join(""),queryParams:{page:this.currentPage||1,size:this.pageSize}}},e.prototype.getNavBasePath=function(){return[this.configuration.get("paths").entitaBasePath,this.currentId+"/",this.currentSlug].join("")},e.prototype.getItemCount=function(){switch(this.selectedTab){case"fondi-collegati":return this.myResponse.relatedLaTotalCount;case"oggetti-collegati":return this.myResponse.relatedItemsTotalCount;default:return 0}},e.prototype.getFields=function(t){var e=t.fields,n=t.typeOfEntity,a=this.configuration.get("paths"),i=this.configuration.get("labels"),r=d.get(this.configuration.get("entita-layout"),"metadata-to-show",[]);return"overview"===this.selectedTab&&(r=d.get(this.configuration.get("entita-layout"),"overview.informazioni",[])),ke({fields:e,paths:a,labels:i,metadataToShow:r,type:n})},e.prototype.getLinkedObjectItems=function(){return"fondi-collegati"===this.selectedTab?this.myResponse.relatedLa:this.myResponse.relatedItems},e.prototype.getPageCount=function(t,e){return Math.floor(t/e)},e}(l.LayoutDataSource),Ee=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new r.Subject,e.handlePageSizeChange=function(t){e.dataSource.pageSize=t,e.dataSource.currentPage=1,e.dataSource.handleNavUpdate("oggetti-collegati")},e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-entita-layout.init":t.dataSource.onInit(a),t.configuration=a.configuration,t.route=a.route,t.entityId=t.route.snapshot.params.id||"",t.dataSource.currentPage=t.route.snapshot.params.page||1,t.listenRoute(t.entityId),window.scrollTo(0,0);break;case"aw-entita-layout.destroy":t.destroyed$.next();break;case"aw-entita-layout.showmore":a&&t.dataSource.handleNavUpdate(a)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-entita-nav.click":a&&(t.dataSource.selectedTab=a,t.dataSource.handleNavUpdate(a));break;case"aw-linked-objects.change":var i={context:t.dataSource.selectedTab,config:t.dataSource.configuration,dynamicPagination:{total:t.dataSource.myResponse.totalCount},page:t.dataSource.currentPage,size:t.dataSource.pageSize,pagination:!0};t.dataSource.updateComponent("aw-linked-objects",{items:t.dataSource.myResponse.relatedItems},i);break;case"n7-smart-pagination.change":t.handlePageSizeChange(a.value)}}))},e.prototype.listenRoute=function(t,e){var n=this;void 0===t&&(t=""),void 0===e&&(e=!1),this.route.queryParams.pipe(o.map((function(t){return{page:t.page,size:t.size}}))).subscribe((function(t){var e=t.page,a=t.size;a&&(n.dataSource.pageSize=a),n.dataSource.currentPage!==e&&(n.dataSource.currentPage=e,n.dataSource.handlePageNavigation())})),this.route.paramMap.subscribe((function(a){if(a.get("id")){if(n.dataSource.currentId===a.get("id")&&!e)return void(n.dataSource.selectedTab!==a.get("tab")&&n.dataSource.handleNavUpdate(a.get("tab")));n.dataSource.loadItem(a.get("id"),a.get("slug"),a.get("tab")).subscribe((function(e){e&&(n.dataSource.loadContent(e),n.dataSource.updateWidgets(e),t&&n.emitOuter("selectItem",t))}))}else n.dataSource.loadItem();window.scrollTo(0,0)}))},e}(l.EventHandler),xe={layoutId:"aw-entita-layout",widgets:[{id:"aw-entita-nav",hasStaticData:!0},{id:"aw-entita-metadata-viewer"},{id:"aw-linked-objects"},{id:"aw-bubble-chart"},{id:"aw-related-entities"},{id:"aw-chart-tippy"},{id:"n7-smart-pagination",dataSource:Y,eventHandler:nt}],layoutDS:Ie,layoutEH:Ee,widgetsDataSources:Ut,widgetsEventHandlers:he,options:{}},Ce=function(t){function n(e,n,a,i,r,o,s){var c=t.call(this,i.get("AwEntitaLayoutConfig")||xe)||this;return c.router=e,c.route=n,c.configuration=a,c.layoutsConfiguration=i,c.communication=r,c.mainState=o,c.titleService=s,c}return v(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,router:this.router,route:this.route,titleService:this.titleService,communication:this.communication,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:s.Router},{type:s.ActivatedRoute},{type:E},{type:x},{type:T},{type:C},{type:c.Title}]},n=w([e.Component({selector:"aw-entita-layout",template:'<div class="aw-entity n7-side-auto-padding"\r\n     *ngIf="lb.dataSource">\r\n\r\n    <div class="aw-entity__sidebar">\r\n        \x3c!-- Custom header --\x3e\r\n        <div *ngIf="lb.dataSource.loading"\r\n             class="aw-entity__sidebar-title-wrapper-loading">\r\n            <n7-content-placeholder [data]="{\r\n                blocks: [{\r\n                    classes: \'entity-placeholder-title\'\r\n                }]\r\n            }">\r\n            </n7-content-placeholder>\r\n        </div>\r\n        <div *ngIf="!lb.dataSource.loading"\r\n             class="aw-entity__sidebar-title-wrapper color-{{lb.dataSource.navHeader.color}}">\r\n            <h1 class="aw-entity__sidebar-title">\r\n                <span class="aw-entity__sidebar-title-icon {{lb.dataSource.navHeader.icon}}"></span>\r\n                <span class="aw-entity__sidebar-title-text">{{lb.dataSource.navHeader.text}}</span>\r\n            </h1>\r\n        </div>\r\n        \x3c!-- Navigation --\x3e\r\n        <div *ngIf="lb.dataSource.loading"\r\n             class="aw-entity__sidebar-nav-loading">\r\n            <n7-content-placeholder *ngFor="let n of [0,1,2]"\r\n                                    [data]="{\r\n                blocks: [{\r\n                    classes: \'entity-placeholder-nav\'\r\n                }]\r\n            }">\r\n            </n7-content-placeholder>\r\n        </div>\r\n        <n7-nav *ngIf="!lb.dataSource.loading" \r\n        [data]="lb.widgets[\'aw-entita-nav\'].ds.out$ | async"\r\n        [emit]="lb.widgets[\'aw-entita-nav\'].emit">\r\n        </n7-nav>\r\n    </div>\r\n\r\n    \x3c!-- lb.dataSource.selectedTab --\x3e\r\n    <div *ngIf="lb.dataSource.loading"\r\n         class="aw-entity__content-loading">\r\n        <div class="aw-entity__content-loading-title">\r\n            <n7-content-placeholder [data]="{\r\n                blocks: [{\r\n                    classes: \'entity-placeholder-title\'\r\n                }]\r\n            }"></n7-content-placeholder>\r\n        </div>\r\n\r\n        <div class="aw-entity__content-loading-items">\r\n            <n7-content-placeholder *ngFor="let n of [0,1,2,3]"\r\n                                    [data]="{\r\n                blocks: [{ classes: \'entity-placeholder-item-preview\' }]\r\n            }"></n7-content-placeholder>\r\n        </div>\r\n    </div>\r\n\r\n    <div *ngIf="!lb.dataSource.loading"\r\n         class="aw-entity__content">\r\n        <section>\r\n            <div *ngIf="lb.dataSource.myResponse.wikiTab || lb.dataSource.myResponse.extraTab"\r\n                 class="aw-entity__content-section"\r\n                 [hidden]="lb.dataSource.selectedTab != \'overview\'">\r\n                <div class="aw-entity__overview-description">\r\n                    {{lb.dataSource.myResponse.extraTab}}\r\n                </div>\r\n                <div class="aw-entity-layout__button-wrapper">\r\n                    <a *ngIf="lb.dataSource.myResponse.wikiTab"\r\n                       class="n7-btn n7-btn-light"\r\n                       [routerLink]="[lb.dataSource.getNavBasePath() + \'/wiki\']">\r\n                        DESCRIZIONE WIKIPEDIA <i class="n7-icon-angle-right"></i>\r\n                    </a>\r\n                    <a *ngIf="lb.dataSource.myResponse.extraTab"\r\n                       class="n7-btn n7-btn-light"\r\n                       [routerLink]="[lb.dataSource.getNavBasePath() + \'/maxxi\']">\r\n                        DESCRIZIONE MAXXI <i class="n7-icon-angle-right"></i>\r\n                    </a>\r\n                </div>\r\n            </div>\r\n\r\n            <ng-container *ngIf="(\r\n                [\'overview\', \'informazioni\'].includes(lb.dataSource.selectedTab)\r\n            )">\r\n                <div class="aw-entity__content-section aw-entity__content-section-overview">\r\n                    <div class="aw-entity__content-section-header"\r\n                         *ngIf="lb.dataSource.selectedTab === \'overview\'">\r\n                        <h2 class="aw-entity__content-section-title"\r\n                            *ngIf="lb.dataSource.selectedTab === \'overview\'">Informazioni</h2>\r\n                        <a *ngIf="lb.dataSource.selectedTab !== \'informazioni\'"\r\n                           class="n7-btn n7-btn-light"\r\n                           [routerLink]="[lb.dataSource.getNavBasePath() + \'/informazioni\']">\r\n                            TUTTE LE INFORMAZIONI <i class="n7-icon-angle-right"></i>\r\n                        </a>\r\n                    </div>\r\n                    <p *ngIf="lb.dataSource.fallbackText"\r\n                       class="aw-entity__content-section-empty">\r\n                        {{ lb.dataSource.fallbackText }}\r\n                    </p>\r\n                    <n7-metadata-viewer class="aw-entity-layout__metadata-viewer"\r\n                                        [data]="lb.widgets[\'aw-entita-metadata-viewer\'].ds.out$ | async">\r\n                    </n7-metadata-viewer>\r\n                </div>\r\n            </ng-container>\r\n\r\n            <div class="aw-entity__content-section aw-entity__content-section-overview"\r\n                 *ngIf="(lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.previews && lb.dataSource.myResponse.relatedItems"\r\n                 [hidden]="lb.dataSource.selectedTab != \'overview\' && lb.dataSource.selectedTab != \'oggetti-collegati\'">\r\n                <div class="aw-entity__content-section-header">\r\n                    <h2 class="aw-entity__content-section-title">Oggetti collegati</h2>\r\n\r\n                    <a *ngIf="lb.dataSource.selectedTab === \'overview\' "\r\n                       [routerLink]="[lb.dataSource.getNavBasePath() + \'/oggetti-collegati/\']"\r\n                       [queryParams]="{ page: 1 }"\r\n                       class="n7-btn n7-btn-light">\r\n                        TUTTI GLI OGGETTI COLLEGATI <i class="n7-icon-angle-right"></i>\r\n                    </a>\r\n                </div>\r\n                <div class="aw-entity__content-item-previews aw-item-preview-list">\r\n                    <ng-container *ngFor="let preview of (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.previews">\r\n                        <div class="aw-item-preview-wrapper">\r\n                            <n7-smart-breadcrumbs [data]="preview.breadcrumbs">\r\n                            </n7-smart-breadcrumbs>\r\n                            <n7-item-preview [data]="preview"\r\n                                             [emit]="lb.widgets[\'aw-linked-objects\'].emit">\r\n                            </n7-item-preview>\r\n                            \x3c!-- Relation --\x3e\r\n                            <div class="aw-item-preview-relation"\r\n                                 *ngIf="preview.relation.value">\r\n                                <p class="aw-item-preview-relation__description">Tipo di relazione \r\n                                    \x3c!-- <span class="aw-item-preview-relation__key">{{preview.relation.key}}</span>: --\x3e\r\n                                    <span class="aw-item-preview-relation__value">{{preview.relation.value}}</span>\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </div>\r\n                <n7-smart-pagination *ngIf="lb.dataSource.selectedTab === \'oggetti-collegati\'"\r\n                                     [data]="lb.widgets[\'n7-smart-pagination\'].ds.out$ | async"\r\n                                     [emit]="lb.widgets[\'n7-smart-pagination\'].emit">\r\n                </n7-smart-pagination>\r\n            </div>\r\n\r\n            <div class="aw-entity__content-section aw-entity__content-section-overview"\r\n                 *ngIf="(lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.previews && lb.dataSource.myResponse.relatedLa"\r\n                 [hidden]="lb.dataSource.selectedTab != \'overview\' && lb.dataSource.selectedTab != \'fondi-collegati\'">\r\n                <div class="aw-entity__content-section-header">\r\n                    <h2 class="aw-entity__content-section-title">{{ lb.dataSource.configuration.get(\'labels\')[\'aggregazioni-logiche-collegate\'] }}</h2>\r\n\r\n                    <a *ngIf="lb.dataSource.selectedTab === \'overview\' "\r\n                       [routerLink]="[lb.dataSource.getNavBasePath() + \'/fondi-collegati/\']"\r\n                       [queryParams]="{ page: 1 }"\r\n                       class="n7-btn n7-btn-light">\r\n                        TUTTE LE FONDI COLLEGATI <i class="n7-icon-angle-right"></i>\r\n                    </a>\r\n                </div>\r\n                <div class="aw-entity__content-item-previews aw-item-preview-list">\r\n                    <ng-container *ngFor="let preview of (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.previews">\r\n                        <div class="aw-item-preview-wrapper">\r\n                            <n7-smart-breadcrumbs [data]="preview.breadcrumbs">\r\n                            </n7-smart-breadcrumbs>\r\n                            <n7-item-preview [data]="preview"\r\n                                             [emit]="lb.widgets[\'aw-linked-objects\'].emit">\r\n                            </n7-item-preview>\r\n                            \x3c!-- Relation --\x3e\r\n                            <div class="aw-item-preview-relation"\r\n                                 *ngIf="preview.relation.value">\r\n                                <p class="aw-item-preview-relation__description">Tipo di relazione\r\n                                    \x3c!-- <span class="aw-item-preview-relation__key">{{preview.relation.key}}</span>: --\x3e\r\n                                    <span class="aw-item-preview-relation__value">{{preview.relation.value}}</span>\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </div>\r\n                <n7-smart-pagination *ngIf="lb.dataSource.selectedTab === \'fondi-collegati\'"\r\n                                     [data]="lb.widgets[\'n7-smart-pagination\'].ds.out$ | async"\r\n                                     [emit]="lb.widgets[\'n7-smart-pagination\'].emit">\r\n                </n7-smart-pagination>\r\n            </div>\r\n\r\n            <div class="aw-entity__content-section aw-entity__content-section-overview aw-related-entities__{{lb.dataSource.selectedTab}}"\r\n                 *ngIf="lb.dataSource.myResponse.relatedEntities"\r\n                 [hidden]="lb.dataSource.selectedTab != \'overview\' && lb.dataSource.selectedTab != \'entita-collegate\'">\r\n                <div class="aw-entity__content-section-header">\r\n                    <h2 class="aw-entity__content-section-title">Entità collegate</h2>\r\n                    <a *ngIf="lb.dataSource.selectedTab == \'overview\'"\r\n                       class="n7-btn n7-btn-light"\r\n                       [routerLink]="[lb.dataSource.getNavBasePath() + \'/entita-collegate\']">\r\n                        TUTTE LE ENTITÀ COLLEGATE <i class="n7-icon-angle-right"></i>\r\n                    </a>\r\n                </div>\r\n\r\n                \x3c!-- ENTITA COLLEGATE --\x3e\r\n                <section id="related-item-container"\r\n                         class="aw-entity__section aw-entity__related">\r\n                    <div class="aw-entity__inner-title">\r\n                        {{lb.dataSource.relatedEntitiesHeader}}\r\n                    </div>\r\n                    <div class="aw-entity__related-items n7-grid-2 aw-item-preview-list">\r\n                        <ng-container *ngFor="let preview of (lb.widgets[\'aw-related-entities\'].ds.out$ | async)?.previews">\r\n                            <div class="aw-item-preview-wrapper">\r\n                                <n7-item-preview [data]="preview"\r\n                                                [emit]="lb.widgets[\'aw-related-entities\'].emit">\r\n                                </n7-item-preview>\r\n                                \x3c!-- Relation --\x3e\r\n                                <div class="aw-item-preview-relation"\r\n                                    *ngIf="preview.relation.value">\r\n                                    <p class="aw-item-preview-relation__description">Tipo di relazione\r\n                                        \x3c!-- <span class="aw-item-preview-relation__key">{{preview.relation.key}}</span>: --\x3e\r\n                                        <span class="aw-item-preview-relation__value">{{preview.relation.value}}</span>\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </ng-container>\r\n                    </div>\r\n                </section>\r\n            </div>\r\n            <div class="aw-entity__content-section aw-entity__content-section-maxxi"\r\n                 *ngIf="lb.dataSource.myResponse.extraTab"\r\n                 [hidden]="lb.dataSource.selectedTab != \'maxxi\'">\r\n                <div class="aw-entity__content-section-header aw-entity__content-section-header-decorated">\r\n                    <h2 class="aw-entity__content-section-title">Descrizione Maxxi</h2>\r\n                </div>\r\n                <div>\r\n                    {{lb.dataSource.myResponse.extraTab}}\r\n                </div>\r\n            </div>\r\n            <div class="aw-entity__content-section aw-entity__content-section-wiki"\r\n                 *ngIf="lb.dataSource.myResponse.wikiTab"\r\n                 [hidden]="lb.dataSource.selectedTab != \'wiki\'">\r\n                <div class="aw-entity__content-section-header aw-entity__content-section-header-decorated">\r\n                    <h2 class="aw-entity__content-section-title">Descrizione Wikipedia</h2>\r\n                </div>\r\n                <div>\r\n                    {{lb.dataSource.myResponse.wikiTab.text}}\r\n                </div>\r\n                <a href="{{lb.dataSource.myResponse.wikiTabUrl}}">\r\n                    {{ lb.dataSource.myResponse.wikiTab.url }}\r\n                </a>\r\n            </div>\r\n        </section>\r\n    </div>\r\n</div>\r\n'}),S("design:paramtypes",[s.Router,s.ActivatedRoute,E,x,T,C,c.Title])],n)}(P),De=function(){function t(){this._models={}}return t.prototype.add=function(t,e){if(this._models[t])throw Error("Search model '"+t+"' already exists!");this._models[t]=new N(t,e)},t.prototype.remove=function(t){this._models[t]&&delete this._models[t]},t.prototype.model=function(t){return this._models[t]||null},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"})],t)}(),Oe={totalCount:0,facets:[{id:"query",type:"value"},{id:"query-all",type:"value",hasStaticData:!0,data:[{value:"1",label:"Cerca in tutti i campi delle schede"}]},{id:"query-links",type:"value"},{id:"entity-types",type:"value",operator:"OR",limit:10,order:"count"},{id:"entity-search",type:"value"},{id:"entity-links",type:"value",searchData:["entity-type"]}],fields:[{inputs:[{type:"text",facetId:"query",placeholder:"Cerca nei titoli delle schede",filterConfig:{delay:500,minChars:3,searchIn:[{key:"label.ngrams",operator:"LIKE"}]}},{type:"checkbox",facetId:"query-all",filterConfig:{searchIn:[{key:"label.ngrams^5,text^4,fields.*^3",operator:"="}]}},{type:"link",facetId:"query-links",filterConfig:{isArray:!0,searchIn:[{key:"source.entityType",operator:"="}]}}]},{header:{label:"Relazione con",classes:"related-class"},inputs:[{type:"checkbox",facetId:"entity-types",filterConfig:{isArray:!0,context:"internal",target:"entity-links",searchIn:[{key:"searchData.entity-type",operator:"="}]}},{type:"text",facetId:"entity-search",placeholder:"Cerca entità",filterConfig:{delay:500,minChars:3,context:"internal",target:"entity-links",searchIn:[{key:"label",operator:"LIKE"}]}},{type:"link",facetId:"entity-links",emptyState:{label:"La tua ricerca non ha dato risultati, prova a cambiare i filtri"},filterConfig:{isArray:!0,limit:20,pagination:{limit:50,offset:0},searchIn:[{key:"relatedEntities.id",operator:"="}]}}]}],results:{order:{type:"text",key:"label_sort",direction:"ASC"},fields:[{id:"description",highlight:!0,limit:200}]},page:{offset:0,limit:10}},Te=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layoutId="aw-search-layout",e.configId="search-layout",e.currentNav="ricerca",e.headTitle="Arianna4View - Ricerca",e.facetsConfig=Oe,e.paginationList=[10,25,50],e.destroyed$=new r.Subject,e.resetButtonEnabled=!0,e.currentPage=1,e.pageSize=10,e.sidebarIsSticky=!1,e.isFirstLoading=!0,e.resultsLoading=!1,e.isSearchingText=new r.BehaviorSubject(!1),e.orderBy="label_sort",e.orderDirection="ASC",e.orderByLabel="Ordina per",e.orderByOptions=[{value:"_score_DESC",label:"Ordine per pertinenza",type:"score",selected:!1},{value:"label_sort_ASC",label:"Ordine alfabetico (A→Z)",type:"text",selected:!0},{value:"label_sort_DESC",label:"Ordine alfabetico (Z→A)",type:"text",selected:!1}],e.drawPagination=function(){var t=e._getPaginationParams(),n=t.href,a=t.queryParams;e.one("n7-smart-pagination").updateOptions({mode:"href",href:n,queryParams:a}),e.one("n7-smart-pagination").update({totalPages:Math.ceil(e.totalCount/e.pageSize),currentPage:e.currentPage,pageLimit:5,sizes:{label:"Numero di risultati",list:e.paginationList,active:e.pageSize}})},e.getSearchModelId=function(){return e.layoutId},e}return v(e,t),e.prototype.onInit=function(t){var e=t.configuration,n=t.mainState,a=t.options,i=t.communication,r=t.search;this.configuration=e,this.mainState=n,this.communication=i,this.search=r,this.options=a,this.prettifyLabels=this.configuration.get("labels"),this.configKeys=this.configuration.get("config-keys"),this.fallback=this.configuration.get(this.configId).fallback,this.pageTitle=this.configuration.get(this.configId).title,this.search.model(this.layoutId)&&this.search.remove(this.layoutId),this.search.add(this.layoutId,d.cloneDeep(this.facetsConfig)),this.searchModel=this.search.model(this.layoutId),N.queryParams&&(this.searchModel.updateFiltersFromQueryParams(N.queryParams),N.queryParams=null),this._sidebarStickyControl(),this.mainState.updateCustom("currentNav",this.currentNav),this.mainState.update("headTitle",this.headTitle)},e.prototype.onDestroy=function(){this.destroyed$.next(),N.queryParams=null},e.prototype.onSearchResponse=function(){this.resetButtonEnabled=!0,this.isFirstLoading&&(this.isFirstLoading=!1,this.one("facets-wrapper").update({searchModel:this.searchModel}),this.searchModel.updateInputsFromFilters())},e.prototype.onOrderByChange=function(t){var e=t.substring(0,t.lastIndexOf("_")),n=t.substring(t.lastIndexOf("_")+1),a="";this.orderByOptions.forEach((function(e){e.value===t?(e.selected=!0,a=e.type):e.selected=!1})),this.orderBy=e,this.orderDirection=n,this.searchModel.setSearchConfigOrderBy(e),this.searchModel.setSearchConfigDirection(n),this.searchModel.setSearchConfigType(a)},e.prototype.onPageSizeChange=function(t){return this.pageSize=t,this._updateSearchPage(this.currentPage)},e.prototype.onPaginationChange=function(t){var e=t.replace("page-","");return this._updateSearchPage(e)},e.prototype.onPaginationGoToChange=function(t){var e=t.replace("goto-","");return this._updateSearchPage(e)},e.prototype.resetPagination=function(){this._updateSearchPage(1)},e.prototype.onResultsLimitChange=function(t){this.setLimit(t),this.currentPage=1,this.searchModel.setPageConfigOffset(0)},e.prototype.setLimit=function(t){this.pageSize=t,this.searchModel.setPageConfigLimit(t),this.searchModel.setPageConfigOffset((this.currentPage-1)*this.pageSize)},e.prototype.getResultsReq$=function(t){var e=this;return this.communication.request$("search",{params:t,onError:function(t){return console.error(t)}}).pipe(o.tap((function(t){var n=t.totalCount,a=t.results;e.totalCount=n;var i=0;e.totalCount>1?i=2:1===e.totalCount&&(i=1),e.resultsTitle=e.configuration.get(e.configId).results[i],e.searchModel.updateTotalCount(n),e.one("aw-linked-objects").updateOptions({context:"gallery-layout"===e.configId?"gallery":"search",config:e.configuration,page:e.currentPage,pagination:!0,paginationParams:e._getPaginationParams(),dynamicPagination:{total:n},size:e.pageSize}),e.drawPagination(),e.one("aw-linked-objects").update({items:e._normalizeItems(a.items)})})))},e.prototype.getFacetsReq$=function(t){var e=this;return this.communication.request$("facets",{params:t,onError:function(t){return console.error(t)}}).pipe(o.tap((function(t){var n=t.facets;jt.onFacetsResponse(e.searchModel,n),e._addFacetsLabels(n),e._addFacetsOptions(n),e.searchModel.updateFacets(n)})))},e.prototype.doSearchRequest$=function(){var t=this.searchModel.getRequestParams(),e={searchParameters:b({totalCount:0,gallery:!("gallery-layout"!==this.configId)},t)};jt.resetOffset(),jt.updateParamsOffset(e.searchParameters),jt.addInitialLoader(this);var n=this.getResultsReq$(e),a=this.getFacetsReq$(e);return r.forkJoin(n,a)},e.prototype._updateSearchPage=function(t){if(+t===this.currentPage)return r.of(!1);this.currentPage=+t;var e=this.searchModel.getConfig().page.limit,n=(this.currentPage-1)*e;return this.searchModel.setPageConfigOffset(n),r.of(!0)},e.prototype._addFacetsLabels=function(t){var e=this;t.filter((function(t){return Array.isArray(t.data)})).forEach((function(t){t.data.forEach((function(t){var n=t.label;t.label=F.prettifySnakeCase(n,e.prettifyLabels[n])}))}))},e.prototype._addFacetsOptions=function(t){var e=this;t.filter((function(t){return"query-links"===t.id})).forEach((function(t){t.data.forEach((function(t){var n=e.configKeys[t.value];n&&(t.options={icon:n.icon,classes:"color-"+n["class-name"]})}))}))},e.prototype._normalizeItems=function(t){return t.map((function(t){return{item:b({},t)}}))},e.prototype._sidebarStickyControl=function(){var t=this;F.browserIsIE()||r.fromEvent(window,"scroll").pipe(o.takeUntil(this.destroyed$)).subscribe((function(){var e=window.pageYOffset,n=document.getElementsByClassName("sticky-parent")[0],a=n?n.offsetTop:0;t.sidebarIsSticky=a<=e}))},e.prototype._getPaginationParams=function(){var t=this.searchModel.getRequestParams(),e=this.searchModel.filtersAsQueryParams(t.filters);Object.keys(e).forEach((function(t){e[t]=e[t]||null})),e.orderby=this.orderBy,e.orderdirection=this.orderDirection,e.page=this.currentPage,e.limit=this.pageSize;var n=this.configuration.get("paths").searchBasePath;return"gallery-layout"===this.configId&&(n=this.configuration.get("paths").galleryBasePath),{href:n,queryParams:e}},e}(l.LayoutDataSource),Pe={totalCount:0,facets:[{id:"query",type:"value"},{id:"query-all",type:"value",hasStaticData:!0,data:[{value:"1",label:"Cerca in tutti i campi delle schede"}]},{id:"entity-types",type:"value",operator:"OR",limit:10,order:"count"},{id:"entity-search",type:"value"},{id:"entity-links",type:"value",searchData:["entity-type"]}],fields:[{inputs:[{type:"text",facetId:"query",placeholder:"Cerca nei titoli delle schede",filterConfig:{delay:500,minChars:3,searchIn:[{key:"label.ngrams",operator:"LIKE"}]}},{type:"checkbox",facetId:"query-all",filterConfig:{searchIn:[{key:"label.ngrams^5,text^4,fields.*^3",operator:"="}]}}]},{header:{label:"Relazione con",classes:"related-class"},inputs:[{type:"checkbox",facetId:"entity-types",filterConfig:{isArray:!0,context:"internal",target:"entity-links",searchIn:[{key:"searchData.entity-type",operator:"="}]}},{type:"text",facetId:"entity-search",filterConfig:{delay:500,minChars:3,context:"internal",target:"entity-links",searchIn:[{key:"label",operator:"LIKE"}]}},{type:"link",facetId:"entity-links",emptyState:{label:"La tua ricerca non ha dato risultati, prova a cambiare i filtri"},filterConfig:{isArray:!0,limit:20,pagination:{limit:50,offset:0},searchIn:[{key:"relatedEntities.id",operator:"="}]}}]}],results:{order:{type:"score",key:"_score",direction:"DESC"},fields:[{id:"description",highlight:!0,limit:200}]},page:{offset:0,limit:12}},Re=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layoutId="aw-gallery-layout",e.configId="gallery-layout",e.currentNav="galleria",e.headTitle="Arianna4View - Galleria",e.facetsConfig=Pe,e.paginationList=[12,24,48],e.pageSize=12,e}return v(e,t),e}(Te),$e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layoutId="aw-search-layout",e.destroyed$=new r.Subject,e.facetsChange$=new r.Subject,e.additionalParamsChange$=new r.Subject,e.previousText="",e.textHasChanged=!1,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.layoutId+".init":t.route=a.route,t.dataSource.onInit(a),t._listenToFacetsChange(),t._listenToAdditionalParamsChange(),t._listenToRouterChanges(),t._listenToInternalFilters(),(t.dataSource.searchModel.getFiltersByFacetId("query")[0].value||"").length>0&&(t.dataSource.isSearchingText.next(!0),setTimeout((function(){t.dataSource.onOrderByChange("_score_DESC"),t.additionalParamsChange$.next()}),100)),window.scrollTo(0,0);break;case t.layoutId+".destroy":t.dataSource.onDestroy(),t.destroyed$.next();break;case t.layoutId+".orderbychange":t.dataSource.onOrderByChange(a),t.additionalParamsChange$.next();break;case t.layoutId+".searchreset":t.dataSource.resetButtonEnabled=!1,t.dataSource.searchModel.clear(),t.additionalParamsChange$.next();break;default:console.warn("(search) unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"facets-wrapper.facetschange":t.dataSource.resetPagination();var i=t.dataSource.searchModel.getFiltersByFacetId("query")[0].value;t.textHasChanged=!(!i||i===t.previousText),t.previousText=i;var r=t.dataSource.orderByOptions.filter((function(t){return t.selected}))[0].value;t.textHasChanged&&(i||"").length>0?t.dataSource.isSearchingText.next(!0):0===(i||"").length&&/score/i.test(r)&&(t.dataSource.isSearchingText.next(!1),setTimeout((function(){t.dataSource.onOrderByChange("label_sort_ASC"),t.additionalParamsChange$.next()}),100));break;case"n7-smart-pagination.change":t.dataSource.onResultsLimitChange(a.value),t.additionalParamsChange$.next()}}))},e.prototype._listenToFacetsChange=function(){var t=this;this.facetsChange$.pipe(o.debounceTime(500)).subscribe((function(){t.dataSource.resultsLoading=!0,t.textHasChanged?t.additionalParamsChange$.next():t.dataSource.doSearchRequest$().subscribe((function(){t.dataSource.resultsLoading=!1,t.dataSource.onSearchResponse(),t.emitGlobal("searchresponse",t.dataSource.getSearchModelId())}))}))},e.prototype._listenToInternalFilters=function(){var t=this;jt.listenToChanges(this.dataSource).subscribe((function(){t.emitGlobal("searchresponse",t.dataSource.getSearchModelId())}))},e.prototype._listenToAdditionalParamsChange=function(){var t=this;this.additionalParamsChange$.subscribe((function(){var e=t.dataSource.searchModel,n=e.getRequestParams(),a=e.filtersAsQueryParams(n.filters);Object.keys(a).forEach((function(t){a[t]=a[t]||null})),a.orderby=t.dataSource.orderBy,a.orderdirection=t.dataSource.orderDirection,a.page=t.dataSource.currentPage,a.limit=t.dataSource.pageSize,t.textHasChanged&&(a.orderby="_score",a.orderdirection="DESC",t.textHasChanged=!1),t.emitGlobal("navigate",{handler:"router",path:[],queryParams:a}),t.facetsChange$.next()}))},e.prototype._listenToRouterChanges=function(){var t=this;this.route.queryParams.pipe(o.takeUntil(this.destroyed$)).subscribe((function(e){t.emitOuter("queryparamschange",e),e.orderby&&e.orderdirection&&t.dataSource.onOrderByChange(e.orderby+"_"+e.orderdirection),e.page&&t.dataSource.onPaginationChange("page-"+e.page),e.limit&&t.dataSource.setLimit(+e.limit),t.facetsChange$.next(),t.scrollRefElement?F.isElementInViewport(t.scrollRefElement)||t.scrollRefElement.scrollIntoView():t.scrollRefElement=document.querySelector(".scroll-ref")}))},e}(l.EventHandler),Le=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layoutId="aw-gallery-layout",e}return v(e,t),e}($e),Ae={layoutId:"aw-gallery-layout",widgets:[{id:"facets-wrapper",dataSource:Ft,eventHandler:ie},{id:"aw-linked-objects"},{id:"aw-search-layout-tabs",hasStaticData:!0},{id:"n7-smart-pagination",dataSource:Y,eventHandler:nt}],layoutDS:Re,layoutEH:Le,widgetsDataSources:Ut,widgetsEventHandlers:he,options:{}},Me=function(t){function n(e,n,a,i,r,o){var s=t.call(this,n.get("AwGalleryLayoutConfig")||Ae)||this;return s.configuration=e,s.layoutsConfiguration=n,s.mainState=a,s.communication=i,s.search=r,s.route=o,s}return v(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,communication:this.communication,search:this.search,route:this.route,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:E},{type:x},{type:C},{type:T},{type:De},{type:s.ActivatedRoute}]},n=w([e.Component({selector:"aw-gallery-layout",template:'<div class="aw-search aw-gallery n7-side-auto-padding"\r\n     id="gallery-layout">\r\n    <div class="aw-search__header">\r\n        <div class="aw-search__header-left">\r\n            <h1 class="aw-search__header-title">{{ lb.dataSource.pageTitle }}</h1>\r\n        </div>\r\n    </div>\r\n    <div class="aw-search__content-wrapper sticky-parent">\r\n        \x3c!-- Left sidebar: facets --\x3e\r\n        <div *ngIf="!(lb.widgets[\'facets-wrapper\'].ds.out$ | async)"\r\n             class="aw-search__sidebar-loading sticky-target">\r\n            <div class="aw-search__facets-loading">\r\n                <n7-content-placeholder [data]="{\r\n                    blocks: [{\r\n                        classes: \'search-placeholder-facet-input\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-check\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }]\r\n                }">\r\n                </n7-content-placeholder>\r\n            </div>\r\n        </div>\r\n        <div *ngIf="!!(lb.widgets[\'facets-wrapper\'].ds.out$ | async)"\r\n             class="aw-search__sidebar sticky-target"\r\n             [ngClass]="{ \'is-sticky\': lb.dataSource.sidebarIsSticky }">\r\n            <div class="aw-search__facets">\r\n                <aw-facets-wrapper [data]="lb.widgets[\'facets-wrapper\'].ds.out$ | async"\r\n                                   [emit]="lb.widgets[\'facets-wrapper\'].emit">\r\n                </aw-facets-wrapper>\r\n            </div>\r\n        </div>\r\n        <div class="scroll-ref">&nbsp;</div>\r\n        <div class="aw-search__content">\r\n            <div class="aw-search__results-header">\r\n                <div class="aw-search__results-header-left">\r\n                    <h3 *ngIf="!lb.dataSource.resultsLoading"\r\n                        class="aw-search__total">\r\n                        <span class="aw-search__total-number">{{ lb.dataSource.totalCount }}</span>&nbsp;\r\n                        <span class="aw-search__total-title">{{ lb.dataSource.resultsTitle }}</span>\r\n                    </h3>\r\n                </div>\r\n                <div class="aw-search__results-header-right">\r\n                    <label class="aw-search__results-select-orderby-label"\r\n                           for="aw-search__results-select-orderby">{{ lb.dataSource.orderByLabel }}</label>\r\n                    <select (change)="lb.eventHandler.emitInner(\'orderbychange\', $event.target.value)"\r\n                            id="aw-search__results-select-orderby">\r\n                        <option *ngFor="let option of lb.dataSource.orderByOptions"\r\n                                [value]="option.value"\r\n                                [selected]="option.selected"\r\n                                [hidden]="option.type === \'score\' && lb.dataSource.isSearchingText.value === false">\r\n                            {{ option.label }}</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n            \x3c!-- Search details --\x3e\r\n            <div *ngIf="lb.dataSource.resultsLoading"\r\n                 class="aw-search__results-wrapper-loading">\r\n                <n7-content-placeholder *ngFor="let n of [0,1,2,3,4,5,6,7,8,9]"\r\n                                        [data]="{\r\n                    blocks: [\r\n                        { classes: \'search-result-placeholder-title\' },\r\n                        { classes: \'search-result-placeholder-metadata\' },\r\n                        { classes: \'search-result-placeholder-metadata\' },\r\n                        { classes: \'search-result-placeholder-metadata\' }\r\n                    ]\r\n                }"></n7-content-placeholder>\r\n            </div>\r\n            <div *ngIf="!lb.dataSource.resultsLoading"\r\n                 class="aw-search__results-wrapper">\r\n                <div class="n7-grid-3">\r\n                    <div *ngFor="let preview of (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.previews">\r\n                        <n7-smart-breadcrumbs [data]="preview.breadcrumbs">\r\n                        </n7-smart-breadcrumbs>\r\n                        <n7-item-preview [data]="preview"\r\n                                         [emit]="lb.widgets[\'aw-linked-objects\'].emit">\r\n                        </n7-item-preview>\r\n                    </div>\r\n                </div>\r\n                <ng-container *ngIf="lb.dataSource.totalCount == 0">\r\n                    <div class="aw-search__fallback">\r\n                        <p class="aw-search__fallback-string">\r\n                            {{ lb.dataSource.fallback }}\r\n                        </p>\r\n                        <button [disabled]="!lb.dataSource.resetButtonEnabled"\r\n                                class="n7-btn aw-search__fallback-button"\r\n                                (click)="lb.eventHandler.emitInner(\'searchreset\', {})">\r\n                            Resetta la ricerca\r\n                        </button>\r\n                    </div>\r\n                </ng-container>\r\n                <n7-smart-pagination *ngIf="lb.dataSource.totalCount > 10"\r\n                                     [data]="lb.widgets[\'n7-smart-pagination\'].ds.out$ | async"\r\n                                     [emit]="lb.widgets[\'n7-smart-pagination\'].emit">\r\n                </n7-smart-pagination>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),S("design:paramtypes",[E,x,C,T,De,s.ActivatedRoute])],n)}(P),He=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.facetInputs={},e.autocompletePopoverOpen=!1,e.autocompleteChanged$=new r.Subject,e.numOfItemsStr=null,e.currentHoverEntity=null,e.hasScrollBackground=!1,e.resultsLimit=-1,e.selectedEntitiesIds=[],e.destroyed$=new r.Subject,e.homeAutocompleteIsLoading=!1,e.resultsListIsLoading=!1,e.carouselEnabled=!1,e.bubblesEnabled=!1,e.selectedBubbles=[],e.updateComponent=function(t,n,a){a&&e.one(t).updateOptions(a),e.one(t).update(n)},e}return v(e,t),e.prototype.onInit=function(t){var e,n,a=t.communication,i=t.mainState,r=t.configuration,o=t.tippy;this.communication=a,this.configuration=r,this.mainState=i,this.tippy=o,this.resultsLimit=this.configuration.get("home-layout")["results-limit"],this.bubblesEnabled=null===(e=this.configuration.get("features-enabled"))||void 0===e?void 0:e.bubblechart,this.carouselEnabled=null===(n=this.configuration.get("features-enabled"))||void 0===n?void 0:n.carousel,this.carouselEnabled&&this.loadCarousel(),this.one("aw-hero").update(this.configuration.get("home-layout")["top-hero"]),this.one("aw-home-hero-patrimonio").update(this.configuration.get("home-layout")["bottom-hero"]),this.mainState.update("headTitle","Arianna4View - Homepage"),this.mainState.update("pageTitle","Arianna4View - Homepage"),this.mainState.updateCustom("currentNav","home"),this._listenAutoCompleteChanges(),this.outerLinks=this.configuration.get("home-layout")["outer-links"].test,this.outerLinksTitle=this.configuration.get("home-layout")["outer-links"].title,this.one("aw-bubble-chart").updateOptions({selectable:!0,config:this.configuration,limit:this.configuration.get("bubble-chart").bubbleLimit}),this.one("aw-chart-tippy").updateOptions({basePath:this.configuration.get("paths").entitaBasePath,selectable:!0})},e.prototype.onDestroy=function(){this.destroyed$.next()},e.prototype.makeRequest$=function(t,e){return this.communication.request$(t,{onError:function(t){return console.error(t)},params:e})},e.prototype.initialFilterRequest=function(){return this.communication.request$("globalFilter",{onError:function(t){return console.error(t)},params:{entitiesListSize:this.configuration.get("bubble-chart").bubbleLimit}})},e.prototype.parseInitialRequest=function(t){var e=this;this.firstBubbleResponse=t.entitiesData;var n=[];t.typeOfEntityData.forEach((function(t){var a=e.configuration.get("config-keys")[t.type];n.push(b(b(b({},t),{enabled:!0,locked:!1}),a))})),this.one("aw-home-facets-wrapper").update(n)},e.prototype.renderPreviewsFromApolloQuery=function(t){var e=this;if(t&&t.itemsPagination){var n=t.itemsPagination.totalCount;if(n>0){for(var a=0;n>999;)n-=1e3,a+=1;var i=""+n;n<10?i="00"+n:n<100&&(i="0"+n),this.numOfItemsStr=a>0?a+"."+i:""+n}else this.numOfItemsStr="0";this.one("aw-linked-objects").updateOptions({context:"home",config:this.configuration}),this.one("aw-linked-objects").update(t.itemsPagination),setTimeout((function(){e._scrollBackgroundControl()}))}},e.prototype.updateTags=function(t){t||this.renderItemTags()},e.prototype.handleFacetSearchChange=function(t){var e=t.inputPayload,n=t.value;this.facetInputs[e]=n},e.prototype.renderItemTags=function(){var t=this,e=[],n=[];this.selectedBubbles.forEach((function(a){var i=t.firstBubbleResponse.find((function(t){return t.entity.id===a}));if(i){var r=t.configuration.get("config-keys")[i.entity.typeOfEntity];n.push({label:i.entity.label,icon:"n7-icon-close",payload:a,classes:"tag-"+r["class-name"]})}else{var o={entityId:a,entitiesListSize:1};e.push(t.makeRequest$("getMissingBubble",o))}})),e.length>0?r.forkJoin(e).subscribe((function(e){e.forEach((function(e){var a=t.configuration.get("config-keys")[e.typeOfEntity];n.push({label:e.label,icon:"n7-icon-close",payload:e.id,classes:"tag-"+a["class-name"]})})),t.one("aw-home-item-tags-wrapper").update(n)})):this.one("aw-home-item-tags-wrapper").update(n)},e.prototype.loadCarousel=function(){var t=this;this.communication.request$("getSlider").subscribe({next:function(e){e&&t.one("aw-carousel").update(e)},error:function(e){console.error(e),t.carouselEnabled=!1}})},e.prototype.onHeroChange=function(t){if(t){var e=F.escapeQuotes(t);this.autocompleteChanged$.next(e),this.homeAutocompleteIsLoading=!0,this.homeAutocompleteQuery=e,this.autocompletePopoverOpen||this._toggleAutocompletePopover()}else this.autocompletePopoverOpen&&this._toggleAutocompletePopover()},e.prototype._scrollBackgroundControl=function(){var t=this,e=document.getElementById("bubble-results-list");if(e){var n=r.fromEvent(e,"scroll");setTimeout((function(){t._setHasScrollBackground(e)}),500),n.pipe(o.debounceTime(50)).subscribe((function(e){var n=e.target;t._setHasScrollBackground(n)}))}},e.prototype._setHasScrollBackground=function(t){this.hasScrollBackground=!!t&&t.scrollHeight>t.scrollTop+t.clientHeight},e.prototype._listenAutoCompleteChanges=function(){var t=this;this.one("aw-home-autocomplete").updateOptions({keys:this.configuration.get("config-keys"),config:this.configuration,labels:this.configuration.get("labels"),paths:this.configuration.get("paths")}),this.autocompleteChanged$.pipe(o.debounceTime(500),o.takeUntil(this.destroyed$)).subscribe((function(e){t.communication.request$("autoComplete",{onError:function(t){return console.error(t)},params:{input:e,itemsPagination:{offset:0,limit:t.configuration.get("home-layout")["results-limit"]}}}).subscribe((function(n){t.homeAutocompleteIsLoading=!1,t.one("aw-home-autocomplete").update({response:n,query:e})}))}))},e.prototype._toggleAutocompletePopover=function(){var t=this;if(!this.autocompletePopover){var e=document.getElementById("aw-home-advanced-autocomplete-popover");e.style.display="block";var n=_(this.tippy(".aw-home__top-hero .n7-hero__input",{content:e,trigger:"manual",interactive:!0,arrow:!1,flip:!1,appendTo:"parent",theme:"light-border",placement:"bottom-start",maxWidth:"100%",onHidden:function(){t.autocompletePopoverOpen=!1}}),1)[0];this.autocompletePopover=n}this.autocompletePopoverOpen?this.autocompletePopover.hide():this.autocompletePopover.show(),this.autocompletePopoverOpen=!this.autocompletePopoverOpen},e}(l.LayoutDataSource),je=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new r.Subject,e.handleSimpleAutocompleteClick=function(t){e.emitOuter("facetclick",t)},e.handleChartSelection=function(t){var n=t;e.dataSource.selectedBubbles=t,e.dataSource.resultsListIsLoading=!0,e.dataSource.makeRequest$("globalFilter",{selectedEntitiesIds:n,entitiesListSize:e.configuration.get("bubble-chart").bubbleLimit}).subscribe((function(t){if(e.dataSource.resultsListIsLoading=!1,t&&t.entitiesData.length>0)e.dataSource.lastBubbleResponse=t.entitiesData,e.emitOuter("filterbubbleresponse",t.entitiesData),e.dataSource.renderPreviewsFromApolloQuery(t),e.dataSource.renderItemTags();else{var n=[];e.dataSource.selectedBubbles.forEach((function(t){var a={entityId:t,entitiesListSize:1};n.push(e.dataSource.makeRequest$("getMissingBubble",a))})),r.forkJoin(n).subscribe((function(n){var a=[];n.forEach((function(t){a.push({count:0,entity:t})})),e.emitOuter("filterbubbleresponse",a),e.dataSource.renderPreviewsFromApolloQuery(t),e.dataSource.renderItemTags()}))}}))},e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-home-layout.init":t.dataSource.onInit(a),t.loadFilters(),t.configuration=a.configuration,window.scrollTo(0,0);break;case"aw-home-layout.outerlinkclick":t.emitGlobal("navigate",{handler:"router",path:a});break;case"aw-home-layout.destroy":t.dataSource.onDestroy();break;case"aw-home-layout.bubbleresultsviewallclick":var i=t.dataSource.selectedBubbles.join(","),r=t.configuration.get("paths").searchBasePath;t.emitGlobal("navigate",{handler:"router",path:[r],queryParams:{"entity-links":i}});break;case"aw-home-layout.clearselection":t.emitOuter("clearselection");break;default:console.warn("(home) unhandled inner event of type: ",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-bubble-chart.d3end":t.emitOuter("d3end",a);break;case"aw-chart-tippy.select":t.emitOuter("select",a);break;case"aw-hero.enter":var i=F.escapeQuotes(a.value);t.emitGlobal("navigate",{handler:"router",path:[t.configuration.get("paths").searchBasePath],queryParams:{query:i}});break;case"aw-hero.change":t.dataSource.autocompleteValue=a.value,t.dataSource.onHeroChange(a.value);break;case"aw-home-facets-wrapper.click":t.emitOuter("togglefilter",a);break;case"aw-home-facets-wrapper.change":if(!a.value||"string"==typeof a.value&&0===a.value.trim().length)t.emitOuter("facetswrapperclose",{facetId:a});else if(a.value){t.emitOuter("facetswrapperrequest",{facetId:a}),t.dataSource.updateComponent("aw-autocomplete-wrapper",{key:a.value,response:null});var r={input:a.value,typeOfEntity:a.inputPayload.replace(/-search/g,"").replace(/-/g," "),itemsPagination:{offset:0,limit:t.configuration.get("home-layout")["results-limit"]}};t.dataSource.makeRequest$("autoComplete",r).subscribe((function(e){if(e.results.length<1){var n={totalcount:0,results:[{entity:{id:"fallback",label:t.configuration.get("home-layout")["autocomplete-fallback"]?t.configuration.get("home-layout")["autocomplete-fallback"]:"Nessun risultato trovato"}}]};t.dataSource.updateComponent("aw-autocomplete-wrapper",{key:a.value,response:n},{config:t.configuration})}else t.dataSource.updateComponent("aw-autocomplete-wrapper",{key:a.value,response:e},{config:t.configuration})}))}break;case"aw-home-item-tags-wrapper.click":t.emitOuter("tagclick",a);break;case"aw-linked-objects.datarequest":var o=a.currentPage;r={selectedEntitiesIds:t.dataSource.selectedBubbles,itemsPagination:{offset:o*t.dataSource.resultsLimit,limit:t.dataSource.resultsLimit}};t.dataSource.makeRequest$("globalFilter",r).subscribe((function(e){e?t.emitOuter("dataresponse",{res:e}):console.warn("Unable to fetch additional data.")}));break;case"aw-autocomplete-wrapper.clickresult":t.handleSimpleAutocompleteClick(a);break;case"aw-home-autocomplete.click":var s=a.source,c=a.type,l=void 0;if("item"===s)l="oggetto-culturale"===c?t.configuration.get("paths").schedaBasePath:t.configuration.get("paths").entitaBasePath,t.emitGlobal("navigate",{handler:"router",path:[l,a.id,F.slugify(a.title)]});else if("showMore"===s){i=t.dataSource.homeAutocompleteQuery;l=t.configuration.get("paths").searchBasePath,t.emitGlobal("navigate",{handler:"router",path:[l],queryParams:{query:i}})}else"extendsearch"===s&&t.emitGlobal("navigate",{handler:"router",path:[t.configuration.get("paths").searchBasePath],queryParams:{query:t.dataSource.autocompleteValue,"query-all":1}});break;case"aw-bubble-chart.selection":t.handleChartSelection(a);break;case"aw-bubble-chart.lockfilter":t.emitOuter("lockfilter",a)}}))},e.prototype.loadFilters=function(){var t=this;this.dataSource.initialFilterRequest().subscribe((function(e){e&&(t.dataSource.parseInitialRequest(e),t.dataSource.bubblesEnabled&&t.emitOuter("filterbubbleresponse",e.entitiesData))}))},e.prototype.outerLinkClick=function(t,e){window.open(e,"_blank")},e}(l.EventHandler),Fe={layoutId:"aw-home-layout",widgets:[{id:"aw-carousel"},{id:"aw-hero"},{id:"aw-home-hero-patrimonio"},{id:"aw-bubble-chart"},{id:"aw-home-facets-wrapper"},{id:"aw-home-item-tags-wrapper"},{id:"aw-home-autocomplete"},{id:"aw-linked-objects"},{id:"aw-autocomplete-wrapper"},{id:"aw-chart-tippy"}],layoutDS:He,layoutEH:je,widgetsDataSources:Ut,widgetsEventHandlers:he,options:{}},qe=function(t){function n(e,n,a,i,r){var o=t.call(this,e.get("AwHomeLayoutConfig")||Fe)||this;return o.router=n,o.configuration=a,o.communication=i,o.mainState=r,o}return v(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,router:this.router,communication:this.communication,options:this.config.options||{},tippy:m}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:x},{type:s.Router},{type:E},{type:T},{type:C}]},n=w([e.Component({selector:"aw-home-layout",template:'<div class="aw-home" *ngIf="lb.dataSource">\r\n    \x3c!-- Carousel --\x3e\r\n    <div class="aw-home__carousel" *ngIf="lb.dataSource.carouselEnabled">\r\n        <n7-carousel [data]="lb.widgets[\'aw-carousel\'].ds.out$ | async">\r\n        </n7-carousel>\r\n    </div>\r\n\r\n    \x3c!-- Hero section at the top of the page --\x3e\r\n    <div class="aw-home__top-hero">\r\n        <n7-hero [data]="lb.widgets[\'aw-hero\'].ds.out$ | async" [emit]="lb.widgets[\'aw-hero\'].emit">\r\n        </n7-hero>\r\n    </div>\r\n\r\n    \x3c!-- Bubble chart --\x3e\r\n    <div class="aw-home__bubble-wrapper n7-side-auto-padding"\r\n        [ngClass]="{ \'has-results\' : lb.dataSource.selectedBubbles.length > 0 }" *ngIf="lb.dataSource.bubblesEnabled">\r\n        <div class="aw-home__facets-wrapper-loading" *ngIf="!(lb.widgets[\'aw-home-facets-wrapper\'].ds.out$ | async)">\r\n            <n7-content-placeholder *ngFor="let i of [0,1,2,3]" [data]="{\r\n                blocks: [{\r\n                    classes: \'facet-placeholder-header\'\r\n                }, {\r\n                    classes: \'facet-placeholder-input\'\r\n                }] \r\n            }"></n7-content-placeholder>\r\n        </div>\r\n        <div class="aw-home__facets-wrapper" *ngIf="!!(lb.widgets[\'aw-home-facets-wrapper\'].ds.out$ | async)">\r\n            <span class="aw-home__facet"\r\n                *ngFor="let widgetData of lb.widgets[\'aw-home-facets-wrapper\'].ds.out$ | async;">\r\n                <n7-facet-header [data]="widgetData.header" [emit]="lb.widgets[\'aw-home-facets-wrapper\'].emit">\r\n                </n7-facet-header>\r\n                <n7-facet [data]="widgetData.input" [emit]="lb.widgets[\'aw-home-facets-wrapper\'].emit">\r\n                </n7-facet>\r\n            </span>\r\n        </div>\r\n\r\n        <div class="aw-home__bubble-chart-wrapper-loading" *ngIf="!(lb.widgets[\'aw-bubble-chart\'].ds.out$ | async)">\r\n            <n7-content-placeholder [data]="{\r\n                blocks: [\r\n                    {\r\n                        classes: \'facet-placeholder-item-1\'\r\n                    }\r\n                ]\r\n            }"></n7-content-placeholder>\r\n        </div>\r\n        <div class="aw-home__bubble-chart-wrapper" *ngIf="!!(lb.widgets[\'aw-bubble-chart\'].ds.out$ | async)"\r\n            [style.overflow]="lb.dataSource.loadingBubbles ? \'visible\' : \'hidden\'">\r\n            <aw-bubble-chart-wrapper>\r\n                <aw-chart-tippy \r\n                    [data]="lb.widgets[\'aw-chart-tippy\'].ds.out$ | async"\r\n                    [emit]="lb.widgets[\'aw-chart-tippy\'].emit">\r\n                </aw-chart-tippy>\r\n                <n7-bubble-chart [data]="lb.widgets[\'aw-bubble-chart\'].ds.out$ | async"\r\n                    [emit]="lb.widgets[\'aw-bubble-chart\'].emit">\r\n                </n7-bubble-chart>\r\n            </aw-bubble-chart-wrapper>\r\n        </div>\r\n\r\n        \x3c!-- Linked objects --\x3e\r\n        <ng-container *ngIf="(lb.widgets[\'aw-bubble-chart\'].ds.out$ | async)?.selected.length > 0;">\r\n            <div class="aw-home__bubble-results" id="home-bubble-results">\r\n                <div *ngIf="lb.dataSource.numOfItemsStr" class="aw-home__bubble-results-title-wrapper">\r\n                    <h1 class="aw-home__bubble-results-title"><strong class="aw-home__bubble-results-title-counter">\r\n                            {{ lb.dataSource.numOfItemsStr }}</strong> <span> Risultati</span>\r\n                    </h1>\r\n                </div>\r\n                <div class="aw-home__bubble-tags-wrapper">\r\n                    <h3 class="aw-home__bubble-tags-title">Collegati a </h3>\r\n                    <ng-container *ngFor="let widgetData of lb.widgets[\'aw-home-item-tags-wrapper\'].ds.out$ | async;">\r\n                        <n7-tag [data]="widgetData" [emit]="lb.widgets[\'aw-home-item-tags-wrapper\'].emit">\r\n                        </n7-tag>\r\n                        <br>\r\n                    </ng-container>\r\n                </div>\r\n                <div class="aw-home__bubble-results-list-wrapper">\r\n                    <div class="aw-home__bubble-results-list-loading" *ngIf="lb.dataSource.resultsListIsLoading">\r\n                        <n7-content-placeholder \r\n                            *ngFor="let i of [1, 2, 3, 4, 5]"\r\n                            [data]="{\r\n                                blocks: [{\r\n                                    classes: \'search-result-placeholder-title\'\r\n                                }, {\r\n                                    classes: \'search-result-placeholder-metadata\'\r\n                                }]\r\n                        }"></n7-content-placeholder>\r\n                    </div>\r\n                    <div *ngIf="!lb.dataSource.resultsListIsLoading" class="aw-home__bubble-results-list"\r\n                        [attr.id]="\'bubble-results-list\'" (scroll)="lb.eventHandler.emitOuter(\'scroll\', $event.target)">\r\n\r\n                        <div class="aw-home__bubble-results-fallback"\r\n                            *ngIf="(lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.result.length < 1;">\r\n                            <p class="aw-home__bubble-results-fallback-text">\r\n                                {{ (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.fallback }}\r\n                            </p>\r\n                            <button class="n7-btn aw-home__bubble-results-reset"\r\n                                (click)="lb.eventHandler.emitInner(\'clearselection\')">\r\n                                Resetta la ricerca\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div class="aw-item-preview-list">\r\n                            <ng-container *ngFor="let preview of (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.result">\r\n                                <div class="aw-item-preview-wrapper">\r\n                                    <n7-smart-breadcrumbs [data]="preview.breadcrumbs">\r\n                                    </n7-smart-breadcrumbs>\r\n                                    <n7-item-preview [data]="preview"\r\n                                                        [emit]="lb.widgets[\'aw-linked-objects\'].emit">\r\n                                    </n7-item-preview>\r\n                                </div>\r\n                            </ng-container>\r\n                        </div>\r\n                        \r\n                        \x3c!-- <ng-container\r\n                            *ngFor="let widgetData of (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.result;">\r\n                            <n7-item-preview [data]="widgetData" [emit]="lb.widgets[\'aw-linked-objects\'].emit">\r\n                            </n7-item-preview>\r\n                        </ng-container> --\x3e\r\n\r\n                        <ng-container *ngIf="(lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.isLoading">\r\n                            <div class="aw-home__bubble-results-list-loader">\r\n                                <n7-loader [data]="(lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.loaderData">\r\n                                </n7-loader>\r\n                            </div>\r\n                        </ng-container>\r\n                    </div>\r\n                    <div [ngClass]="{ \'is-visible\' : lb.dataSource.hasScrollBackground }"\r\n                        class="aw-home__bubble-results-list-wrapper-with-scroll"></div>\r\n                </div>\r\n                \x3c!-- aw-linked-objects__actions --\x3e\r\n                <ng-container\r\n                    *ngIf="(lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.result.length > 0 && !lb.dataSource.resultsListIsLoading">\r\n                    <div *ngIf="(lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.actions as action"\r\n                        class="aw-home__bubble-results-list-actions">\r\n                        <button (click)="lb.eventHandler.emitInner(\'bubbleresultsviewallclick\')"\r\n                            class="n7-btn n7-btn-light n7-btn-l aw-home__bubble-results-list-view-all">\r\n                            {{action[0].label}}\r\n                        </button>\r\n                    </div>\r\n                </ng-container>\r\n            </div>\r\n        </ng-container>\r\n    </div>\r\n\r\n    \x3c!-- Outer links --\x3e\r\n    <div *ngIf="lb.dataSource.outerLinks && lb.dataSource.outerLinks.length > 0" class="aw-home__outer-links">\r\n        <section class="aw-home__outer-links-wrapper n7-side-auto-padding">\r\n            <h2 class="aw-home__outer-links-title" *ngIf="lb.dataSource.outerLinksTitle">\r\n                {{ lb.dataSource.outerLinksTitle }}\r\n            </h2>\r\n            <div class="aw-home__outer-links-items">\r\n                \x3c!-- Item preview --\x3e\r\n                <n7-item-preview *ngFor="let outerLink of lb.dataSource.outerLinks" [data]="outerLink"\r\n                    [emit]="lb.eventHandler.outerLinkClick.bind(lb.eventHandler)">\r\n                </n7-item-preview>\r\n                \x3c!-- END // Item preview --\x3e\r\n            </div>\r\n        </section>\r\n    </div>\r\n    \x3c!-- END // Outer links --\x3e\r\n\r\n    \x3c!-- Hero section at the bottom of the page --\x3e\r\n    <div class="aw-home__bottom-hero">\r\n        <n7-hero [data]="lb.widgets[\'aw-home-hero-patrimonio\'].ds.out$ | async"\r\n            [emit]="lb.widgets[\'aw-home-hero-patrimonio\'].emit">\r\n        </n7-hero>\r\n    </div>\r\n\r\n    \x3c!-- Adavanced autocomplete popover  --\x3e\r\n    <div class="aw-home__advanced-autocomplete" id="aw-home-advanced-autocomplete-popover" style="display: none;">\r\n        <div class="aw-home__advanced-autocomplete-loader" *ngIf="lb.dataSource.homeAutocompleteIsLoading">\r\n            <n7-loader [data]="{}"></n7-loader>\r\n        </div>\r\n        <n7-advanced-autocomplete *ngIf="!lb.dataSource.homeAutocompleteIsLoading"\r\n            [data]="lb.widgets[\'aw-home-autocomplete\'].ds.out$ | async"\r\n            [emit]="lb.widgets[\'aw-home-autocomplete\'].emit">\r\n        </n7-advanced-autocomplete>\r\n    </div>\r\n\r\n    \x3c!-- Simple autocomplete popover. DO NOT CHANGE parent div class! --\x3e\r\n    \x3c!-- Creating one template for each facet --\x3e\r\n    <div *ngFor="let widgetData of lb.widgets[\'aw-home-facets-wrapper\'].ds.out$ | async;"\r\n        class="aw-home__simple-autocomplete aw-simple-autocomplete__template" style="display: none;">\r\n        <div class="aw-home__simple-autocomplete-content aw-simple-autocomplete__tippy-wrapper">\r\n            <div class="aw-home__simple-autocomplete-loader aw-simple-autocomplete__tippy-wrapper-loader"\r\n                *ngIf="(lb.widgets[\'aw-autocomplete-wrapper\'].ds.out$ | async)?.loading">\r\n                <n7-loader [data]="{}"></n7-loader>\r\n            </div>\r\n            <n7-simple-autocomplete *ngIf="!(lb.widgets[\'aw-autocomplete-wrapper\'].ds.out$ | async)?.loading"\r\n                [data]="lb.widgets[\'aw-autocomplete-wrapper\'].ds.out$ | async"\r\n                [emit]="lb.widgets[\'aw-autocomplete-wrapper\'].emit">\r\n            </n7-simple-autocomplete>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),S("design:paramtypes",[x,s.Router,E,T,C])],n)}(P),Be=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageSize=10,e.state$=new r.BehaviorSubject("EMPTY"),e.currentPage=1,e}return v(e,t),e.prototype.onInit=function(t){var e=this,n=t.configuration,a=t.mainState,i=t.options,r=t.titleService,o=t.communication;this.communication=o,this.configuration=n,this.mainState=a,this.options=i,this.titleService=r,this.mainState.update("headTitle","Arianna4View - Mappa"),this.mainState.updateCustom("currentNav","mappa"),this.communication.request$("getMapObjects").subscribe((function(t){e.one("aw-map").update(t)}))},e.prototype.onMarkerOpen=function(t){var e=this,n=t.id,a=t.label;this.state$.next("LOADING"),this.communication.request$("getEntityRelatedItems",{params:{selectedEntitiesIds:[n]}}).subscribe((function(t){var i=t.itemsPagination;e.state$.next("SUCCESS"),e.relatedItems=i.items,e.total=e.relatedItems.length;var r="<strong>"+e.total+'</strong> Risultati collegati a<br><span class="aw-multimedia__results-title-big">'+a+"</span>";1===e.total&&(r="<strong>"+e.total+'</strong> Risultato collegato a<br><span class="aw-multimedia__results-title-big">'+a+"</span>");var o={title:{main:{text:r}},actions:{buttons:[{anchor:{href:e.configuration.get("paths").entitaBasePath+"/"+n+"/"+F.slugify(a)},text:"Vedi Entità"}]}};e.one("aw-scheda-inner-title").update(o),e.updateItems(),e.updatePagination()}))},e.prototype.onMarkerClose=function(){this.state$.next("EMPTY"),this.pageSize=10,this.currentPage=1,this.relatedItems=[],this.total=0,this.one("aw-scheda-inner-title").update({title:{main:{text:""}}}),this.one("aw-linked-objects").update({items:[]})},e.prototype.onPaginationChange=function(t){var e=t.value;this.pageSize=+e,this.updateItems(),this.updatePagination()},e.prototype.onPaginationClick=function(t){var e=t.page;"number"==typeof e&&e!==this.currentPage&&(this.currentPage=e,this.updateItems(),this.updatePagination())},e.prototype.updateItems=function(){this.one("aw-linked-objects").updateOptions({context:"map",config:this.configuration,page:this.currentPage,pagination:!0,size:this.pageSize}),this.one("aw-linked-objects").update({items:this.relatedItems})},e.prototype.updatePagination=function(){this.one("n7-smart-pagination").updateOptions({mode:"payload"}),this.one("n7-smart-pagination").update({totalPages:Math.ceil(this.total/this.pageSize),currentPage:this.currentPage,pageLimit:5,sizes:{label:"Numero di risultati",list:[10,25,50],active:this.pageSize}})},e}(l.LayoutDataSource),Ne=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-map-layout.init":t.dataSource.onInit(a),t.emitOuter("init",a),window.scrollTo(0,0);break;case"aw-map-layout.destroy":t.destroyed$.next()}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-map.markeropen":t.dataSource.onMarkerOpen(a);break;case"aw-map.markerclose":t.dataSource.onMarkerClose();break;case"n7-smart-pagination.change":t.dataSource.onPaginationChange(a);break;case"n7-smart-pagination.click":t.dataSource.onPaginationClick(a)}}))},e}(l.EventHandler),Ve={layoutId:"aw-map-layout",widgets:[{id:"aw-map"},{id:"aw-scheda-inner-title"},{id:"aw-linked-objects"},{id:"n7-smart-pagination",dataSource:Y,eventHandler:nt}],layoutDS:Be,layoutEH:Ne,widgetsDataSources:Ut,widgetsEventHandlers:he,options:{}},ze=function(t){function n(e,n,a,i,r){var o=t.call(this,n.get("AwMapLayoutConfig")||Ve)||this;return o.configuration=e,o.layoutsConfiguration=n,o.communication=a,o.mainState=i,o.titleService=r,o}return v(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,titleService:this.titleService,communication:this.communication,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:E},{type:x},{type:T},{type:C},{type:c.Title}]},n=w([e.Component({selector:"aw-map-layout",template:'<div class="aw-multimedia" id="map-layout" *ngIf="lb.dataSource">\r\n    <n7-inner-title [data]="{\r\n        title: {\r\n            main: {\r\n                    text: \'I luoghi dell\\\'archivio\'\r\n            }\r\n        }\r\n    }">\r\n    </n7-inner-title>\r\n\r\n    \x3c!-- Map --\x3e\r\n    <div class="aw-multimedia__map">\r\n        <n7-map [data]="lb.widgets[\'aw-map\'].ds.out$ | async"></n7-map>\r\n    </div>\r\n    \x3c!-- END // Map --\x3e\r\n\r\n    \x3c!-- RESULTS --\x3e\r\n    <div class="aw-multimedia__results">\r\n        <div class="aw-multimedia__loader" *ngIf="(lb.dataSource.state$ | async) === \'LOADING\'">\r\n            <ng-container>\r\n                <n7-loader></n7-loader>\r\n            </ng-container>\r\n        </div>\r\n\r\n        <div class="aw-multimedia__empty" *ngIf="(lb.dataSource.state$ | async) === \'EMPTY\'">\r\n            <ng-container>\r\n                <p class="aw-multimedia__empty-text">Clicca su un luogo della mappa per vedere tutti gli oggetti collegati.</p>\r\n            </ng-container>\r\n        </div>\r\n        \r\n        <ng-container *ngIf="(lb.dataSource.state$ | async) === \'SUCCESS\'">\r\n            <div class="aw-multimedia__results-title">\r\n                <n7-inner-title \r\n                    [data]="lb.widgets[\'aw-scheda-inner-title\'].ds.out$ | async">\r\n                </n7-inner-title>\r\n            </div>\r\n            <div class="aw-multimedia__results-wrapper">\r\n                <div>\r\n                    <div class="aw-item-preview-wrapper" *ngFor="let preview of (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.previews">\r\n                        <n7-smart-breadcrumbs \r\n                            [data]="preview.breadcrumbs">\r\n                        </n7-smart-breadcrumbs>\r\n                        <n7-item-preview \r\n                            [data]="preview" \r\n                            [emit]="lb.widgets[\'aw-linked-objects\'].emit">\r\n                        </n7-item-preview>\r\n                    </div>\r\n                </div>\r\n                <n7-smart-pagination *ngIf="lb.dataSource.total > 0"\r\n                    [data]="lb.widgets[\'n7-smart-pagination\'].ds.out$ | async"\r\n                    [emit]="lb.widgets[\'n7-smart-pagination\'].emit">\r\n                </n7-smart-pagination>\r\n            </div>\r\n        </ng-container>\r\n    </div>\r\n</div>'}),S("design:paramtypes",[E,x,T,C,c.Title])],n)}(P),Ue=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.destroyed$=new r.Subject,n.stickyControlTrigger$=new r.Subject,n.contentParts={},n.sidebarIsSticky=!1,n.treeMaxHeight="100%",n.contentIsLoading=!1,n.currentId=null,n.hasContent=!0,n.getTreeQuery="getTree",n.getTree=function(){return e.tree},n}return v(e,t),e.prototype.onInit=function(t){var e,n,a,i=t.configuration,r=t.mainState,o=t.router,s=t.options,c=t.titleService,l=t.communication;i&&(this.configuration=i,this.layoutConfig=this.configuration.get("scheda-layout")),this.mainState=r,this.router=o,this.titleService=c,this.communication=l,this.options=s,this.sidebarCollapsed||(this.sidebarCollapsed=null!==(e=this.layoutConfig.tree.collapsedByDefault)&&void 0!==e&&e),this.relatedEntitiesHeader=this.layoutConfig["related-entities"].title,this.similarItemsSectionTitle=this.layoutConfig["related-items"].title,this.externalUrlText=this.layoutConfig["external-url-text"],this.metadataSectionTitle=this.getMetadataSectionTitle(),this.hasSimilarItems=!1,this.one("aw-chart-tippy").updateOptions({basePath:this.configuration.get("paths").entitaBasePath}),this.emptyLabel=this.layoutConfig["empty-label"],this.emptyStateString=this.layoutConfig["empty-html"],this.one("aw-tree").updateOptions({config:this.configuration.get("config-keys")}),(null===(a=null===(n=this.layoutConfig)||void 0===n?void 0:n.tree)||void 0===a?void 0:a.lite)&&(this.getTreeQuery="getTreeLite"),this.mainState.update("headTitle","Arianna4View - Patrimonio"),this.mainState.update("pageTitle","Arianna4View - Patrimonio"),this.mainState.updateCustom("currentNav","patrimonio");var u=this.configuration.get("scheda-layout")["image-viewer"]||{};this.hasContextMenu=function(){return!!u["context-menu"]},this.one("aw-scheda-pdf").updateOptions(this.configuration.get("scheda-layout")["pdf-viewer"]||{}),this._sidebarStickyControl()},e.prototype.onDestroy=function(){this.destroyed$.next()},e.prototype.getMetadataSectionTitle=function(){return(this.configuration.get("scheda-layout").metadata||{}).title||null},e.prototype.getNavigation=function(t){return e.tree?r.of(e.tree):this.communication.request$(this.getTreeQuery,{onError:function(t){return console.error(t)},params:{treeId:t}})},e.prototype.setTree=function(t){e.tree=t},e.prototype.updateNavigation=function(t){this.one("aw-sidebar-header").update({text:t,isExpanded:!this.sidebarCollapsed})},e.prototype.loadItem=function(t){var e=this.configuration.get("scheda-layout")["related-items"]["max-related-items"];return this.communication.request$("getNode",{onError:function(t){return console.error(t)},params:{id:t,maxSimilarItems:e}})},e.prototype.loadContent=function(t){var e=this;if(t){this.currentDigitalObject=null,this.currentDigitalObjectIndex=null;var n=this.getFields(t);this.hasMetadata=!(!Array.isArray(n)||!n.length),this.hasSimilarItems=Array.isArray(t.relatedItems)&&t.relatedItems.length,this.hasBreadcrumb=Array.isArray(t.breadcrumbs)&&t.breadcrumbs.length,this.hasDigitalObjects=Array.isArray(t.digitalObjects)&&t.digitalObjects.length,this.hasRelatedEntities=Array.isArray(t.relatedEntities)&&t.relatedEntities.length,this.hasContent=!!(this.hasMetadata||this.hasSimilarItems||this.hasRelatedEntities||this.hasDigitalObjects),this.contentParts=[];var a={content:null};t.text&&(a.content=t.text),this.contentParts.push(a),this.hasDigitalObjects&&(t.digitalObjects=this.normalizeDigitalObjects(t.digitalObjects),this.one("aw-scheda-dropdown").update(t),this.digitalObjects=t.digitalObjects,this.changeDigitalObject(0));var i={icon:t.icon,title:{main:{text:t.title||t.label,classes:"bold"}},tools:t.subTitle,actions:{}};this.one("aw-scheda-inner-title").update(i),this.one("aw-scheda-metadata").update(n);var r={items:[]};t.breadcrumbs&&(t.breadcrumbs.forEach((function(t){r.items.push({label:t.label,anchor:{href:[e.configuration.get("paths").schedaBasePath,t.link+"/",F.slugify(t.label)].join("")}})})),this.one("aw-scheda-breadcrumbs").update(r)),this.mainState.update("headTitle","Arianna4View - Patrimonio - "+(t.title||t.label))}t.relatedItems&&(this.one("aw-linked-objects").updateOptions({context:"scheda",config:this.configuration}),this.one("aw-linked-objects").update(t)),t.relatedEntities&&(t.relatedEntities.forEach((function(e){var n=t.title||t.label;e.relationName=n.length>30?n.substr(0,30)+"... ":n})),this.one("aw-related-entities").updateOptions({context:"scheda",config:this.configuration,list:"relatedEntities",title:t.title}),this.one("aw-related-entities").update(t.relatedEntities)),setTimeout((function(){e.stickyControlTrigger$.next()}))},e.prototype.collapseSidebar=function(){this.layoutConfig.tree.collapsedByDefault=!this.layoutConfig.tree.collapsedByDefault,this.sidebarCollapsed=!this.sidebarCollapsed,this.getWidgetDataSource("aw-sidebar-header").toggleSidebar()},e.prototype._sidebarStickyControl=function(){var t=this;if(!F.browserIsIE()){var e=r.fromEvent(window,"scroll");r.merge(e,this.stickyControlTrigger$).pipe(o.takeUntil(this.destroyed$)).subscribe((function(){var e=window.pageYOffset,n=window.scrollY+window.innerHeight,a=document.getElementsByClassName("sticky-parent")[0],i=a.offsetTop,r=i+a.clientHeight;t.sidebarIsSticky=i<=e,t.sidebarIsSticky&&n<r?t.treeMaxHeight=n-e-50+"px":t.sidebarIsSticky&&n>=r?t.treeMaxHeight=r-e-50+"px":t.treeMaxHeight=n<r?n-i-50+"px":r-i-50+"px"}))}},e.prototype.getFields=function(t){var e=t.fields,n=t.document_type,a=t.document_classification,i=this.configuration.get("paths"),r=this.configuration.get("labels"),o="string"==typeof a?a.split("."):[],s=o[o.length-1],c=d.get(this.configuration.get("scheda-layout"),"metadata-to-show",{});return c=c[s]||c[n]||[],ke({fields:e,paths:i,labels:r,metadataToShow:c,type:n})},e.prototype.changeDigitalObject=function(t){if(this.currentDigitalObjectIndex!==t)if("external"===this.digitalObjects[t].type&&this.currentDigitalObject)window.open(this.digitalObjects[t].url,"_blank");else{var e=this.getWidgetDataSource("aw-scheda-image");e.reset(),this.currentDigitalObjectIndex=t,this.currentDigitalObject=this.digitalObjects[t],this.currentDigitalObject.type.includes("images")?e.hasInstance()?e.updateImages(this.currentDigitalObject):this.one("aw-scheda-image").update(this.currentDigitalObject):"pdf"===this.currentDigitalObject.type&&this.one("aw-scheda-pdf").update(this.currentDigitalObject)}},e.prototype.normalizeDigitalObjects=function(t){return t.map((function(t){return t.type.includes("images")?{id:"scheda-layout-viewer",type:t.type,label:t.label,hasNavigation:t.items.length>1,items:t.items.map((function(e){return{url:e.url,iiifImages:e.iiifImages,type:t.type}}))}:t}))},e.tree=null,e}(l.LayoutDataSource),Ge=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-scheda-layout.init":t.dataSource.onInit(a),t.configuration=a.configuration,t.route=a.route;var i=t.route.snapshot.params.id||"";i&&(t.dataSource.currentId=i),t.listenRoute(),t.loadNavigation(i),t.emitOuter("viewleaf"),window.scrollTo(0,0);break;case"aw-scheda-layout.destroy":t.destroyed$.next(),t.dataSource.onDestroy();break;case"aw-scheda-layout.togglesidebar":t.dataSource.collapseSidebar();break;default:console.warn("unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-sidebar-header.click":t.dataSource.collapseSidebar();break;case"aw-scheda-dropdown.click":t.dataSource.changeDigitalObject(a)}}))},e.prototype.listenRoute=function(){var t=this;this.route.paramMap.subscribe((function(e){var n=e.get("id");n&&(n&&(t.dataSource.currentId=n,t.emitOuter("routechanged",n)),t.dataSource.contentIsLoading=!0,t.dataSource.loadItem(n).pipe(o.switchMap((function(e){return t.parseDigitalObjects$(e)}))).subscribe((function(e){t.dataSource.contentIsLoading=!1,e&&t.dataSource.loadContent(e)}))),window.scrollTo(0,0)}))},e.prototype.loadNavigation=function(t){var e=this;this.dataSource.updateNavigation("Caricamento in corso..."),this.dataSource.getNavigation("patrimonio").subscribe((function(n){n&&(e.dataSource.setTree(n),e.dataSource.updateNavigation(e.dataSource.getTree().label),e.emitOuter("navigationresponse",{tree:e.dataSource.getTree(),currentItem:t,basePath:e.configuration.get("paths").schedaBasePath}))}))},e.prototype.parseDigitalObjects$=function(t){var e=this,n={};return Array.isArray(null==t?void 0:t.digitalObjects)&&t.digitalObjects.forEach((function(t){"images-iiif"===t.type&&t.items.forEach((function(t){var e=t.url;n[e]=r.from(fetch(e).then((function(t){if(!t.ok)throw Error(t.statusText);return t.json()})).catch((function(t){return console.warn("Error loading iiif manifest "+e,t),null})))}))})),d.isEmpty(n)?r.of(t):r.forkJoin(n).pipe(o.switchMap((function(n){return t.digitalObjects.forEach((function(t){"images-iiif"===t.type&&t.items.forEach((function(a,i){t.items[i].iiifImages=e.getManifestImages(n[a.url])}))})),r.of(t)})))},e.prototype.getManifestImages=function(t){var e=[];return(null==t?void 0:t.sequences)&&t.sequences.forEach((function(t){t.canvases.forEach((function(t){t.images.forEach((function(t){var n=t.resource;e.push(n["@id"])}))}))})),e},e}(l.EventHandler),We={layoutId:"aw-scheda-layout",widgets:[{id:"aw-sidebar-header"},{id:"aw-tree"},{id:"aw-scheda-breadcrumbs"},{id:"aw-scheda-metadata"},{id:"aw-scheda-dropdown"},{id:"aw-scheda-image"},{id:"aw-scheda-pdf"},{id:"aw-scheda-inner-title"},{id:"aw-related-entities"},{id:"aw-chart-tippy"},{id:"aw-linked-objects"}],layoutDS:Ue,layoutEH:Ge,widgetsDataSources:Ut,widgetsEventHandlers:he,options:{}},Ke=function(t){function n(e,n,a,i,r,o,s){var c=t.call(this,i.get("AwPatrimonioLayoutConfig")||We)||this;return c.router=e,c.route=n,c.configuration=a,c.layoutsConfiguration=i,c.mainState=r,c.titleService=o,c.communication=s,c}return v(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,router:this.router,route:this.route,titleService:this.titleService,communication:this.communication,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:s.Router},{type:s.ActivatedRoute},{type:E},{type:x},{type:C},{type:c.Title},{type:T}]},n=w([e.Component({selector:"aw-scheda-layout",template:'<div class="aw-scheda"\r\n     id="scheda-layout">\r\n    <div class="aw-scheda__content n7-side-auto-padding sticky-parent"\r\n         [ngClass]="{ \'is-collapsed\' : lb.dataSource.sidebarCollapsed }">\r\n\r\n        <ng-container *ngTemplateOutlet="tree"></ng-container>\r\n\r\n        <div class="aw-scheda__scheda-wrapper"\r\n             [hidden]="lb.dataSource.contentIsLoading">\r\n\r\n            <n7-smart-breadcrumbs *ngIf="lb.dataSource.hasBreadcrumb"\r\n                                  [data]="lb.widgets[\'aw-scheda-breadcrumbs\'].ds.out$ | async"\r\n                                  [emit]="lb.widgets[\'aw-scheda-breadcrumbs\'].emit">\r\n            </n7-smart-breadcrumbs>\r\n\r\n            <div *ngIf="!lb.dataSource.hasBreadcrumb"\r\n                 class="aw-scheda__fake-breadcrumbs"\r\n                 (click)="lb.eventHandler.emitInner(\'togglesidebar\', {})">\r\n                 <p class="aw-scheda__fake-breadcrumbs-open" \r\n                    *ngIf="lb.dataSource.sidebarCollapsed">\r\n                    Consulta il patrimonio\r\n                 </p>\r\n            </div>\r\n\r\n            <div *ngIf="!lb.dataSource.currentId"\r\n                 class="aw-scheda__intro-text"\r\n                 [innerHTML]="lb.dataSource.emptyLabel">\r\n            </div>\r\n\r\n            <n7-inner-title [data]="lb.widgets[\'aw-scheda-inner-title\'].ds.out$ | async">\r\n            </n7-inner-title>\r\n\r\n            \x3c!-- Empty state --\x3e\r\n            <ng-container *ngIf="!lb.dataSource.hasContent">\r\n                <ng-container *ngTemplateOutlet="empty"></ng-container>\r\n            </ng-container>\r\n\r\n            \x3c!-- Content sections --\x3e\r\n            <ng-container *ngIf="lb.dataSource.hasContent">\r\n                <ng-container *ngTemplateOutlet="content"></ng-container>\r\n            </ng-container>\r\n\r\n        </div>\r\n\r\n    </div>\r\n</div>\r\n\r\n<ng-template #tree>\r\n    <div class="aw-scheda__tree sticky-target"\r\n         [ngClass]="{ \'is-sticky\': lb.dataSource.sidebarIsSticky }">\r\n        <n7-sidebar-header [data]="lb.widgets[\'aw-sidebar-header\'].ds.out$ | async"\r\n                           [emit]="lb.widgets[\'aw-sidebar-header\'].emit"></n7-sidebar-header>\r\n        <div class="aw-scheda__tree-content-loading"\r\n             *ngIf="!(lb.widgets[\'aw-tree\'].ds.out$ | async)">\r\n            <n7-content-placeholder *ngFor="let n of [0,1,2,3]"\r\n                                    [data]="{\r\n                            blocks: [{\r\n                                classes: \'tree-placeholder-item\'\r\n                            }]\r\n                        }"></n7-content-placeholder>\r\n        </div>\r\n        <div class="aw-scheda__tree-content"\r\n             (click)="lb.eventHandler.emitOuter(\'treeposition\', $event)"\r\n             [ngStyle]="{\r\n                            \'max-height\': lb.dataSource.treeMaxHeight,\r\n                            \'overflow\': \'auto\'\r\n                        }">\r\n            <n7-tree [data]="lb.widgets[\'aw-tree\'].ds.out$ | async"\r\n                     [emit]="lb.widgets[\'aw-tree\'].emit"\r\n                     *ngIf="!lb.dataSource.sidebarCollapsed">\r\n            </n7-tree>\r\n        </div>\r\n    </div>\r\n</ng-template>\r\n\r\n<ng-template #empty>\r\n    <section class="aw-scheda__section aw-scheda__empty"\r\n             [innerHTML]="lb.dataSource.emptyStateString">\r\n    </section>\r\n</ng-template>\r\n\r\n<ng-template #content>\r\n    \x3c!-- Digital Object selection dropdown --\x3e\r\n    <section class="aw-scheda__digital-object-dropdown"\r\n            *ngIf="(\r\n                lb.dataSource.hasDigitalObjects \r\n                && lb.dataSource.digitalObjects.length > 1\r\n            )">\r\n        <p class="aw-scheda__digital-object-dropdown-label">\r\n            Seleziona l\'oggetto digitale da visualizzare:\r\n        </p>\r\n        <aw-scheda-dropdown \r\n        [data]="lb.widgets[\'aw-scheda-dropdown\'].ds.out$ | async"\r\n        [emit]="lb.widgets[\'aw-scheda-dropdown\'].emit">\r\n        </aw-scheda-dropdown>\r\n    </section>\r\n    \x3c!-- END // Digital Object selection dropdown --\x3e\r\n\r\n    \x3c!-- Digital Objects: images, IIP, PDFs, external links --\x3e\r\n    <section *ngIf="lb.dataSource.currentDigitalObject as $do" \r\n        class="aw-scheda__media aw-scheda__{{ $do.type }}"\r\n        [ngClass]="{ \r\n            \'navigation-hidden\': !$do.hasNavigation\r\n        }">\r\n        <ng-container [ngSwitch]="$do.type">\r\n            \x3c!-- IMAGE VIEWER (IIP) --\x3e\r\n            <ng-container *ngSwitchCase="\'images-iip\'">\r\n                <n7-image-viewer \r\n                (contextmenu)="lb.dataSource.hasContextMenu()" \r\n                [data]="lb.widgets[\'aw-scheda-image\'].ds.out$ | async">\r\n                </n7-image-viewer>\r\n            </ng-container>\r\n\r\n            \x3c!-- IMAGE VIEWER (IIIF) --\x3e\r\n            <ng-container *ngSwitchCase="\'images-iiif\'">\r\n                <n7-image-viewer \r\n                (contextmenu)="lb.dataSource.hasContextMenu()" \r\n                [data]="lb.widgets[\'aw-scheda-image\'].ds.out$ | async">\r\n                </n7-image-viewer>\r\n            </ng-container>\r\n\r\n            \x3c!-- IMAGE VIEWER (Simple: jpg, png) --\x3e\r\n            <ng-container *ngSwitchCase="\'images-simple\'">\r\n                <n7-image-viewer \r\n                (contextmenu)="lb.dataSource.hasContextMenu()"\r\n                [data]="lb.widgets[\'aw-scheda-image\'].ds.out$ | async">\r\n                </n7-image-viewer>\r\n            </ng-container>\r\n    \r\n            \x3c!-- PDF --\x3e\r\n            <ng-container *ngSwitchCase="\'pdf\'">\r\n                <aw-pdf-viewer \r\n                [data]="lb.widgets[\'aw-scheda-pdf\'].ds.out$ | async"\r\n                [emit]="lb.widgets[\'aw-scheda-pdf\'].emit">\r\n                </aw-pdf-viewer>\r\n            </ng-container>\r\n    \r\n            \x3c!-- EXTERNAL URL --\x3e\r\n            <ng-container *ngSwitchCase="\'external\'">\r\n                <div class="aw-scheda__external-url">\r\n                    <a class="aw-scheda__external-url-link" href="{{ $do.url }}" target="_blank">\r\n                        {{ $do.label || lb.dataSource.externalUrlText }}\r\n                        <span class="n7-icon-external-link"></span>\r\n                    </a>\r\n                </div>\r\n            </ng-container>\r\n        </ng-container>\r\n    </section>\r\n    \x3c!-- END // Digital Objects --\x3e\r\n\r\n    <section class="aw-scheda__section aw-scheda__description"\r\n             *ngIf="lb.dataSource.contentParts.content">\r\n        <div *ngFor="let part of lb.dataSource.contentParts">\r\n            <div [innerHTML]="part.content"></div>\r\n        </div>\r\n    </section>\r\n\r\n    \x3c!-- Metadata --\x3e\r\n    <section class="aw-scheda__section aw-scheda__metadata"\r\n             *ngIf="lb.dataSource.hasMetadata">\r\n        <div class="aw-scheda__inner-title"\r\n             *ngIf="lb.dataSource.metadataSectionTitle">\r\n            {{lb.dataSource.metadataSectionTitle}}\r\n        </div>\r\n        <n7-metadata-viewer [data]="lb.widgets[\'aw-scheda-metadata\'].ds.out$ | async">\r\n        </n7-metadata-viewer>\r\n    </section>\r\n    \x3c!-- END // Metadata --\x3e\r\n\r\n    \x3c!-- Related entities --\x3e\r\n    <section *ngIf="lb.dataSource.hasRelatedEntities"\r\n             id="related-item-container"\r\n             class="aw-scheda__section aw-scheda__related">\r\n        <div class="aw-scheda__inner-title">\r\n            {{lb.dataSource.relatedEntitiesHeader}}\r\n        </div>\r\n        <div class="aw-scheda__related-items aw-item-preview-list n7-grid-2">\r\n            <ng-container *ngFor="let preview of (lb.widgets[\'aw-related-entities\'].ds.out$ | async)?.previews">\r\n                <div class="aw-item-preview-wrapper">\r\n                    <n7-item-preview [data]="preview"\r\n                                     [emit]="lb.widgets[\'aw-related-entities\'].emit">\r\n                    </n7-item-preview>\r\n                    \x3c!-- Relation --\x3e\r\n                    <div class="aw-item-preview-relation"\r\n                         *ngIf="preview.relation?.value">\r\n                        <p class="aw-item-preview-relation__description">Tipo di relazione\r\n                            \x3c!-- <span class="aw-item-preview-relation__key">{{preview.relation.key}}</span>: --\x3e\r\n                            <span class="aw-item-preview-relation__value">{{preview.relation.value}}</span>\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </ng-container>\r\n        </div>\r\n    </section>\r\n    \x3c!-- END // Related entities --\x3e\r\n\r\n    \x3c!-- Similar Objects --\x3e\r\n    <section *ngIf="lb.dataSource.hasSimilarItems"\r\n             id="related-item-container"\r\n             class="aw-scheda__section aw-scheda__related">\r\n        <div class="aw-scheda__inner-title">\r\n            {{lb.dataSource.similarItemsSectionTitle}}\r\n        </div>\r\n        <div class="aw-scheda__related-items aw-item-preview-list n7-grid-2">\r\n            <ng-container *ngFor="let preview of (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.previews">\r\n                <div class="aw-item-preview-wrapper">\r\n                    <n7-item-preview [data]="preview"\r\n                                    [emit]="lb.widgets[\'aw-linked-objects\'].emit">\r\n                    </n7-item-preview>\r\n                </div> \r\n            </ng-container>\r\n        </div>\r\n    </section>\r\n    \x3c!-- END // Similar Objects --\x3e\r\n</ng-template>\r\n'}),S("design:paramtypes",[s.Router,s.ActivatedRoute,E,x,C,c.Title,T])],n)}(P),Qe={layoutId:"aw-search-layout",widgets:[{id:"facets-wrapper",dataSource:Ft,eventHandler:ie},{id:"aw-linked-objects"},{id:"aw-search-layout-tabs",hasStaticData:!0},{id:"n7-smart-pagination",dataSource:Y,eventHandler:nt}],layoutDS:Te,layoutEH:$e,widgetsDataSources:Ut,widgetsEventHandlers:he,options:{}},Ye=function(t){function n(e,n,a,i,r,o){var s=t.call(this,n.get("AwSearchLayoutConfig")||Qe)||this;return s.configuration=e,s.layoutsConfiguration=n,s.mainState=a,s.communication=i,s.search=r,s.route=o,s}return v(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,communication:this.communication,search:this.search,route:this.route,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:E},{type:x},{type:C},{type:T},{type:De},{type:s.ActivatedRoute}]},n=w([e.Component({selector:"aw-search-layout",template:'<div class="aw-search n7-side-auto-padding"\r\n     id="search-layout">\r\n    <div class="aw-search__header">\r\n        <div class="aw-search__header-left">\r\n            <h1 class="aw-search__header-title">{{ lb.dataSource.pageTitle }}</h1>\r\n        </div>\r\n        \x3c!--\r\n        <div class="aw-search__header-right">\r\n            <n7-nav\r\n                [data]="lb.widgets[\'aw-search-layout-tabs\'].ds.out$ | async"\r\n                [emit]="lb.widgets[\'aw-search-layout-tabs\'].emit">\r\n            </n7-nav>\r\n        </div>\r\n        --\x3e\r\n    </div>\r\n    <div class="aw-search__content-wrapper sticky-parent">\r\n        \x3c!-- Left sidebar: facets --\x3e\r\n        <div *ngIf="!(lb.widgets[\'facets-wrapper\'].ds.out$ | async)"\r\n             class="aw-search__sidebar-loading sticky-target">\r\n            <div class="aw-search__facets-loading">\r\n                <n7-content-placeholder [data]="{\r\n                    blocks: [{\r\n                        classes: \'search-placeholder-facet-input\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-check\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }, {\r\n                        classes: \'search-placeholder-facet-item\'\r\n                    }]\r\n                }">\r\n                </n7-content-placeholder>\r\n            </div>\r\n        </div>\r\n        <div *ngIf="!!(lb.widgets[\'facets-wrapper\'].ds.out$ | async)"\r\n             class="aw-search__sidebar sticky-target"\r\n             [ngClass]="{ \'is-sticky\': lb.dataSource.sidebarIsSticky }">\r\n            <div class="aw-search__facets">\r\n                <aw-facets-wrapper [data]="lb.widgets[\'facets-wrapper\'].ds.out$ | async"\r\n                                   [emit]="lb.widgets[\'facets-wrapper\'].emit">\r\n                </aw-facets-wrapper>\r\n            </div>\r\n        </div>\r\n        <div class="scroll-ref">&nbsp;</div>\r\n        <div class="aw-search__content">\r\n            <div class="aw-search__results-header">\r\n                <div class="aw-search__results-header-left">\r\n                    <h3 *ngIf="!lb.dataSource.resultsLoading"\r\n                        class="aw-search__total">\r\n                        <span class="aw-search__total-number">{{ lb.dataSource.totalCount }}</span>&nbsp;\r\n                        <span class="aw-search__total-title">{{ lb.dataSource.resultsTitle }}</span>\r\n                    </h3>\r\n                </div>\r\n                <div class="aw-search__results-header-right">\r\n                    <label class="aw-search__results-select-orderby-label"\r\n                           for="aw-search__results-select-orderby">{{ lb.dataSource.orderByLabel }}</label>\r\n                    <select (change)="lb.eventHandler.emitInner(\'orderbychange\', $event.target.value)"\r\n                            id="aw-search__results-select-orderby">\r\n                        <option *ngFor="let option of lb.dataSource.orderByOptions"\r\n                                [value]="option.value"\r\n                                [selected]="option.selected"\r\n                                [hidden]="option.type === \'score\' && lb.dataSource.isSearchingText.value === false">\r\n                            {{ option.label }}</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n            \x3c!-- Search details --\x3e\r\n            <div *ngIf="lb.dataSource.resultsLoading"\r\n                 class="aw-search__results-wrapper-loading">\r\n                <n7-content-placeholder *ngFor="let n of [0,1,2,3,4,5,6,7,8,9]"\r\n                                        [data]="{\r\n                    blocks: [\r\n                        { classes: \'search-result-placeholder-title\' },\r\n                        { classes: \'search-result-placeholder-metadata\' },\r\n                        { classes: \'search-result-placeholder-metadata\' },\r\n                        { classes: \'search-result-placeholder-metadata\' }\r\n                    ]\r\n                }"></n7-content-placeholder>\r\n            </div>\r\n            <div *ngIf="!lb.dataSource.resultsLoading"\r\n                 class="aw-search__results-wrapper">\r\n                 <div class="aw-item-preview-list">\r\n                    <ng-container *ngFor="let preview of (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.previews">\r\n                        <div class="aw-item-preview-wrapper">\r\n                            <n7-smart-breadcrumbs [data]="preview.breadcrumbs">\r\n                            </n7-smart-breadcrumbs>\r\n                            <n7-item-preview [data]="preview"\r\n                                            [emit]="lb.widgets[\'aw-linked-objects\'].emit">\r\n                            </n7-item-preview>\r\n                        </div>\r\n                    </ng-container>\r\n                </div>\r\n                <ng-container *ngIf="lb.dataSource.totalCount == 0">\r\n                    <div class="aw-search__fallback">\r\n                        <p class="aw-search__fallback-string">\r\n                            {{ lb.dataSource.fallback }}\r\n                        </p>\r\n                        <button [disabled]="!lb.dataSource.resetButtonEnabled"\r\n                                class="n7-btn aw-search__fallback-button"\r\n                                (click)="lb.eventHandler.emitInner(\'searchreset\', {})">\r\n                            Resetta la ricerca\r\n                        </button>\r\n                    </div>\r\n                </ng-container>\r\n                <n7-smart-pagination *ngIf="lb.dataSource.totalCount > 10"\r\n                                     [data]="lb.widgets[\'n7-smart-pagination\'].ds.out$ | async"\r\n                                     [emit]="lb.widgets[\'n7-smart-pagination\'].emit">\r\n                </n7-smart-pagination>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),S("design:paramtypes",[E,x,C,T,De,s.ActivatedRoute])],n)}(P),Xe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageSize=10,e.state$=new r.BehaviorSubject("EMPTY"),e.currentPage=1,e}return v(e,t),e.prototype.onInit=function(t){var e=this,n=t.configuration,a=t.mainState,i=t.options,r=t.titleService,o=t.communication;this.communication=o,this.configuration=n,this.mainState=a,this.options=i,this.titleService=r,this.mainState.update("headTitle","Arianna4View - Timeline"),this.mainState.updateCustom("currentNav","timeline"),this.communication.request$("getEventObjects",{params:{},onError:function(t){console.warn(t)}}).subscribe((function(t){e.one("aw-timeline").update(t)}))},e.prototype.onTimelineClick=function(t){var e=this,n=t.id,a=t.label,i=t.dateText;d.isNull(n)?(this.currentId=null,this.clearResults()):(this.state$.next("LOADING"),this.communication.request$("getEntityRelatedItems",{params:{selectedEntitiesIds:[n]}}).subscribe((function(t){var r=t.itemsPagination;e.state$.next("SUCCESS"),e.relatedItems=r.items,e.total=e.relatedItems.length;var o="<strong>"+e.total+'</strong> Risultati collegati a<br><span class="aw-multimedia__results-title-big">'+a+"</span>";1===e.total&&(o="<strong>"+e.total+'</strong> Risultato collegato a<br><span class="aw-multimedia__results-title-big">'+a+"</span>");var s={title:{main:{text:o},secondary:i?{text:i}:null},actions:{buttons:[{anchor:{href:e.configuration.get("paths").entitaBasePath+"/"+n+"/"+F.slugify(a)},text:"Vedi Entità"}]}};e.one("aw-scheda-inner-title").update(s),e.updateItems(),e.updatePagination()})))},e.prototype.clearResults=function(){this.relatedItems&&(this.state$.next("EMPTY"),this.pageSize=10,this.currentPage=1,this.relatedItems=[],this.total=0,this.one("aw-scheda-inner-title").update({title:{main:{text:""}}}),this.one("aw-linked-objects").update({items:[]}))},e.prototype.onPaginationChange=function(t){var e=t.value;this.pageSize=+e,this.updateItems(),this.updatePagination()},e.prototype.onPaginationClick=function(t){var e=t.page;"number"==typeof e&&e!==this.currentPage&&(this.currentPage=e,this.updateItems(),this.updatePagination())},e.prototype.updateItems=function(){this.one("aw-linked-objects").updateOptions({context:"map",config:this.configuration,page:this.currentPage,pagination:!0,size:this.pageSize}),this.one("aw-linked-objects").update({items:this.relatedItems})},e.prototype.updatePagination=function(){this.one("n7-smart-pagination").updateOptions({mode:"payload"}),this.one("n7-smart-pagination").update({totalPages:Math.ceil(this.total/this.pageSize),currentPage:this.currentPage,pageLimit:5,sizes:{label:"Numero di risultati",list:[10,25,50],active:this.pageSize}})},e}(l.LayoutDataSource),Ze=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-timeline-layout.init":t.dataSource.onInit(a),t.emitOuter("init",a),window.scrollTo(0,0);break;case"aw-timeline-layout.destroy":t.destroyed$.next()}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"aw-timeline.click":t.dataSource.onTimelineClick(a);break;case"n7-smart-pagination.change":t.dataSource.onPaginationChange(a);break;case"n7-smart-pagination.click":t.dataSource.onPaginationClick(a)}}))},e}(l.EventHandler),Je={layoutId:"aw-timeline-layout",widgets:[{id:"aw-timeline"},{id:"aw-scheda-inner-title"},{id:"aw-linked-objects"},{id:"n7-smart-pagination",dataSource:Y,eventHandler:nt}],layoutDS:Xe,layoutEH:Ze,widgetsDataSources:Ut,widgetsEventHandlers:he,options:{}},tn=function(t){function n(e,n,a,i,r){var o=t.call(this,n.get("AwTimelineLayoutConfig")||Je)||this;return o.configuration=e,o.layoutsConfiguration=n,o.communication=a,o.mainState=i,o.titleService=r,o}return v(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,titleService:this.titleService,communication:this.communication,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:E},{type:x},{type:T},{type:C},{type:c.Title}]},n=w([e.Component({selector:"aw-timeline-layout",template:'<div class="aw-multimedia" id="timeline-layout" *ngIf="lb.dataSource">\r\n    <n7-inner-title [data]="{\r\n               title: {\r\n                    main: {\r\n                         text: \'Gli eventi dell\\\'archivio\'\r\n                    }\r\n               }\r\n          }">\r\n    </n7-inner-title>\r\n    \r\n    \x3c!-- Timeline --\x3e\r\n    <div class="aw-multimedia__timeline">\r\n        <n7-timeline [data]="lb.widgets[\'aw-timeline\'].ds.out$ | async"></n7-timeline>\r\n        \r\n        <div id="timelinecontrols" class="aw-multimedia__timeline-controls" *ngIf="lb.widgets[\'aw-timeline\'].ds.timelineControlsVisible">\r\n            <button class="n7-btn aw-multimedia__timeline-control" (click)="lb.eventHandler.emitOuter(\'zoomin\', {})">\r\n                <span class="n7-icon-search-plus"></span>\r\n            </button>\r\n\r\n            <button class="n7-btn aw-multimedia__timeline-control" (click)="lb.eventHandler.emitOuter(\'zoomout\', {})">\r\n                <span class="n7-icon-search-minus"></span>\r\n            </button>\r\n        </div>\r\n\r\n    </div>\r\n    \x3c!-- END // Timeline --\x3e\r\n    \r\n    \x3c!-- RESULTS --\x3e\r\n    <div class="aw-multimedia__results">\r\n\r\n        <div class="aw-multimedia__loader" *ngIf="(lb.dataSource.state$ | async) === \'LOADING\'">\r\n            <ng-container>\r\n                <n7-loader></n7-loader>\r\n            </ng-container>\r\n        </div>\r\n\r\n        <div class="aw-multimedia__empty" *ngIf="(lb.dataSource.state$ | async) === \'EMPTY\'">\r\n            <ng-container>\r\n                <p class="aw-multimedia__empty-text">Clicca su un evento della timeline per vedere tutti gli oggetti culturali collegati.</p>\r\n            </ng-container>\r\n        </div>\r\n        \r\n        <ng-container *ngIf="(lb.dataSource.state$ | async) === \'SUCCESS\'">\r\n            <div class="aw-multimedia__results-title">\r\n                <n7-inner-title [data]="lb.widgets[\'aw-scheda-inner-title\'].ds.out$ | async">\r\n                </n7-inner-title>\r\n            </div>\r\n            <div class="aw-multimedia__results-wrapper">\r\n                <div>\r\n                    <div class="aw-item-preview-wrapper" *ngFor="let preview of (lb.widgets[\'aw-linked-objects\'].ds.out$ | async)?.previews">\r\n                        <n7-smart-breadcrumbs [data]="preview.breadcrumbs">\r\n                        </n7-smart-breadcrumbs>\r\n                        <n7-item-preview [data]="preview" [emit]="lb.widgets[\'aw-linked-objects\'].emit">\r\n                        </n7-item-preview>\r\n                    </div>\r\n                </div>\r\n                <n7-smart-pagination *ngIf="lb.dataSource.total > 0"\r\n                    [data]="lb.widgets[\'n7-smart-pagination\'].ds.out$ | async"\r\n                    [emit]="lb.widgets[\'n7-smart-pagination\'].emit">\r\n                </n7-smart-pagination>\r\n            </div>\r\n        </ng-container>\r\n    </div>\r\n</div>'}),S("design:paramtypes",[E,x,T,C,c.Title])],n)}(P),en=function(){function t(){}return t.prototype.headerEmit=function(t,e){this.emit&&this.emit("facetheader",{eventType:t,eventPayload:e})},t.prototype.facetEmit=function(t,e){this.emit&&this.emit("facet",{eventType:t,eventPayload:e})},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"emit",void 0),t=w([e.Component({selector:"aw-facets-wrapper",template:'<div *ngIf="data" class="n7-facets-wrapper {{ data.classes || \'\' }}">\r\n    <div *ngFor="let group of data.groups" class="n7-facets-wrapper__group {{ group.classes || \'\' }}">\r\n        <n7-facet-header\r\n            [data]="group.header"\r\n            [emit]="headerEmit.bind(this)"\r\n        ></n7-facet-header>\r\n\r\n        <n7-facet\r\n            *ngIf="group.isOpen"\r\n            [data]="group.facet"\r\n            [emit]="facetEmit.bind(this)"\r\n        ></n7-facet>\r\n    </div>\r\n</div>'})],t)}(),nn=function(){function t(){}return t.prototype.onClick=function(t,e){this.emit(t,e)},w([e.Input(),S("design:type",Object)],t.prototype,"emit",void 0),w([e.Input(),S("design:type",String)],t.prototype,"container",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"buttons",void 0),t=w([e.Component({selector:"aw-bubble-chart-wrapper",template:'<div class="aw-bubble-chart-wrapper">\r\n    <ng-content></ng-content>\r\n</div>'})],t)}(),an=function(){function t(){}return t.prototype.onClick=function(t,e){this.emit(t,e)},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"emit",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"anchorData",void 0),t=w([e.Component({selector:"aw-chart-tippy",template:'<div *ngIf="data" style="display: none;">\r\n  <div *ngFor="let d of data" id="template__{{d.id}}" class="bubble-chart__tippy-template">\r\n    <div id="bubble-popup-menu" class="aw-bubble-popup-menu">\r\n      <h2 class="aw-bubble-popup-menu__title">{{ d.title }}</h2>\r\n      <p class="aw-bubble-popup-menu__text">\r\n        {{ d.text }}\r\n      </p>\r\n\r\n      <div *ngIf="d.relation.value" class="aw-item-preview-relation">\r\n        <p class="aw-item-preview-relation__description">Tipo di relazione \r\n          \x3c!-- <span class="aw-item-preview-relation__key">{{d.relation.key}}</span>: --\x3e\r\n          <span class="aw-item-preview-relation__label">{{d.relation.value}}</span>\r\n        </p>\r\n      </div>\r\n\r\n      <div class="aw-bubble-popup-menu__actions">\r\n        <n7-anchor-wrapper [classes]="\'aw-bubble-popup-menu__link\'" [data]="d.anchorData">\r\n          Vai alla scheda\r\n        </n7-anchor-wrapper>\r\n        <span *ngIf="d.selectable" class="aw-bubble-popup-menu__link" (click)="onClick(\'select\', {id: d.id})">\r\n          {{ d.isSelected ? \'Deseleziona\' : \'Seleziona\'}}\r\n        </span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>'})],t)}(),rn=function(){function t(){}return t.prototype.onClick=function(t){this.emit&&!d.isNull(t)&&this.emit("click",t)},t.prototype.onLoaded=function(){this.emit("loaded")},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Function)],t.prototype,"emit",void 0),t=w([e.Component({selector:"aw-pdf-viewer",template:'<div *ngIf="data" class="aw-pdf-viewer {{ data.classes || \'\' }}">\r\n    <div class="aw-pdf-viewer__loader">\r\n        <n7-loader></n7-loader>\r\n    </div>\r\n    \r\n    <ngx-extended-pdf-viewer\r\n        [src]="data.currentUrl"\r\n        [height]="\'90vh\'"\r\n        [useBrowserLocale]="true"\r\n        [textLayer]="true"\r\n        [showToolbar]="data.libOptions.showToolbar"\r\n        [showSidebarButton]="data.libOptions.showSidebarButton"\r\n        [showFindButton]="data.libOptions.showFindButton"\r\n        [showPagingButtons]="data.libOptions.showPagingButtons"\r\n        [showZoomButtons]="data.libOptions.showZoomButtons"\r\n        [showPresentationModeButton]="data.libOptions.showPresentationModeButton"\r\n        [showOpenFileButton]="data.libOptions.showOpenFileButton"\r\n        [showPrintButton]="data.libOptions.showPrintButton"\r\n        [showDownloadButton]="data.libOptions.showDownloadButton"\r\n        [showBookmarkButton]="data.libOptions.showBookmarkButton"\r\n        [showSecondaryToolbarButton]="data.libOptions.showSecondaryToolbarButton"\r\n        [showRotateButton]="data.libOptions.showRotateButton"\r\n        [showHandToolButton]="data.libOptions.showHandToolButton"\r\n        [showScrollingButton]="data.libOptions.showScrollingButton"\r\n        [showSpreadButton]="data.libOptions.showSpreadButton"\r\n        [showPropertiesButton]="data.libOptions.showPropertiesButton"\r\n        (pdfLoaded)="onLoaded()"\r\n        (pdfLoadingFailed)="onLoaded()">\r\n    </ngx-extended-pdf-viewer>\r\n    \r\n    <div *ngIf="data.items.length > 1" class="aw-pdf-viewer__navigation">\r\n        <div class="aw-pdf-viewer__navigation-tools">\r\n            <a class="aw-pdf-viewer__navigation-prev {{ (!data.prev && data.prev !== 0) ? \'is-disabled\' : \'\' }}" \r\n            (click)="onClick(data.prev)">\r\n                <span class="n7-icon-angle-left"></span>\r\n            </a>\r\n            <div class="aw-pdf-viewer__navigation-select">\r\n                <p class="aw-pdf-viewer__navigation-select-text">Scorri i documenti PDF</p>\r\n                <select (change)="onClick(+$event.target.value)">\r\n                    <option *ngFor="let item of data.items; let $i = index" [value]="$i"\r\n                    [selected]="item.selected">{{ item.label }}</option>\r\n                </select>\r\n            </div>\r\n            <a class="aw-pdf-viewer__navigation-next {{ !data.next ? \'is-disabled\' : \'\' }}" \r\n            (click)="onClick(data.next)">\r\n                <span class="n7-icon-angle-right"></span>\r\n            </a>\r\n        </div>\r\n    </div>\r\n</div>'})],t)}(),on=function(){function t(){}return t.prototype.onClick=function(t,e){this.emit&&(t.stopImmediatePropagation(),this.emit("click",e))},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Function)],t.prototype,"emit",void 0),t=w([e.Component({selector:"aw-scheda-dropdown",template:'<div *ngIf="data" class="aw-scheda-dropdown {{ data.classes || \'\' }}">\r\n    <div class="aw-scheda-dropdown__header"\r\n    (click)="onClick($event, data.header.payload)">\r\n        \x3c!-- header label --\x3e\r\n        <span class="aw-scheda-dropdown__header-label">\r\n            {{ data.header.label }}\r\n        </span>\r\n        \x3c!-- header icon --\x3e\r\n        <span class="aw-scheda-dropdown__header-icon"\r\n        [ngClass]="data.header.icon[\'id\']">\r\n        </span>\r\n    </div>\r\n    <div class="aw-scheda-dropdown__items">\r\n        <ul>\r\n            <li *ngFor="let item of data.items"\r\n            [ngClass]="{\r\n                \'is-selected\': item.selected \r\n            }"\r\n            (click)="onClick($event, item.payload)">\r\n                {{ item.label }}\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>'})],t)}(),sn=function(){function t(){var t=this;this.tippyBuilder=function(t,e){return m(t,{content:e,interactive:!0,arrow:!0,theme:"light-border no-padding",appendTo:document.body})},this.getWidths=function(e,n){var a=e.nativeElement.clientWidth,i=n.nativeElement.clientWidth;return{parentWidth:a-t.getSidePadding(e.nativeElement),childWidth:i}},this.getSidePadding=function(t){return+window.getComputedStyle(t,null).getPropertyValue("padding-left").match(/\d+/)[0]+ +window.getComputedStyle(t,null).getPropertyValue("padding-right").match(/\d+/)[0]},this.triggerSmartEllipsis=function(){var e;if(t.bcdiv&&t.bcol){var n=t.getWidths(t.bcdiv,t.bcol),a=n.parentWidth,i=n.childWidth,r=t.bcol.nativeElement.children;if(a<=i)for(var o=1;a<=i&&o<r.length-1;){var s=document.createElement("ol");s.className="n7-smart-breadcrumbs__tippy-content",s.appendChild(r[o].cloneNode(!0)),r[o].children[0].innerText="…",r[o].className="n7-breadcrumbs__item-ellipsis",t.tippyBuilder(r[o].children[0],s),o+=1,a=(e=t.getWidths(t.bcdiv,t.bcol)).parentWidth,i=e.childWidth}}}}return t.prototype.ngAfterViewChecked=function(){this.triggerSmartEllipsis()},t.prototype.onClick=function(t){this.emit&&this.emit("click",t)},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"emit",void 0),w([e.ViewChild("bcol",{read:e.ElementRef}),S("design:type",e.ElementRef)],t.prototype,"bcol",void 0),w([e.ViewChild("bcdiv",{read:e.ElementRef}),S("design:type",e.ElementRef)],t.prototype,"bcdiv",void 0),t=w([e.Component({selector:"n7-smart-breadcrumbs",template:'<div *ngIf="data" class="n7-breadcrumbs {{ data.classes || \'\' }}" #bcdiv>\r\n    <nav class="n7-breadcrumbs__nav">\r\n        <ol class="n7-breadcrumbs__list" #bcol>\r\n            <li *ngFor="let item of data.items" class="n7-breadcrumbs__item {{ item.classes || \'\' }}">\r\n                <span class="ellipsis-target">\r\n                    <n7-anchor-wrapper [classes]="item.classes"\r\n                        [data]="item.anchor"\r\n                        (clicked)="onClick($event)">\r\n                        {{ item.label }}\r\n                    </n7-anchor-wrapper>\r\n                </span>\r\n            </li>\r\n        </ol>\r\n    </nav>\r\n</div>\r\n'})],t)}(),cn=function(t,e){void 0===e&&(e=!0);var n="\n    label\n    id\n    document_type\n    document_classification\n  ";e&&(n="\n      label\n      id\n      img\n      document_type\n      document_classification\n    ");var a,i,r=[];for(a=0;a<t;a+=1)r.push(0===a?n:"branches {"+n);for(i=0;i<t;i+=1)r.push(0===i?"":"}");return r.join("")},ln=function(t){return{getLastPosts:{queryName:"getLastPosts",queryBody:"\n        {\n          getLastPosts(__PARAMS__) {\n            id\n            title\n          }\n        }\n      "},getSlider:{queryName:"getSlider",queryBody:" {\n      getSlider {\n        pretext\n        title\n        text\n        background {\n            type\n            value\n        }\n        ctaLabel\n        ctaPayload\n        metadata {\n            key\n            value\n        }\n      }\n    }"},getTreeLite:{queryName:"getTreeOfItems",queryBody:"\n      {\n        getTreeOfItems{\n          "+cn(t,!1)+"\n        }\n      }\n      "},getTree:{queryName:"getTreeOfItems",queryBody:"\n      {\n        getTreeOfItems{\n          "+cn(t)+"\n        }\n      }\n      "},globalFilter:{queryName:"globalFilter",queryBody:"{\n        globalFilter(__PARAMS__){\n          entitiesData {\n            entity {\n                id\n                label\n                typeOfEntity\n            } count\n          }\n          typeOfEntityData {\n            type\n            count\n          }\n          itemsPagination {\n            totalCount\n            items {\n              thumbnail\n              item {\n                id\n                label\n                fields\n                {\n                  ...\n                  on KeyValueField {\n                    key\n                    value\n                  }\n                }\n                breadcrumbs {\n                  label\n                  link\n                }\n                relatedTypesOfEntity {\n                  type\n                  count\n                }\n              }\n            }\n          }\n        }\n        }"},getEntityRelatedItems:{queryName:"globalFilter",queryBody:"{\n        globalFilter(__PARAMS__){\n          itemsPagination {\n            totalCount\n            items {\n              thumbnail\n              item {\n                id\n                label\n                fields\n                {\n                  ...\n                  on KeyValueField {\n                    key\n                    value\n                  }\n                }\n                breadcrumbs {\n                  label\n                  link\n                }\n                relatedTypesOfEntity {\n                  type\n                  count\n                }\n              }\n            }\n          }\n        }\n        }"},getEntityDetails:{queryName:"getEntity",queryBody:"{\n        getEntity(__PARAMS__){\n          relatedItemsTotalCount,\n          relatedLaTotalCount: relatedAlTotalCount,\n          overviewTab\n          label\n          id\n          typeOfEntity\n          relatedLa: relatedAl {\n            thumbnail\n            relation          \n            item {\n              label\n              id\n              fields {\n                ...\n                on KeyValueField {\n                  key\n                  value\n                }\n              }\n            }\n          }\n          fields {\n            ... on KeyValueField {\n              key\n              value\n            }\n            ... on KeyValueFieldGroup {\n              label\n              fields {\n                ... on KeyValueField {\n                  key\n                  value\n                }\n                ... on KeyValueFieldGroup {\n                  label\n                  fields {\n                    ... on KeyValueField {\n                      key\n                      value\n                    }\n                  }\n                }\n              }\n            }\n          }\n          extraTab\n          wikiTab {\n            text\n            url\n          }\n          relatedItems {\n            thumbnail\n            relation\n            item {\n              label\n              id\n              fields\n              {\n                ...\n                on KeyValueField {\n                  key\n                  value\n                }\n              }\n              breadcrumbs {\n                label\n                link\n              }\n            }\n            relatedTypesOfEntity {\n              type\n              count\n            }\n          }\n          relatedEntities {\n            entity {\n                id\n                label\n                typeOfEntity\n                relation\n            }\n            count\n          }\n        }\n      }\n      "},getItem:{queryName:"getItem",queryBody:"{\n        getItem(__PARAMS__) {\n          id\n          label\n          icon\n          title\n          subTitle\n          image\n          text\n          fields {\n            ...\n            on KeyValueField {\n              key\n              value\n            }\n            ... on KeyValueFieldGroup {\n              label\n              fields {\n                ...\n                on KeyValueField {\n                  key\n                  value\n                }\n              }\n            }\n          }\n          relatedEntities {\n            count\n            entity{\n              id\n              label\n              typeOfEntity\n              relation\n            }\n          }\n          relatedItems {\n            thumbnail\n            item {\n              label\n              id\n              relatedTypesOfEntity {\n                type\n                count\n              }\n            }\n          }\n          breadcrumbs {\n            label\n            link\n          }\n        }\n      }"},getNode:{queryName:"getNode",queryBody:"{\n        getNode(__PARAMS__) {\n          ... on Item {\n            id\n            label\n            title\n            subTitle\n            image\n            digitalObjects {\n              label\n              type\n              url\n              order\n              items {      \n                order      \n                label\n                url                 \n              }\n            }\n            text\n            document_type\n            document_classification\n            fields {\n              ... on KeyValueField {\n                key\n                value\n              }\n              ... on KeyValueFieldGroup {\n                label\n                fields {\n                  ... on KeyValueField {\n                    key\n                    value\n                  }\n                  ... on KeyValueFieldGroup {\n                    label\n                    fields {\n                      ... on KeyValueField {\n                        key\n                        value\n                      }\n                    }\n                  }\n                }\n              }\n            }\n            relatedEntities {\n                count\n                entity{\n                  id\n                  label\n                  typeOfEntity\n                  relation\n                }\n            }\n            relatedItems {\n              thumbnail\n              item {\n                label\n                id\n                fields {\n                  ...\n                  on KeyValueField {\n                    key\n                    value\n                  }\n                  ... on KeyValueFieldGroup {\n                    label\n                    fields {\n                      ...\n                      on KeyValueField {\n                        key\n                        value\n                      }\n                    }\n                  }\n                }\n                relatedTypesOfEntity {\n                  type\n                  count\n                }\n              }\n            }\n            breadcrumbs {\n              label\n              link\n            }\n          }\n          ... on Node {\n            id\n            label\n            img\n            document_type\n            document_classification\n            fields {\n              ... on KeyValueField {\n                key\n                value\n              }\n              ... on KeyValueFieldGroup {\n                label\n                fields {\n                  ... on KeyValueField {\n                    key\n                    value\n                  }\n                  ... on KeyValueFieldGroup {\n                    label\n                    fields {\n                      ... on KeyValueField {\n                        key\n                        value\n                      }\n                    }\n                  }\n                }\n              }\n            }\n            relatedEntities {\n              count\n              entity {\n                id\n                label\n                typeOfEntity\n                relation\n              }\n            }\n            breadcrumbs {\n              label\n              link\n            }\n          }\n        }\n      }"},autoComplete:{queryName:"autoComplete",queryBody:"{\n        autoComplete(__PARAMS__){\n          totalCount\n          results {\n            ... on EntityCountData {\n              count\n              entity {\n                id\n                label\n                typeOfEntity\n                fields {\n                  ... on KeyValueField {\n                    key\n                    value\n                  }\n                  ... on KeyValueFieldGroup {\n                    label\n                    fields {\n                      ... on KeyValueField {\n                        key\n                        value\n                      }\n                    }\n                  }\n                }\n              }\n            }\n            ... on ItemListing {\n              item {\n                id\n                label\n                document_type\n                fields {\n                  ... on KeyValueField {\n                    key\n                    value\n                  }\n                  ... on KeyValueFieldGroup {\n                    label\n                    fields {\n                      ... on KeyValueField {\n                        key\n                        value\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }"},search:{queryName:"search",queryBody:"{\n      search(__PARAMS__){\n        totalCount\n        results {\n          order{\n            type\n            key\n            direction\n          }\n          fields\n          {\n            id\n            highlight\n            limit\n          }\n          items {\n            ... on Entity {\n              id\n              label\n              typeOfEntity\n              fields {\n                ...\n                on KeyValueField {\n                  key\n                  value\n                }\n                ... on KeyValueFieldGroup {\n                  label\n                  fields {\n                    ...\n                    on KeyValueField {\n                      key\n                      value\n                    }\n                  }\n                }\n              }\n              relatedEntities {\n                  count\n                  entity{\n                    id\n                    label\n                    typeOfEntity\n                    relation\n                  }\n              }\n              relatedItems {\n                  thumbnail\n                  item {\n                    label\n                    id\n                    fields {\n                      ...\n                      on KeyValueField {\n                        key\n                        value\n                      }\n                      ... on KeyValueFieldGroup {\n                        label\n                        fields {\n                          ...\n                          on KeyValueField {\n                            key\n                            value\n                          }\n                        }\n                      }\n                    }\n                }\n                relatedTypesOfEntity {\n                  type\n                  count\n                }\n              }\n            }\n            ... on Item {\n              id\n              label\n              icon\n              title\n              subTitle\n              image\n              text\n              relatedTypesOfEntity {\n                type\n                count\n              }\n              breadcrumbs {\n                label\n                link\n              }\n              fields {\n                ...\n                on KeyValueField {\n                  key\n                  value\n                }\n                ... on KeyValueFieldGroup {\n                  label\n                  fields {\n                    ...\n                    on KeyValueField {\n                      key\n                      value\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }"},facets:{queryName:"search",queryBody:"{\n      search(__PARAMS__){\n        facets {\n          id\n          type\n          operator\n          limit\n          order\n          totalCount\n          data {\n            label\n            value\n            counter\n            searchData {\n              key\n              value\n            }\n          }\n        }\n      }\n    }"},getMissingBubble:{queryName:"getEntity",queryBody:"{\n        getEntity(__PARAMS__){\n          label\n          id\n          typeOfEntity\n        }\n      }"},getMapObjects:{queryName:"getMapObjects",queryBody:"{\n      getMapObjects{\n        lat\n        lon\n        item {\n          ...on Item {\n              id\n              label\n          }\n          ...on Entity {\n              id\n              label\n          }\n        }\n      }\n    }"},getEventObjects:{queryName:"getEventObjects",queryBody:"{\n      getEventObjects{\n        id\n        start\n        end\n        label\n        item {\n          ... on Entity {\n            id\n            label\n          }\n        }\n      }\n    }"},getCollection:{queryName:"getCollection",queryBody:"{\n      getCollection(__PARAMS__) {\n        title\n        text\n        total\n        items {\n          title\n          content\n          background\n          image\n          url\n          a4vId\n          type\n          classification\n        }\n      }\n    }"}}},un=[ye,Ce,en,Me,qe,ze,Ke,Ye,tn,nn,an,rn,on,sn],dn=function(){function t(t,e){t.donePromise.then((function(){var t=e.get("communication"),n=t.defaultProvider;t.providers[n].config=ln,e.set("communication",t)}))}return t.ctorParameters=function(){return[{type:e.ApplicationInitStatus},{type:E}]},t=w([e.NgModule({declarations:un,imports:[n.CommonModule,s.RouterModule,i.DvComponentsLibModule,pt,h.NgxExtendedPdfViewerModule],entryComponents:un,exports:un}),S("design:paramtypes",[e.ApplicationInitStatus,E])],t)}(),pn=function(){function t(){}return w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),t=w([e.Component({selector:"dv-data-widget-wrapper",template:"<div class=\"dv-data-widget-wrapper {{ data && data.classes || '' }}\">\r\n    <ng-content></ng-content>\r\n</div>"})],t)}(),hn=function(){function t(){}return t.prototype.onClick=function(t){this.emit&&this.emit("click",t)},t.prototype.toggleDropDown=function(t){this.emit&&this.emit("toggle",t)},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"emit",void 0),t=w([e.Component({selector:"dv-datepicker-wrapper",template:'<div *ngIf="data" class="dv-datepicker-wrapper {{ data.select.classes || \'\' }}">\r\n    <div class="dv-datepicker-wrapper__label" (click)="toggleDropDown(data.payload)">\r\n        <input type="text" [value]="data.select.label" [readOnly]="true"/>\r\n        <span class="{{data.select.icon}}"></span>\r\n    </div>\r\n    <div class="dv-datepicker-wrapper__dropdown" [hidden]="data.select.hidden">\r\n        <ul class="dv-datepicker-wrapper__dropdown-list">\r\n            <li class="dv-datepicker-wrapper__dropdown-list-option {{ opt.classes || \'\' }}" *ngFor="let opt of data.select.items" (click)="onClick(opt.payload)">{{opt.text}}</li>\r\n        </ul>\r\n    </div>\r\n    <n7-datepicker\r\n        [data]="data.datepicker.data"\r\n        [emit]="emit">\r\n    </n7-datepicker>\r\n</div>\r\n'})],t)}(),fn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Items=[{text:"Last week",payload:"Last week"},{text:"Last month",payload:"Last month"},{text:"Last year",payload:"Last year"},{text:"Select Date",payload:"ByDate"}],e.datepickerOptions={dateFormat:"Y-m-d",mode:"range"},e.datePickerExternalData={select:{id:"dv-select",label:"Last week",items:e.Items},datepicker:{id:"datepicker",libOptions:e.datepickerOptions}},e}return v(e,t),e.prototype.onInit=function(){this.one("dv-datepicker-wrapper").update(this.datePickerExternalData)},e}(l.LayoutDataSource),gn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){e.type,e.payload;t.dataSource.onInit()}))},e}(l.EventHandler),mn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return null},e}(l.DataSource),yn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._datepicker=null,e}return v(e,t),e.prototype.transform=function(t){var e=this;return t?{select:{id:t.select.id,hidden:!0,icon:t.select.icon||"n7-icon-angle-down",label:t.select.label,items:t.select.items,classes:t.select.classes},datepicker:{hidden:!0,data:{id:t.datepicker.id,libOptions:t.datepicker.libOptions,getInstance:function(t){e._datepicker=t}}}}:null},e.prototype.openDatepicker=function(){var t=this;setTimeout((function(){return t._datepicker.open()})),this.output.select.hidden=!0,this.output.datepicker.hidden=!1},e.prototype.closeDatepicker=function(){var t=this;setTimeout((function(){return t._datepicker.close()})),this.output.select.hidden=!0,this.output.datepicker.hidden=!0},e.prototype.setLabel=function(t){this.output.select.label=t,this.output.datepicker.hidden=!0},e.prototype.toggleDropDown=function(){!1===this.output.select.hidden?this.output.select.hidden=!0:this.output.select.hidden=!1},e}(l.DataSource),vn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){return{containerId:"test-Chart",libOptions:{chart:{height:550,width:1500,type:"area",toolbar:{show:!0}},dataLabels:{enabled:!1},colors:["rgba(15,200,255)"],fill:{colors:["#0fc8ff"],gradient:{opacityFrom:.5,opacityTo:.1}},stroke:{curve:"straight",width:[2,1]},series:[{name:"Reddish value",data:[["2019-08-01","770.17"],["2019-08-02","645.03"],["2019-08-03","709.32"],["2019-08-04","708.11"],["2019-08-05","706.59"],["2019-08-06","607.28"],["2019-08-07","494.59"],["2019-08-08","636.81"],["2019-08-09","709.04"],["2019-08-10","717.31"],["2019-08-11","805.61"],["2019-08-12","758.60"],["2019-08-13","612.82"],["2019-08-14","608.90"],["2019-08-15","734.68"],["2019-08-16","838.54"],["2019-08-17","692.88"]]}],grid:{borderColor:"#e7e7e7",strokeDashArray:3,xaxis:{lines:{show:!0}}},markers:{size:3,hover:{size:6}},xaxis:{axisBorder:{show:!0,color:"#f4f6fc"},labels:{},type:"datetime",tickAmount:6},yaxis:[{show:!0,showAlways:!1,opposite:!1,reversed:!1,logarithmic:!1,forceNiceScale:!1,floating:!1,labels:{show:!0,minWidth:0,maxWidth:160,offsetX:0,offsetY:0,rotate:0,padding:20,style:{colors:[],fontSize:"11px",cssClass:""}},axisBorder:{show:!0,color:"#f4f6fc",offsetX:0,offsetY:0},axisTicks:{show:!1,color:"#78909C",width:6,offsetX:0,offsetY:0},title:{text:"P Totale °C",rotate:90,offsetY:0,offsetX:0,style:{fontSize:"11px",cssClass:""}},tooltip:{enabled:!1,offsetX:0},crosshairs:{show:!0,position:"front",stroke:{color:"#b6b6b6",width:1,dashArray:0}}}],legend:{show:!0},tooltip:{},annotations:{yaxis:[],xaxis:[],points:[]}}}},e}(l.DataSource),bn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){return{title:{main:{text:"Dipendenti",classes:"n7-main-widget-title"},secondary:{text:"Dipendeti al 10/10/10",classes:"n7-secondary-widget-title"}}}},e}(l.DataSource),wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){return i.DATA_WIDGET_MOCK},e}(l.DataSource),Sn=Object.freeze({__proto__:null,DvDataWidgetDS:mn,DvDatepickerWrapperDS:yn,DvGraphDS:vn,DvInnerTitleDS:bn,DvWidgetDS:wn}),_n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"dv-datepicker-wrapper.click":t.dataSource.setLabel(a),"ByDate"===a?t.dataSource.openDatepicker():t.dataSource.closeDatepicker();break;case"dv-datepicker-wrapper.toggle":t.dataSource.toggleDropDown();break;case"dv-datepicker-wrapper.change":t.dataSource.setLabel(a.dateStr)}}))},e}(l.EventHandler),kn={layoutId:"dv-example-layout",widgets:[{id:"dv-inner-title",hasStaticData:!0},{id:"dv-widget",hasStaticData:!0},{id:"dv-datepicker-wrapper"},{id:"dv-graph",hasStaticData:!0}],layoutDS:fn,layoutEH:gn,widgetsDataSources:Sn,widgetsEventHandlers:Object.freeze({__proto__:null,DvDatepickerWrapperEH:_n}),options:{}},In=function(t){function n(){return t.call(this,kn)||this}return v(n,t),n.prototype.initPayload=function(){return{}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n=w([e.Component({selector:"dv-example-layout",template:'<div class="dv-example-layout" id="example-layout">\r\n\r\n    \x3c!-- Data widget wrapper with not-fixed height, two rows --\x3e\r\n    <dv-data-widget-wrapper>\r\n        <div class="dv-data-widget-wrapper__title">\r\n            <n7-inner-title\r\n                [data]="lb.widgets[\'dv-inner-title\'].ds.out$ | async">\r\n            </n7-inner-title>\r\n        </div>\r\n        <div class="dv-data-widget-wrapper__content">\r\n            <div class="dv-data-widget-wrapper__content-row">\r\n                <n7-data-widget\r\n                    [data]="lb.widgets[\'dv-widget\'].ds.out$ | async">\r\n                </n7-data-widget>\r\n            </div>\r\n            <div class="dv-data-widget-wrapper__content-row">\r\n                <n7-chart\r\n                    [data]="lb.widgets[\'dv-graph\'].ds.out$ | async">\r\n                </n7-chart>\r\n            </div>\r\n        </div>\r\n    </dv-data-widget-wrapper>\r\n\r\n    \x3c!-- Data widget wrapper with fixed height, two rows --\x3e\r\n    <dv-data-widget-wrapper [data]="{ classes: \'dv-data-widget-wrapper-fixed-height\' }">\r\n        <div class="dv-data-widget-wrapper__title">\r\n            <n7-inner-title\r\n                [data]="lb.widgets[\'dv-inner-title\'].ds.out$ | async">\r\n            </n7-inner-title>\r\n        </div>\r\n        <div class="dv-data-widget-wrapper__content">\r\n            <div class="dv-data-widget-wrapper__content-row">\r\n                <n7-data-widget\r\n                    [data]="lb.widgets[\'dv-widget\'].ds.out$ | async">\r\n                </n7-data-widget>\r\n            </div>\r\n            <div class="dv-data-widget-wrapper__content-row">\r\n                Row content\r\n            </div>\r\n        </div>\r\n    </dv-data-widget-wrapper>\r\n\r\n    \x3c!-- Data widget wrapper with fixed height, one row --\x3e\r\n    <dv-data-widget-wrapper [data]="{ classes: \'dv-data-widget-wrapper-fixed-height\' }">\r\n        <div class="dv-data-widget-wrapper__title">\r\n            <n7-inner-title\r\n                [data]="lb.widgets[\'dv-inner-title\'].ds.out$ | async">\r\n            </n7-inner-title>\r\n        </div>\r\n        <div class="dv-data-widget-wrapper__content">\r\n            <div class="dv-data-widget-wrapper__content-row">\r\n                <n7-data-widget\r\n                    [data]="lb.widgets[\'dv-widget\'].ds.out$ | async">\r\n                </n7-data-widget>\r\n            </div>\r\n        </div>\r\n    </dv-data-widget-wrapper>\r\n    \r\n    <dv-datepicker-wrapper \r\n        [data]="lb.widgets[\'dv-datepicker-wrapper\'].ds.out$ | async"\r\n        [emit]="lb.widgets[\'dv-datepicker-wrapper\'].emit">\r\n    </dv-datepicker-wrapper>\r\n</div>'}),S("design:paramtypes",[])],n)}(P),En=[pn,hn,In],xn=function(){function t(){}return t=w([e.NgModule({declarations:En,imports:[n.CommonModule,i.DvComponentsLibModule,pt],providers:[],exports:En})],t)}(),Cn=function(t){return Array.isArray(t)?t.length>0:!!t},Dn=function(t,e){var n={};return Object.keys(t).forEach((function(a){var i=e[a],r=i.multiple,o=i.valueType,s=t[a];if(Cn(s))switch(o){case"number":case"string":n[a]=r?s.join(","):s;break;case"boolean":n[a]=r?s.map((function(t){return+t})).join(","):+s}})),n},On=function(t,e){var n={};return Object.keys(t).forEach((function(a){var i=t[a],r=e[a],o=r.multiple,s=r.valueType;if(Cn(i)&&Cn(i))switch(s){case"number":n[a]=o?i.split(",").map((function(t){return+t})):+i;break;case"string":n[a]=o?i.split(",").map((function(t){return""+t})):""+i;break;case"boolean":n[a]=o?i.split(",").map((function(t){return!!t})):!!i}})),n},Tn=function(){function t(t,e,n){var a=this;this.router=t,this.activatedRoute=e,this.communication=n,this.destroyed$=new r.Subject,this.queryParamKeys=[],this.inputSchemas={},this.contextState={},this.internalFilterKeys=[],this.internalFilterState={globalParams:{},facets:{}},this.state$={},this.beforeHook={},this.getConfig=function(){return a.config},this.isQueryParamKey=function(t){return a.queryParamKeys.includes(t)}}return t.prototype.init=function(t,e){this.searchId=t,this.config=e,this.clear(),this.initInputState(),this.initFacetState(),this.initSectionState(),this.onInputsChange(),this.onInternalInputsChange(),this.onRouteChange(),this.onResultsLoading(),this.onFacetsScroll()},t.prototype.getState$=function(t,e){var n=e?t+"."+e:t;if(!this.state$[n])throw Error('Key "'+n+'" does not exist');return this.state$[n]},t.prototype.addStateContext=function(t){if(this.state$[t])throw Error('State key "'+t+'" already exists');this.contextState[t]={},this.state$[t]=new r.Subject},t.prototype.addState=function(t,e){var n=t+"."+e;if(!this.state$[t])throw Error('\n        State context "'+t+'" does not exist.\n        You must add context first\n      ');if(this.state$[n])throw Error('State key "'+n+'" already exists');this.state$[n]=new r.Subject},t.prototype.setState=function(t,e,n){var a=t+"."+e;if(!this.state$[a])throw Error('Key "'+a+'" does not exist');var i=n;this.beforeHook[a]&&(i=this.beforeHook[a](i)),this.state$[a].next(i),this.setContextState(t,e,i)},t.prototype.setBeforeHook=function(t,e,n){var a=t+"."+e;if(!this.state$[a])throw Error('Key "'+a+'" does not exist');this.beforeHook[a]=n},t.prototype.reset=function(){var t=this;Object.keys(this.contextState.input).filter((function(e){return!t.internalFilterKeys.includes(e)})).forEach((function(e){t.setState("input",e,null)}))},t.prototype.destroy=function(){this.destroyed$.next()},t.prototype.clear=function(){this.contextState={},this.state$={},this.beforeHook={}},t.prototype.setContextState=function(t,e,n){var a;this.contextState[t]=b(b({},this.contextState[t]),((a={})[""+e]=n,a)),this.state$[t].next({lastUpdated:e,state:this.contextState[t]})},t.prototype.initInputState=function(){var t=this,e=this.config,n=e.facets,a=e.layoutInputs;this.addStateContext("input"),n.sections.forEach((function(e){k([e.header],e.inputs).filter((function(t){return t})).forEach((function(e){var n=e.id,a=e.queryParam,i=e.schema,r=e.limit,o=e.type,s=e.target;n&&(t.addState("input",n),a&&t.queryParamKeys.push(n),i&&(t.inputSchemas[n]=i),"link"===o&&(t.internalFilterState.facets[n]={id:n,limit:r,offset:0,query:"",loading:!1,values:[]}),s&&t.internalFilterKeys.push(n))}))})),a.forEach((function(e){var n=e.id,a=e.queryParam,i=e.schema;t.addState("input",n),a&&t.queryParamKeys.push(n),i&&(t.inputSchemas[n]=i)}))},t.prototype.initFacetState=function(){var t=this,e=this.config.facets;this.addStateContext("facet"),e.sections.forEach((function(e){k([e.header],e.inputs).filter((function(t){return t})).forEach((function(e){t.addState("facet",e.id)}))}))},t.prototype.initSectionState=function(){var t=this,e=this.config.facets;this.addStateContext("section"),e.sections.forEach((function(e){var n=e.id;t.addState("section",n)}))},t.prototype.onRouteChange=function(){var t=this,e=this.config.request.results;this.addStateContext("resultsRequest"),["loading","request","success","error"].forEach((function(e){t.addState("resultsRequest",e)})),this.activatedRoute.queryParams.pipe(o.takeUntil(this.destroyed$),o.delay(1),o.map((function(e){return On(e,t.inputSchemas)})),o.tap((function(e){if(d.isEmpty(e)&&t.reset(),!d.isEmpty(e)){var n=t.contextState.input;d.isEmpty(n)?Object.keys(e).filter((function(e){return t.queryParamKeys.includes(e)})).forEach((function(n){t.setState("input",n,e[n])})):Object.keys(e).filter((function(e){return t.queryParamKeys.includes(e)})).filter((function(a){return t.notEquals(n[a],e[a])})).forEach((function(n){t.setState("input",n,e[n]||null)}))}})),o.map((function(e){return t.setState("resultsRequest","loading",e),e})),o.debounceTime(e.delay||1),o.map((function(e){return t.setState("resultsRequest","request",e),e})),o.switchMap((function(n){return t.communication.request$(e.id,{params:b(b({},n),{searchId:t.searchId}),method:"POST",onError:function(e){t.setState("resultsRequest","error",e)}},e.provider||null)}))).subscribe((function(e){t.setState("resultsRequest","success",e)}))},t.prototype.onInputsChange=function(){var t=this;this.getState$("input").pipe(o.filter((function(e){var n=e.lastUpdated;return-1!==t.queryParamKeys.indexOf(n)}))).subscribe((function(e){var n=e.state,a={};Object.keys(n).forEach((function(e){-1!==t.queryParamKeys.indexOf(e)&&(a[e]=n[e])}));var i=Dn(a,t.inputSchemas);t.router.navigate([],{queryParams:i})}))},t.prototype.onInternalInputsChange=function(){var t=this;this.getState$("input").pipe(o.filter((function(e){var n=e.lastUpdated;return-1===t.queryParamKeys.indexOf(n)})),o.map((function(e){var n,a=e.lastUpdated,i=e.state;return t.config.facets.sections.forEach((function(t){t.inputs.forEach((function(t){t.id===a&&(n=t)}))})),n&&n.target?{inputConfig:n,value:i[a]}:null})),o.filter((function(t){return null!==t}))).subscribe((function(e){var n=e.inputConfig,a=e.value,i=n.target;t.internalFilterState.facets[i].query=a,t.internalFilterState.facets[i].offset=0,t.doSingleFacetRequest(i)}))},t.prototype.doSingleFacetRequest=function(t){var e=this,n=this.config.request.facets,a=this.internalFilterState.globalParams,i=this.internalFilterState.facets[t],r=i.id,o=i.limit,s=i.offset,c=i.query;this.communication.request$(n.id,{params:b(b({},a),{facets:[{id:r,limit:o,offset:s,query:c}],searchId:this.searchId}),method:"POST",onError:function(t){e.setState("facetsRequest","error",t)}},n.provider||null).subscribe((function(n){e.onFacetsRequestSuccess(n),e.internalFilterState.facets[t].loading=!1}))},t.prototype.onResultsLoading=function(){var t=this,e=this.config.request.facets;e&&(this.addStateContext("facetsRequest"),["loading","request","success","error"].forEach((function(e){t.addState("facetsRequest",e)})),this.getState$("resultsRequest","loading").pipe(o.map((function(e){var n=b({},e);return t.setState("facetsRequest","loading",n),t.internalFilterState.globalParams=b({},n),n})),o.debounceTime(e.delay||1),o.map((function(e){return e.facets=[],t.config.facets.sections.forEach((function(n){n.inputs.filter((function(t){return"link"===t.type})).forEach((function(n){var a=n.id;t.internalFilterState.facets[a].offset=0;var i=t.internalFilterState.facets[a],r=i.limit,o=i.query,s=i.offset;e.facets.push({id:a,limit:r,offset:s,query:o})}))})),t.setState("facetsRequest","request",e),e})),o.switchMap((function(n){return t.communication.request$(e.id,{params:b(b({},n),{searchId:t.searchId}),method:"POST",onError:function(e){t.setState("facetsRequest","error",e)}},e.provider||null)}))).subscribe((function(e){t.onFacetsRequestSuccess(e)})),this.getState$("facetsRequest","success").subscribe((function(e){var n=e.facets;Object.keys(n).forEach((function(e){var a=n[e],i=a.values,r=a.filtered_total_count,o=t.internalFilterState.facets[e],s=o.limit,c=o.offset,u=o.values,d=t.internalFilterState.facets[e];c>0?(d.values.pop(),d.values=k(u,i)):d.values=k(i),c+s<r&&d.values.push({text:l._t("global#facet_loading_text"),classes:"loading-text-link",payload:null}),t.setState("facet",e,{links:d.values})}))})))},t.prototype.onFacetsRequestSuccess=function(t){var e=this,n=t.facets;Object.keys(n).forEach((function(t){var a=n[t].filtered_total_count;e.internalFilterState.facets[t].filtered_total_count=a})),this.setState("facetsRequest","success",t)},t.prototype.onFacetsScroll=function(){var t=this;setTimeout((function(){t.config.facets.sections.forEach((function(e){e.inputs.filter((function(t){return t})).filter((function(t){return"link"===t.type})).forEach((function(e){var n=e.id,a=document.querySelector("#facet-container-"+n+" .n7-input-link");r.fromEvent(a,"scroll").pipe(o.debounceTime(300)).subscribe((function(e){var a=e.target,i=t.internalFilterState.facets[n],r=i.limit,o=i.offset,s=i.loading,c=i.filtered_total_count,l=a;l.scrollTop+l.clientHeight>=l.scrollHeight&&o+r<c&&!1===s&&(t.internalFilterState.facets[n].loading=!0,t.internalFilterState.facets[n].offset=o+r,t.doSingleFacetRequest(n))}))}))}))}))},t.prototype.notEquals=function(t,e){return Array.isArray(t)&&Array.isArray(e)?!!d.xor(t,e).length:t!==e},t.ctorParameters=function(){return[{type:s.Router},{type:s.ActivatedRoute},{type:T}]},t=w([e.Injectable(),S("design:paramtypes",[s.Router,s.ActivatedRoute,T])],t)}();!function(t){t.IDLE="IDLE",t.LOADING="LOADING",t.SUCCESS="SUCCESS",t.EMPTY="EMPTY",t.ERROR="ERROR"}(I||(I={}));var Pn=function(){function t(){this.stateContainers={}}return t.prototype.add=function(t){var e=this;(Array.isArray(t)?t:[t]).forEach((function(t){e.stateContainers[t]=new r.ReplaySubject,e.stateContainers[t].next(I.IDLE)}))},t.prototype.get$=function(t){if(!this.stateContainers[t])throw Error("Layout state id '"+t+"' does not exists");return this.stateContainers[t]},t.prototype.set=function(t,e){if(!this.stateContainers[t])throw Error("Layout state id '"+t+"' does not exists");this.stateContainers[t].next(e)},t=w([e.Injectable()],t)}(),Rn=function(){function t(t,e){this.configuration=t,this.communication=e,this.state$=new r.Subject,this.state$.next({status:"IDLE"})}return t.prototype.open=function(t,e){var n=this;this.state$.next({status:"LOADING"});var a=this.configuration.get("resource-modal-"+e);["top","content"].forEach((function(t){a.sections[t]=a.sections[t].map((function(t){return b(b({},t),{title:l._t(t.title)})}))})),this.pageRequest$(t,a,(function(e){console.warn("Error loading resource modal for "+t,e.message),n.state$.next({status:"ERROR"})})).subscribe((function(t){n.state$.next({response:t,config:a,status:"SUCCESS"})}))},t.prototype.close=function(){this.state$.next({status:"IDLE"})},t.prototype.pageRequest$=function(t,e,n){var a=e.sections,i=a.top,r=a.content,o=i.concat(r);return this.communication.request$("resource",{onError:n,method:"POST",params:{id:t,type:e.type,sections:o.map((function(t){return t.id}))}})},t.ctorParameters=function(){return[{type:E},{type:T}]},t=w([e.Injectable(),S("design:paramtypes",[E,T])],t)}(),$n=function(){function t(t){this.sanitizer=t}return t.prototype.transform=function(t){return this.sanitizer.bypassSecurityTrustHtml(t)},t.ctorParameters=function(){return[{type:c.DomSanitizer}]},t=w([e.Pipe({name:"keepHtml",pure:!1}),S("design:paramtypes",[c.DomSanitizer])],t)}(),Ln=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.onInit=function(t){this.configuration=t.configuration,this.mainState=t.mainState,this.configId=t.configId,this.communication=t.communication,this.pageConfig=this.configuration.get(this.configId),this.all().updateOptions({config:this.pageConfig}),this.one("mr-search-page-title").update({}),this.updateHeadTitle(),this.addTranslations(this.pageConfig)},e.prototype.updateSearchTags=function(t){if(this.pageConfig.filters){var e=this.pageConfig.filters.labels,n=[];Object.keys(e).filter((function(e){return!!t[e]})).forEach((function(e){n[e]=t[e]})),this.one("mr-advanced-search-tags").updateOptions({labels:e}),this.one("mr-advanced-search-tags").update(n)}},e.prototype.request$=function(t,e){var n=this.pageConfig.searchId,a=b({},t);Object.keys(a).filter((function(t){return["page","limit","sort"].includes(t)})).forEach((function(t){a.results=a.results||{},a.results[t]=a[t],delete a[t]}));var i={},r=a.results||{},o=r.page?+r.page:1;return i.limit=r.limit?+r.limit:12,i.offset=1===o?0:i.limit*(o-1),i.sort=r.sort||"sort_ASC",this.communication.request$("advancedSearch",{method:"POST",params:b(b({},a),{searchId:n,results:b({},i)}),onError:e})},e.prototype.handleResponse=function(t){this.some(["mr-search-results-title","mr-search-results"]).update(t),this.one("n7-smart-pagination").updateOptions({mode:"payload"}),this.one("n7-smart-pagination").update(this.getPaginationParams(t))},e.prototype.updateHeadTitle=function(){var t=this.configuration.get("name"),e=this.pageConfig.title;this.mainState.update("headTitle",[t,l._t(e)].join(" > "))},e.prototype.addTranslations=function(t){var e;(null===(e=null==t?void 0:t.sort)||void 0===e?void 0:e.label)&&(t.sort.label=l._t(t.sort.label),t.sort.options=t.sort.options.map((function(t){return b(b({},t),{label:l._t(t.label)})}))),["text","button"].forEach((function(e){t.fallback&&(t.fallback[e]=l._t(t.fallback[e])),t.ko&&(t.ko[e]=l._t(t.ko[e]))}));var n=this.pageConfig.filters;n&&(n.title=l._t(n.title),Object.keys(n.labels).forEach((function(t){n.labels[t]=l._t(n.labels[t])})))},e.prototype.getPaginationParams=function(t){var e=t.total_count,n=t.offset,a=t.limit,i=this.pageConfig.pagination;return{totalPages:Math.ceil(e/a),currentPage:(n+a)/a,pageLimit:i.limit,sizes:{label:i.selectLabel?l._t(i.selectLabel):null,list:i.options,active:a}}},e}(l.LayoutDataSource),An=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroy$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-advanced-results-layout.init":t.activatedRoute=a.activatedRoute,t.router=a.router,t.layoutState=a.layoutState,t.modalService=a.modalService,t.dataSource.onInit(a),t.listenToRouterChanges(),window.scrollTo(0,0);break;case"mr-advanced-results-layout.destroy":t.destroy$.next();break;default:console.warn("unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"n7-smart-pagination.click":t.updateRouter({page:a.page});break;case"n7-smart-pagination.change":t.updateRouter({limit:a.value,page:1});break;case"mr-search-results-title.change":t.updateRouter({sort:a.value,page:1});break;case"mr-search-results.openresourcemodal":var i=a.id,r=a.type;t.modalService.open(i,r);break;default:console.warn("unhandled inner event of type",n)}}))},e.prototype.listenToRouterChanges=function(){var t=this;this.activatedRoute.queryParams.pipe(o.takeUntil(this.destroy$),o.tap((function(){t.layoutState.set("results",I.LOADING)})),o.switchMap((function(e){return t.dataSource.updateSearchTags(e),t.dataSource.request$(e,(function(e){console.warn("Advanced search error",e),t.layoutState.set("results",I.ERROR)}))}))).subscribe((function(e){t.dataSource.handleResponse(e),t.layoutState.set("results",d.isEmpty(e.results)?I.EMPTY:I.SUCCESS),t.scrollRefElement?F.isElementInViewport(t.scrollRefElement)||t.scrollRefElement.scrollIntoView():t.scrollRefElement=document.querySelector(".scroll-ref")}))},e.prototype.updateRouter=function(t){this.router.navigate([],{queryParams:t,queryParamsHandling:"merge"})},e}(l.EventHandler),Mn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){if(!t)return null;var e=[];if(Array.isArray(t)&&t.length){var n=(this.options||{}).base;e=k((n=Array.isArray(n)?n:[]).map((function(t){var e=t.link,n=t.title;return{label:l._t(n),anchor:{href:e}}})),t.map((function(t){var e=t.link;return{label:t.title,anchor:{href:e}}})))}return e.length&&(e[e.length-1].anchor=null),{items:e}},e}(l.DataSource),Hn=function(t){var e={};return t.split("&").forEach((function(t){var n=_(t.split("="),2),a=n[0],i=n[1];e[a]=i})),e},jn={getQueryParams:function(t){var e=t.split("?")[1]?Hn(t.split("?")[1]):null;return this.isExternalLink(t)?null:e},getRouterLink:function(t){return this.isExternalLink(t)?t:t.split("?")[0]},isExternalLink:function(t){return/^http(?:s)?:\/{2}\S+$/.test(t)}},Fn={limit:100,striptags:!0},qn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){if(!t)return null;var e=t.header,n=t.items;if(Array.isArray(n)&&!n.length)return null;var a=this.options,i=a.classes,r=a.itemPreview,o=a.linkTarget,s=d.merge(Fn,r||{});if((e||{}).button){var c=e.button,l=c.link,u=c.text;e.button=[{text:u,anchor:{href:jn.getRouterLink(l),queryParams:jn.getQueryParams(l)}}]}return{header:e?{title:{main:{text:e.title,classes:"bold"},secondary:e.subtitle?{text:e.subtitle}:null},actions:{buttons:e.button}}:null,items:n.map((function(t){var e=null;return t.text&&(s.striptags&&(t.text=F.striptags(t.text)),s.limit&&t.text.length>s.limit&&(t.text=t.text.substring(0,s.limit)+"...")),t.link&&(e={href:jn.getRouterLink(t.link),queryParams:jn.getQueryParams(t.link)},o&&(e.target=o)),t.payload&&(e={payload:b({},t.payload)}),b(b({},t),{anchor:e,classes:i||""})}))}},e}(l.DataSource),Bn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),Nn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),Vn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=this.options,n=e.classes,a=e.background,i=t.text,r=t.image,o=t.title,s=t.button,c=a?r:null;return{text:i,title:o,classes:n,backgroundImage:c,image:c?null:r,button:s&&s.link?b(b({},s),{anchor:{href:jn.getRouterLink(s.link),queryParams:jn.getQueryParams(s.link)}}):null}},e}(l.DataSource),zn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.viewerLoaded$=new r.Subject,e}return v(e,t),e.prototype.transform=function(t){var e=this;if(!t)return null;var n=t.images,a=t.thumbs,i=(this.options||{}).tools;return{images:n,thumbs:a,viewerId:this.id,libOptions:{showNavigator:!1,autoHideControls:!1,showRotationControl:!1,showSequenceControl:!0,showHomeControl:!0,showZoomControl:!0,sequenceMode:!0,showReferenceStrip:!0!==i,navigationControlAnchor:"TOP_RIGHT"},_setViewer:function(t){e.viewer=t,e.viewerLoaded$.next()}}},e.prototype.changePage=function(t){this.viewer.goToPage(t)},e}(l.DataSource),Un=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){if(!t)return null;var e=t.thumbs,n=t.images.map((function(t,n){return{caption:t.caption,thumb:e[n],payload:{thumbindex:n}}}));return{images:n,controls:{description:{icon:"n7-icon-info1",anchor:{payload:"toggle-description"}},thumbs:{icon:"n7-icon-images",anchor:{payload:"toggle-thumbs"}},closedescription:{icon:"n7-icon-close-circle",anchor:{payload:"close-description"}}},isVisible:{description:!1,thumbnails:!1},description:n[0].caption,initial:0}},e.prototype.toggleDescription=function(){this.output.isVisible.description=!this.output.isVisible.description},e.prototype.toggleThumbs=function(){this.output.isVisible.thumbnails=!this.output.isVisible.thumbnails},e.prototype.handleThumbs=function(t){this.output.initial=t,this.updateDescription()},e.prototype.handlePageChange=function(t){this.handleThumbs(t.page)},e.prototype.updateDescription=function(){var t=this.output.initial,e=this.output.images;this.output.description=e[t].caption},e}(l.DataSource),Gn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),Wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){if(!t)return null;var e=t.title,n=t.description,a=t.button;return{title:{main:{text:e,classes:"bold"},secondary:{text:n,classes:"italic"}},actions:a&&a.link?{buttons:[{anchor:{href:jn.getRouterLink(a.link),queryParams:jn.getQueryParams(a.link)},text:a.text,classes:"n7-btn-cta"}]}:null}},e}(l.DataSource),Kn={limit:100,striptags:!0},Qn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){if(!t)return null;var e=this.options,n=e.classes,a=e.itemPreview,i=d.merge(Kn,a||{});return i.striptags&&(t.text=F.striptags(t.text)),i.limit&&t.text.length>i.limit&&(t.text=t.text.substring(0,i.limit)+"..."),b(b({},t),{anchor:{href:jn.getRouterLink(t.link),queryParams:jn.getQueryParams(t.link)},classes:n||""})},e}(l.DataSource),Yn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mock={resources:[{image:"https://i.imgur.com/8bNcgR6.png",title:"Unattributed version",text:"A japanese colored version",metadata:[{classes:"metadata",items:[{label:"Artista",value:"Massimo Berruti"},{label:"Tecnica",value:"Fotografia"},{label:"Galleria",value:"Galleria Tonelli"}]}]},{image:"https://i.imgur.com/52UFqca.png",title:"Yudi Shanhai Quantu",text:"Complete Map of all mountains and seas"},{image:"https://i.imgur.com/sLu7u2v.png",title:"Reconstruction of D'Elia's map",text:'A digital collage of the map portions from Pasquale D\'Elia "mappamondo"',metadata:[{classes:"metadata",items:[{label:"Artista",value:"Massimo Berruti"},{label:"Tecnica",value:"Fotografia"},{label:"Galleria",value:"Galleria Tonelli"}]}]},{image:"https://i.imgur.com/8bNcgR6.png",title:"Unattributed version",text:"A japanese colored version"}],collections:[{image:"https://i.imgur.com/8bNcgR6.png",title:"Unattributed version",text:"A japanese colored version"},{image:"https://i.imgur.com/52UFqca.png",title:"Yudi Shanhai Quantu",text:"Complete Map of all mountains and seas"},{image:"https://i.imgur.com/sLu7u2v.png",title:"Reconstruction of D'Elia's map",text:'A digital collage of the map portions from Pasquale D\'Elia "mappamondo"'}],search:[{image:"https://i.imgur.com/52UFqca.png",title:"Yudi Shanhai Quantu",text:"Complete Map of all mountains and seas"},{image:"https://i.imgur.com/52UFqca.png",title:"World Map based on Matteo Ricci 1850",text:"Complete Map fo all mountains and seas"},{image:"",title:"Reconstruction of D'Elia's map",text:'A digital collage of the map portions from Pasquale D\'Elia "mappamondo"'},{image:"",title:"Unattributed version",text:"A japanese colored version"},{image:"",title:"Matteo Ricci's way from Macau to Beijing",text:"A japanese colored version"},{image:"",title:"The 400-year-old map that shows China as the centre of the world",text:"A japanese colored version"},{image:"https://i.imgur.com/52UFqca.png",title:"Yudi Shanhai Quantu",text:"Complete Map of all mountains and seas"},{image:"https://i.imgur.com/52UFqca.png",title:"World Map based on Matteo Ricci 1850",text:"Complete Map fo all mountains and seas"},{image:"",title:"Reconstruction of D'Elia's map",text:'A digital collage of the map portions from Pasquale D\'Elia "mappamondo"'},{image:"",title:"Unattributed version",text:"A japanese colored version"},{image:"",title:"Matteo Ricci's way from Macau to Beijing",text:"A japanese colored version"},{image:"",title:"The 400-year-old map that shows China as the centre of the world",text:"A japanese colored version"}]},e}return v(e,t),e.prototype.transform=function(t){return this.mock[this.options.source]},e}(l.DataSource),Xn=L.icon({iconUrl:"/assets/pin.png",iconSize:[30,45.5],popupAnchor:[0,-25],className:"marker-icon"}),Zn=L.icon({iconUrl:"/assets/pin-selected.png",iconSize:[30,45.5],popupAnchor:[0,-25],className:"marker-icon-selected"}),Jn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mapLoaded$=new r.Subject,e}return v(e,t),e.prototype.transform=function(t){var e,n=this;t.find((function(t){return t.markers}))&&(e=t.map((function(t){return t.markers.map((function(e){var n,a;return{coords:[+e.lat,+e.lng],template:null!==(n=e.default_label)&&void 0!==n?n:e.label,title:null!==(a=e.label)&&void 0!==a?a:e.default_label,id:t.id,slug:t.slug}}))})).reduce((function(t,e){return t.concat(e)}),[]));return this.mapInstance&&this.markerLayer&&(this.buildMarkers(e),this.fitMapToBounds(e.map((function(t){return t.coords})))),{_setInstance:function(t){n.mapInstance=t,n.fitMapToBounds(e.map((function(t){return t.coords}))),n.buildMarkers(e),n.mapLoaded$.next({map:t,markers:n.markerLayer})},containerId:"map-canvas",libOptions:b({},this.options.libOptions),tileLayers:[{url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",options:{}}],initialView:{center:[54.526,15.2551],zoom:5}}},e.prototype.fitMapToBounds=function(t){this.mapInstance?this.mapInstance.fitBounds(t,{maxZoom:15,padding:[20,20]}):console.warn("map instance is missing")},e.prototype.buildMarkers=function(t){if(t){this.markerLayer&&(this.markerLayer.clearLayers(),this.mapInstance.removeLayer(this.markerLayer));var e=L.markerClusterGroup();t.forEach((function(t){var n=t.coords,a=t.template,i=t.id,r=t.slug,o=L.marker(n,{icon:Xn});i&&r&&(o.id=i,o.slug=r),o.addTo(e).bindPopup(a),o.getPopup().on("remove",(function(t){t.target._source.setIcon(Xn)})),o.getPopup().on("add",(function(t){t.target._source.setIcon(Zn)}))})),this.mapInstance.addLayer(e),this.markerLayer=e}},e}(l.DataSource),ta=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isUrl=/^(?:http(s)?:\/\/)[\w.-]+(?:\.[\w.-]+)+[\w\-._~:/?#[\]@!$&'()*+,;=.]+$/,e.toUrl=function(t){return'<a href="'+t+'" target="_blank">'+t+"<a>"},e}return v(e,t),e.prototype.transform=function(t){var e=this;if(!t)return null;var n=this.options.hideLabels,a=t.group;if(!(a||[]).length)return null;var i={group:[]};return a.filter((function(t){var e=t.items;return Array.isArray(e)})).forEach((function(t){t.items.filter((function(t){return d.isObject(t)})).forEach((function(t){var a=t.label,r=t.value,o=a&&!n?a:null;Array.isArray(r)?i.group.push({group:[b({title:l._t(o)},e.getItemGroup(r))]}):i.group.push({group:[{items:r?[{label:l._t(o),value:e.getItemValue(r)}]:[]}]})}))})),i},e.prototype.getItemGroup=function(t){var e=this;return Array.isArray(t)&&Array.isArray(t[0])?{group:t.map((function(t){return b({},e.getItemGroup(t))}))}:{items:t.filter((function(t){return!!t.value})).map((function(t){return{label:l._t(t.label),value:e.getItemValue(t.value)}}))}},e.prototype.getItemValue=function(t){return this.isUrl.test(t)?this.toUrl(t):t},e}(l.DataSource),ea=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=[];return t.nav.forEach((function(t){e.push({text:t.title,anchor:{href:"http://localhost:4200/mr/static/"+t.id,target:"_blank",payload:t.id}})})),{items:e}},e}(l.DataSource),na=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){if(!t)return null;var e=this.options,n=e.currentTab,a=e.root,i=e.slug,r=e.id;return t.map((function(t){var e=t.id,o=t.label;return{label:l._t(o),classes:n===e?"is-active":"",anchor:{href:"/"+a+"/"+r+"/"+i+"/"+e}}}))},e}(l.DataSource),aa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),ia=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timelineLoaded$=new r.Subject,e}return v(e,t),e.prototype.transform=function(t){var e=this;return{containerID:"mr-timeline",libOptions:b({height:"500px",locale:"it_IT",align:"left",showTooltips:!1,tooltip:{followMouse:!1,template:function(t,e){return'<div class="tooltip">'+e.title+"</div>"}},width:"100%",minHeight:"350px",maxHeight:"800px",zoomFriction:8},this.options.libOptions),dataSet:t.dataSet.map((function(t){return t.end&&t.end===t.start?b(b({},t),{end:void 0}):t})),_setInstance:function(t){e.timeline=t,e.timelineLoaded$.next(t)}}},e}(l.DataSource),ra=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),oa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return t?{selected:null,items:t.map((function(t){var e=t.id;return{id:e,title:t.title,thumbSrc:t.thumbnail,fullSrc:t.image,payload:e}}))}:null},e.prototype.setSelected=function(t){this.output.selected=this.output.items.find((function(e){return e.id===t}))},e.prototype.removeSelected=function(){this.output.selected=null},e}(l.DataSource),sa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){var t=this.options.config,e=t.title,n=t.description,a=t.searchId,i={title:{main:{text:l._t(e)}}};return n&&n.buttonText&&(i.actions={buttons:[{text:l._t(n.buttonText),anchor:{payload:a}}]}),i},e}(l.DataSource),ca=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=this.options.config,n=e.totalResultsText,a=e.sort,i=t.total_count,r=t.sort;return{title:{main:{text:l._t(n,{total:i},(function(t,e){var n=e.total;return 0===n?t+"_0":1===n?t+"_1":t}))}},actions:{select:{label:a.label,options:a.options.map((function(t){var e=t.label,n=t.value,a=t.selected;return{value:n,disabled:t.disabled,selected:r?n===r:a,text:e}})),payload:"sort"}}}},e.prototype.OnInputQueryChange=function(t){this.options.config.sort.options.forEach((function(e){"_score"===e.value&&(e.disabled=!t)})),this.update(this.input)},e}(l.DataSource),la={limit:100,striptags:!0},ua=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=t.results,n=this.options.config.itemPreview,a=d.merge(d.clone(la),n||{});return e.map((function(t){"string"==typeof t.text&&(a.striptags&&(t.text=F.striptags(t.text)),a.limit&&t.text.length>a.limit&&(t.text=t.text.substring(0,a.limit)+"..."));var e=[];Array.isArray(t.metadata)&&t.metadata.forEach((function(t){var n=[];(t.items||[]).forEach((function(t){n.push(b(b({},t),{label:l._t(t.label)}))})),e.push({items:n})}));var n=[];if(t.highlights){var i={title:l._t("advancedsearch#highlights_title"),items:[],classes:"n7-item-preview__highlights"};t.highlights.forEach((function(e){var n,a;Array.isArray(e)?i.items.push({label:l._t(e[0]),value:l._t(e[1][0])}):i.items.push({label:e.label?l._t(e.label):void 0,value:null!==(n=e.text)&&void 0!==n?n:"",href:null!==(a=""+t.link+e.link)&&void 0!==a?a:void 0})})),n.push(i)}var r=null;return t.link&&(r={href:jn.getRouterLink(t.link),queryParams:jn.getQueryParams(t.link),target:"_blank"}),t.payload&&(r={payload:b({},t.payload)}),b(b({},t),{metadata:e,anchor:r,highlights:n,classes:a.classes})}))},e}(l.DataSource),da=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasFilters=!1,e}return v(e,t),e.prototype.transform=function(t){var e=t.state,n=t.linksResponse,a=t.facetsConfig,i=n.facets,r=[];return a.sections.forEach((function(t){t.inputs.filter((function(t){return t.queryParam})).forEach((function(t){var n=t.id;e[n]&&(Array.isArray(e[n])?e[n]:[e[n]]).forEach((function(t){var e=t;if(i[n]){var a=i[n].values.find((function(e){return e.payload===t}));a&&(e=a.text)}r.push({text:e,icon:"n7-icon-close",payload:{id:n,value:t}})}))}))})),this.hasFilters=!!r.length,r},e}(l.DataSource),pa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=this.options.config.description;if(!e)return null;var n=e.linkText;return{text:t.text,link:{text:l._t(n),payload:!0}}},e}(l.DataSource),ha=function(t,e){return g(t).format(e)},fa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return{group:[{items:["authors","date","time_to_read"].filter((function(e){return t[e]})).map((function(e){var n="date"===e?ha(t[e],l._t("global#date_human")):t[e];return{label:l._t("resource#"+e),value:n}}))}]}},e}(l.DataSource),ga=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=t.form.config.groups;return t.form.config.groups=e.map((function(t){return b(b({},t),{options:b(b({},t.options),{text:t.options.label,payload:t.id,iconRight:t.options.isOpen?"n7-icon-angle-up":"n7-icon-angle-down",isOpen:t.options.isOpen})})})),t},e.prototype.toggleGroup=function(t){this.output.form.config.groups.forEach((function(e){if(e.id===t){var n=e.options.isOpen;e.options.iconRight=n?"n7-icon-angle-down":"n7-icon-angle-up",e.options.isOpen=!e.options.isOpen}}))},e}(l.DataSource),ma=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){var e=this.options.labels;return Object.keys(t).map((function(n){return{text:(e[n]||n)+": "+l._t(t[n])}}))},e}(l.DataSource),ya=Object.freeze({__proto__:null,MrBreadcrumbsDS:Mn,MrCollectionDS:qn,MrContentDS:Bn,MrFiltersDS:Nn,MrHeroDS:Vn,MrImageViewerDS:zn,MrImageViewerToolsDS:Un,MrInfoBoxDS:Gn,MrInnerTitleDS:Wn,MrItemPreviewDS:Qn,MrItemPreviewsDS:Yn,MrMapDS:Jn,MrMetadataDS:ta,MrNavDS:ea,MrResourceTabsDS:na,MrTextViewerDS:aa,MrTimelineDS:ia,MrYearHeaderDS:ra,MrGalleryDS:oa,MrSearchPageTitleDS:sa,MrSearchResultsTitleDS:ca,MrSearchResultsDS:ua,MrSearchTagsDS:da,MrSearchPageDescriptionDS:pa,MrStaticMetadataDS:fa,MrFormWrapperAccordionDS:ga,MrAdvancedSearchTagsDS:ma}),va=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){},e}(l.EventHandler),ba=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){},e}(l.EventHandler),wa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"dv-nav.click":t.emitOuter("navclick",a);break;default:console.warn("unhandled event of type",n)}}))},e}(l.EventHandler),Sa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){},e}(l.EventHandler),_a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){switch(e.type){case"mr-year-header.click":t.emitOuter("closeevent")}}))},e}(l.EventHandler),ka=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".click":t.dataSource.setSelected(a);break;case t.dataSource.id+".close":t.dataSource.removeSelected()}}))},e}(l.EventHandler),Ia=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".click":"resource-modal"===a.action&&t.emitOuter("openresourcemodal",a)}}))},e}(l.EventHandler),Ea=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-search-tags.click":t.emitOuter("click",a)}}))},e}(l.EventHandler),xa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-search-results-title.change":t.emitOuter("change",a)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-search-layout.inputquerychange":t.dataSource.OnInputQueryChange(a)}}))},e}(l.EventHandler),Ca=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-search-page-title.click":t.emitOuter("click",a)}}))},e}(l.EventHandler),Da=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-search-page-description.click":t.emitOuter("click",a)}}))},e}(l.EventHandler),Oa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-search-results.click":"resource-modal"===a.action&&t.emitOuter("openresourcemodal",a)}}))},e}(l.EventHandler),Ta=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroy$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-form-wrapper-accordion.init":t.listenKeyUpEvents();break;case"mr-form-wrapper-accordion.destroy":t.destroy$.next();break;case"mr-form-wrapper-accordion.submit":var i=t.dataSource.output.form;t.emitOuter("submit",{state:i.getState()});break;case"mr-form-wrapper-accordion.reset":t.emitOuter("reset");break;case"mr-form-wrapper-accordion.click":t.dataSource.toggleGroup(a)}}))},e.prototype.listenKeyUpEvents=function(){var t=this;r.fromEvent(window,"keyup").pipe(o.filter((function(t){return"Enter"===t.key})),o.takeUntil(this.destroy$)).subscribe((function(){t.emitInner("submit")}))},e}(l.EventHandler),Pa=Object.freeze({__proto__:null,MrDummyEH:va,MrFiltersEH:ba,MrNavEH:wa,MrTimelineEH:Sa,MrYearHeaderEH:_a,MrGalleryEH:ka,MrCollectionEH:Ia,MrSearchTagsEH:Ea,MrSearchResultsTitleEH:xa,MrSearchPageTitleEH:Ca,MrSearchPageDescriptionEH:Da,MrSearchResultsEH:Oa,MrFormWrapperAccordionEH:Ta}),Ra={layoutId:"mr-advanced-results-layout",widgets:[{id:"mr-search-page-title"},{id:"mr-search-results-title"},{id:"mr-search-results"},{id:"n7-smart-pagination",dataSource:Y,eventHandler:nt},{id:"mr-advanced-search-tags"}],layoutDS:Ln,layoutEH:An,widgetsDataSources:ya,widgetsEventHandlers:Pa,layoutOptions:{}},$a=function(t){function n(e,n,a,i,r,o,s,c){var l=t.call(this,c.get("MrAdvancedResultsLayoutConfig")||Ra)||this;return l.router=e,l.activatedRoute=n,l.mainState=a,l.configuration=i,l.communication=r,l.layoutState=o,l.modalService=s,l}return v(n,t),n.prototype.initPayload=function(){return{configId:this.configId,configuration:this.configuration,communication:this.communication,mainState:this.mainState,router:this.router,activatedRoute:this.activatedRoute,layoutState:this.layoutState,modalService:this.modalService,options:this.config.options||{}}},n.prototype.ngOnInit=function(){var t=this;this.activatedRoute.data.subscribe((function(e){t.configId=e.configId,t.layoutState.add(["results"]),t.onInit()}))},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:s.Router},{type:s.ActivatedRoute},{type:C},{type:E},{type:T},{type:Pn},{type:Rn},{type:x}]},n=w([e.Component({selector:"mr-advanced-results-layout",template:'<div class="mr-advanced-results mr-layout"\r\n     *ngIf="lb.dataSource">\r\n    <section class="mr-layout__maxwidth mr-side-margin">\r\n\r\n        <div class="mr-advanced-results__title">\r\n            <n7-inner-title\r\n            [data]="lb.widgets[\'mr-search-page-title\'].ds.out$ | async"\r\n            [emit]="lb.widgets[\'mr-search-page-title\'].emit">\r\n            </n7-inner-title>\r\n        </div>\r\n        \r\n        <div class="mr-advanced-results__results-content">\r\n            <div class="scroll-ref">&nbsp;</div>\r\n            <div class="mr-advanced-results__results-wrapper">\r\n                \r\n                <div class="mr-advanced-results__results-info">\r\n                    <n7-inner-title\r\n                    [data]="lb.widgets[\'mr-search-results-title\'].ds.out$ | async"\r\n                    [emit]="lb.widgets[\'mr-search-results-title\'].emit">\r\n                    </n7-inner-title>\r\n                </div>\r\n                \r\n                <div *ngIf="lb.dataSource.pageConfig[\'filters\']" class="mr-active-filters">\r\n                    <span *ngIf="lb.dataSource.pageConfig[\'filters\'].title" \r\n                    class="mr-active-filters__label">{{ lb.dataSource.pageConfig[\'filters\'].title }}</span>\r\n                    <div class="mr-active-filters__tags-wrapper">\r\n                        <n7-tag *ngFor="let tag of (lb.widgets[\'mr-advanced-search-tags\'].ds.out$ | async)"\r\n                            [data]="tag">\r\n                        </n7-tag>\r\n                    </div>\r\n                </div>\r\n\r\n                <main class="mr-advanced-results__results">\r\n                    \r\n                    \x3c!-- SEARCH RESULTS --\x3e\r\n                    <ng-container [ngSwitch]="layoutState.get$(\'results\') | async">\r\n                        \r\n                        \x3c!-- loading --\x3e\r\n                        <ng-container *ngSwitchCase="\'LOADING\'">\r\n                            <div class="mr-advanced-results__results-loading n7-grid-{{ lb.dataSource.pageConfig.grid || 3 }}">\r\n                                <n7-content-placeholder *ngFor="let n of [0,1,2,3,4,5,6,7,8,9]" [data]="{\r\n                                    blocks: [\r\n                                        { classes: \'search-result-placeholder-title\' },\r\n                                        { classes: \'search-result-placeholder-metadata\' },\r\n                                        { classes: \'search-result-placeholder-metadata\' },\r\n                                        { classes: \'search-result-placeholder-metadata\' }\r\n                                    ]\r\n                                }"></n7-content-placeholder>\r\n                            </div>\r\n                        </ng-container>\r\n                        \r\n                        \x3c!-- success: items > 0 --\x3e\r\n                        <ng-container *ngSwitchCase="\'SUCCESS\'">\r\n                            <div class="n7-grid-{{ lb.dataSource.pageConfig.grid || 3 }}">\r\n                                \x3c!-- Use a custom item preview with clickable metadata items --\x3e\r\n                                <mr-advanced-result\r\n                                    *ngFor="let item of (lb.widgets[\'mr-search-results\'].ds.out$ | async)"\r\n                                    [data]="item" [emit]="lb.widgets[\'mr-search-results\'].emit">\r\n                                </mr-advanced-result>\r\n                                \x3c!-- ../../components/advanced-result/advanced-result.html --\x3e\r\n                            </div>\r\n                        </ng-container>\r\n\r\n                        \x3c!-- empty: items === 0 --\x3e\r\n                        <ng-container *ngSwitchCase="\'EMPTY\'">\r\n                            <div *ngIf="lb.dataSource.pageConfig?.fallback?.text" class="mr-advanced-results__results-fallback">\r\n                                <p class="mr-advanced-results__feedback-text">\r\n                                    {{ lb.dataSource.pageConfig.fallback.text }}\r\n                                </p>\r\n                                \x3c!-- <div class="mr-advanced-results__buttons">\r\n                                    <button class="n7-btn n7-btn-xl mr-advanced-results__results-fallback-button"\r\n                                    (click)="lb.eventHandler.emitInner(\'searchreset\')">\r\n                                        {{ lb.dataSource.pageConfig.fallback.button }}\r\n                                    </button>\r\n                                </div> --\x3e\r\n                            </div>\r\n                        </ng-container>\r\n\r\n                        \x3c!-- error: request problem --\x3e\r\n                        <ng-container *ngSwitchCase="\'ERROR\'">\r\n                            <p *ngIf="lb.dataSource.pageConfig?.ko?.text" class="mr-advanced-results__feedback-text">\r\n                                {{ lb.dataSource.pageConfig.ko.text }}\r\n                            </p>\r\n                            \x3c!-- <div class="mr-advanced-results__buttons">\r\n                                <button class="n7-btn n7-btn-xl mr-advanced-results__results-ko-button"\r\n                                (click)="lb.eventHandler.emitInner(\'searchreset\')">\r\n                                    {{ lb.dataSource.pageConfig.ko.button }}\r\n                                </button>\r\n                            </div> --\x3e\r\n                        </ng-container>\r\n                        \r\n                    </ng-container>\r\n                </main>               \r\n                \r\n                <n7-smart-pagination\r\n                    *ngIf="(layoutState.get$(\'results\') | async) === \'SUCCESS\'"\r\n                    [data]="lb.widgets[\'n7-smart-pagination\'].ds.out$ | async"\r\n                    [emit]="lb.widgets[\'n7-smart-pagination\'].emit">\r\n                </n7-smart-pagination>\r\n\r\n            </div>\r\n        </div>\r\n    </section>\r\n</div>\r\n'}),S("design:paramtypes",[s.Router,s.ActivatedRoute,C,E,T,Pn,Rn,x])],n)}(P),La=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={value:null,disabled:!1,hidden:!1},e.getState=function(){return e.state},e}return v(e,t),e.prototype.transform=function(t){return b(b({},t),{placeholder:l._t(t.placeholder)})},e.prototype.setState=function(t){this.state=b(b({},this.state),t),this.refresh()},e.prototype.clear=function(){this.setState({value:null})},e.prototype.refresh=function(){var t=this.state,e=t.value,n=t.hidden,a=t.disabled;this.output.value=e;var i=document.getElementById(this.id);i&&(i.value=e),this.output.disabled=a,this.output.classes=n?"is-hidden":""},e}(l.DataSource),Aa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".change":var i=a.value;t.dataSource.setState({value:i}),t.changed$.next({id:t.dataSource.id,state:t.dataSource.getState()})}}))},e}(l.EventHandler),Ma=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={value:null,disabled:!1,hidden:!1},e.getState=function(){return e.state},e}return v(e,t),e.prototype.transform=function(t){return b(b({},t),{options:this.getOptions(t.options)})},e.prototype.setState=function(t){this.state=b(b({},this.state),t),this.refresh()},e.prototype.clear=function(){this.setState({value:null})},e.prototype.refresh=function(){var t=this.state,e=t.hidden,n=t.disabled;this.output.options=this.getOptions(this.output.options),this.output.disabled=n,this.output.classes=e?"is-hidden":""},e.prototype.getOptions=function(t){var e=this.state.value;return t.map((function(t){return b(b({},t),{label:l._t(t.label),selected:e===t.value})}))},e}(l.DataSource),Ha=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".change":var i=a.value;t.dataSource.setState({value:i}),t.changed$.next({id:t.dataSource.id,state:t.dataSource.getState()})}}))},e}(l.EventHandler),ja=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={value:[],disabled:!1,hidden:!1},e.getState=function(){return e.state},e}return v(e,t),e.prototype.transform=function(t){return b(b({},t),{checkboxes:this.getCheckboxes(t.checkboxes)})},e.prototype.setState=function(t){this.state=b(b({},this.state),t),this.refresh()},e.prototype.clear=function(){this.setState({value:[]})},e.prototype.refresh=function(){var t=this.state.hidden;this.output.checkboxes=this.getCheckboxes(this.output.checkboxes),this.output.classes=t?"is-hidden":""},e.prototype.toggleValue=function(t){var e=t.inputPayload,n=t.value,a=this.state.value,i=!!a.includes(e);n&&!i?a.push(e):!n&&i&&a.splice(a.indexOf(e),1),this.setState({value:a})},e.prototype.getCheckboxes=function(t){var e=this,n=this.state,a=n.value,i=n.disabled;return t.map((function(t,n){return b(b({},t),{id:e.id+"-"+n,disabled:i,label:l._t(t.label),checked:!!a.includes(t.payload)})}))},e}(l.DataSource),Fa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".change":t.dataSource.toggleValue(a),t.changed$.next({id:t.dataSource.id,state:t.dataSource.getState()})}}))},e}(l.EventHandler),qa=function(){function t(){var t=this;this.loaded$=new r.ReplaySubject,this.inputs={},this.inputTypes={text:{ds:La,eh:Aa},select:{ds:Ma,eh:Ha},checkbox:{ds:ja,eh:Fa}},this.changed$=new r.Subject,this.getInput=function(e){return t.inputs[e].ds},this.getInputs=function(){var e={};return Object.keys(t.inputs).forEach((function(n){e[n]=t.getInput(n)})),e}}return t.prototype.init=function(t){this.config=t,this.initInputs(),this.loaded$.next(!0)},t.prototype.getState=function(){var t=this,e={};return Object.keys(this.inputs).forEach((function(n){e[n]=t.inputs[n].ds.getState()})),e},t.prototype.addInputType=function(t,e,n){if(this.inputTypes[t])throw Error("input type "+t+" already exists!");this.inputTypes[t]={ds:e,eh:n}},t.prototype.initInputs=function(){var t=this;this.config.sections.forEach((function(e){e.inputs.forEach((function(e){var n=e.id,a=e.type,i=e.options,r=e.state,o=e.data,s=t.inputTypes[a].ds,c=t.inputTypes[a].eh,l=new s(i||{}),u=new c;l.id=n,o&&l.update(o),r&&l.setState(r),u.hostId=n,u.dataSource=l,u.changed$=t.changed$,u.listen(),t.inputs[n]={ds:l,eh:u,emit:function(t,e){return u.emitInner(t,e)}}}))}))},t}(),Ba=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.initialState={},e}return v(e,t),e.prototype.onInit=function(t){this.router=t.router,this.configuration=t.configuration,this.mainState=t.mainState,this.configId=t.configId,this.pageConfig=this.configuration.get(this.configId),this.addTranslations(this.pageConfig),this.form=new qa,this.form.init(this.pageConfig.formConfig),this.initialState=d.cloneDeep(this.form.getState()),this.one("mr-form-wrapper-accordion").update({form:this.form}),this.updateHeadTitle()},e.prototype.updateHeadTitle=function(){var t=this.configuration.get("name"),e=this.pageConfig.title;this.mainState.update("headTitle",[t,l._t(e)].join(" > "))},e.prototype.onSubmit=function(t){var e=t.state;if(!d.isEmpty(e)){var n=this.pageConfig.resultsUrl+"?"+Object.keys(e).filter((function(t){return!(e[t].disabled||d.isEmpty(e[t].value))})).map((function(t){return{key:t,value:Array.isArray(e[t].value)?e[t].value.join(","):e[t].value}})).map((function(t){var e=t.key,n=t.value;return e+"="+encodeURIComponent(n)})).join("&");window.open(n,"_blank")}},e.prototype.onReset=function(){var t=this;Object.keys(this.initialState).forEach((function(e){var n=d.cloneDeep(t.initialState[e]);t.form.getInput(e).setState(n)}))},e.prototype.addTranslations=function(t){var e=t.formConfig;t.title=l._t(t.title),e.submitButton&&(e.submitButton.label=l._t(e.submitButton.label)),e.resetButton&&(e.resetButton.label=l._t(e.resetButton.label)),e.groups.forEach((function(t){var e;(null===(e=t.options)||void 0===e?void 0:e.label)&&(t.options.label=l._t(t.options.label))})),e.sections.forEach((function(t){t.title&&(t.title=l._t(t.title)),t.description&&(t.description=l._t(t.description)),t.inputs.forEach((function(t){t.data.label&&(t.data.label=l._t(t.data.label)),"text"===t.type&&t.data.placeholder&&(t.data.placeholder=l._t(t.data.placeholder)),"checkbox"===t.type&&t.data.checkboxes.forEach((function(t){t.label=l._t(t.label)})),"select"===t.type&&t.data.options.forEach((function(t){t.label=l._t(t.label)}))}))}))},e}(l.LayoutDataSource),Na=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroy$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-advanced-search-layout.init":t.dataSource.onInit(a),t.onInit(),window.scrollTo(0,0);break;case"mr-advanced-search-layout.destroy":t.destroy$.next();break;default:console.warn("unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-form-wrapper-accordion.submit":t.dataSource.onSubmit(a);break;case"mr-form-wrapper-accordion.reset":t.dataSource.onReset();break;default:console.warn("unhandled inner event of type",n)}}))},e.prototype.onInit=function(){},e}(l.EventHandler),Va={layoutId:"mr-advanced-search-layout",widgets:[{id:"mr-form-wrapper-accordion"}],layoutDS:Ba,layoutEH:Na,widgetsDataSources:ya,widgetsEventHandlers:Pa,layoutOptions:{}},za=function(t){function n(e,n,a,i,r){var o=t.call(this,r.get("MrAdvancedSearchLayoutConfig")||Va)||this;return o.router=e,o.activatedRoute=n,o.mainState=a,o.configuration=i,o}return v(n,t),n.prototype.initPayload=function(){return{configId:this.configId,configuration:this.configuration,mainState:this.mainState,router:this.router,activatedRoute:this.activatedRoute,options:this.config.options||{}}},n.prototype.ngOnInit=function(){var t=this;this.activatedRoute.data.subscribe((function(e){t.configId=e.configId,t.onInit()}))},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:s.Router},{type:s.ActivatedRoute},{type:C},{type:E},{type:x}]},n=w([e.Component({selector:"mr-advanced-search-layout",template:'<div *ngIf="lb.dataSource" class="mr-advanced-search mr-layout">\r\n    <div class="mr-layout__maxwidth mr-side-margin">\r\n\r\n        <n7-inner-title [data]="{\r\n            title: {\r\n                main: {\r\n                    text: lb.dataSource.pageConfig.title\r\n                }\r\n            }\r\n        }"></n7-inner-title>\r\n\r\n        <mr-form-wrapper-accordion \r\n            [data]="lb.widgets[\'mr-form-wrapper-accordion\'].ds.out$ | async"\r\n            [emit]="lb.widgets[\'mr-form-wrapper-accordion\'].emit">\r\n        </mr-form-wrapper-accordion>\r\n    </div>\r\n</div>'}),S("design:paramtypes",[s.Router,s.ActivatedRoute,C,E,x])],n)}(P),Ua=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.onInit=function(){},e}(l.LayoutDataSource),Ga=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-glossary-layout.init":t.dataSource.onInit(a),window.scrollTo(0,0);break;default:console.warn("unhandled inner event of type",n)}}))},e}(l.EventHandler),Wa={layoutId:"n7-glossary-layout",widgets:[],layoutDS:Ua,layoutEH:Ga,widgetsDataSources:ya,widgetsEventHandlers:Pa,layoutOptions:{}},Ka=function(t){function n(e){return t.call(this,e.get("MrGlossaryLayoutConfig")||Wa)||this}return v(n,t),n.prototype.initPayload=function(){return{options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:x}]},n=w([e.Component({selector:"mr-glossary-layout",template:'<div class="glossary-layout" *ngIf="lb.dataSource">\r\n    Hello, from Glossary layout!\r\n</div>\r\n'}),S("design:paramtypes",[x])],n)}(P),Qa=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.errorTitle=l._t("global#layout_error_title"),e.errorDescription=l._t("global#layout_error_description"),e}return v(e,t),e.prototype.onInit=function(t){this.configuration=t.configuration,this.communication=t.communication,this.mainState=t.mainState,this.layoutState=t.layoutState,this.configId=t.configId,this.pageConfig=this.configuration.get(this.configId)||{},this.doRequest(),this.updateHeadTitle()},e.prototype.doRequest=function(){var t=this,e=this.pageConfig.sections;d.isEmpty(e)?console.warn("There are no sections configured for "+this.configId+" layout"):(this.layoutState.set("content",I.LOADING),this.communication.request$("home",{method:"POST",params:e.map((function(t){return t.id})),onError:function(e){console.warn("Error loading "+t.configId+" sections",e.message),t.layoutState.set("content",I.ERROR)}}).subscribe((function(e){t.layoutState.set("content",I.SUCCESS),t.initSections(e)})))},e.prototype.initSections=function(t){var e=this,n=this.pageConfig.sections;n&&n.forEach((function(n){var a=n.id,i=e.getWidgetDataSource(a),r=t[a];i.id=a,r&&e.one(a).update(r)}))},e.prototype.updateHeadTitle=function(){var t=this.configuration.get("name"),e=this.pageConfig.title;this.mainState.update("headTitle",[t,e].join(" > "))},e}(l.LayoutDataSource),Ya=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-home-layout.init":t.dataSource.onInit(a),window.scrollTo(0,0)}})),this.outerEvents$.subscribe((function(t){t.type}))},e}(l.EventHandler),Xa={layoutId:"mr-home-layout",widgets:[],layoutDS:Qa,layoutEH:Ya,widgetsDataSources:ya,widgetsEventHandlers:Pa,options:{}},Za=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(t){return{slides:t.slides,containerId:"carousel-"+this.id,libOptions:{count:1,move:1,buttons:!0,dots:!0,rewind:!0,autoplay:0,animation:500}}},e}(l.DataSource),Ja=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){},e}(l.EventHandler),ti=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){},e}(l.EventHandler),ei={slider:Za,collection:qn,hero:Vn,content:Bn},ni={slider:Ja,collection:Ia,hero:ti},ai=function(t){function n(e,n,a,i,r,o){var s=t.call(this,e.get("MrHomeLayoutConfig")||Xa)||this;return s.activatedRoute=n,s.configuration=a,s.communication=i,s.mainState=r,s.layoutState=o,s}return v(n,t),n.prototype.initPayload=function(){return{configId:this.configId,mainState:this.mainState,configuration:this.configuration,communication:this.communication,layoutState:this.layoutState,options:this.config.options||{}}},n.prototype.ngOnInit=function(){var t=this;this.activatedRoute.data.subscribe((function(e){t.configId=e.configId,t.layoutState.add("content"),t.loadWidgets(),t.onInit()}))},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.prototype.loadWidgets=function(){var t=this,e=(this.configuration.get(this.configId)||{}).sections;this.widgets=[],e&&e.forEach((function(e){var n=e.id,a=e.type,i=e.options;t.widgets.push({id:n,options:i,dataSource:ei[a],eventHandler:ni[a]})}))},n.ctorParameters=function(){return[{type:x},{type:s.ActivatedRoute},{type:E},{type:T},{type:C},{type:Pn}]},n=w([e.Component({selector:"mr-home-layout",template:'<div class="mr-home mr-layout"\r\n     *ngIf="lb.dataSource"\r\n     [ngClass]="{\r\n        \'is-loading\': ( layoutState.get$(\'content\') | async ) == \'LOADING\',\r\n        \'is-error\': ( layoutState.get$(\'content\') | async ) == \'ERROR\'\r\n      }">\r\n    \x3c!-- HOME CONTENT --\x3e\r\n    <ng-container [ngSwitch]="layoutState.get$(\'content\') | async">\r\n        \x3c!-- loading --\x3e\r\n        <ng-container *ngSwitchCase="\'LOADING\'">\r\n            <div class="mr-layout__loader">\r\n                <n7-loader></n7-loader>\r\n            </div>\r\n        </ng-container>\r\n\r\n        \x3c!-- error --\x3e\r\n        <ng-container *ngSwitchCase="\'ERROR\'">\r\n            <div class="mr-layout__error">\r\n                <h2>{{ lb.dataSource.errorTitle }}</h2>\r\n                <p>{{ lb.dataSource.errorDescription }}</p>\r\n            </div>\r\n        </ng-container>\r\n\r\n        \x3c!-- success --\x3e\r\n        <ng-container *ngSwitchCase="\'SUCCESS\'">\r\n            <section *ngFor="let section of lb.dataSource.pageConfig.sections" class="{{ \'mr-layout__\' + section.type }}">\r\n                <ng-container [ngSwitch]="section.type">\r\n        \r\n                    \x3c!-- SLIDER --\x3e\r\n                    <ng-container *ngSwitchCase="\'slider\'">\r\n                        <n7-carousel \r\n                        [data]="lb.widgets[section.id].ds.out$ | async"\r\n                        [emit]="lb.widgets[section.id].emit">\r\n                        </n7-carousel> \r\n                    </ng-container>\r\n        \r\n                    \x3c!-- COLLECTION --\x3e\r\n                    <ng-container *ngSwitchCase="\'collection\'">\r\n                        <div class="mr-layout__maxwidth mr-items-preview">\r\n                            <n7-inner-title \r\n                            [data]="(lb.widgets[section.id].ds.out$ | async)?.header"\r\n                            [emit]="lb.widgets[section.id].emit">\r\n                            </n7-inner-title>\r\n                            <div class="{{ section.grid ? \'n7-grid-\' + section.grid : \'\' }}">\r\n                                <n7-item-preview\r\n                                *ngFor="let item of (lb.widgets[section.id].ds.out$ | async)?.items"\r\n                                [data]="item"\r\n                                [emit]="lb.widgets[section.id].emit">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n        \r\n                    \x3c!-- HERO --\x3e\r\n                    <ng-container *ngSwitchCase="\'hero\'">\r\n                        <n7-hero \r\n                        [data]="lb.widgets[section.id].ds.out$ | async"\r\n                        [emit]="lb.widgets[section.id].emit">\r\n                        </n7-hero> \r\n                    </ng-container>\r\n        \r\n                    \x3c!-- CONTENT --\x3e\r\n                    <ng-container *ngSwitchCase="\'content\'">\r\n                        <div [innerHTML]="lb.widgets[section.id].ds.out$ | async"></div>\r\n                    </ng-container>\r\n                \r\n                </ng-container>\r\n            </section>\r\n        </ng-container>\r\n\r\n    </ng-container>\r\n</div>\r\n'}),S("design:paramtypes",[x,s.ActivatedRoute,E,T,C,Pn])],n)}(P),ii=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.errorTitle=l._t("global#layout_error_title"),e.errorDescription=l._t("global#layout_error_description"),e}return v(e,t),e.prototype.onInit=function(t){this.configuration=t.configuration,this.communication=t.communication,this.mainState=t.mainState,this.configId=t.configId,this.pageConfig=this.configuration.get(this.configId),this.pageConfig.sections=this.pageConfig.sections.map((function(t){return b(b({},t),{title:l._t(t.title)})}))},e.prototype.pageRequest$=function(t,e){return this.communication.request$("itinerary",{onError:e,method:"GET",urlParams:t})},e.prototype.handleResponse=function(t){this.updateTitle(t),this.updateContent(t),this.updateMetadata(t),this.initSections(t),this.updateHeadTitle(t)},e.prototype.updateTitle=function(t){var e=t.title;this.title=e},e.prototype.updateContent=function(t){var e=t.content;this.content=e},e.prototype.updateMetadata=function(t){this.one("mr-static-metadata").update(t)},e.prototype.initSections=function(t){var e=this;this.pageConfig.sections.forEach((function(n){var a=n.id,i=e.getWidgetDataSource(a);if(i){var r=t.sections[a];i.id=a,r&&e.one(a).update(r)}}))},e.prototype.updateHeadTitle=function(t){var e=t.title,n=this.configuration.get("name"),a=this.pageConfig.title;this.mainState.update("headTitle",[n,l._t(a),e].join(" > "))},e}(l.LayoutDataSource),ri=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroy$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-itinerary-layout.init":t.route=a.route,t.router=a.router,t.layoutState=a.layoutState,t.modalService=a.modalService,t.dataSource.onInit(a),t.listenRoute(),window.scrollTo(0,0);break;case"mr-resource-layout.destroy":t.destroy$.next();break;default:console.warn("unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;if(-1!==n.indexOf("openresourcemodal")){var i=a.id,r=a.type;t.modalService.open(i,r)}}))},e.prototype.listenRoute=function(){var t=this;this.route.paramMap.pipe(o.takeUntil(this.destroy$),o.tap((function(){t.layoutState.set("content",I.LOADING)})),o.map((function(t){return t.get("id")})),o.switchMap((function(e){return t.dataSource.pageRequest$(e,(function(n){if(404===n.status){var a=t.router.config.find((function(t){var e=t.data;return"page-404"===(null==e?void 0:e.id)})),i=(null==a?void 0:a.path)||"page-404";t.router.navigate([i])}console.warn("Error loading resource layout for "+e,n.message),t.layoutState.set("content",I.ERROR)}))}))).subscribe((function(e){t.layoutState.set("content",I.SUCCESS),t.dataSource.handleResponse(e),window.scrollTo(0,0)}))},e}(l.EventHandler),oi={layoutId:"mr-itinerary-layout",widgets:[{id:"mr-static-metadata"}],layoutDS:ii,layoutEH:ri,widgetsDataSources:ya,widgetsEventHandlers:Pa,options:{}},si={collection:qn,metadata:ta,gallery:oa},ci={collection:Ia,gallery:ka},li=function(t){function n(e,n,a,i,r,o,s,c,l){var u=t.call(this,e.get("MrItineraryLayoutConfig")||oi)||this;return u.activatedRoute=n,u.configuration=a,u.communication=i,u.mainState=r,u.route=o,u.router=s,u.layoutState=c,u.modalService=l,u}return v(n,t),n.prototype.initPayload=function(){return{configId:this.configId,configuration:this.configuration,communication:this.communication,mainState:this.mainState,layoutState:this.layoutState,modalService:this.modalService,options:this.config.options||{},route:this.route,router:this.router}},n.prototype.ngOnInit=function(){var t=this;this.activatedRoute.data.subscribe((function(e){t.layoutState.add("content"),t.configId=e.configId,t.loadWidgets(),t.onInit()}))},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.prototype.loadWidgets=function(){var t=this,e=this.configuration.get(this.configId).sections;e&&e.forEach((function(e){var n=e.id,a=e.type,i=e.options;t.widgets.push({id:n,options:i,dataSource:si[a],eventHandler:ci[a]})}))},n.ctorParameters=function(){return[{type:x},{type:s.ActivatedRoute},{type:E},{type:T},{type:C},{type:s.ActivatedRoute},{type:s.Router},{type:Pn},{type:Rn}]},n=w([e.Component({selector:"mr-itinerary-layout",template:'<div class="mr-static mr-layout" \r\n     *ngIf="lb.dataSource && lb.dataSource.pageConfig"\r\n     [ngClass]="{\r\n        \'is-loading\': ( layoutState.get$(\'content\') | async ) == \'LOADING\',\r\n        \'is-error\': ( layoutState.get$(\'content\') | async ) == \'ERROR\'\r\n      }">\r\n    \x3c!-- ITINERARY LAYOUT CONTENT --\x3e\r\n    <ng-container [ngSwitch]="layoutState.get$(\'content\') | async">\r\n        \x3c!-- loading --\x3e\r\n        <ng-container *ngSwitchCase="\'LOADING\'">\r\n            <div class="mr-layout__loader">\r\n                <n7-loader></n7-loader>\r\n            </div>\r\n        </ng-container>\r\n\r\n        \x3c!-- error --\x3e\r\n        <ng-container *ngSwitchCase="\'ERROR\'">\r\n            <div class="mr-layout__error">\r\n                <h2>{{ lb.dataSource.errorTitle }}</h2>\r\n                <p>{{ lb.dataSource.errorDescription }}</p>\r\n            </div>\r\n        </ng-container>\r\n\r\n        \x3c!-- success --\x3e\r\n        <ng-container *ngSwitchCase="\'SUCCESS\'">\r\n            <div class="mr-static__top">\r\n                <h1 class="mr-static__title mr-generated-title-WP">{{lb.dataSource.title}}</h1>\r\n                <div class="mr-static__metadata">\r\n                    <n7-metadata-viewer \r\n                    [data]="lb.widgets[\'mr-static-metadata\'].ds.out$ | async">\r\n                    </n7-metadata-viewer>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="mr-static__content mr-side-margin">\r\n                \x3c!-- Page content html --\x3e\r\n                <div class="mr-wp-content" [innerHTML]="lb.dataSource.content | keepHtml"></div>\r\n    \r\n                \x3c!-- Pass the list of blocks to render to the block template --\x3e\r\n                <div class="mr-static__related-resources">\r\n                    <ng-container *ngTemplateOutlet="blocks; context: { $implicit: lb.dataSource.pageConfig.sections }"></ng-container>\r\n                </div>\r\n            </div>\r\n        </ng-container>\r\n\r\n    </ng-container>\r\n</div>\r\n\r\n<ng-template #blocks let-list>\r\n    <ng-container *ngFor="let section of list">\r\n        <section *ngIf="lb.widgets[section.id].ds.out$ | async"\r\n        class="{{ \'mr-resource__section mr-resource__\' + section.type }}">\r\n            <ng-container [ngSwitch]="section.type">\r\n    \r\n                \x3c!-- METADATA VIEWER --\x3e\r\n                <ng-container *ngSwitchCase="\'metadata\'">\r\n                    \r\n                    <div class="mr-content-block mr-content-block-metadata">\r\n                        <h3 *ngIf="section.title" class="mr-content-block__title">\r\n                            {{ section.title }}\r\n                        </h3>\r\n                        <div class="mr-content-block__content">\r\n                            <mr-read-more [data]="section.readmore">\r\n                                <n7-metadata-viewer [data]="lb.widgets[section.id].ds.out$ | async"\r\n                                    [emit]="lb.widgets[section.id].emit">\r\n                                </n7-metadata-viewer>\r\n                            </mr-read-more>\r\n                        </div>\r\n                    </div>\r\n\r\n                </ng-container>\r\n    \r\n                \x3c!-- COLLECTION --\x3e\r\n                <ng-container *ngSwitchCase="\'collection\'">\r\n                    <ng-container *ngIf="lb.widgets[section.id].ds.out$ | async as collection$">\r\n                        \r\n                        <div *ngIf="collection$.items?.length > 0" class="mr-content-block mr-content-block-collection">\r\n                            <h3 *ngIf="section.title" class="mr-content-block__title">\r\n                                {{ section.title }}\r\n                            </h3>\r\n                            <div class="mr-content-block__content {{ section.grid ? \'n7-grid-\' + section.grid : \'\' }}">\r\n                                <n7-item-preview *ngFor="let item of collection$?.items"\r\n                                    [data]="item" [emit]="lb.widgets[section.id].emit">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </div>\r\n\r\n                    </ng-container>\r\n                </ng-container>\r\n    \r\n                \x3c!-- GALLERY --\x3e\r\n                <ng-container *ngSwitchCase="\'gallery\'">\r\n                    <div class="mr-content-block mr-content-block-gallery">\r\n                        <h3 *ngIf="section.title" class="mr-content-block__title">\r\n                            {{ section.title }}\r\n                        </h3>\r\n                        <div class="mr-content-block__content">\r\n                            <mr-gallery [grid]="section.grid" [data]="lb.widgets[section.id].ds.out$ | async" [emit]="lb.widgets[section.id].emit">        \r\n                            </mr-gallery>\r\n                        </div>\r\n                    </div>\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n        </section>\r\n    </ng-container>\r\n</ng-template>\r\n'}),S("design:paramtypes",[x,s.ActivatedRoute,E,T,C,s.ActivatedRoute,s.Router,Pn,Rn])],n)}(P),ui=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading={resourceDetails:!0,timeline:!0},e.eventDescription="",e.mapListener$=new r.Subject,e}return v(e,t),e.prototype.onInit=function(t){var e=this;this.configuration=t.configuration,this.communication=t.communication,this.route=t.route,this.location=t.location,this.configId=t.configId,this.pageConfig=this.configuration.get(this.configId)||{},this.one("mr-map").updateOptions({libOptions:this.pageConfig.libOptions}),this.communication.request$("map",{method:"GET",onError:function(t){return console.error(t)}}).subscribe((function(t){var n=t.dataSet;n&&e.one("mr-map").update(n)})),this.getWidgetDataSource("mr-map").mapLoaded$.pipe(o.first()).subscribe((function(t){var n=t.map,a=t.markers;e.mapListener$.next({map:n,markers:a})}))},e.prototype.loadDefaults=function(t){this.eventDescription=l._t(this.pageConfig.defaultText),this.eventHeader="",this.bibliographyData=void 0,this.collectionWitnessData=void 0,this.collectionWorksData=void 0,this.collectionGalleryData=void 0,t&&this.location.go("/map/"),this.one("mr-year-header").update({title:{main:{text:l._t(this.pageConfig.title)}}})},e.prototype.updatePageDetails=function(t){var e=this;this.communication.request$("resource",{onError:function(t){return console.error(t)},method:"POST",params:{id:t,type:"views/places"}}).subscribe((function(t){if(t&&null!=t){var n=t.sections,a=n["collection-bibliography"],i=n["collection-places"],r=n["collection-witnesses"],o=n["collection-works"],s=n.gallery,c=n.header;i&&e.one("mr-map").update(i),e.bibliographyData=a||void 0,e.collectionWitnessData=r?{items:r.items.map((function(t){return{title:t.title,anchor:{href:t.link}}})),header:r.header}:void 0,(null==o?void 0:o.items)?e.collectionWorksData={header:o.header,items:o.items.map((function(t){return{image:t.image,title:t.title,anchor:t.link?{href:t.link}:void 0,text:t.text}}))}:e.collectionWorksData=void 0,e.collectionGalleryData=s||void 0,c&&(e.eventDescription=c.content,e.eventHeader=t.title,e.one("mr-year-header").update({title:{main:{text:t.title}},actions:{buttons:[{text:"",icon:"n7-icon-close",anchor:{payload:"closebutton"}}]}})),e.loading.resourceDetails=!1}}))},e}(l.LayoutDataSource),di=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-map-layout.init":t.dataSource.onInit(a),t.route=a.route,t.router=a.router,t.location=a.location,t.listenRoute(),window.scrollTo(0,0),t.dataSource.mapListener$.subscribe((function(e){e.markers.on("click",(function(e){var n=e.layer;n.id&&(n.getIcon().options.className.includes("selected")?(t.location.go("/map/"+n.id+"/"+n.slug),t.dataSource.updatePageDetails(n.id)):(t.location.go("/map/"),t.dataSource.loadDefaults()))}))}));break;case"mr-timeline-layout.destroy":break;default:console.warn("unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){switch(e.type){case"mr-year-header.closeevent":t.dataSource.loadDefaults(!0)}}))},e.prototype.listenRoute=function(){var t=this;this.route.paramMap.subscribe((function(e){var n=e.get("id");n?(t.dataSource.currentId=n,t.emitOuter("routechanged",n),t.dataSource.updatePageDetails(n)):t.dataSource.loadDefaults(!0)}))},e}(l.EventHandler),pi={layoutId:"mr-map-layout",widgets:[{id:"mr-map"},{id:"mr-year-header"}],layoutDS:ui,layoutEH:di,widgetsDataSources:ya,widgetsEventHandlers:Pa,options:{}},hi=function(t){function a(e,n,a,i,r,o,s,c){var l=t.call(this,e.get("MrMapLayoutConfig")||pi)||this;return l.route=n,l.router=a,l.location=i,l.configuration=r,l.communication=o,l.mainState=s,l.layoutState=c,l}return v(a,t),a.prototype.initPayload=function(){return{configId:this.configId,mainState:this.mainState,configuration:this.configuration,communication:this.communication,layoutState:this.layoutState,route:this.route,router:this.router,location:this.location,options:this.config.options||{}}},a.prototype.ngOnInit=function(){var t=this;this.route.data.subscribe((function(e){t.configId=e.configId,t.layoutState.add("content"),t.onInit()}))},a.prototype.ngOnDestroy=function(){this.onDestroy()},a.ctorParameters=function(){return[{type:x},{type:s.ActivatedRoute},{type:s.Router},{type:n.Location},{type:E},{type:T},{type:C},{type:Pn}]},a=w([e.Component({selector:"mr-map-layout",template:'<div class="mr-map-layout mr-layout"\r\n     *ngIf="lb.dataSource">\r\n    <div class="mr-map-layout__map">\r\n        <div class="mr-map-layout__map-loading"\r\n             *ngIf="lb.dataSource.loading.timeline">\r\n        </div>\r\n        <n7-map [data]="lb.widgets[\'mr-map\'].ds.out$ | async"></n7-map>\r\n        \x3c!-- <n7-timeline [data]="lb.widgets[\'mr-timeline\'].ds.out$ | async"\r\n                     *ngIf="!lb.dataSource.loading.timeline">\r\n        </n7-timeline> --\x3e\r\n    </div>\r\n\r\n    <div class="mr-map-layout__page mr-side-margin">\r\n        <div class="mr-map-layout__date">\r\n            <n7-inner-title [data]="lb.widgets[\'mr-year-header\'].ds.out$ | async"\r\n                            [emit]="lb.widgets[\'mr-year-header\'].emit">\r\n            </n7-inner-title>\r\n        </div>\r\n        \x3c!--\r\n        <h1 class="mr-map-layout__title"\r\n            *ngIf="!lb.dataSource.loading.resourceDetails">\r\n            {{lb.dataSource.eventHeader}}\r\n        </h1>\r\n        --\x3e\r\n        <div class="mr-map-layout__content">\r\n            \x3c!-- DESCRIZIONE --\x3e\r\n            <div class="mr-content-block mr-content-block-description" *ngIf="lb.dataSource.eventDescription">\r\n                <p [innerHTML]="lb.dataSource.eventDescription">\r\n                <p>\r\n            </div>\r\n            <ng-container *ngIf="!lb.dataSource.loading.resourceDetails">\r\n\r\n                \x3c!-- GALLERIA --\x3e\r\n                <div class="mr-content-block n7-grid-6">\r\n                    <ng-container *ngFor="let image of lb.dataSource.collectionGalleryData">\r\n                        <a [href]="image.image" class="mr-gallery__image">\r\n                            <img [src]="image.thumbnail" alt="image.title">\r\n                        </a>\r\n                    </ng-container>\r\n                </div>\r\n\r\n                \x3c!-- BIBLIOGRAFIA --\x3e\r\n                <ng-container *ngIf="lb.dataSource.bibliographyData as biblio">\r\n                    <ng-container *ngIf="biblio.items && biblio.items.length > 0">\r\n                        <div class="mr-content-block mr-content-block-collection">\r\n                            <h3 class="mr-content-block__title">{{ biblio.header.title }}</h3>\r\n                            <div class="mr-content-block__content n7-grid-1">\r\n                                <ng-container *ngFor="let item of biblio.items">\r\n                                    <div class="mr-map-layout__collection-content">\r\n                                        <n7-item-preview [data]="item"></n7-item-preview>\r\n                                    </div>\r\n                                </ng-container>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </ng-container>\r\n\r\n                \x3c!-- TESTIMONI --\x3e\r\n                <ng-container *ngIf="lb.dataSource.collectionWitnessData as wit">\r\n                    <ng-container *ngIf="wit.items && wit.items.length > 0">\r\n                        <div class="mr-content-block-collection mr-content-block">\r\n                            <h3 class="mr-content-block__title">{{ wit.header.title }}</h3>\r\n                            <div class="mr-content-block__content n7-grid-3">\r\n                                <n7-item-preview *ngFor="let item of wit.items"\r\n                                                 [data]="item">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </ng-container>\r\n\r\n                \x3c!-- OPERE --\x3e\r\n                <ng-container *ngIf="lb.dataSource.collectionWorksData as works">\r\n                    <ng-container *ngIf="works.items && works.items.length > 0">\r\n                        <div class="mr-content-block-collection mr-content-block">\r\n                            <h3 class="mr-content-block__title">{{ works.header.title }}</h3>\r\n                            <div class="mr-content-block__content n7-grid-3">\r\n                                <n7-item-preview *ngFor="let item of works.items"\r\n                                                 [data]="item">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),S("design:paramtypes",[x,s.ActivatedRoute,s.Router,n.Location,E,T,C,Pn])],a)}(P),fi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.onInit=function(t){this.configuration=t.configuration,this.mainState=t.mainState,this.configId=t.configId,this.communication=t.communication,this.pageConfig=this.configuration.get(this.configId),this.all().updateOptions({config:this.pageConfig}),this.one("mr-search-page-title").update({}),this.updateHeadTitle(),this.addTranslations(this.pageConfig)},e.prototype.updateSearchTags=function(t){if(this.pageConfig.filters){var e=this.pageConfig.filters.labels,n=[];Object.keys(e).filter((function(e){return!!t[e]})).forEach((function(e){n[e]=t[e]})),this.one("mr-advanced-search-tags").updateOptions({labels:e}),this.one("mr-advanced-search-tags").update(n)}},e.prototype.request$=function(t,e){var n=this.pageConfig.searchId,a=b({},t);Object.keys(a).filter((function(t){return["page","limit","sort"].includes(t)})).forEach((function(t){a.results=a.results||{},a.results[t]=a[t],delete a[t]}));var i={},r=a.results||{},o=r.page?+r.page:1;return i.limit=r.limit?+r.limit:12,i.offset=1===o?0:i.limit*(o-1),i.sort=r.sort||"sort_ASC",this.communication.request$("posts",{method:"POST",params:b(b({},a),{searchId:n,results:b({},i)}),onError:e})},e.prototype.handleResponse=function(t){this.some(["mr-search-results-title","mr-search-results"]).update(t),this.one("n7-smart-pagination").updateOptions({mode:"payload"}),this.one("n7-smart-pagination").update(this.getPaginationParams(t))},e.prototype.updateHeadTitle=function(){var t=this.configuration.get("name"),e=this.pageConfig.title;this.mainState.update("headTitle",[t,l._t(e)].join(" > "))},e.prototype.addTranslations=function(t){var e;(null===(e=null==t?void 0:t.sort)||void 0===e?void 0:e.label)&&(t.sort.label=l._t(t.sort.label),t.sort.options=t.sort.options.map((function(t){return b(b({},t),{label:l._t(t.label)})}))),["text","button"].forEach((function(e){t.fallback&&(t.fallback[e]=l._t(t.fallback[e])),t.ko&&(t.ko[e]=l._t(t.ko[e]))}));var n=this.pageConfig.filters;n&&(n.title=l._t(n.title),Object.keys(n.labels).forEach((function(t){n.labels[t]=l._t(n.labels[t])})))},e.prototype.getPaginationParams=function(t){var e=t.total_count,n=t.offset,a=t.limit,i=this.pageConfig.pagination;return{totalPages:Math.ceil(e/a),currentPage:(n+a)/a,pageLimit:i.limit,sizes:{label:i.selectLabel?l._t(i.selectLabel):null,list:i.options,active:a}}},e}(l.LayoutDataSource),gi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroy$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-posts-layout.init":t.activatedRoute=a.activatedRoute,t.router=a.router,t.layoutState=a.layoutState,t.dataSource.onInit(a),t.listenToRouterChanges(),window.scrollTo(0,0);break;case"mr-posts-layout.destroy":t.destroy$.next();break;default:console.warn("unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"n7-smart-pagination.click":t.updateRouter({page:a.page});break;case"n7-smart-pagination.change":t.updateRouter({limit:a.value,page:1});break;case"mr-search-results-title.change":t.updateRouter({sort:a.value,page:1});break;default:console.warn("unhandled inner event of type",n)}}))},e.prototype.listenToRouterChanges=function(){var t=this;this.activatedRoute.queryParams.pipe(o.takeUntil(this.destroy$),o.tap((function(){t.layoutState.set("results",I.LOADING)})),o.switchMap((function(e){return t.dataSource.updateSearchTags(e),t.dataSource.request$(e,(function(e){console.warn("Posts search error",e),t.layoutState.set("results",I.ERROR)}))}))).subscribe((function(e){t.dataSource.handleResponse(e),t.layoutState.set("results",d.isEmpty(e.results)?I.EMPTY:I.SUCCESS),t.scrollRefElement?F.isElementInViewport(t.scrollRefElement)||t.scrollRefElement.scrollIntoView():t.scrollRefElement=document.querySelector(".scroll-ref")}))},e.prototype.updateRouter=function(t){this.router.navigate([],{queryParams:t,queryParamsHandling:"merge"})},e}(l.EventHandler),mi={layoutId:"mr-posts-layout",widgets:[{id:"mr-search-page-title"},{id:"mr-search-results-title"},{id:"mr-search-results"},{id:"n7-smart-pagination",dataSource:Y,eventHandler:nt},{id:"mr-advanced-search-tags"}],layoutDS:fi,layoutEH:gi,widgetsDataSources:ya,widgetsEventHandlers:Pa,layoutOptions:{}},yi=function(t){function n(e,n,a,i,r,o,s){var c=t.call(this,s.get("MrPostsLayoutConfig")||mi)||this;return c.router=e,c.activatedRoute=n,c.mainState=a,c.configuration=i,c.communication=r,c.layoutState=o,c}return v(n,t),n.prototype.initPayload=function(){return{configId:this.configId,configuration:this.configuration,communication:this.communication,mainState:this.mainState,router:this.router,activatedRoute:this.activatedRoute,layoutState:this.layoutState,options:this.config.options||{}}},n.prototype.ngOnInit=function(){var t=this;this.activatedRoute.data.subscribe((function(e){t.configId=e.configId,t.layoutState.add(["results"]),t.onInit()}))},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:s.Router},{type:s.ActivatedRoute},{type:C},{type:E},{type:T},{type:Pn},{type:x}]},n=w([e.Component({selector:"mr-posts-layout",template:'<div class="mr-search mr-layout"\r\n     *ngIf="lb.dataSource">\r\n    <section class="mr-layout__maxwidth mr-side-margin">\r\n\r\n        <div class="mr-search__title">\r\n            <div class="scroll-ref">&nbsp;</div>\r\n            <n7-inner-title\r\n            [data]="lb.widgets[\'mr-search-page-title\'].ds.out$ | async"\r\n            [emit]="lb.widgets[\'mr-search-page-title\'].emit">\r\n            </n7-inner-title>\r\n        </div>\r\n        \r\n        <div class="mr-search__results-content">\r\n            <div class="mr-search__results-wrapper">\r\n                <div class="mr-search__results-info">\r\n                    <n7-inner-title\r\n                    [data]="lb.widgets[\'mr-search-results-title\'].ds.out$ | async"\r\n                    [emit]="lb.widgets[\'mr-search-results-title\'].emit">\r\n                    </n7-inner-title>\r\n                </div>\r\n                <div *ngIf="lb.dataSource.pageConfig[\'filters\']" class="mr-search__results-filters">\r\n                    <span *ngIf="lb.dataSource.pageConfig[\'filters\'].title" \r\n                    class="mr-search__results-filters-title">{{ lb.dataSource.pageConfig[\'filters\'].title }}</span>\r\n                    <div class="mr-search__results-filters-wrapper">\r\n                        <n7-tag *ngFor="let tag of (lb.widgets[\'mr-advanced-search-tags\'].ds.out$ | async)"\r\n                            [data]="tag">\r\n                        </n7-tag>\r\n                    </div>\r\n                </div>\r\n                <main class="mr-search__results">\r\n                    \x3c!-- SEARCH RESULTS --\x3e\r\n                    <ng-container [ngSwitch]="layoutState.get$(\'results\') | async">\r\n                        \r\n                        \x3c!-- loading --\x3e\r\n                        <ng-container *ngSwitchCase="\'LOADING\'">\r\n                            <div class="mr-search__results-loading n7-grid-{{ lb.dataSource.pageConfig.grid || 3 }}">\r\n                                <n7-content-placeholder *ngFor="let n of [0,1,2,3,4,5,6,7,8,9]" [data]="{\r\n                                    blocks: [\r\n                                        { classes: \'search-result-placeholder-title\' },\r\n                                        { classes: \'search-result-placeholder-metadata\' },\r\n                                        { classes: \'search-result-placeholder-metadata\' },\r\n                                        { classes: \'search-result-placeholder-metadata\' }\r\n                                    ]\r\n                                }"></n7-content-placeholder>\r\n                            </div>\r\n                        </ng-container>\r\n                        \r\n                        \x3c!-- success: items > 0 --\x3e\r\n                        <ng-container *ngSwitchCase="\'SUCCESS\'">\r\n                            <div class="n7-grid-{{ lb.dataSource.pageConfig.grid || 3 }}">\r\n                                <n7-item-preview *ngFor="let item of (lb.widgets[\'mr-search-results\'].ds.out$ | async)"\r\n                                [data]="item">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </ng-container>\r\n\r\n                        \x3c!-- empty: items === 0 --\x3e\r\n                        <ng-container *ngSwitchCase="\'EMPTY\'">\r\n                            <div class="mr-search__results-fallback">\r\n                                <p class="mr-search__results-fallback-string">\r\n                                    {{ lb.dataSource.pageConfig.fallback.text }}\r\n                                </p>\r\n                                <button class="n7-btn mr-search__results-fallback-button"\r\n                                    (click)="lb.eventHandler.emitInner(\'searchreset\')">\r\n                                    {{ lb.dataSource.pageConfig.fallback.button }}\r\n                                </button>\r\n                            </div>\r\n                        </ng-container>\r\n\r\n                        \x3c!-- error: request problem --\x3e\r\n                        <ng-container *ngSwitchCase="\'ERROR\'">\r\n                            <p class="mr-search__results-ko-string">\r\n                                {{ lb.dataSource.pageConfig.ko.text }}\r\n                            </p>\r\n                            <button class="n7-btn mr-search__results-ko-button"\r\n                                (click)="lb.eventHandler.emitInner(\'searchreset\')">\r\n                                {{ lb.dataSource.pageConfig.ko.button }}\r\n                            </button>\r\n                        </ng-container>\r\n                        \r\n                    </ng-container>\r\n                </main>               \r\n                <n7-smart-pagination\r\n                *ngIf="(layoutState.get$(\'results\') | async) === \'SUCCESS\'"\r\n                [data]="lb.widgets[\'n7-smart-pagination\'].ds.out$ | async"\r\n                [emit]="lb.widgets[\'n7-smart-pagination\'].emit">\r\n                </n7-smart-pagination>\r\n            </div>\r\n        </div>\r\n\r\n    </section>\r\n</div>\r\n'}),S("design:paramtypes",[s.Router,s.ActivatedRoute,C,E,T,Pn,x])],n)}(P),vi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.errorTitle=l._t("global#layout_error_title"),e.errorDescription=l._t("global#layout_error_description"),e}return v(e,t),e.prototype.onInit=function(t){var e=this;this.configuration=t.configuration,this.communication=t.communication,this.mainState=t.mainState,this.configId=t.configId,this.pageConfig=this.configuration.get(this.configId);var n=this.configuration.get("tabs"),a=this.pageConfig.tabs;n&&a&&(this.tabConfig=n[a]),["top","content"].forEach((function(t){e.pageConfig.sections[t]=e.pageConfig.sections[t].map((function(t){return b(b({},t),{title:l._t(t.title)})}))}))},e.prototype.pageRequest$=function(t,e){var n=this.pageConfig.sections,a=n.top,i=n.content,r=a.concat(i);return this.communication.request$("resource",{onError:e,method:"POST",params:{id:t,type:this.pageConfig.type,sections:r.map((function(t){return t.id}))}})},e.prototype.handleResponse=function(t){this.initSections(t),this.updateHeadTitle(t)},e.prototype.initSections=function(t){var e=this,n=this.pageConfig.sections,a=n.top,i=n.content,r=a.concat(i);if(r.forEach((function(n){var a=n.id,i=n.type,r=n.tools,o=e.getWidgetDataSource(a);if(o){var s=t.sections[a];if(o.id=a,"viewer"===i&&e.one(a).updateOptions({tools:r}),s&&!F.isEmpty(s)?e.one(a).update(s):e.one(a).update(void 0),"viewer"===i&&r){var c=a+"-tools",l=e.getWidgetDataSource(c);if(!l)return;l.id=c,s&&!F.isEmpty(s)?e.one(c).update(s):e.one(c).update(void 0)}}})),this.tabConfig){var o=r.find((function(t){return"tabs"===t.type}));this.one(o.id).updateOptions({id:this.id,root:this.pageConfig.tabs,slug:this.slug,currentTab:this.tab}),this.one(o.id).update(this.tabConfig)}},e.prototype.updateHeadTitle=function(t){var e=t.title,n=this.configuration.get("name"),a=this.pageConfig.title;this.mainState.update("headTitle",[n,l._t(a),e].join(" > "))},e}(l.LayoutDataSource),bi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroy$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-resource-layout.init":t.route=a.route,t.router=a.router,t.modalService=a.modalService;var i=t.route.snapshot.params,r=i.slug,o=i.id,s=t.route.snapshot.url;t.dataSource.tab=s[s.length-1].path,t.dataSource.slug=r,t.dataSource.id=o,t.layoutState=a.layoutState,t.dataSource.onInit(a),t.listenRoute(),window.scrollTo(0,0),t.emitOuter("init");break;case"mr-resource-layout.destroy":t.destroy$.next();break;default:console.warn("unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;if(-1!==n.indexOf("openresourcemodal")){var i=a.id,r=a.type;t.modalService.open(i,r)}if(-1!==n.indexOf("thumbclick")){var o=_(n.split("."),1)[0].replace("-tools","");t.emitOuter("thumbclick",{targetId:o,thumbindex:a})}if(-1!==n.indexOf("pagechange")){o=_(n.split("."),1)[0]+"-tools";t.emitOuter("pagechange",{targetId:o,eventData:a})}}))},e.prototype.listenRoute=function(){var t=this;this.route.paramMap.pipe(o.takeUntil(this.destroy$),o.tap((function(){t.layoutState.set("content",I.LOADING)})),o.map((function(t){return t.get("id")})),o.switchMap((function(e){return t.dataSource.pageRequest$(e,(function(n){if(404===n.status){var a=t.router.config.find((function(t){var e=t.data;return"page-404"===(null==e?void 0:e.id)})),i=(null==a?void 0:a.path)||"page-404";t.router.navigate([i])}console.warn("Error loading resource layout for "+e,n.message),t.dataSource.id=e,t.layoutState.set("content",I.ERROR)}))}))).subscribe((function(e){t.layoutState.set("content",I.SUCCESS),t.dataSource.handleResponse(e),window.scrollTo(0,0)}))},e}(l.EventHandler),wi={layoutId:"mr-resource-layout",widgets:[{id:"mr-read-more"}],layoutDS:vi,layoutEH:bi,widgetsDataSources:ya,widgetsEventHandlers:Pa,options:{}},Si=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".click":t.emitOuter("click",a);break;case t.dataSource.id+".pagechange":t.emitOuter("pagechange",a)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-resource-layout.init":t.listenToViewer();break;case"mr-resource-layout.thumbclick":a.targetId===t.dataSource.id&&t.dataSource.changePage(a.thumbindex)}}))},e.prototype.listenToViewer=function(){var t=this;this.dataSource.viewerLoaded$.pipe(o.first()).subscribe((function(){t.dataSource.viewer.addHandler("page",(function(e){t.emitOuter("pagechange",e)}))}))},e}(l.EventHandler),_i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".click":if(void 0!==a.thumbindex){var i=a.thumbindex;t.dataSource.handleThumbs(i),t.emitOuter("thumbclick",i);break}if("close-description"===a){t.dataSource.toggleDescription();break}if("toggle-description"===a){t.dataSource.toggleDescription();break}if("toggle-thumbs"===a){t.dataSource.toggleThumbs();break}}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-resource-layout.init":case"mr-resource-layout.thumbclick":break;case"mr-resource-layout.pagechange":a.targetId===t.dataSource.id&&t.dataSource.handlePageChange(a.eventData)}}))},e}(l.EventHandler),ki={breadcrumbs:Mn,collection:qn,info:Gn,metadata:ta,preview:Qn,text:aa,title:Wn,viewer:zn,"viewer-tools":Un,tabs:na,"text-viewer":aa},Ii={viewer:Si,"viewer-tools":_i,collection:Ia},Ei=function(t){function n(e,n,a,i,r,o,s,c,l){var u=t.call(this,e.get("MrResourceLayoutConfig")||wi)||this;return u.activatedRoute=n,u.configuration=a,u.communication=i,u.mainState=r,u.route=o,u.router=s,u.layoutState=c,u.modalService=l,u}return v(n,t),n.prototype.initPayload=function(){return{configId:this.configId,configuration:this.configuration,communication:this.communication,mainState:this.mainState,layoutState:this.layoutState,modalService:this.modalService,options:this.config.options||{},route:this.route,router:this.router}},n.prototype.ngOnInit=function(){var t=this;this.activatedRoute.data.subscribe((function(e){t.layoutState.add("content"),t.configId=e.configId,t.loadWidgets(),t.onInit()}))},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.prototype.loadWidgets=function(){var t=this,e=this.configuration.get(this.configId).sections,n=e.top,a=e.content,i=n.concat(a);this.widgets=[],i&&i.forEach((function(e){var n=e.id,a=e.type,i=e.options,r=e.tools;t.widgets.push({id:n,options:i,dataSource:ki[a],eventHandler:Ii[a]}),"viewer"===a&&r&&t.widgets.push({options:i,id:n+"-tools",dataSource:ki[a+"-tools"],eventHandler:Ii[a+"-tools"]})}))},n.ctorParameters=function(){return[{type:x},{type:s.ActivatedRoute},{type:E},{type:T},{type:C},{type:s.ActivatedRoute},{type:s.Router},{type:Pn},{type:Rn}]},n=w([e.Component({selector:"mr-resource-layout",template:'<div class="mr-resource mr-layout" \r\n     *ngIf="lb.dataSource && lb.dataSource.pageConfig"\r\n     [ngClass]="{\r\n        \'is-loading\': ( layoutState.get$(\'content\') | async ) == \'LOADING\',\r\n        \'is-error\': ( layoutState.get$(\'content\') | async ) == \'ERROR\'\r\n      }">\r\n    \x3c!-- RESOURCE LAYOUT CONTENT --\x3e\r\n    <ng-container [ngSwitch]="layoutState.get$(\'content\') | async">\r\n        \x3c!-- loading --\x3e\r\n        <ng-container *ngSwitchCase="\'LOADING\'">\r\n            <div class="mr-layout__loader">\r\n                <n7-loader></n7-loader>\r\n            </div>\r\n        </ng-container>\r\n\r\n        \x3c!-- error --\x3e\r\n        <ng-container *ngSwitchCase="\'ERROR\'">\r\n            <div class="mr-layout__error">\r\n                <h2>{{ lb.dataSource.errorTitle }}</h2>\r\n                <p>{{ lb.dataSource.errorDescription }}</p>\r\n            </div>\r\n        </ng-container>\r\n\r\n        \x3c!-- success --\x3e\r\n        <ng-container *ngSwitchCase="\'SUCCESS\'">\r\n            <ng-container *ngIf="lb.dataSource.pageConfig.sections as sections">\r\n                \x3c!-- Pass the list of blocks to render to the block template --\x3e\r\n                <div class="mr-resource__top">\r\n                    <ng-container *ngTemplateOutlet="blocks; context: { $implicit: sections.top }"></ng-container>\r\n                </div>\r\n                <div class="mr-resource__content mr-side-margin">\r\n                    <ng-container *ngTemplateOutlet="blocks; context: { $implicit: sections.content }"></ng-container>\r\n                </div>\r\n            </ng-container>\r\n        </ng-container>\r\n\r\n    </ng-container>\r\n</div>\r\n\r\n<ng-template #blocks let-list>\r\n    <ng-container *ngFor="let section of list">\r\n        <section *ngIf="lb.widgets[section.id].ds.out$ | async"\r\n        class="{{ \'mr-resource__section mr-resource__\' + section.type }}">\r\n            <ng-container [ngSwitch]="section.type">\r\n    \r\n                \x3c!-- TABS --\x3e\r\n                <ng-container *ngSwitchCase="\'tabs\'">\r\n                    <ng-container *ngFor="let tab of lb.widgets[section.id].ds.out$ | async">\r\n                        <n7-anchor-wrapper [data]="tab.anchor" [classes]="tab.classes">\r\n                            <span class="mr-resource__tabs-item">{{ tab.label }}</span>\r\n                        </n7-anchor-wrapper>\r\n                    </ng-container>\r\n                </ng-container>\r\n    \r\n                \x3c!-- INNER TITLE --\x3e\r\n                <ng-container *ngSwitchCase="\'title\'">\r\n                    <div class="mr-resource__title-content mr-side-margin">\r\n                        <n7-inner-title [data]="lb.widgets[section.id].ds.out$ | async"\r\n                            [emit]="lb.widgets[section.id].emit">\r\n                        </n7-inner-title>\r\n                    </div>\r\n                </ng-container>\r\n    \r\n                \x3c!-- IMAGE VIEWER TOOLS --\x3e\r\n                <ng-container *ngSwitchCase="\'viewer\'">\r\n                    <n7-image-viewer \r\n                        [data]="lb.widgets[section.id].ds.out$ | async" \r\n                        [emit]="lb.widgets[section.id].emit">\r\n                    </n7-image-viewer>\r\n                    <n7-image-viewer-tools *ngIf="section.tools" \r\n                        [data]="lb.widgets[section.id + \'-tools\'].ds.out$ | async" \r\n                        [emit]="lb.widgets[section.id + \'-tools\'].emit">\r\n                    </n7-image-viewer-tools>\r\n                </ng-container>\r\n                \x3c!-- IMAGE VIEWER TOOLS --\x3e\r\n    \r\n                \x3c!-- METADATA VIEWER --\x3e\r\n                <ng-container *ngSwitchCase="\'metadata\'">\r\n                    \r\n                    <div class="mr-content-block mr-content-block-metadata">\r\n                        <h3 *ngIf="section.title" class="mr-content-block__title">\r\n                            {{ section.title }}\r\n                        </h3>\r\n                        <div class="mr-content-block__content">\r\n                            <mr-read-more [data]="section.readmore">\r\n                                <n7-metadata-viewer [data]="lb.widgets[section.id].ds.out$ | async"\r\n                                    [emit]="lb.widgets[section.id].emit">\r\n                                </n7-metadata-viewer>\r\n                            </mr-read-more>\r\n                        </div>\r\n                    </div>\r\n\r\n                </ng-container>\r\n    \r\n                \x3c!-- COLLECTION --\x3e\r\n                <ng-container *ngSwitchCase="\'collection\'">\r\n                    <ng-container *ngIf="lb.widgets[section.id].ds.out$ | async as collection$">\r\n                        <div *ngIf="collection$.items?.length > 0" class="mr-content-block mr-content-block-collection">\r\n                            <h3 *ngIf="section.title" class="mr-content-block__title">\r\n                                {{ section.title }}\r\n                            </h3>\r\n                            <div class="mr-content-block__content {{ section.grid ? \'n7-grid-\' + section.grid : \'\' }}">\r\n                                <n7-item-preview *ngFor="let item of collection$?.items"\r\n                                    [data]="item" [emit]="lb.widgets[section.id].emit">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </ng-container>\r\n    \r\n                \x3c!-- ITEM PREVIEW --\x3e\r\n                <ng-container *ngSwitchCase="\'preview\'">\r\n                    <div class="mr-content-block mr-content-block-item-preview">\r\n                        <h3 *ngIf="section.title" class="mr-content-block__title">\r\n                            {{ section.title }}\r\n                        </h3>\r\n                        <div class="mr-content-block__content">\r\n                            <n7-item-preview [data]="lb.widgets[section.id].ds.out$ | async" [emit]="lb.widgets[section.id].emit">        \r\n                            </n7-item-preview>\r\n                        </div>\r\n                    </div>\r\n                </ng-container>\r\n    \r\n                \x3c!-- TEXT VIEWER --\x3e\r\n                <ng-container *ngSwitchCase="\'text-viewer\'">\r\n                  <div class="mr-content-block mr-content-block-text-viewer">\r\n                        <h3 *ngIf="section.title" class="mr-content-block__title">\r\n                            {{ section.title }}\r\n                        </h3>\r\n                        <div class="mr-content-block__content">\r\n                          <n7-text-viewer [data]="lb.widgets[section.id].ds.out$ | async" [emit]="lb.widgets[section.id].emit">\r\n                          </n7-text-viewer>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                </ng-container>\r\n    \r\n                \x3c!-- INFO BOX --\x3e\r\n                <ng-container *ngSwitchCase="\'info-box\'">\r\n                    <div class="mr-content-block mr-content-block-info-box">\r\n                        <h3 *ngIf="section.title" class="mr-content-block__title">\r\n                            {{ section.title }}\r\n                        </h3>\r\n                        <div class="mr-content-block__content">\r\n                            <div class="info-box__mock">info-box</div>    \r\n                        </div>\r\n                    </div>\r\n                </ng-container>\r\n    \r\n                \x3c!-- BREADCRUMBS --\x3e\r\n                <ng-container *ngSwitchCase="\'breadcrumbs\'">\r\n                    <n7-breadcrumbs [data]="lb.widgets[section.id].ds.out$ | async">\r\n                    </n7-breadcrumbs>\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n        </section>\r\n    </ng-container>\r\n</ng-template>\r\n'}),S("design:paramtypes",[x,s.ActivatedRoute,E,T,C,s.ActivatedRoute,s.Router,Pn,Rn])],n)}(P),xi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.inputsDS={},e}return v(e,t),e.prototype.onInit=function(t){this.searchService=t.searchService,this.searchConfig=this.searchService.getConfig(),this.facets=this.searchConfig.facets,this.initInputs()},e.prototype.initInputs=function(){var t=this;this.facets.sections.forEach((function(e){k([e.header],e.inputs).filter((function(t){return t})).forEach((function(e){var n=t.getWidgetDataSource(e.id);n.id=e.id,t.inputsDS[e.id]=n,n.update(e.data)}))}))},e.prototype.updateInputValue=function(t,e){var n=this.inputsDS[t];n.setValue(e,n.value!==e)},e.prototype.updateInputData=function(t,e){var n=this.inputsDS[t];n.update(b(b({},n.input),e)),n.setValue(n.value,!0)},e.prototype.clearInput=function(t){var e=this.inputsDS[t];e.clear(),e.setValue(e.value,!0)},e.prototype.clearInputs=function(){var t=this;Object.keys(this.inputsDS).forEach((function(e){t.clearInput(e)}))},e}(l.LayoutDataSource),Ci=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.changed$={},e.destroyed$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-search-facets-layout.init":t.searchService=a.searchService,t.initChangedListener(t.searchService.getConfig()),t.initStateListener(),t.dataSource.onInit(a);break;case"mr-search-facets-layout.destroy":t.destroyed$.next()}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;n.indexOf("change")&&t.changed$[a.id].next(a)}))},e.prototype.initChangedListener=function(t){var e=this;t.facets.sections.forEach((function(t){var n=[];if(t.header){var a=t.header,i=a.id,s=a.delay;n.push({id:i,delay:s})}t.inputs.forEach((function(t){var e=t.id,a=t.delay;n.push({id:e,delay:a})})),n.forEach((function(t){e.changed$[t.id]=new r.Subject,e.changed$[t.id].pipe(o.debounceTime(t.delay||1)).subscribe((function(t){var n=t.id,a=t.value;e.searchService.setState("input",n,a)}))}))}))},e.prototype.initStateListener=function(){var t=this;this.searchService.getState$("input").pipe(o.takeUntil(this.destroyed$),o.filter((function(e){var n=e.lastUpdated;return t.dataSource.inputsDS[n]}))).subscribe((function(e){var n=e.lastUpdated,a=e.state[n];null===a?t.dataSource.clearInput(n):t.dataSource.updateInputValue(n,a)})),this.searchService.getState$("facet").pipe(o.takeUntil(this.destroyed$),o.filter((function(e){var n=e.lastUpdated;return t.dataSource.inputsDS[n]}))).subscribe((function(e){var n=e.lastUpdated,a=e.state[n];t.dataSource.updateInputData(n,a)})),this.searchService.getState$("facetsRequest","success").pipe(o.takeUntil(this.destroyed$)).subscribe((function(e){var n=e.facets;Object.keys(n).forEach((function(e){var a=n[e].total_count;t.dataSource.updateInputValue("header-"+e,a)}))}))},e}(l.EventHandler),Di={layoutId:"mr-search-facets-layout",widgets:[],layoutDS:xi,layoutEH:Ci,widgetsDataSources:ya,widgetsEventHandlers:Pa,layoutOptions:{}},Oi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.getValue=function(){return e.value},e}return v(e,t),e.prototype.transform=function(t){return b(b({},t),{placeholder:l._t(t.placeholder)})},e.prototype.setValue=function(t,e){if(void 0===e&&(e=!1),this.value=t,e){this.update(b(b({},this.input),{value:t}));var n=document.getElementById(this.output.id);n&&(n.value=t)}},e.prototype.clear=function(){this.value=null},e}(l.DataSource),Ti=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=[],e.getValue=function(){return e.value},e}return v(e,t),e.prototype.transform=function(t){return t},e.prototype.setValue=function(t,e){var n=this;if(void 0===e&&(e=!1),this.value=Array.isArray(t)?t:[t],e){var a=this.input.checkboxes.map((function(t){return b(b({},t),{checked:-1!==n.value.indexOf(t.payload)})}));this.update(b(b({},this.input),{checkboxes:a}))}},e.prototype.toggleValue=function(t){var e=t.inputPayload,n=t.value,a=-1!==this.value.indexOf(e);n&&!a?this.value.push(e):!n&&a&&this.value.splice(this.value.indexOf(e),1)},e.prototype.clear=function(){this.value=[]},e}(l.DataSource),Pi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.getValue=function(){return e.value},e}return v(e,t),e.prototype.transform=function(t){return t},e.prototype.setValue=function(t,e){if(void 0===e&&(e=!1),this.value=t,e){var n=this.input.options.map((function(e){return b(b({},e),{selected:t===e.value})}));this.update(b(b({},this.input),{options:n}))}},e.prototype.clear=function(){this.value=null},e}(l.DataSource),Ri=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=null,e.isUpdate=!1,e.getValue=function(){return e.value},e}return v(e,t),e.prototype.transform=function(t){var e=t.links;return this.isUpdate&&!e.length?{links:[{text:l._t("global#facet_empty_text"),classes:"empty-text-link",payload:null}]}:t},e.prototype.setValue=function(t,e){var n=this;if(void 0===e&&(e=!1),this.value=t,this.isUpdate=e,e){var a=this.input.links.map((function(t){return b(b({},t),{classes:n.value===t.payload?"is-active":""})}));this.update(b(b({},this.input),{links:a}))}},e.prototype.toggleValue=function(t){this.setValue(this.value!==t?t:null,!0)},e.prototype.clear=function(){this.value=null},e}(l.DataSource),$i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.getValue=function(){return e.value},e}return v(e,t),e.prototype.transform=function(t){return b(b({},t),{text:l._t(t.text),iconRight:t.iconRight||"n7-icon-angle-up"})},e.prototype.setValue=function(t,e){void 0===e&&(e=!1),this.value=t,e&&this.update(b(b({},this.input),{additionalText:t}))},e.prototype.toggle=function(){var t=this.output.iconRight;t="n7-icon-angle-up"===t?"n7-icon-angle-down":"n7-icon-angle-up",this.update(b(b({},this.input),{iconRight:t}))},e.prototype.isOpen=function(){return"n7-icon-angle-up"===this.output.iconRight},e.prototype.clear=function(){this.value=null},e}(l.DataSource),Li=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){switch(e.type){case t.dataSource.id+".click":t.dataSource.toggle(),t.emitOuter("change",{isOpen:t.dataSource.isOpen(),id:t.dataSource.id,value:t.dataSource.value})}}))},e}(l.EventHandler),Ai=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".change":"string"==typeof a.value&&(a.value=a.value.trim()),t.dataSource.setValue(a.value),t.emitOuter("change",b(b({},a),{id:t.dataSource.id}))}}))},e}(l.EventHandler),Mi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".change":t.dataSource.toggleValue(a),t.emitOuter("change",{value:t.dataSource.getValue(),id:t.dataSource.id})}}))},e}(l.EventHandler),Hi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".change":t.dataSource.setValue(a.value),t.emitOuter("change",b(b({},a),{id:t.dataSource.id}))}}))},e}(l.EventHandler),ji=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".change":a&&(t.dataSource.toggleValue(a),t.emitOuter("change",{value:t.dataSource.getValue(),id:t.dataSource.id}))}}))},e}(l.EventHandler),Fi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=[],e.isUpdate=!1,e.getValue=function(){return e.value},e}return v(e,t),e.prototype.transform=function(t){var e=t.links;return this.isUpdate&&!e.length?{links:[{text:l._t("global#facet_empty_text"),classes:"empty-text-link",payload:null}]}:t},e.prototype.setValue=function(t,e){var n=this;if(void 0===e&&(e=!1),this.value=t,this.isUpdate=e,e){var a=this.input.links.map((function(t){return b(b({},t),{classes:n.value.includes(t.payload)?"is-active":""})}));this.update(b(b({},this.input),{links:a}))}},e.prototype.toggleValue=function(t){var e=this.value.includes(t);e?e&&this.value.splice(this.value.indexOf(t),1):this.value.push(t),this.setValue(this.value,!0)},e.prototype.clear=function(){this.value=[]},e}(l.DataSource),qi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case t.dataSource.id+".change":a&&(t.dataSource.toggleValue(a),t.emitOuter("change",{value:t.dataSource.getValue(),id:t.dataSource.id}))}}))},e}(l.EventHandler),Bi={header:$i,text:Oi,checkbox:Ti,select:Pi,link:Ri,"link-multiple":Fi},Ni={header:Li,text:Ai,checkbox:Mi,select:Hi,link:ji,"link-multiple":qi},Vi=function(t){function n(){return t.call(this,Di)||this}return v(n,t),n.prototype.initPayload=function(){return{searchService:this.searchService}},n.prototype.ngOnInit=function(){this.loadWidgets(),this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.prototype.loadWidgets=function(){var t=this,e=this.searchService.getConfig().facets;this.widgets=[],e.sections.forEach((function(e){var n=e.header,a=e.inputs;n&&t.widgets.push({id:n.id,dataSource:Bi.header,eventHandler:Ni.header}),a.forEach((function(e){var n=e.type;e.schema.multiple&&(n+="-multiple"),t.widgets.push({id:e.id,dataSource:Bi[n],eventHandler:Ni[n]})}))}))},w([e.Input(),S("design:type",Tn)],n.prototype,"searchService",void 0),n=w([e.Component({selector:"mr-search-facets-layout",template:'<div *ngIf="lb.dataSource.facets" class="mr-facets__facets-wrapper {{ lb.dataSource.facets.classes || \'\' }}">\r\n    <div *ngFor="let section of lb.dataSource.facets.sections" \r\n    class="mr-facets__single-facet {{ section.classes || \'\' }}"\r\n    [ngClass]="lb.dataSource.searchService.getState$(\'section\', section.id) | async">\r\n        <n7-facet-header\r\n        *ngIf="section.header"\r\n        [data]="lb.widgets[section.header.id].ds.out$ | async"\r\n        [emit]="lb.widgets[section.header.id].emit"\r\n        ></n7-facet-header>\r\n\r\n        <div [hidden]="section.header && !lb.widgets[section.header.id].ds.isOpen()" class="mr-facets__single-facet-content">\r\n            <div *ngFor="let input of section.inputs" \r\n            [attr.id]="\'facet-container-\' + input.id"\r\n            class="mr-facets__single-facet-inner-content {{ input.classes || \'\' }}">\r\n                <ng-container [ngSwitch]="input.type">\r\n    \r\n                    \x3c!-- INPUT TEXT --\x3e\r\n                    <n7-input-text \r\n                    *ngSwitchCase="\'text\'"\r\n                    [data]="lb.widgets[input.id].ds.out$ | async"\r\n                    [emit]="lb.widgets[input.id].emit"></n7-input-text>\r\n    \r\n                    \x3c!-- INPUT CHECKBOX --\x3e\r\n                    <n7-input-checkbox \r\n                    *ngSwitchCase="\'checkbox\'"\r\n                    [data]="lb.widgets[input.id].ds.out$ | async"\r\n                    [emit]="lb.widgets[input.id].emit"></n7-input-checkbox>\r\n                    \r\n                    \x3c!-- INPUT SELECT --\x3e\r\n                    <n7-input-select \r\n                    *ngSwitchCase="\'select\'"\r\n                    [data]="lb.widgets[input.id].ds.out$ | async"\r\n                    [emit]="lb.widgets[input.id].emit"></n7-input-select>\r\n                    \r\n                    \x3c!-- INPUT LINK --\x3e\r\n                    <n7-input-link \r\n                    *ngSwitchCase="\'link\'"\r\n                    [data]="lb.widgets[input.id].ds.out$ | async"\r\n                    [emit]="lb.widgets[input.id].emit"></n7-input-link>\r\n\r\n                    \x3c!-- INPUT LINKMULTI --\x3e\r\n                    <n7-input-link \r\n                    *ngSwitchCase="\'linkMulti\'"\r\n                    [data]="lb.widgets[input.id].ds.out$ | async"\r\n                    [emit]="lb.widgets[input.id].emit"></n7-input-link>\r\n                \r\n                </ng-container>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),S("design:paramtypes",[])],n)}(P),zi={set:function(t,e){localStorage.setItem(t,e)},get:function(t){return localStorage.getItem(t)},remove:function(t){localStorage.removeItem(t)},toggle:function(t,e){this.get(t)?this.remove(t):this.set(t,e)}},Ui=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.totalResultsText=null,e.descriptionLoaded=!1,e.showDescription=!1,e}return v(e,t),e.prototype.onInit=function(t){this.configuration=t.configuration,this.communication=t.communication,this.mainState=t.mainState,this.searchService=t.searchService,this.configId=t.configId,this.pageConfig=this.configuration.get(this.configId),this.hideDescriptionKey="hide-description-"+this.configId,this.all().updateOptions({config:this.pageConfig}),this.one("mr-search-page-title").update({}),this.updateHeadTitle(),this.addTranslations(this.pageConfig),this.getPageDescription()},e.prototype.handleResponse=function(t){this.some(["mr-search-results-title","mr-search-results"]).update(t),this.one("n7-smart-pagination").updateOptions({mode:"payload"}),this.one("n7-smart-pagination").update(this.getPaginationParams(t))},e.prototype.updateActiveFilters=function(t,e){this.one("mr-search-tags").update({state:t,linksResponse:e,facetsConfig:this.searchService.getConfig().facets})},e.prototype.toggleDescription=function(){zi.toggle(this.hideDescriptionKey,!0),this.showDescription=!zi.get(this.hideDescriptionKey),this.showDescription&&!this.descriptionLoaded&&this.getPageDescription()},e.prototype.getPaginationParams=function(t){var e=t.total_count,n=t.offset,a=t.limit,i=this.pageConfig.pagination;return{totalPages:Math.ceil(e/a),currentPage:(n+a)/a,pageLimit:i.limit,sizes:{label:i.selectLabel?l._t(i.selectLabel):null,list:i.options,active:a}}},e.prototype.updateHeadTitle=function(){var t=this.configuration.get("name"),e=this.pageConfig.title;this.mainState.update("headTitle",[t,l._t(e)].join(" > "))},e.prototype.addTranslations=function(t){var e;t.facetsTitle&&(t.facetsTitle=l._t(t.facetsTitle)),t.filtersTitle&&(t.filtersTitle=l._t(t.filtersTitle)),(null===(e=null==t?void 0:t.sort)||void 0===e?void 0:e.label)&&(t.sort.label=l._t(t.sort.label),t.sort.options=t.sort.options.map((function(t){return b(b({},t),{label:l._t(t.label)})}))),["text","button"].forEach((function(e){t.fallback&&(t.fallback[e]=l._t(t.fallback[e])),t.ko&&(t.ko[e]=l._t(t.ko[e]))}))},e.prototype.getPageDescription=function(){var t=this;if(this.pageConfig.description&&!zi.get(this.hideDescriptionKey)){var e=this.pageConfig.description;this.communication.request$("searchDescription",{urlParams:e.id}).subscribe((function(e){t.one("mr-search-page-description").update(e),t.descriptionLoaded=!0,t.showDescription=!0}))}},e}(l.LayoutDataSource),Gi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new r.Subject,e.searchState={},e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-search-layout.init":t.searchService=a.searchService,t.layoutState=a.layoutState,t.modalService=a.modalService,t.dataSource.onInit(a),t.initStateListener(),window.scrollTo(0,0),t.scrollRefElement=null;break;case"mr-search-layout.destroy":t.searchService.destroy(),t.destroyed$.next(!0);break;case"mr-search-layout.searchreset":t.searchService.reset();break;default:console.warn("unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"n7-smart-pagination.click":t.searchService.setState("input","page",a.page);break;case"n7-smart-pagination.change":t.searchService.setState("input","limit",a.value);break;case"mr-search-results-title.change":t.searchService.setState("input","sort",a.value);break;case"mr-search-page-description.click":case"mr-search-page-title.click":t.dataSource.toggleDescription();break;case"mr-search-tags.click":var i=t.searchState[a.id],r=null;Array.isArray(i)&&(r=i.filter((function(t){return t!==a.value}))),t.searchService.setState("input",a.id,r);break;case"mr-search-results.openresourcemodal":var o=a.id,s=a.type;t.modalService.open(o,s)}}))},e.prototype.initStateListener=function(){var t,e=this,n=this.dataSource.pageConfig,a=n.pagination.options[0],i=null===(t=n.sort.options.find((function(t){return!0===t.selected})))||void 0===t?void 0:t.value;i||(i=n.sort.options[0].value),this.searchService.getState$("input").pipe(o.filter((function(t){var n=t.lastUpdated;return e.searchService.isQueryParamKey(n)})),o.takeUntil(this.destroyed$)).subscribe((function(t){var n=t.lastUpdated,a=t.state;e.searchState=a,"page"!==n&&e.searchService.setState("input","page",1)})),this.searchService.getState$("input","query").pipe(o.takeUntil(this.destroyed$)).subscribe((function(t){e.emitOuter("inputquerychange",t),e.searchService.setState("input","sort",t?"_score":"sort_ASC")})),this.searchService.getState$("facetsRequest","success").pipe(o.takeUntil(this.destroyed$)).subscribe((function(t){if(e.linksResponse=t,e.dataSource.updateActiveFilters(e.searchState,e.linksResponse),t){var n=t.facets;Object.keys(n).forEach((function(t){var a=n[t].total_count;e.searchService.setState("section","section-"+t,a?"is-not-empty":"is-empty")}))}})),this.searchService.getState$("resultsRequest","loading").pipe(o.takeUntil(this.destroyed$)).subscribe((function(){e.layoutState.set("results",I.LOADING)})),this.searchService.setBeforeHook("resultsRequest","loading",(function(t){void 0===t&&(t={});var e={sort:i,limit:a,offset:0};return t.sort&&(e.sort=t.sort),t.limit&&(e.limit=t.limit),t.page&&t.page>1&&(e.offset=e.limit*(t.page-1)),t.results=e,Object.keys(t).filter((function(t){return["sort","page","limit"].includes(t)})).forEach((function(e){delete t[e]})),t})),this.searchService.setBeforeHook("facetsRequest","loading",(function(t){return void 0===t&&(t={}),delete t.results,t})),this.searchService.getState$("resultsRequest","success").subscribe((function(t){e.dataSource.handleResponse(t),e.layoutState.set("results",d.isEmpty(t.results)?I.EMPTY:I.SUCCESS),e.scrollRefElement?F.isElementInViewport(e.scrollRefElement)||e.scrollRefElement.scrollIntoView():e.scrollRefElement=document.querySelector(".scroll-ref")})),this.searchService.getState$("resultsRequest","error").subscribe((function(t){console.warn("resultsRequest",t),e.layoutState.set("results",I.ERROR)}))},e}(l.EventHandler),Wi={layoutId:"mr-search-layout",widgets:[{id:"mr-search-page-title"},{id:"mr-search-page-description"},{id:"mr-search-results-title"},{id:"mr-search-results"},{id:"mr-search-tags"},{id:"mr-resources",dataSource:Yn},{id:"n7-smart-pagination",dataSource:Y,eventHandler:nt}],layoutDS:Ui,layoutEH:Gi,widgetsDataSources:ya,widgetsEventHandlers:Pa,layoutOptions:{}},Ki=function(t){function n(e,n,a,i,r,o,s,c,l){var u=t.call(this,e.get("MrSearchLayoutConfig")||Wi)||this;return u.router=n,u.activatedRoute=a,u.communication=i,u.configuration=r,u.searchService=o,u.layoutState=s,u.mainState=c,u.modalService=l,u}return v(n,t),n.prototype.initPayload=function(){return{configId:this.configId,configuration:this.configuration,mainState:this.mainState,router:this.router,activatedRoute:this.activatedRoute,communication:this.communication,searchService:this.searchService,layoutState:this.layoutState,modalService:this.modalService,options:this.config.options||{}}},n.prototype.ngOnInit=function(){var t=this;this.activatedRoute.data.subscribe((function(e){t.configId=e.configId;var n=t.configuration.get(t.configId),a=n.searchId,i=n.searchConfig;t.searchService.init(a,i),t.layoutState.add(["results"]),t.onInit()}))},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:x},{type:s.Router},{type:s.ActivatedRoute},{type:T},{type:E},{type:Tn},{type:Pn},{type:C},{type:Rn}]},n=w([e.Component({selector:"mr-search-layout",template:'<div class="mr-search mr-layout"\r\n     *ngIf="lb.dataSource">\r\n    <section class="mr-layout__maxwidth mr-side-margin">\r\n\r\n        <div class="mr-search__title">\r\n            <n7-inner-title\r\n            [data]="lb.widgets[\'mr-search-page-title\'].ds.out$ | async"\r\n            [emit]="lb.widgets[\'mr-search-page-title\'].emit">\r\n            </n7-inner-title>\r\n        </div>\r\n\r\n        <div *ngIf="lb.dataSource.showDescription" class="mr-search__description">\r\n            <mr-search-page-description\r\n            [data]="lb.widgets[\'mr-search-page-description\'].ds.out$ | async"\r\n            [emit]="lb.widgets[\'mr-search-page-description\'].emit">\r\n            </mr-search-page-description>\r\n        </div>\r\n        \r\n        <div class="mr-search__results-content">\r\n            <aside class="mr-facets">\r\n                <div class="scroll-ref">&nbsp;</div>\r\n                <div class="mr-facets__contents">\r\n                    <h2 class="mr-facets__title" \r\n                        *ngIf="lb.dataSource.pageConfig[\'facetsTitle\']">\r\n                        {{ lb.dataSource.pageConfig[\'facetsTitle\'] }}\r\n                    </h2>\r\n                    <mr-search-facets-layout \r\n                    [searchService]="lb.dataSource.searchService">\r\n                    </mr-search-facets-layout>\r\n                </div>\r\n            </aside>\r\n            <div class="mr-search__results-wrapper">\r\n                <div class="mr-search__results-info">\r\n                    <n7-inner-title\r\n                    [data]="lb.widgets[\'mr-search-results-title\'].ds.out$ | async"\r\n                    [emit]="lb.widgets[\'mr-search-results-title\'].emit">\r\n                    </n7-inner-title>\r\n                </div>\r\n                \r\n                <div *ngIf="(\r\n                    lb.dataSource.pageConfig[\'filtersTitle\'] && \r\n                    lb.widgets[\'mr-search-tags\'].ds.hasFilters\r\n                )" \r\n                class="mr-active-filters">\r\n                    <span class="mr-active-filters__label">{{ lb.dataSource.pageConfig[\'filtersTitle\'] }}</span>\r\n                    <div class="mr-active-filters__tags-wrapper">\r\n                        <n7-tag *ngFor="let tag of (lb.widgets[\'mr-search-tags\'].ds.out$ | async)"\r\n                        [data]="tag"\r\n                        [emit]="lb.widgets[\'mr-search-tags\'].emit">\r\n                        </n7-tag>\r\n                    </div>\r\n                </div>\r\n\r\n                <main class="mr-search__results">\r\n                    \x3c!-- SEARCH RESULTS --\x3e\r\n                    <ng-container [ngSwitch]="layoutState.get$(\'results\') | async">\r\n                        \r\n                        \x3c!-- loading --\x3e\r\n                        <ng-container *ngSwitchCase="\'LOADING\'">\r\n                            <div class="mr-search__results-loading n7-grid-{{ lb.dataSource.pageConfig.grid || 3 }}">\r\n                                <n7-content-placeholder *ngFor="let n of [0,1,2,3,4,5,6,7,8,9]" [data]="{\r\n                                    blocks: [\r\n                                        { classes: \'search-result-placeholder-title\' },\r\n                                        { classes: \'search-result-placeholder-metadata\' },\r\n                                        { classes: \'search-result-placeholder-metadata\' },\r\n                                        { classes: \'search-result-placeholder-metadata\' }\r\n                                    ]\r\n                                }"></n7-content-placeholder>\r\n                            </div>\r\n                        </ng-container>\r\n                        \r\n                        \x3c!-- success: items > 0 --\x3e\r\n                        <ng-container *ngSwitchCase="\'SUCCESS\'">\r\n                            <div class="n7-grid-{{ lb.dataSource.pageConfig.grid || 3 }}">\r\n                                <n7-item-preview *ngFor="let item of (lb.widgets[\'mr-search-results\'].ds.out$ | async)"\r\n                                [data]="item" [emit]="lb.widgets[\'mr-search-results\'].emit">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </ng-container>\r\n\r\n                        \x3c!-- empty: items === 0 --\x3e\r\n                        <ng-container *ngSwitchCase="\'EMPTY\'">\r\n                            <div class="mr-search__results-fallback">\r\n                                <p class="mr-search__results-fallback-string">\r\n                                    {{ lb.dataSource.pageConfig.fallback.text }}\r\n                                </p>\r\n                                <button class="n7-btn mr-search__results-fallback-button"\r\n                                    (click)="lb.eventHandler.emitInner(\'searchreset\')">\r\n                                    {{ lb.dataSource.pageConfig.fallback.button }}\r\n                                </button>\r\n                            </div>\r\n                        </ng-container>\r\n\r\n                        \x3c!-- error: request problem --\x3e\r\n                        <ng-container *ngSwitchCase="\'ERROR\'">\r\n                            <p class="mr-search__results-ko-string">\r\n                                {{ lb.dataSource.pageConfig.ko.text }}\r\n                            </p>\r\n                            <button class="n7-btn mr-search__results-ko-button"\r\n                                (click)="lb.eventHandler.emitInner(\'searchreset\')">\r\n                                {{ lb.dataSource.pageConfig.ko.button }}\r\n                            </button>\r\n                        </ng-container>\r\n                        \r\n                    </ng-container>\r\n                </main>               \r\n                <n7-smart-pagination\r\n                *ngIf="(layoutState.get$(\'results\') | async) === \'SUCCESS\'"\r\n                [data]="lb.widgets[\'n7-smart-pagination\'].ds.out$ | async"\r\n                [emit]="lb.widgets[\'n7-smart-pagination\'].emit">\r\n                </n7-smart-pagination>\r\n            </div>\r\n        </div>\r\n\r\n    </section>\r\n</div>'}),S("design:paramtypes",[x,s.Router,s.ActivatedRoute,T,E,Tn,Pn,C,Rn])],n)}(P),Qi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.errorTitle=l._t("global#layout_error_title"),e.errorDescription=l._t("global#layout_error_description"),e}return v(e,t),e.prototype.onInit=function(t){this.communication=t.communication,this.configuration=t.configuration,this.mainState=t.mainState},e.prototype.pageRequest$=function(t,e){return t.length>1?this.communication.request$("post",{onError:e,urlParams:t[1].path}):this.communication.request$("static",{onError:e,urlParams:t[0].path})},e.prototype.handleResponse=function(t){this.setHtml(t),this.updateHeadTitle(t.title)},e.prototype.setHtml=function(t){var e=t.content,n=t.title;this.title=n,this.content=e,this.one("mr-static-metadata").update(t)},e.prototype.updateHeadTitle=function(t){var e=this.configuration.get("name");this.mainState.update("headTitle",[e,t].join(" > "))},e}(l.LayoutDataSource),Yi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroy$=new r.Subject,e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-static-layout.init":t.route=a.route,t.router=a.router,t.layoutState=a.layoutState,t.dataSource.onInit(a),t.listenRoute(),window.scrollTo(0,0);break;case"mr-static-layout.destroy":t.destroy$.next();break;default:console.warn("unhandled inner event of type",n)}}))},e.prototype.listenRoute=function(){var t=this;this.route.url.pipe(o.takeUntil(this.destroy$),o.tap((function(){t.layoutState.set("content",I.LOADING)})),o.switchMap((function(e){return t.dataSource.pageRequest$(e,(function(n){if(404===n.status){var a=t.router.config.find((function(t){var e=t.data;return"page-404"===(null==e?void 0:e.id)})),i=(null==a?void 0:a.path)||"page-404";t.router.navigate([i])}console.warn("Error loading static layout for "+e,n.message),t.layoutState.set("content",I.ERROR)}))}))).subscribe((function(e){t.layoutState.set("content",I.SUCCESS),t.dataSource.handleResponse(e)}))},e}(l.EventHandler),Xi={layoutId:"mr-static-layout",widgets:[{id:"mr-static-metadata"}],layoutDS:Qi,layoutEH:Yi,widgetsDataSources:ya,widgetsEventHandlers:Pa,layoutOptions:{}},Zi=function(t){function n(e,n,a,i,r,o,s){var c=t.call(this,s.get("MrStaticLayoutConfig")||Xi)||this;return c.communication=e,c.configuration=n,c.mainState=a,c.route=i,c.router=r,c.layoutState=o,c}return v(n,t),n.prototype.initPayload=function(){return{communication:this.communication,configuration:this.configuration,mainState:this.mainState,layoutState:this.layoutState,route:this.route,router:this.router,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.layoutState.add("content"),this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:T},{type:E},{type:C},{type:s.ActivatedRoute},{type:s.Router},{type:Pn},{type:x}]},n=w([e.Component({selector:"mr-static-layout",template:'<div class="mr-static mr-layout"\r\n     *ngIf="lb.dataSource"\r\n     [ngClass]="{\r\n        \'is-loading\': ( layoutState.get$(\'content\') | async ) == \'LOADING\',\r\n        \'is-error\': ( layoutState.get$(\'content\') | async ) == \'ERROR\'\r\n      }">\r\n    \x3c!-- STATIC LAYOUT CONTENT --\x3e\r\n    <ng-container [ngSwitch]="layoutState.get$(\'content\') | async">\r\n        \x3c!-- loading --\x3e\r\n        <ng-container *ngSwitchCase="\'LOADING\'">\r\n            <div class="mr-layout__loader">\r\n                <n7-loader></n7-loader>\r\n            </div>\r\n        </ng-container>\r\n\r\n        \x3c!-- error --\x3e\r\n        <ng-container *ngSwitchCase="\'ERROR\'">\r\n            <div class="mr-layout__error">\r\n                <h2>{{ lb.dataSource.errorTitle }}</h2>\r\n                <p>{{ lb.dataSource.errorDescription }}</p>\r\n            </div>\r\n        </ng-container>\r\n\r\n        \x3c!-- success --\x3e\r\n        <ng-container *ngSwitchCase="\'SUCCESS\'">\r\n            <div class="mr-static__top">\r\n                <h1 class="mr-static__title mr-generated-title-WP">{{lb.dataSource.title}}</h1>\r\n                <div class="mr-static__metadata">\r\n                    <n7-metadata-viewer \r\n                    [data]="lb.widgets[\'mr-static-metadata\'].ds.out$ | async">\r\n                    </n7-metadata-viewer>\r\n                </div>\r\n            </div>\r\n            \r\n            <div class="mr-static__content mr-wp-content" [innerHTML]="lb.dataSource.content | keepHtml"></div>\r\n        </ng-container>\r\n    \r\n    </ng-container>\r\n</div>\r\n'}),S("design:paramtypes",[T,E,C,s.ActivatedRoute,s.Router,Pn,x])],n)}(P),Ji=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loading={resourceDetails:!0,timeline:!0},e.defaultDescription="",e.eventDescription="",e.hasMap=!1,e.timelineListener$=new r.Subject,e}return v(e,t),e.prototype.onInit=function(t){var e=this;this.configuration=t.configuration,this.communication=t.communication,this.route=t.route,this.location=t.location,this.configId=t.configId,this.pageConfig=this.configuration.get(this.configId)||{},this.communication.request$("timeline",{method:"GET",onError:function(t){return console.error(t)}}).subscribe((function(t){e.timelineData=t,e.loading.timeline=!1,e.one("mr-timeline").updateOptions({libOptions:e.pageConfig.libOptions}),e.one("mr-timeline").update(t)})),this.getWidgetDataSource("mr-timeline").timelineLoaded$.pipe(o.first()).subscribe((function(t){e.timelineListener$.next(t)})),this.communication.request$("timelineDescription",{method:"GET",onError:function(t){return console.error(t)}}).subscribe((function(t){e.defaultDescription=t.text,e.loadDefaults(!1)})),this.mapHeader=l._t(this.pageConfig.mapHeader)},e.prototype.loadDefaults=function(t){var e=this.getWidgetDataSource("mr-timeline").timeline;e&&e.setSelection([]),this.eventDescription=this.defaultDescription,this.eventHeader="",this.hasMap=!1,this.bibliographyData=void 0,this.collectionWitnessData=void 0,this.collectionWorksData=void 0,this.collectionGalleryData=void 0,t&&this.location.go("/timeline/"),this.one("mr-year-header").update({title:{main:{text:l._t(this.pageConfig.title)}}})},e.prototype.updatePageDetails=function(t){var e=this;this.communication.request$("resource",{onError:function(t){return console.error(t)},method:"POST",params:{id:t,type:"views/time-events"}}).subscribe((function(t){if(t&&null!=t){var n=t.sections,a=n["collection-bibliography"],i=n["collection-places"],r=n["collection-witnesses"],o=n["collection-works"],s=n.gallery,c=n.header;i?(e.hasMap=!0,e.one("mr-map").update(i)):e.hasMap=!1,e.bibliographyData=a?{header:a.header,items:a.items.map((function(t){return b(b({},t),{anchor:{payload:t.payload},classes:"mr-item-preview-bibliography"})}))}:void 0,e.collectionWitnessData=r?{items:r.items.map((function(t){return{title:t.title,anchor:{href:t.link}}})),header:r.header}:void 0,(null==o?void 0:o.items)?e.collectionWorksData={header:o.header,items:o.items.map((function(t){return{image:t.image,title:t.title,anchor:t.link?{href:t.link}:void 0,text:t.text}}))}:e.collectionWorksData=void 0,e.collectionGalleryData=s||void 0,c&&(e.eventDescription=c.content,e.eventHeader=t.title,e.one("mr-year-header").update({title:{main:{text:c.title}},actions:{buttons:[{text:"",icon:"n7-icon-close",anchor:{payload:"closebutton"}}]}})),e.loading.resourceDetails=!1}}))},e}(l.LayoutDataSource),tr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemPreviewEmit=function(t,n){if("click"===t&&"resource-modal"===(null==n?void 0:n.action)){var a=n.id,i=n.type;e.modalService.open(a,i)}},e}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"mr-timeline-layout.init":t.dataSource.onInit(a),t.modalService=a.modalService,t.route=a.route,t.router=a.router,t.location=a.location,t.listenRoute(),window.scrollTo(0,0),t.dataSource.timelineListener$.subscribe((function(e){e.on("click",(function(e){if(e.item){var n=t.dataSource.timelineData.dataSet.find((function(t){return t.id===e.item})).content,a=F.slugify(n);t.location.go("/timeline/"+e.item+"/"+a),t.dataSource.updatePageDetails(e.item)}}))}));break;case"mr-timeline-layout.destroy":break;default:console.warn("unhandled inner event of type",n)}})),this.outerEvents$.subscribe((function(e){switch(e.type){case"mr-year-header.closeevent":t.dataSource.loadDefaults(!0)}}))},e.prototype.listenRoute=function(){var t=this;this.route.paramMap.subscribe((function(e){var n=e.get("id");n?(t.dataSource.currentId=n,t.emitOuter("routechanged",n),t.dataSource.updatePageDetails(n)):t.dataSource.loadDefaults(!0)}))},e}(l.EventHandler),er={layoutId:"mr-timeline-layout",widgets:[{id:"mr-timeline"},{id:"mr-map"},{id:"mr-year-header"}],layoutDS:Ji,layoutEH:tr,widgetsDataSources:ya,widgetsEventHandlers:Pa,options:{}},nr=function(t){function a(e,n,a,i,r,o,s,c,l){var u=t.call(this,e.get("MrTimelineLayoutConfig")||er)||this;return u.route=n,u.router=a,u.location=i,u.configuration=r,u.communication=o,u.mainState=s,u.layoutState=c,u.modalService=l,u}return v(a,t),a.prototype.initPayload=function(){return{configId:this.configId,mainState:this.mainState,configuration:this.configuration,communication:this.communication,layoutState:this.layoutState,modalService:this.modalService,route:this.route,router:this.router,location:this.location,options:this.config.options||{}}},a.prototype.ngOnInit=function(){var t=this;this.route.data.subscribe((function(e){t.configId=e.configId,t.layoutState.add("content"),t.onInit()}))},a.prototype.ngOnDestroy=function(){this.onDestroy()},a.ctorParameters=function(){return[{type:x},{type:s.ActivatedRoute},{type:s.Router},{type:n.Location},{type:E},{type:T},{type:C},{type:Pn},{type:Rn}]},a=w([e.Component({selector:"mr-timeline-layout",template:'<div class="mr-timeline mr-layout"\r\n     *ngIf="lb.dataSource">\r\n    <div class="mr-timeline__timeline">\r\n        <div class="mr-timeline__timeline-loading"\r\n             *ngIf="lb.dataSource.loading.timeline">\r\n        </div>\r\n        <n7-timeline [data]="lb.widgets[\'mr-timeline\'].ds.out$ | async"\r\n                     *ngIf="!lb.dataSource.loading.timeline">\r\n        </n7-timeline>\r\n    </div>\r\n\r\n    <div class="mr-timeline__page mr-side-margin">\r\n        <div class="mr-timeline__date">\r\n            <n7-inner-title [data]="lb.widgets[\'mr-year-header\'].ds.out$ | async"\r\n                            [emit]="lb.widgets[\'mr-year-header\'].emit">\r\n            </n7-inner-title>\r\n        </div>\r\n        <h1 class="mr-timeline__title"\r\n            *ngIf="!lb.dataSource.loading.resourceDetails">\r\n            {{lb.dataSource.eventHeader}}\r\n        </h1>\r\n        <div class="mr-timeline__content">\r\n            \x3c!-- DESCRIZIONE --\x3e\r\n            <div class="mr-content-block mr-content-block-description">\r\n                <p [innerHTML]="lb.dataSource.eventDescription">\r\n                <p>\r\n            </div>\r\n            <ng-container *ngIf="!lb.dataSource.loading.resourceDetails">\r\n\r\n                \x3c!-- GALLERIA --\x3e\r\n                <div class="mr-content-block n7-grid-6">\r\n                    <ng-container *ngFor="let image of lb.dataSource.collectionGalleryData">\r\n                        <a [href]="image.image" class="mr-gallery__image">\r\n                            <img [src]="image.thumbnail" alt="image.title">\r\n                        </a>\r\n                    </ng-container>\r\n                </div>\r\n                \r\n\r\n                \x3c!-- MAPPA --\x3e\r\n                <div class="mr-content-block mr-content-block-map" *ngIf="lb.dataSource.hasMap">\r\n                    <h3 class="mr-content-block__title" *ngIf="lb.dataSource.mapHeader">{{ lb.dataSource.mapHeader }}</h3>\r\n                    <div class="mr-content-block__content">\r\n                        <n7-map [data]="lb.widgets[\'mr-map\'].ds.out$ | async"></n7-map>\r\n                    </div>\r\n                </div>\r\n\r\n                \x3c!-- BIBLIOGRAFIA --\x3e\r\n                <ng-container *ngIf="lb.dataSource.bibliographyData as biblio">\r\n                    <ng-container *ngIf="biblio.items && biblio.items.length > 0">\r\n                        <div class="mr-content-block mr-content-block-collection">\r\n                            <h3 class="mr-content-block__title">{{ biblio.header.title }}</h3>\r\n                            <div class="mr-content-block__content n7-grid-1">\r\n                                <ng-container *ngFor="let item of biblio.items">\r\n                                    <div class="mr-timeline__collection-content">\r\n                                        <n7-item-preview \r\n                                            [emit]="lb.eventHandler.itemPreviewEmit"    \r\n                                            [data]="item">\r\n                                        </n7-item-preview>\r\n                                    </div>\r\n                                </ng-container>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </ng-container>\r\n\r\n                \x3c!-- TESTIMONI --\x3e\r\n                <ng-container *ngIf="lb.dataSource.collectionWitnessData as wit">\r\n                    <ng-container *ngIf="wit.items && wit.items.length > 0">\r\n                        <div class="mr-content-block-collection mr-content-block">\r\n                            <h3 class="mr-content-block__title">{{ wit.header.title }}</h3>\r\n                            <div class="mr-content-block__content n7-grid-3">\r\n                                <n7-item-preview *ngFor="let item of wit.items"\r\n                                                 [data]="item">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </ng-container>\r\n\r\n                \x3c!-- OPERE --\x3e\r\n                <ng-container *ngIf="lb.dataSource.collectionWorksData as works">\r\n                    <ng-container *ngIf="works.items && works.items.length > 0">\r\n                        <div class="mr-content-block-collection mr-content-block">\r\n                            <h3 class="mr-content-block__title">{{ works.header.title }}</h3>\r\n                            <div class="mr-content-block__content n7-grid-3">\r\n                                <n7-item-preview *ngFor="let item of works.items"\r\n                                                 [data]="item">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),S("design:paramtypes",[x,s.ActivatedRoute,s.Router,n.Location,E,T,C,Pn,Rn])],a)}(P),ar=function(){function t(){this.collapsed=!0,this.hasReadmore=!1,this._loaded=!1}return t.prototype.ngAfterViewChecked=function(){var t=this;if(!this._loaded&&this.data&&this.root&&this.root.nativeElement.clientHeight>0){this._loaded=!0,this.clientHeight=this.root.nativeElement.clientHeight;var e=this.data,n=e.height,a=e.labels;Object.keys(a).forEach((function(e){t.data.labels[e]=l._t(a[e])})),this.clientHeight>n+50&&setTimeout((function(){t.hasReadmore=!0,t.updateWrapperHeight()}))}},t.prototype.handleToggle=function(){this.collapsed=!this.collapsed,this.updateWrapperHeight()},t.prototype.updateWrapperHeight=function(){this.wrapperHeight=this.collapsed?this.data.height:this.clientHeight},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"emit",void 0),w([e.ViewChild("root",{read:e.ElementRef}),S("design:type",e.ElementRef)],t.prototype,"root",void 0),t=w([e.Component({selector:"mr-read-more",template:'<div #root class="mr-read-more"\r\n    [ngClass]="{\r\n        \'is-collapsed\': !!(hasReadmore && collapsed),\r\n        \'is-expanded\': !!(hasReadmore && !collapsed)\r\n    }">\r\n        <div class="mr-read-more__content"\r\n        [ngStyle]="{\r\n            height: hasReadmore ? wrapperHeight + \'px\' : false\r\n        }">\r\n            \x3c!-- Child component --\x3e\r\n            <ng-content class="content"></ng-content>\r\n        </div>\r\n        <div *ngIf="hasReadmore" class="mr-read-more__btn" (click)="handleToggle()">\r\n            <span class="n7-icon-{{ collapsed ? \'plus\' : \'minus\' }}"></span>\r\n            <span class="mr-read-more__btn-text">{{ collapsed ? data.labels.more : data.labels.less }}</span>\r\n        </div>\r\n</div>\r\n'})],t)}(),ir=function(){function t(){}return t.prototype.onClick=function(t){this.emit&&this.emit("click",t)},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"emit",void 0),t=w([e.Component({selector:"mr-advanced-result",template:'<div *ngIf="data"\r\n     class="mr-advanced-result">\r\n    <n7-item-preview [data]="data"></n7-item-preview>\r\n    <div class="mr-advanced-result__content"\r\n         *ngFor="let highlightGroup of data.highlights">\r\n        <div class="mr-advanced-result__content-group">\r\n            \x3c!-- METADATA GROUP TITLE --\x3e\r\n            \x3c!--\r\n            <h3 class="mr-advanced-result__title"\r\n                *ngIf="highlightGroup.title"\r\n                [innerHTML]="highlightGroup.title">\r\n            </h3>\r\n            --\x3e\r\n            \x3c!-- METADATA ITEM --\x3e\r\n            <div class="mr-advanced-result__item {{ item.classes || \'\' }}"\r\n                 *ngFor="let item of highlightGroup.items">\r\n                \x3c!-- ICON --\x3e\r\n                <span class="mr-advanced-result__icon {{item.icon}}"\r\n                      *ngIf="item.icon">\r\n                </span>\r\n                \x3c!-- LABEL --\x3e\r\n                <span class="mr-advanced-result__label"\r\n                      *ngIf="item.label"\r\n                      [innerHTML]="item.label">\r\n                </span>\r\n                \x3c!-- VALUE W/ HREF --\x3e\r\n                <a *ngIf="item.href"\r\n                   [href]="item.href">\r\n                    <span class="mr-advanced-result__value"\r\n                          *ngIf="item.value"\r\n                          [innerHTML]="item.value">\r\n                    </span>\r\n                </a>\r\n                \x3c!-- VALUE W/OUT HREF --\x3e\r\n                <span class="mr-advanced-result__value"\r\n                      *ngIf="item.value && !item.href"\r\n                      [innerHTML]="item.value">\r\n                </span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'})],t)}(),rr=function(){function t(){}return t.prototype.ngOnInit=function(){var t=this;this.group?this.sections=this.form.config.sections.filter((function(e){var n=e.id;return t.group.sections.includes(n)})):this.sections=this.form.config.sections,this.sections=this.sections.map((function(t){return b(b({},t),{title:l._t(t.title),description:l._t(t.description)})}))},w([e.Input(),S("design:type",qa)],t.prototype,"form",void 0),w([e.Input(),S("design:type",Object)],t.prototype,"group",void 0),w([e.ContentChild(e.TemplateRef),S("design:type",e.TemplateRef)],t.prototype,"templateRef",void 0),t=w([e.Component({selector:"mr-form",template:'<div *ngIf="form.loaded$ | async" class="mr-form {{ group?.classes || \'\' }}">\r\n    <div *ngFor="let section of sections" class="mr-form__section {{ section.classes || \'\' }}" \r\n         [ngClass]="{ \'mr-form__section-advanced\' : section.advancedSection  }" >\r\n        \r\n        <div class="mr-form__section-header">\r\n            <h3 *ngIf="section.title" class="mr-form__section-title">{{ section.title }}</h3>\r\n            <p *ngIf="section.description" class="mr-form__section-description">{{ section.description }}</p>\r\n        </div>\r\n        \r\n        <div class="mr-form__section-content">\r\n            <div *ngFor="let input of section.inputs" class="mr-form__element {{ input.options?.classes || \'\' }}">\r\n                <ng-container [ngSwitch]="input.type">\r\n\r\n                    \x3c!-- INPUT TEXT --\x3e\r\n                    <n7-input-text *ngSwitchCase="\'text\'" \r\n                        [data]="form.inputs[input.id].ds.out$ | async"\r\n                        [emit]="form.inputs[input.id].emit"></n7-input-text>\r\n\r\n                    \x3c!-- INPUT CHECKBOX --\x3e\r\n                    <n7-input-checkbox *ngSwitchCase="\'checkbox\'" \r\n                        [data]="form.inputs[input.id].ds.out$ | async"\r\n                        [emit]="form.inputs[input.id].emit"></n7-input-checkbox>\r\n\r\n                    \x3c!-- INPUT SELECT --\x3e\r\n                    <n7-input-select *ngSwitchCase="\'select\'" \r\n                        [data]="form.inputs[input.id].ds.out$ | async"\r\n                        [emit]="form.inputs[input.id].emit"></n7-input-select>\r\n\r\n                    \x3c!-- DEFAULT (external template) --\x3e\r\n                    <ng-container *ngSwitchDefault>\r\n                        <ng-template *ngTemplateOutlet="\r\n                        templateRef; \r\n                        context: { \r\n                            type: input.type, \r\n                            input: form.inputs[input.id] \r\n                        }"></ng-template>\r\n                    </ng-container>\r\n\r\n                </ng-container>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'})],t)}(),or=function(){function t(){var t=this;this.fakeEmit=function(e,n){t.emit&&t.emit(e,n)}}return t.prototype.ngOnInit=function(){this.fakeEmit("init")},t.prototype.ngOnDestroy=function(){this.fakeEmit("destroy")},t.prototype.onReset=function(){this.fakeEmit("reset")},t.prototype.onSubmit=function(){this.fakeEmit("submit")},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Function)],t.prototype,"emit",void 0),t=w([e.Component({selector:"mr-form-wrapper-accordion",template:'<div *ngIf="data" class="mr-form-wrapper-accordion">\r\n    <ng-container *ngFor="let group of data.form.config.groups; index as $i">\r\n        <div *ngIf="group.options && (group.options.showHeader !== false)" \r\n            class="mr-form-wrapper-accordion__header">\r\n            <n7-facet-header\r\n                [data]="group.options"\r\n                [emit]="fakeEmit"\r\n            ></n7-facet-header>\r\n        </div>\r\n\r\n        <div *ngIf="group.options.isOpen" class="mr-form-wrapper-accordion__content" [attr.id]="group.id">\r\n            <mr-form [form]="data.form" [group]="group">\r\n                \x3c!-- CUSTOM INPUTS --\x3e\r\n                \x3c!-- <ng-template let-type="type" let-input="input">\r\n                    <ng-container [ngSwitch]="type">\r\n                        \r\n                        <n7-tag *ngSwitchCase="\'tag\'" \r\n                            [data]="input.ds.out$ | async"\r\n                            [emit]="input.emit"></n7-tag>\r\n    \r\n                    </ng-container>\r\n                </ng-template> --\x3e\r\n            </mr-form>\r\n        </div>\r\n    </ng-container>\r\n    \r\n    <div class="mr-form-wrapper-accordion__actions">\r\n        <a *ngIf="data.form.config.resetButton" \r\n            class="n7-btn n7-btn-xl n7-btn-danger" \r\n            (click)="onReset()">{{ data.form.config.resetButton.label }}</a>\r\n        <a *ngIf="data.form.config.submitButton" \r\n            class="n7-btn n7-btn-cta n7-btn-xl n7-btn-info" \r\n            (click)="onSubmit()">{{ data.form.config.submitButton.label }}</a>\r\n    </div>\r\n</div>'})],t)}(),sr=function(){function t(){}return t.prototype.onClick=function(t){this.emit&&this.emit("click",t)},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Function)],t.prototype,"emit",void 0),t=w([e.Component({selector:"mr-search-page-description",template:'<div *ngIf="data" class="mr-search-page-description">\r\n    <div class="mr-search-page-description__text" [innerHTML]="data.text"></div>\r\n    <a class="mr-search-page-description__link" (click)="onClick(data.link.payload)">{{ data.link.text }}</a>\r\n</div>'})],t)}(),cr={collection:qn,metadata:ta,preview:Qn,title:Wn},lr=function(){function t(t,e){this.router=t,this.modalService=e,this.destroy$=new r.Subject,this.status="IDLE",this.widgets={},this.errorTitle=l._t("global#layout_error_title"),this.errorDescription=l._t("global#layout_error_description")}return t.prototype.ngOnInit=function(){var t=this;this.modalService.state$.pipe(o.takeUntil(this.destroy$)).subscribe((function(e){var n=e.status,a=e.config,i=e.response;t.status=n,t.config=a,"SUCCESS"===n&&t.loadWidgets(a,i)})),this.router.events.pipe(o.takeUntil(this.destroy$),o.filter((function(){return!d.isEmpty(t.widgets)})),o.filter((function(t){return t instanceof s.NavigationStart}))).subscribe((function(){t.onClose()}))},t.prototype.ngOnDestroy=function(){this.onClose(),this.destroy$.next()},t.prototype.onClose=function(t){t&&"mr-resource-modal__overlay"!==t.className||(this.widgets={},this.modalService.close())},t.prototype.loadWidgets=function(t,e){var n=this,a=t.sections,i=a.top,r=a.content,o=i.concat(r);o&&o.forEach((function(t){var a=t.id,i=t.type,r=t.options,o=e.sections[a];n.widgets[a]={ds:new cr[i]},r&&(n.widgets[a].ds.options=r),o&&n.widgets[a].ds.update(o)}))},t.ctorParameters=function(){return[{type:s.Router},{type:Rn}]},t=w([e.Component({selector:"mr-resource-modal",template:'<div *ngIf="status !== \'IDLE\'" class="mr-modal mr-resource-modal" [ngClass]="{\r\n        \'is-loading\': status === \'LOADING\',\r\n        \'is-error\': status === \'ERROR\'\r\n      }">\r\n    <div class="mr-modal__overlay" (click)="onClose($event.target)">\r\n        <div class="mr-modal__window mr-resource-modal__window">\r\n            <ng-container [ngSwitch]="status">\r\n\r\n                \x3c!-- Loading --\x3e\r\n                <ng-container *ngSwitchCase="\'LOADING\'">\r\n                    <div class="mr-modal__loader">\r\n                        <n7-loader></n7-loader>\r\n                    </div>\r\n                </ng-container>\r\n\r\n                \x3c!-- Error --\x3e\r\n                <ng-container *ngSwitchCase="\'ERROR\'">\r\n\r\n                    <div class="mr-modal__header mr-resource-modal__header">\r\n                        <h2 class="mr-modal__header-title">\r\n                            {{ errorTitle }}\r\n                        </h2>\r\n                        <div class="mr-modal__close">\r\n                            <a class="mr-modal__close-link" (click)="onClose()"><span class="n7-icon-close"></span></a>\r\n                        </div>\r\n                    </div>\r\n                    <div class="mr-modal__content">\r\n                        <p class="mr-modal__error-text">{{ errorDescription }}</p>\r\n                    </div>\r\n\r\n                </ng-container>\r\n\r\n                \x3c!-- Success --\x3e\r\n                <ng-container *ngSwitchCase="\'SUCCESS\'">\r\n                    \r\n                    <div class="mr-modal__header mr-resource-modal__header">\r\n                        <ng-container *ngIf="config.sections as sections">\r\n                            <ng-container *ngTemplateOutlet="blocks; context: { $implicit: sections.top }"></ng-container>\r\n                        </ng-container>\r\n                        <div class="mr-modal__close">\r\n                            <a class="mr-modal__close-link" (click)="onClose()"><span class="n7-icon-close"></span></a>\r\n                        </div>\r\n                    </div>\r\n                    <div class="mr-modal__content mr-resource-modal__content">\r\n                        <ng-container *ngIf="config.sections as sections">\r\n                            <ng-container *ngTemplateOutlet="blocks; context: { $implicit: sections.content }"></ng-container>                            \r\n                        </ng-container>\r\n                    </div>\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #blocks let-list>\r\n    <ng-container *ngFor="let section of list">\r\n        <section *ngIf="widgets[section.id].ds && (widgets[section.id].ds.out$ | async)"\r\n            class="{{ \'mr-resource__section mr-resource__\' + section.type }}">\r\n            <ng-container [ngSwitch]="section.type">\r\n\r\n                \x3c!-- INNER TITLE --\x3e\r\n                <ng-container *ngSwitchCase="\'title\'">\r\n                    <n7-inner-title [data]="widgets[section.id].ds.out$ | async">\r\n                    </n7-inner-title>\r\n                </ng-container>\r\n\r\n                \x3c!-- METADATA VIEWER --\x3e\r\n                <ng-container *ngSwitchCase="\'metadata\'">\r\n                    <div class="mr-resource-modal__metadata-content">\r\n                        <h3 *ngIf="section.title" class="mr-resource-modal__section-title mr-resource__metadata-title">\r\n                            {{ section.title }}\r\n                        </h3>\r\n                        <mr-read-more [data]="section.readmore">\r\n                            <n7-metadata-viewer [data]="widgets[section.id].ds.out$ | async">\r\n                            </n7-metadata-viewer>\r\n                        </mr-read-more>\r\n                    </div>\r\n                </ng-container>\r\n\r\n                \x3c!-- COLLECTION --\x3e\r\n                <ng-container *ngSwitchCase="\'collection\'">\r\n                    <ng-container *ngIf="widgets[section.id].ds.out$ | async as collection$">\r\n                        <div *ngIf="collection$.items?.length > 0" class="mr-resource__collection-content">\r\n                            <h3 *ngIf="section.title" class="mr-resource-modal__section-title">\r\n                                {{ section.title }}\r\n                            </h3>\r\n                            <div\r\n                                class="mr-resource__collection-grid {{ section.grid ? \'n7-grid-\' + section.grid : \'\' }}">\r\n                                <n7-item-preview *ngFor="let item of collection$?.items" [data]="item">\r\n                                </n7-item-preview>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                </ng-container>\r\n\r\n                \x3c!-- ITEM PREVIEW --\x3e\r\n                <ng-container *ngSwitchCase="\'preview\'">\r\n                    <h3 *ngIf="section.title" class="mr-resource-modal__section-title">\r\n                        {{ section.title }}\r\n                    </h3>\r\n                    <n7-item-preview [data]="widgets[section.id].ds.out$ | async">\r\n                    </n7-item-preview>\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n        </section>\r\n    </ng-container>\r\n</ng-template>\r\n'}),S("design:paramtypes",[s.Router,Rn])],t)}(),ur=function(){function t(){}return t.prototype.onClick=function(t){this.emit&&this.emit("click",t)},t.prototype.onClose=function(){this.emit&&this.emit("close")},w([e.Input(),S("design:type",Object)],t.prototype,"data",void 0),w([e.Input(),S("design:type",Function)],t.prototype,"emit",void 0),w([e.Input(),S("design:type",Number)],t.prototype,"grid",void 0),t=w([e.Component({selector:"mr-gallery",template:'<div *ngIf="data" class="mr-gallery mr-wp-content">\r\n    <div class="mr-gallery__wrapper wp-block-gallery has-zoom {{ grid ? \'columns-\' + grid : \'\' }}">\r\n        <ul class="mr-gallery__items blocks-gallery-grid">\r\n            <li *ngFor="let item of data.items" class="mr-gallery__item blocks-gallery-item">\r\n                <figure>\r\n                    <a (click)="onClick(item.payload)" class="mr-gallery__link">\r\n                        <img [src]="item.thumbSrc" [alt]="item.title" class="mr-gallery__image">\r\n                    </a>\r\n                </figure>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div *ngIf="data.selected" class="mr-modal mr-gallery-modal" (click)="onClose()">\r\n        <div class="mr-modal__overlay">\r\n            <div class="mr-modal__window mr-gallery-modal__window">\r\n                <div class="mr-modal__header mr-gallery-modal__header">\r\n                    <div class="mr-modal__close">\r\n                        <a class="mr-modal__close-link" (click)="onClose()"><span class="n7-icon-close"></span></a>\r\n                    </div>\r\n                </div>\r\n                <div class="mr-modal__content mr-gallery-modal__content">\r\n                    <div class="mr-gallery__zoom-image-wrapper">\r\n                        <img [src]="data.selected.fullSrc" [alt]="data.selected.title" class="mr-gallery__zoom-image">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'})],t)}(),dr=[$a,za,Ka,ai,li,hi,yi,Ei,Vi,Ki,Zi,nr,ar,rr,or,sr,lr,ur,ir],pr=function(){function t(){}return t=w([e.NgModule({declarations:[$n,dr],imports:[n.CommonModule,i.DvComponentsLibModule,pt],providers:[Tn,Pn,Rn],entryComponents:dr,exports:dr})],t)}(),hr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.onInit=function(){},e}(l.LayoutDataSource),fr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"sb-example-layout.init":console.log("layout-inner",n,a),t.emitOuter("init",a),t.dataSource.onInit();break;default:console.warn("unhandled event of type",n)}})),this.outerEvents$.subscribe((function(t){var e=t.type,n=t.payload;switch(e){case"sb-dummy.click":console.log("layout-outer",e,n);break;default:console.warn("unhandled event of type",e)}}))},e}(l.EventHandler),gr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.viewer=null,e.viewerLoaded$=new r.Subject,e}return v(e,t),e.prototype.transform=function(){var t=this,e=i.IMAGE_VIEWER_MOCK;return e.images=[{type:"image",url:"http://placekitten.com/1920/1080",buildPyramid:!1},{type:"image",url:"http://placekitten.com/500/600",buildPyramid:!1},{type:"image",url:"http://placekitten.com/700/400",buildPyramid:!1}],e.libOptions.showReferenceStrip=!1,e._setViewer=function(e){t.viewer=e,t.viewerLoaded$.next()},e},e.prototype.changePage=function(t){this.viewer.goToPage(t)},e}(l.DataSource),mr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.transform=function(){var t=i.IMAGE_VIEWER_TOOLS_MOCK;t.images=[{thumb:"http://placekitten.com/200/130",payload:{thumbindex:0},caption:"Test caption <b>#1</b>"},{thumb:"http://placekitten.com/90/180",payload:{thumbindex:1},caption:"Test caption <b>#2</b>"},{thumb:"http://placekitten.com/90/110",payload:{thumbindex:2},caption:"Test caption <b>#3</b>"}];var e=t.images[t.initial].caption;return void 0!==e&&(t.description=e),t},e.prototype.toggleDescription=function(){this.output.isVisible.description=!this.output.isVisible.description},e.prototype.toggleThumbs=function(){this.output.isVisible.thumbnails=!this.output.isVisible.thumbnails},e.prototype.handleThumbs=function(t){this.output.initial=t,this.updateDescription()},e.prototype.handlePageChange=function(t){this.handleThumbs(t.page)},e.prototype.updateDescription=function(){var t=this.output.initial,e=this.output.images;this.output.description=e[t].caption},e}(l.DataSource),yr=Object.freeze({__proto__:null,SbImageViewerDS:gr,SbImageViewerToolsDS:mr}),vr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"sb-image-viewer.click":t.emitOuter("click",a);break;case"sb-image-viewer.pagechange":t.emitOuter("pagechange",a)}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"sb-image-viewer-layout.init":t.listenToViewer();break;case"sb-image-viewer-layout.thumbclick":t.dataSource.changePage(a)}}))},e.prototype.listenToViewer=function(){var t=this;this.dataSource.viewerLoaded$.pipe(o.first()).subscribe((function(){t.dataSource.viewer.addHandler("page",(function(e){t.emitOuter("pagechange",e)}))}))},e}(l.EventHandler),br=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"sb-image-viewer-tools.click":if(void 0!==a.thumbindex){var i=a.thumbindex;t.dataSource.handleThumbs(i),t.emitOuter("thumbclick",i);break}if("close-description"===a){t.dataSource.toggleDescription();break}if("toggle-description"===a){t.dataSource.toggleDescription();break}if("toggle-thumbs"===a){t.dataSource.toggleThumbs();break}}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"sb-image-viewer-layout.init":case"sb-image-viewer-layout.thumbclick":break;case"sb-image-viewer-layout.pagechange":t.dataSource.handlePageChange(a)}}))},e}(l.EventHandler),wr=Object.freeze({__proto__:null,SbImageViewerEH:vr,SbImageViewerToolsEH:br}),Sr={layoutId:"sb-example-layout",widgets:[{id:"sb-dummy",hasStaticData:!0}],layoutDS:hr,layoutEH:fr,widgetsDataSources:yr,widgetsEventHandlers:wr,options:{}},_r=function(t){function n(){return t.call(this,Sr)||this}return v(n,t),n.prototype.initPayload=function(){return{}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n=w([e.Component({selector:"sb-example-layout",template:'<div class="sb-example-layout" id="example-layout">\r\n    <n7-tag \r\n    [data]="lb.widgets[\'sb-dummy\'].ds.out$ | async"\r\n    [emit]="lb.widgets[\'sb-dummy\'].emit"></n7-tag> \r\n</div>'}),S("design:paramtypes",[])],n)}(P),kr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.onInit=function(t){var e=t.communication,n=t.configuration;this.communication=e,this.configuration=n,console.log("communication config",this.configuration.get("communication")),this.communication.request$("posts",{method:"GET",params:{id:505},onError:function(t){console.warn("err",t)}}).subscribe((function(t){console.log("response------------\x3e",t)}))},e}(l.LayoutDataSource),Ir=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"sb-image-viewer-layout.init":t.dataSource.onInit(a),t.emitOuter("init")}})),this.outerEvents$.subscribe((function(e){var n=e.type,a=e.payload;switch(n){case"sb-image-viewer-tools.click":break;case"sb-image-viewer.pagechange":t.emitOuter("pagechange",a);break;case"sb-image-viewer-tools.thumbclick":t.emitOuter("thumbclick",a);break;case"sb-image-viewer.click":t.emitOuter("viewerclick",a)}}))},e}(l.EventHandler),Er={layoutId:"sb-image-viewer-layout",widgets:[{id:"sb-image-viewer-tools",hasStaticData:!0},{id:"sb-image-viewer",hasStaticData:!0}],layoutDS:kr,layoutEH:Ir,widgetsDataSources:yr,widgetsEventHandlers:wr,options:{}},xr=function(t){function n(e,n){var a=t.call(this,Er)||this;return a.configuration=e,a.communication=n,a}return v(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,communication:this.communication}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.ctorParameters=function(){return[{type:E},{type:T}]},n=w([e.Component({selector:"sb-image-viewer-layout",template:'<div class="sb-image-viewer-layout" id="image-viewer-layout">\r\n    <n7-image-viewer \r\n        [data]="lb.widgets[\'sb-image-viewer\'].ds.out$ | async"\r\n        [emit]="lb.widgets[\'sb-image-viewer\'].emit">\r\n    </n7-image-viewer> \r\n    <n7-image-viewer-tools \r\n        [data]="lb.widgets[\'sb-image-viewer-tools\'].ds.out$ | async"\r\n        [emit]="lb.widgets[\'sb-image-viewer-tools\'].emit">\r\n    </n7-image-viewer-tools>\r\n</div>\r\n'}),S("design:paramtypes",[E,T])],n)}(P),Cr=[_r,xr],Dr=function(){function t(){}return t=w([e.NgModule({declarations:Cr,imports:[n.CommonModule,i.DvComponentsLibModule,pt],providers:[],exports:Cr})],t)}(),Or=function(){function t(){}return t=w([e.NgModule({imports:[n.CommonModule],providers:[],exports:[pt,dn,xn,pr,Dr]})],t)}(),Tr=function(){function t(t,e){this.http=t,this.config=e}return t.prototype.load=function(t){var e=this;return this.http.get(t).pipe(o.catchError((function(){return r.of({})})),o.tap((function(t){return e._handleResponse(t)}))).toPromise()},t.prototype._handleResponse=function(t){var e=this;if(t&&(Object.keys(t).forEach((function(n){var a=e.config.get(n),i=t[n];e.config.set(n,d.merge(a,i))})),t["config-keys"])){var n=document.querySelector("head"),a=document.createElement("style"),i=[];Object.keys(t["config-keys"]).forEach((function(e){var n=t["config-keys"][e]||{},a=n["class-name"];n.color&&n.color.hex&&i.push("--color-"+a+": "+n.color.hex+";")})),i.length&&(i.unshift(":root {"),i.push("}"),a.appendChild(document.createTextNode(i.join("\n"))),n.appendChild(a))}},t.ctorParameters=function(){return[{type:a.HttpClient},{type:E}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(a.HttpClient),e.ɵɵinject(E))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),S("design:paramtypes",[a.HttpClient,E])],t)}(),Pr=function(){function t(t){this.config=t}return t.prototype.load=function(t){var e=this;return r.of(!0).pipe(o.tap((function(){if(t&&(Object.keys(t).forEach((function(n){return e.config.set(n,t[n])})),t["config-keys"])){var n=document.querySelector("head"),a=document.createElement("style"),i=[];Object.keys(t["config-keys"]).forEach((function(e){var n=t["config-keys"][e]||{},a=n["class-name"];n.color&&n.color.hex&&i.push("--color-"+a+": "+n.color.hex+";")})),i.length&&(i.unshift(":root {"),i.push("}"),a.appendChild(document.createTextNode(i.join("\n"))),n.appendChild(a))}}))).toPromise()},t.ctorParameters=function(){return[{type:E}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(E))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),S("design:paramtypes",[E])],t)}(),Rr=function(){function t(t,e){var n=this;this.http=t,this.configuration=e,this.dynamicPaths=[],this.isDynamicPath=function(t){return n.dynamicPaths.includes(t)}}return t.prototype.load=function(){var t,e=this,n=this.configuration.get("communication"),a=n.defaultProvider,i=n.providers[a]||{},s=i.baseUrl,c=null===(t=null==i?void 0:i.config)||void 0===t?void 0:t.menu;if(s&&c){var l=s+c;return this.http.get(l).pipe(o.catchError((function(){return r.of(null)})),o.tap((function(t){return e._handleResponse(t)}))).toPromise()}return r.of(null).toPromise()},t.prototype._handleResponse=function(t){var e=this;if(t){var n=this.configuration.get("header");n.nav.items=t.map((function(t){var n=t.label,a=t.slug,i=t.isStatic,r=t.subpages,o=t.classes,s="/"+a;i||e.dynamicPaths.push(s);var c={classes:o,text:n,anchor:s?{href:jn.getRouterLink(s),queryParams:jn.getQueryParams(s)}:null,_meta:{id:s}};return void 0!==r&&(c.subnav=[],r.forEach((function(t){var n="/"+t.slug;t.isStatic||e.dynamicPaths.push(n),c.subnav.push({classes:t.classes||null,text:t.label,anchor:n?{href:jn.getRouterLink(n),queryParams:jn.getQueryParams(n)}:null,_meta:{id:n}})}))),c})),this.configuration.set("header",n)}},t.ctorParameters=function(){return[{type:a.HttpClient},{type:E}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(a.HttpClient),e.ɵɵinject(E))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),S("design:paramtypes",[a.HttpClient,E])],t)}(),$r=function(){function t(t,e){this.http=t,this.configuration=e}return t.prototype.load=function(){var t,e=this,n=this.configuration.get("communication"),a=n.defaultProvider,i=n.providers[a]||{},s=i.baseUrl,c=null===(t=null==i?void 0:i.config)||void 0===t?void 0:t.footer;if(s&&c){var l=s+c;return this.http.get(l).pipe(o.catchError((function(){return r.of(null)})),o.tap((function(t){return e._handleResponse(t)}))).toPromise()}return r.of(null).toPromise()},t.prototype._handleResponse=function(t){t&&this.configuration.set("footer",t)},t.ctorParameters=function(){return[{type:a.HttpClient},{type:E}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(a.HttpClient),e.ɵɵinject(E))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),S("design:paramtypes",[a.HttpClient,E])],t)}(),Lr=function(){function t(t,e){this.http=t,this.configuration=e}return t.prototype.load=function(t){var e,n=this,a=this.configuration.get("communication"),i=a.defaultProvider,s=a.providers[i]||{},c=s.baseUrl,l=null===(e=null==s?void 0:s.config)||void 0===e?void 0:e.translation;if(c&&l){var u=c+l+t;return this.http.get(u).pipe(o.catchError((function(){return r.of(null)})),o.tap((function(e){return n._handleResponse(e,t)}))).toPromise()}return r.of(null).toPromise()},t.prototype._handleResponse=function(t,e){t&&Object.keys(t).forEach((function(n){l.translate.setLangTranslation(e,n,t[n])}))},t.ctorParameters=function(){return[{type:a.HttpClient},{type:E}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(a.HttpClient),e.ɵɵinject(E))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),S("design:paramtypes",[a.HttpClient,E])],t)}(),Ar=function(){function t(t,e){this.menuService=t,this.router=e}return t.prototype.canActivate=function(t,e){var n=e.url;if(!this.menuService.isDynamicPath(n)){var a=t.data.notFoundPath;return this.router.navigate([a?"/"+a:"/"]),!1}return!0},t.ctorParameters=function(){return[{type:Rr},{type:s.Router}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(Rr),e.ɵɵinject(s.Router))},token:t,providedIn:"root"}),t=w([e.Injectable({providedIn:"root"}),S("design:paramtypes",[Rr,s.Router])],t)}();t.AbstractLayout=P,t.ApolloProvider=D,t.AwAutocompleteWrapperDS=ft,t.AwAutocompleteWrapperEH=le,t.AwBubbleChartDS=gt,t.AwBubbleChartEH=ue,t.AwCarouselDS=yt,t.AwChartTippyDS=mt,t.AwChartTippyEH=pe,t.AwCollectionLayoutComponent=ye,t.AwCollectionLayoutConfig=me,t.AwCollectionLayoutDS=fe,t.AwCollectionLayoutEH=ge,t.AwEntitaLayoutComponent=Ce,t.AwEntitaLayoutConfig=xe,t.AwEntitaLayoutDS=Ie,t.AwEntitaLayoutEH=Ee,t.AwEntitaMetadataViewerDS=Et,t.AwEntitaNavDS=It,t.AwEntitaNavEH=Xt,t.AwFacetsWrapperComponent=en,t.AwFacetsWrapperDS=Ft,t.AwFacetsWrapperEH=ie,t.AwGalleryLayoutComponent=Me,t.AwGalleryLayoutConfig=Ae,t.AwGalleryLayoutDS=Re,t.AwGalleryLayoutEH=Le,t.AwGalleryResultsDS=qt,t.AwGalleryResultsEH=re,t.AwHeroDS=vt,t.AwHeroEH=Gt,t.AwHomeAutocompleteDS=kt,t.AwHomeAutocompleteEH=Yt,t.AwHomeFacetsWrapperDS=St,t.AwHomeFacetsWrapperEH=Wt,t.AwHomeHeroPatrimonioDS=wt,t.AwHomeHeroPatrimonioEH=Kt,t.AwHomeItemTagsWrapperDS=_t,t.AwHomeItemTagsWrapperEH=Qt,t.AwHomeLayoutComponent=qe,t.AwHomeLayoutConfig=Fe,t.AwHomeLayoutDS=He,t.AwHomeLayoutEH=je,t.AwLinkedObjectsDS=ht,t.AwLinkedObjectsEH=ce,t.AwMapDS=Vt,t.AwMapEH=oe,t.AwMapLayoutComponent=ze,t.AwMapLayoutConfig=Ve,t.AwMapLayoutDS=Be,t.AwMapLayoutEH=Ne,t.AwPatrimonioLayoutConfig=We,t.AwRelatedEntitiesDS=xt,t.AwSchedaBreadcrumbsDS=Ct,t.AwSchedaDropdownDS=Dt,t.AwSchedaDropdownEH=ee,t.AwSchedaImageDS=Tt,t.AwSchedaInnerTitleDS=Pt,t.AwSchedaLayoutComponent=Ke,t.AwSchedaLayoutDS=Ue,t.AwSchedaLayoutEH=Ge,t.AwSchedaMetadataDS=Rt,t.AwSchedaPdfDS=Lt,t.AwSchedaPdfEH=ne,t.AwSchedaSidebarEH=Zt,t.AwSearchLayoutComponent=Ye,t.AwSearchLayoutConfig=Qe,t.AwSearchLayoutDS=Te,t.AwSearchLayoutEH=$e,t.AwSearchLayoutTabsDS=Mt,t.AwSearchLayoutTabsEH=ae,t.AwSidebarHeaderDS=Ot,t.AwSidebarHeaderEH=Jt,t.AwTableDS=bt,t.AwTableEH=de,t.AwTimelineDS=zt,t.AwTimelineEH=se,t.AwTimelineLayoutComponent=tn,t.AwTimelineLayoutConfig=Je,t.AwTimelineLayoutDS=Xe,t.AwTimelineLayoutEH=Ze,t.AwTreeDS=At,t.AwTreeEH=te,t.BreadcrumbsDS=W,t.BreadcrumbsEH=tt,t.BubbleChartWrapperComponent=nn,t.ChartTippyComponent=an,t.CommunicationService=T,t.ConfigurationService=E,t.DataWidgetWrapperComponent=pn,t.DatepickerWrapperComponent=hn,t.DvDataWidgetDS=mn,t.DvDatepickerWrapperDS=yn,t.DvDatepickerWrapperEH=_n,t.DvExampleLayoutComponent=In,t.DvExampleLayoutConfig=kn,t.DvExampleLayoutDS=fn,t.DvExampleLayoutEH=gn,t.DvGraphDS=vn,t.DvInnerTitleDS=bn,t.DvWidgetDS=wn,t.DynamicPathGuard=Ar,t.FacetsDS=K,t.FooterDS=Q,t.FooterEH=et,t.HeaderDS=U,t.HeaderEH=Z,t.JsonConfigService=Tr,t.LayoutsConfigurationService=x,t.LocalConfigService=Pr,t.MainLayoutComponent=rt,t.MainLayoutConfig=it,t.MainLayoutDS=R,t.MainLayoutEH=V,t.MainStateService=C,t.MrAdvancedResultComponent=ir,t.MrAdvancedResultsLayoutComponent=$a,t.MrAdvancedResultsLayoutConfig=Ra,t.MrAdvancedResultsLayoutDS=Ln,t.MrAdvancedResultsLayoutEH=An,t.MrAdvancedSearchLayoutComponent=za,t.MrAdvancedSearchLayoutConfig=Va,t.MrAdvancedSearchLayoutDS=Ba,t.MrAdvancedSearchLayoutEH=Na,t.MrAdvancedSearchTagsDS=ma,t.MrBreadcrumbsDS=Mn,t.MrCollectionDS=qn,t.MrCollectionEH=Ia,t.MrContentDS=Bn,t.MrDummyEH=va,t.MrFiltersDS=Nn,t.MrFiltersEH=ba,t.MrFooterService=$r,t.MrFormComponent=rr,t.MrFormWrapperAccordionComponent=or,t.MrFormWrapperAccordionDS=ga,t.MrFormWrapperAccordionEH=Ta,t.MrGalleryComponent=ur,t.MrGalleryDS=oa,t.MrGalleryEH=ka,t.MrGlossaryLayoutComponent=Ka,t.MrGlossaryLayoutConfig=Wa,t.MrGlossaryLayoutDS=Ua,t.MrGlossaryLayoutEH=Ga,t.MrHeroDS=Vn,t.MrHomeLayoutComponent=ai,t.MrHomeLayoutConfig=Xa,t.MrHomeLayoutDS=Qa,t.MrHomeLayoutEH=Ya,t.MrImageViewerDS=zn,t.MrImageViewerToolsDS=Un,t.MrInfoBoxDS=Gn,t.MrInnerTitleDS=Wn,t.MrItemPreviewDS=Qn,t.MrItemPreviewsDS=Yn,t.MrItineraryLayoutComponent=li,t.MrItineraryLayoutConfig=oi,t.MrItineraryLayoutDS=ii,t.MrItineraryLayoutEH=ri,t.MrMapDS=Jn,t.MrMapLayoutComponent=hi,t.MrMapLayoutConfig=pi,t.MrMapLayoutDS=ui,t.MrMapLayoutEH=di,t.MrMenuService=Rr,t.MrMetadataDS=ta,t.MrNavDS=ea,t.MrNavEH=wa,t.MrPostsLayoutComponent=yi,t.MrPostsLayoutConfig=mi,t.MrPostsLayoutDS=fi,t.MrPostsLayoutEH=gi,t.MrResourceLayoutComponent=Ei,t.MrResourceLayoutConfig=wi,t.MrResourceLayoutDS=vi,t.MrResourceLayoutEH=bi,t.MrResourceModalComponent=lr,t.MrResourceTabsDS=na,t.MrSearchFacetsLayoutComponent=Vi,t.MrSearchLayoutComponent=Ki,t.MrSearchLayoutConfig=Wi,t.MrSearchLayoutDS=Ui,t.MrSearchLayoutEH=Gi,t.MrSearchPageDescriptionComponent=sr,t.MrSearchPageDescriptionDS=pa,t.MrSearchPageDescriptionEH=Da,t.MrSearchPageTitleDS=sa,t.MrSearchPageTitleEH=Ca,t.MrSearchResultsDS=ua,t.MrSearchResultsEH=Oa,t.MrSearchResultsTitleDS=ca,t.MrSearchResultsTitleEH=xa,t.MrSearchTagsDS=da,t.MrSearchTagsEH=Ea,t.MrStaticLayoutComponent=Zi,t.MrStaticLayoutConfig=Xi,t.MrStaticLayoutDS=Qi,t.MrStaticLayoutEH=Yi,t.MrStaticMetadataDS=fa,t.MrTextViewerDS=aa,t.MrTimelineDS=ia,t.MrTimelineEH=Sa,t.MrTimelineLayoutComponent=nr,t.MrTimelineLayoutConfig=er,t.MrTimelineLayoutDS=Ji,t.MrTimelineLayoutEH=tr,t.MrTranslationsLoaderService=Lr,t.MrYearHeaderDS=ra,t.MrYearHeaderEH=_a,t.N7BoilerplateAriannaWebModule=dn,t.N7BoilerplateCommonModule=pt,t.N7BoilerplateDataVizModule=xn,t.N7BoilerplateLibModule=Or,t.N7BoilerplateMurucaModule=pr,t.N7BoilerplateSandboxModule=Dr,t.Page404LayoutComponent=lt,t.Page404LayoutConfig=ct,t.Page404LayoutDS=ot,t.Page404LayoutEH=st,t.PdfViewerComponent=rn,t.ReadMoreComponent=ar,t.RestProvider=O,t.SbExampleLayoutComponent=_r,t.SbExampleLayoutConfig=Sr,t.SbExampleLayoutDS=hr,t.SbExampleLayoutEH=fr,t.SbImageViewerDS=gr,t.SbImageViewerEH=vr,t.SbImageViewerLayoutComponent=xr,t.SbImageViewerLayoutConfig=Er,t.SbImageViewerLayoutDS=kr,t.SbImageViewerLayoutEH=Ir,t.SbImageViewerToolsDS=mr,t.SbImageViewerToolsEH=br,t.SchedaDropdownComponent=on,t.SearchFacetsLayoutConfig=Di,t.SearchFacetsLayoutDS=xi,t.SearchFacetsLayoutEH=Ci,t.SmartBreadcrumbsComponent=sn,t.SmartPaginationComponent=ut,t.SmartPaginationDS=Y,t.SmartPaginationEH=nt,t.SubnavDS=G,t.SubnavEH=J,t.ɵa=rt,t.ɵb=P,t.ɵba=hn,t.ɵbb=In,t.ɵbc=$n,t.ɵbd=$a,t.ɵbe=Pn,t.ɵbf=Rn,t.ɵbg=za,t.ɵbh=Ka,t.ɵbi=ai,t.ɵbj=li,t.ɵbk=hi,t.ɵbl=yi,t.ɵbm=Ei,t.ɵbn=Vi,t.ɵbo=Ki,t.ɵbp=Tn,t.ɵbq=Zi,t.ɵbr=nr,t.ɵbs=ar,t.ɵbt=rr,t.ɵbu=or,t.ɵbv=sr,t.ɵbw=lr,t.ɵbx=ur,t.ɵby=ir,t.ɵbz=_r,t.ɵc=E,t.ɵca=xr,t.ɵd=x,t.ɵe=C,t.ɵf=lt,t.ɵg=ut,t.ɵh=T,t.ɵi=D,t.ɵj=O,t.ɵk=ye,t.ɵl=Ce,t.ɵm=en,t.ɵn=Me,t.ɵo=De,t.ɵp=qe,t.ɵq=ze,t.ɵr=Ke,t.ɵs=Ye,t.ɵt=tn,t.ɵu=nn,t.ɵv=an,t.ɵw=rn,t.ɵx=on,t.ɵy=sn,t.ɵz=pn,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=n7-frontend-boilerplate.umd.min.js.map