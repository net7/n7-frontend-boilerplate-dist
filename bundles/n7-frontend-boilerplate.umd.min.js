!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("@n7-frontend/components"),require("rxjs"),require("rxjs/operators"),require("@angular/router"),require("@angular/platform-browser"),require("@n7-frontend/core"),require("tippy.js")):"function"==typeof define&&define.amd?define("@n7-frontend/boilerplate",["exports","@angular/core","@angular/common","@angular/common/http","@n7-frontend/components","rxjs","rxjs/operators","@angular/router","@angular/platform-browser","@n7-frontend/core","tippy.js"],e):e(((t=t||self)["n7-frontend"]=t["n7-frontend"]||{},t["n7-frontend"].boilerplate={}),t.ng.core,t.ng.common,t.ng.common.http,t.components,t.rxjs,t.rxjs.operators,t.ng.router,t.ng.platformBrowser,t.core$1,t.tippy)}(this,function(t,e,n,o,i,a,r,s,u,l,c){"use strict";c=c&&c.hasOwnProperty("default")?c.default:c;var d=function(t,e){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function p(t,e){function n(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var b=function(){return(b=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function h(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,a=n.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(o=a.next()).done;)r.push(o.value)}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return r}var f=function(){function t(t){var e=this;this.config=t,this.defaults={},this.get=function(t){return e.defaults[t]},this.set=function(t,n){return e.defaults[t]=n},this.config.global&&Object.keys(this.config.global).forEach(function(t){e.set(t,e.config.global[t])})}return t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:["config"]}]}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject("config"))},token:t,providedIn:"root"}),t}();var m=function(){function t(t){var e=this;this.config=t,this.defaults={},this.get=function(t){return e.defaults[t]},this.set=function(t,n){return e.defaults[t]=n},this.config.layouts&&Object.keys(this.config.layouts).forEach(function(t){e.set(t,e.config.layouts[t])})}return t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:["config"]}]}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject("config"))},token:t,providedIn:"root"}),t}();var y=function(){function t(){var t=this;this.custom={},this.default={headTitle:new a.ReplaySubject,pageTitle:new a.ReplaySubject,subnav:new a.ReplaySubject,breadcrumbs:new a.ReplaySubject,filters:new a.ReplaySubject},this.get$=function(e){return t._get("default",e)},this.getCustom$=function(e){return t._get("custom",e)},this.update=function(e,n){return t._update("default",e,n)},this.updateCustom=function(e,n){return t._update("custom",e,n)},this.has=function(e){return!!t.default[e]},this.hasCustom=function(e){return!!t.custom[e]}}return t.prototype.addCustom=function(t,e){if(this.custom[t])throw Error("custom stream "+t+" exists!");this.custom[t]=e},t.prototype._update=function(t,e,n){if(!this[t])throw Error(t+" stream group does not exists!");if(!this[t][e])throw Error(t+" stream "+e+" does not exists!");this[t][e].next(n)},t.prototype._get=function(t,e){if(!this[t])throw Error(t+" stream group does not exists!");if(!this[t][e])throw Error(t+" stream "+e+" does not exists!");return this[t][e]},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();var g={getLastPosts:{queryName:"getLastPosts",queryBody:"\n      {\n        getLastPosts(__PARAMS__) {\n          id\n          title\n        }\n      }\n    "},getTree:{queryName:"getTreeOfItems",queryBody:'\n    {\n      getTreeOfItems(treeId: "patrimonioId" ) {\n        id\n        label\n        icon\n        branches {\n          label\n          id\n          icon   \n          branches {\n            label\n            id\n            icon  \n            branches {\n              label\n              id\n              icon          \n            }        \n          }       \n        }\n      }\n    }\n    '},globalFilter:{queryName:"globalFilter",queryBody:"{\n      globalFilter(__PARAMS__){\n        entitiesData {\n          countData {\n            type {\n              id\n              label\n              configKey\n            }\n            count\n          }\n          entitiesCountData {\n            entity {\n              id\n              label\n              typeOfEntity {\n                id\n              }\n            }\n            count\n          }\n        }\n        itemsPagination {\n          totalCount\n          items {\n            item {\n              id\n              label\n              info {\n                key\n                value\n              }\n            }\n            thumbnail\n            relatedTOEData {\n              type {\n                id\n                label\n                configKey\n              }\n              count\n            }\n          }\n        }\n      }\n    }"},getEntityDetails:{queryName:"getEntityDetails",queryBody:"{\n      getEntityDetails(__PARAMS__){\n        overviewTab\n        entity {\n          label\n          id\n        }\n        fieldsTab {\n          id\n          fields {\n            id\n            key\n            value\n          }\n        }\n        entities {\n          entity {\n            id\n            label\n            typeOfEntity {\n              configKey\n            }\n          }\n          count\n        }\n        items {\n          breadcrumbs {\n            link\n            label\n          }\n          item {\n            id\n            label\n          }\n          thumbnail\n          relatedTOEData {\n            type {\n              id\n              configKey\n            }\n            count\n          }\n        }\n      }\n    }\n    "},getItemDetails:{queryName:"getItemDetails",queryBody:"{\n        getItemDetails(__PARAMS__){\n            title\n            text\n            subTitle\n            image\n            fields {\n              id\n              label\n              fields {\n                id\n                key\n                value\n              }\n            }\n            item {\n              id\n            }\n            breadcrumbs {\n              label\n              link\n            }\n          }\n      }"}},v=function(){function t(t,e){this.config=t,this.http=e;try{this.providerConfig=this.config.get("communication").providers.apollo}catch(t){throw Error("No config found for apollo provider!")}}return t.prototype.request$=function(t,e){var n=e.params,o=e.method,i=e.httpOptions,a=g[t];this.providerConfig.config&&this.providerConfig.config[t]&&(a=this.providerConfig.config[t]);var s=(a=a||{}).queryName,u=a.queryBody;if(!s||!u)throw Error('No config found for requestId "'+t+'"');if(n){var l=this.makeParamsStr(n);u=u.replace("__PARAMS__",l)}else u=u.replace("(__PARAMS__)","");return(o&&"GET"===o?this.http.get(this.providerConfig.baseUrl):this.http.post(this.providerConfig.baseUrl,{query:u},i)).pipe(r.map(function(t){return t.data[s]}))},t.prototype.makeParamsStr=function(t){var e=this,n=[];return Object.keys(t).forEach(function(o){if(Array.isArray(t[o])){var i=[];t[o].forEach(function(t){if("object"==typeof t){var n=e.makeParamsStr(t);i.push("{ "+n+" }")}else isNaN(t)?i.push('"'+t+'"'):i.push(""+t)}),n.push(o+": ["+i.join(",")+"]")}else if("object"==typeof t[o]&&t[o]){var a=e.makeParamsStr(t[o]);n.push(o+": { "+a+" }")}else"string"==typeof t[o]&&0===o.indexOf("$")?n.push(o.replace("$","")+": "+t[o]):isNaN(t[o])?n.push(o+': "'+t[o]+'"'):n.push(o+": "+t[o])}),n.join(" ")},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:f},{type:o.HttpClient}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(f),e.ɵɵinject(o.HttpClient))},token:t,providedIn:"root"}),t}();var w={getLastPosts:"posts"},S=function(){function t(t,e){this.config=t,this.http=e;try{this.providerConfig=this.config.get("communication").providers.rest}catch(t){throw Error("No config found for rest provider!")}}return t.prototype.request$=function(t,e){void 0===e&&(e={});var n=e.params,o=e.method,i=e.httpOptions,a=w[t];if(o||(o=this.providerConfig.defaultMethod||"GET"),this.providerConfig.config&&this.providerConfig.config[t]&&(a=this.providerConfig.config[t]),!a)throw Error('No config found for requestId "'+t+'"');if("POST"===o||"PUT"===o)return this.http[o.toLowerCase()](this.providerConfig.baseUrl+a,n,i);if("GET"===o||"DELETE"===o)return this.http[o.toLowerCase()](this.providerConfig.baseUrl+a,i);throw Error("Rest method "+o+" not supported")},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:f},{type:o.HttpClient}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(f),e.ɵɵinject(o.HttpClient))},token:t,providedIn:"root"}),t}();var E=function(){function t(t,e,n){this.config=t,this.apollo=e,this.rest=n;try{this.communicationConfig=this.config.get("communication"),this.defaultProvider=this.communicationConfig.defaultProvider}catch(t){throw Error("No communications.defaultProvider setted in config")}}return t.prototype.request$=function(t,e,n){var o=this;if(void 0===e&&(e={}),!this[n=n||this.defaultProvider])throw Error("There is no "+n+" provider");var i=e.onError;return this[n].request$(t,e).pipe(r.catchError(function(t){return o.handleError(t,i)}))},t.prototype.handleError=function(t,e){return e?e(t):console.warn("No error handler for communication request",t),a.empty()},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:f},{type:v},{type:S}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(f),e.ɵɵinject(v),e.ɵɵinject(S))},token:t,providedIn:"root"}),t}();var I=function(){function t(t){this.config=t,this.widgets=this.config.widgets,this.lb=new l.LayoutBuilder(this.config.layoutId)}return t.prototype.initPayload=function(){},t.prototype.onInit=function(){var t=this;this.lb.ready$.subscribe(function(){t.lb.eventHandler.emitInner("init",t.initPayload())}),this.lb.init({widgetsConfig:this.widgets,widgetsDataSources:this.config.widgetsDataSources,widgetsEventHandlers:this.config.widgetsEventHandlers,dataSource:new this.config.layoutDS,eventHandler:new this.config.layoutEH})},t.prototype.onDestroy=function(){this.lb.eventHandler.emitInner("destroy")},t}();var H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.onInit=function(t){var e=this,n=t.configuration,o=t.mainState,i=t.router,a=t.options,r=t.titleService;this.configuration=n,this.mainState=o,this.router=i,this.titleService=r,this.options=a,this.one("header").update(this.configuration.get("header")),this.mainState.get$("headTitle").subscribe(function(t){return e.titleService.setTitle(t)}),this.mainState.get$("pageTitle").subscribe(function(t){return e.pageTitle=t}),this.mainState.get$("subnav").subscribe(function(t){return e.one("subnav").update(t)}),this.mainState.get$("breadcrumbs").subscribe(function(t){return e.one("breadcrumbs").update(t)})},e.prototype.onNavigate=function(t){if("router"===t.handler){if(!t.path)throw Error("onNavigate: no path for router navigate");this.router.navigate(t.path)}},e}(l.LayoutDataSource);var D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new a.Subject,e}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"main-layout.init":t.dataSource.onInit(o);break;case"main-layout.destroy":t.destroyed$.next()}}),l.EventHandler.globalEvents$.pipe(r.takeUntil(this.destroyed$)).subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"global.navigate":t.dataSource.onNavigate(o)}})},e}(l.EventHandler);var C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return{classes:"main-subnav",items:t}},e.prototype.setActive=function(t){this.output.items.forEach(function(e){e._meta.id===t?(e.classes="is-current",e._meta.isActive=!0):(e.classes="",e._meta.isActive=!1)})},e.prototype.getActive=function(){return this.output.items.filter(function(t){return t._meta.isActive})[0]||null},e}(l.DataSource),_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),k=Object.freeze({HeaderDS:C,SubnavDS:A,BreadcrumbsDS:_}),B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"header.click":t.emitGlobal("navigate",{handler:"router",path:[o]})}})},e}(l.EventHandler),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"subnav.click":"navigate"===o.source&&t.emitGlobal("navigate",o),t.emitGlobal(n,o)}})},e}(l.EventHandler),x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"breadcrumbs.click":"navigate"===o.source&&t.emitGlobal("navigate",o),t.emitGlobal(n,o)}})},e}(l.EventHandler),T=Object.freeze({HeaderEH:B,SubnavEH:P,BreadcrumbsEH:x}),O={layoutId:"main-layout",widgets:[{id:"header"},{id:"subnav"},{id:"breadcrumbs"}],layoutDS:H,layoutEH:D,widgetsDataSources:k,widgetsEventHandlers:T,options:{}},j=function(t){function n(e,n,o,i,a){var r=t.call(this,o.get("MainLayoutConfig")||O)||this;return r.router=e,r.configuration=n,r.layoutsConfiguration=o,r.mainState=i,r.titleService=a,r}return p(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,router:this.router,titleService:this.titleService,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.decorators=[{type:e.Component,args:[{selector:"main-layout",template:'<div class="n7-main-layout" id="main-layout">\n    <div class="n7-page-content">\n        <n7-header\n        [emit]="lb.widgets[\'header\'].emit"\n        [data]="lb.widgets[\'header\'].ds.out$ | async"></n7-header>\n\n        \x3c!-- <n7-nav \n        *ngIf="!lb.dataSource.options.sidebar"\n        [emit]="lb.widgets[\'subnav\'].emit"\n        [data]="lb.widgets[\'subnav\'].ds.out$ | async">\n        </n7-nav> --\x3e\n\n        <main class="n7-content">\n            <div class="n7-top-page-bar">\n                <div class="n7-top-page-bar__main">\n                    \x3c!-- <h1 \n                    *ngIf="lb.dataSource.pageTitle"\n                    class="n7-top-page-bar__title">{{ lb.dataSource.pageTitle }}</h1>\n                    <n7-breadcrumbs \n                    [emit]="lb.widgets[\'breadcrumbs\'].emit"\n                    [data]="lb.widgets[\'breadcrumbs\'].ds.out$ | async">\n                    </n7-breadcrumbs> --\x3e\n                </div>\n                \x3c!--<div *ngIf="lb.dataSource.pageTools" class="n7-top-page-bar__tools">\n                    <a *ngFor="let tool of lb.dataSource.pageTools" \n                    (click)="lb.eventHandler.emitInner(\'tools-click\', tool.payload)" \n                    class="n7-btn {{ tool.classes || \'\' }}">\n                        {{ tool.label | translate }}\n                    </a>\n                </div>--\x3e\n            </div>\n            \n            <div class="n7-alert-bar">\n                \x3c!--<n7-alert\n                [attr.id]="\'main-layout-alert\'"\n                [data]="lb.dataSource.alertData$ | async"\n                [emit]="lb.dataSource.closeAlert.bind(lb.dataSource)"></n7-alert>--\x3e\n            </div>\n            <ng-content></ng-content>\n        </main>\n    </div>\n\n    <div class="n7-footer-wrapper"></div>\n</div>'}]}],n.ctorParameters=function(){return[{type:s.Router},{type:f},{type:m},{type:y},{type:u.Title}]},n}(I);var L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.onInit=function(t){var e=t.options;this.options=e},e}(l.LayoutDataSource);var $=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new a.Subject,e}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"n7-page404-layout.init":t.dataSource.onInit(o);break;case"n7-page404-layout.destroy":t.destroyed$.next()}})},e}(l.EventHandler);var q={layoutId:"n7-page404-layout",widgets:[],layoutDS:L,layoutEH:$,widgetsDataSources:k,widgetsEventHandlers:T,options:{}},M=function(t){function n(e){return t.call(this,e.get("Page404LayoutConfig")||q)||this}return p(n,t),n.prototype.initPayload=function(){return{options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.decorators=[{type:e.Component,args:[{selector:"n7-page404-layout",template:'<div class="n7-page404-layout">\n    PAGE404!!!\n</div>'}]}],n.ctorParameters=function(){return[{type:m}]},n}(I),N=[j,M],W=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[y,f,m,E,v,{provide:"config",useValue:e}]}},t.decorators=[{type:e.NgModule,args:[{declarations:N,imports:[n.CommonModule,o.HttpClientModule,i.DvComponentsLibModule],providers:[],exports:N}]}],t}(),R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.onInit=function(t){},e}(l.LayoutDataSource),F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){},e}(l.EventHandler),G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){var e=t.title,n=t.text,o=t.button,i=t.backgroundImage,a=t.input;return{title:e,text:n,backgroundImage:i,button:{text:o.text,payload:"cerca"},input:{placeholder:a.placeholder,payload:"cerca-in-maxxi"}}},e}(l.DataSource),U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return i.TABLE_MOCK},e}(l.DataSource),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return{title:t.title,backgroundImage:t.backgroundImage,image:t.image,text:t.text,button:{text:t.button.text,payload:"naviga-patrimonio"}}},e}(l.DataSource),z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.thresholdShowTitle=50,e.thresholdShowValue=60,e}return p(e,t),e.prototype.transform=function(t){var e=this;if(!t)return null;var n=document.getElementById("bubble-chart-container").offsetWidth,o=700*n,i={containerId:"bubbleChartContainer",containerWidth:n,containerHeight:700,isForceSimulationEnabled:!0,maxBubblesSelected:3,bubblesData:[]},a=-1,r=-1,s=0;return t.bubbles.forEach(function(t){a<t.count&&(a=t.count),(r<0||r>t.count)&&(r=t.count),s++,t.count,t.selected&&0}),t.bubbles.forEach(function(t){var u=t.id,l=(t.count-r/3)/(3*a-r/3),c=Math.log(o)/10*(3*l)*(70-Math.sqrt(s)),d={id:u,texts:[{id:u+"_label0",label:function(n){return n.radius<e.thresholdShowTitle?null:t.entity.label},x_function:function(t){return t.x},y_function:function(t){var n=t.radius/9;return t.radius<e.thresholdShowValue&&(n=0),t.y-n},user_select:"none",fontSize_function:function(t){return t.radius/5},color:"white",classes:""},{id:u+"_label1",label:function(n){return n.radius<e.thresholdShowValue?null:t.count},x_function:function(t){return t.x},y_function:function(t){return t.y+t.radius/9},user_select:"none",fontSize_function:function(t){return t.radius/6},color:"white",classes:""}],x:n/2+50,y:400,radius:c,color:t.color,hasCloseIcon:!!t.selected&&t.selected,payload:{id:u}};i.bubblesData.push(d)}),i.forceSimulationData={xPull:n/2,xPullStrength:-.01,yPull:350,yPullStrength:-.01,collisionStrengh:.99,collisionIterations:1,velocityDecay:.65},t.reset&&(i.reset=t.reset),t.setUpdateReference&&(i.setUpdateReference=t.setUpdateReference),t.setBubbleChart&&(i.setBubbleChart=t.setBubbleChart),i},e}(l.DataSource);var V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){var e=[],n=[];t.forEach(function(t){var o=[],i=[t.icon];t.enabled&&o.push("is-disabled"),t.type.configKey&&(o.push("color-"+t.type.configKey),i.push("color-"+t.type.configKey)),e.push({iconLeft:i.join(" "),text:t.label,additionalText:t.count,iconRight:t.enabled?"n7-icon-eye":"n7-icon-eye-slash",classes:o.join(" "),payload:t.type.id}),n.push({input:{placeholder:t["input-placeholder"],icon:"n7-icon-search",disabled:!t.enabled,payload:String(t.type.id)+"-search"}})});var o=[];return e.map(function(t,e){o.push({header:t,input:n[e]})}),o},e}(l.DataSource),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){var e=[];return t.forEach(function(t){var n=[{label:"Autore",value:""},{label:"",value:""}];t.item.info.forEach(function(t){"author"===t.key?n[0].value=t.value:"short_description"===t.key&&(n[1].value=t.value)});var o=t.relatedTOEData.map(function(t){return{label:t.type.label,value:t.count,icon:t.type.icon}}),i=[{items:n},{items:o}];e.push({image:t.thumbnail,title:t.item.label,metadata:i,payload:t.item.id})}),e},e}(l.DataSource),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.toggleNav=function(){},e.prototype.transform=function(t){return t},e.prototype.updateTree=function(t,e,n){var o=this;t||(t=this.output),t.items.forEach(function(t){t._meta==n?"is-expanded"==t.classes?t.classes="is-collapsed":t.classes="is-expanded":e.indexOf(t._meta)>=0&&(t.classes="is-expanded"),void 0!==t.items&&t.items.length>0&&o.updateTree(t,e,n)}),this.update(t)},e.prototype.selectTreeItem=function(t,e){var n=this;e||(e=this.output),e.items.forEach(function(e){if(e._meta==t)e.classes=e.classes+" is-active",n.currentItem=e;else{var o=e.classes;e.classes=o.replace("is-active","")}void 0!==e.items&&e.items.length>0&&n.selectTreeItem(t,e)}),this.update(e)},e.prototype.toggleSidebar=function(){var t=this.output;"is-expanded"==t.classes?t.classes="is-collapsed":t.classes="is-expanded",this.update(t)},e}(l.DataSource);var Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return t},e.prototype.toggleSidebar=function(){var t=this.output;"is-expanded"==t.classes?t.classes="is-collapsed":t.classes="is-expanded",this.update(t)},e}(l.DataSource),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return t},e.prototype.toggleSidebar=function(){var t=this.output;"is-expanded"==t.classes?t.classes="is-collapsed":t.classes="is-expanded",this.update(t)},e}(l.DataSource),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.transform=function(t){return t},e}(l.DataSource),nt=Object.freeze({AwHeroDS:G,AwTableDS:U,AwHomeHeroPatrimonioDS:K,AwHomeBubbleChartDS:z,AwHomeFacetsWrapperDS:V,AwHomeItemPreviewWrapperDS:Q,AwHomeItemTagsWrapperDS:X,AwEntitaNavDS:J,AwTreeDS:Y,AwSidebarHeaderDS:Z,AwSchedaBreadcrumbsDS:tt,AwSchedaMetadataDS:et}),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"aw-hero.click":break;case"aw-hero.change":t.emitOuter("change",o)}})},e}(l.EventHandler),it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){switch(e.type){case"aw-home-bubble-chart.click":t.emitOuter("click",e.payload);break;case"aw-home-bubble-chart.mouse_enter":t.emitOuter("mouse_enter",e.payload);break;case"aw-home-bubble-chart.mouse_leave":t.emitOuter("mouse_leave",e.payload)}})},e}(l.EventHandler),at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"aw-home-facets-wrapper.click":t.emitOuter("click",o);break;case"aw-home-facets-wrapper.change":t.emitOuter("change",o);break;case"aw-home-facets-wrapper.enter":t.emitOuter("enter",o)}})},e}(l.EventHandler),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type;e.payload;switch(n){case"aw-home-hero-patrimonio.click":t.emitGlobal("navigate",{handler:"router",path:["aw/patrimonio"]})}})},e}(l.EventHandler),st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){},e}(l.EventHandler),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){switch(e.type){case"aw-home-item-tags-wrapper.click":t.emitOuter("click",e.payload)}})},e}(l.EventHandler),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){},e}(l.EventHandler),ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;"aw-sidebar-header.click"==n&&(t.dataSource.toggleSidebar(),t.emitOuter(n,o))})},e}(l.EventHandler),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;"aw-sidebar-header.click"==n&&(t.dataSource.toggleSidebar(),t.emitOuter("click",o))})},e}(l.EventHandler),pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){e.type;var n=e.payload;if(n&&void 0!==n.source)switch(n.source){case"toggle":t.dataSource.updateTree(null,n.parents,n.id);break;case"ToggleMenuItem":t.dataSource.updateTree(null,n.parents,n.id);case"menuItem":t.dataSource.selectTreeItem(n.id),t.emitOuter("click",n.id)}}),this.outerEvents$.subscribe(function(e){var n=e.type,o=e.payload;"aw-sidebar-header.click"==n?t.dataSource.toggleSidebar():"aw-scheda-layout.selectItem"==n&&(t.dataSource.selectTreeItem(o),t.dataSource.updateTree(null,t.dataSource.currentItem.payload.parents,o))})},e}(l.EventHandler),bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){},e}(l.EventHandler),ht=Object.freeze({AwHeroEH:ot,AwHomeBubbleChartEH:it,AwHomeFacetsWrapperEH:at,AwHomeHeroPatrimonioEH:rt,AwHomeItemPreviewWrapperEH:st,AwHomeItemTagsWrapperEH:ut,AwEntitaNavEH:lt,AwSchedaSidebarEH:ct,AwSidebarHeaderEH:dt,AwTreeEH:pt,AwTableEH:bt}),ft={layoutId:"aw-about-layout",widgets:[],layoutDS:R,layoutEH:F,widgetsDataSources:nt,widgetsEventHandlers:ht,layoutOptions:{}},mt=function(t){function n(){return t.call(this,ft)||this}return p(n,t),n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.decorators=[{type:e.Component,args:[{selector:"aw-about-layout",template:'<div class="" *ngIf="lb.dataSource">\n    About page!\n</div>'}]}],n.ctorParameters=function(){return[]},n}(I),yt=function(){function t(t,e){this.http=t,this.config=e}return t.prototype.load=function(t){var e=this;return this.http.get(t).pipe(r.catchError(function(t){return a.of({})}),r.tap(function(t){return e._handleResponse(t)})).toPromise()},t.prototype._handleResponse=function(t){var e=this;t&&Object.keys(t).forEach(function(n){return e.config.set(n,t[n])})},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:f}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(o.HttpClient),e.ɵɵinject(f))},token:t,providedIn:"root"}),t}();var gt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.myResponse={},e}return p(e,t),e.prototype.onInit=function(t){var e=t.configuration,n=t.mainState,o=t.router,i=t.options,a=t.titleService,r=t.communication;this.configuration=e,this.mainState=n,this.router=o,this.titleService=a,this.options=i,this.communication=r},e.prototype.getNavigation=function(t){return this.communication.request$("getEntityDetails",{onError:function(t){return console.error(t)},params:{entityId:t}})},e.prototype.updateWidgets=function(t){this.one("aw-entita-nav").update({items:[{text:"OVERVIEW",payload:"overview"},{text:"CAMPI",payload:"campi"},{text:"OGGETTI COLLEGATI",payload:"oggetti-collegati"},{text:"ENTITA COLLEGATE",payload:"entita-collegate"},{text:"MAXXI",payload:"maxxi"},{text:"WIKIPEDIA",payload:"wiki"}],payload:"entita-nav"})},e.prototype.loadItem=function(t,e){if(t&&e)return this.selectedTab=e,this.communication.request$("getEntityDetails",{onError:function(t){return console.error(t)},params:{entityId:t}});this.pageTitle="Entità Test"},e.prototype.loadContent=function(t){console.log("loadcontent-response: ",{res:t}),this.myResponse=t,this.entityTitle=t.entity.label},e}(l.LayoutDataSource);var vt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new a.Subject,e}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"aw-entita-layout.init":t.dataSource.onInit(o),t.configuration=o.configuration,t.route=o.route;var i=t.route.snapshot.params.id||"";t.listenRoute(),t.loadNavigation(i);break;case"aw-entita-layout.destroy":t.destroyed$.next()}})},e.prototype.listenRoute=function(){var t=this;this.route.paramMap.subscribe(function(e){e.get("id")?t.dataSource.loadItem(e.get("id"),e.get("tab")).subscribe(function(e){e&&t.dataSource.loadContent(e)}):t.dataSource.loadItem()})},e.prototype.loadNavigation=function(t){var e=this;this.dataSource.getNavigation("entita").subscribe(function(n){n&&e.dataSource.updateWidgets(n),t&&e.emitOuter("selectItem",t)})},e}(l.EventHandler);var wt={layoutId:"aw-entita-layout",widgets:[{id:"aw-entita-nav"}],layoutDS:gt,layoutEH:vt,widgetsDataSources:nt,widgetsEventHandlers:ht,options:{}},St=function(t){function n(e,n,o,i,a,r,s){var u=t.call(this,i.get("AwEntitaLayoutConfig")||wt)||this;return u.router=e,u.route=n,u.configuration=o,u.layoutsConfiguration=i,u.communication=a,u.mainState=r,u.titleService=s,u}return p(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,router:this.router,route:this.route,titleService:this.titleService,communication:this.communication,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.decorators=[{type:e.Component,args:[{selector:"aw-entita-layout",template:'<div class="aw-entita-layout" *ngIf="lb.dataSource">\n    <h2><span class="n7-icon-map-marker-alt"></span> {{lb.dataSource.entityTitle}}</h2>\n    <n7-nav \n        [data]="lb.widgets[\'aw-entita-nav\'].ds.out$ | async" \n        [emit]="lb.widgets[\'aw-entita-nav\'].emit">\n    </n7-nav>\n    <ng-container [ngSwitch]="lb.dataSource.selectedTab">\n        <ng-container *ngSwitchCase="\'overview\'">\n            <ng-container *ngTemplateOutlet="overview"></ng-container>\n        </ng-container>\n        <ng-container *ngSwitchCase="\'campi\'">\n            <ng-container *ngTemplateOutlet="campi"></ng-container>\n        </ng-container>\n        <ng-container *ngSwitchCase="\'oggetti\'">\n            <ng-container *ngTemplateOutlet="oggetti"></ng-container>\n        </ng-container>\n        <ng-container *ngSwitchCase="\'entita\'">\n            <ng-container *ngTemplateOutlet="entita"></ng-container>\n        </ng-container>\n        <ng-container *ngSwitchCase="\'maxxi\'">\n            <ng-container *ngTemplateOutlet="maxxi"></ng-container>\n        </ng-container>\n        <ng-container *ngSwitchCase="\'wiki\'">\n            <ng-container *ngTemplateOutlet="wiki"></ng-container>\n        </ng-container>\n    </ng-container>\n</div>\n\n<ng-template #overview>\n    <div>\n        {{lb.dataSource.myResponse.overviewTab}}\n    </div>\n</ng-template>\n\n<ng-template #campi>\n    <div>\n        Page campi\n    </div>\n</ng-template>\n\n<ng-template #oggetti>\n    <div>\n        Page oggetti\n    </div>\n</ng-template>\n\n<ng-template #entita>\n    <div>\n        Page entita\n    </div>\n</ng-template>\n\n<ng-template #maxxi>\n    <div>\n        Page maxxi\n    </div>\n</ng-template>\n\n<ng-template #wiki>\n    <div>\n        Page wiki\n    </div>\n</ng-template>\n'}]}],n.ctorParameters=function(){return[{type:s.Router},{type:s.ActivatedRoute},{type:f},{type:m},{type:E},{type:y},{type:u.Title}]},n}(I);var Et=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.facetData=null,e.facetInputs={},e.allBubbles=null,e.selectedBubbles=[],e.numOfItemsStr=null,e._bubbleChart=null,e.maxBubblesSelectable=3,e.entityBubbleIdMap={},e.lastWindowWidth=-1,e.bubblePopup=null,e.currentHoverEntity=null,e.hasScrollBackground=!1,e}return p(e,t),e.prototype.onInit=function(t){var e=this,n=t.communication,o=t.mainState,i=t.configuration,s=t.tippy;this.communication=n,this.tippy=s,this.mainState=o,this.configuration=i,this.one("aw-hero").update(this.configuration.get("home-layout")["top-hero"]),this.one("aw-home-hero-patrimonio").update(this.configuration.get("home-layout")["bottom-hero"]),this.communication.request$("globalFilter",{onError:function(t){return console.error(t)}}).subscribe(function(t){e.facetData=[],t.entitiesData.forEach(function(t){var n=e.configuration.get("config-keys")[t.countData.type.configKey];n&&e.facetData.push(b({},t.countData,n,{enabled:!0}))}),e.one("aw-home-facets-wrapper").update(e.facetData),e.setAllBubblesFromApolloQuery(t),e.renderPreviewsFromApolloQuery(t)}),this.mainState.update("headTitle","Arianna Web > Home"),this.mainState.update("pageTitle","Arianna Web: Home Layout"),this.lastWindowWidth=window.outerWidth,a.fromEvent(window,"resize").pipe(r.debounce(function(){return a.interval(200)})).subscribe(function(){e.lastWindowWidth!=window.outerWidth&&(e.lastWindowWidth=window.outerWidth,e.updateBubblesAndItemPreviews(!0))})},e.prototype.onBubbleTooltipClick=function(t,e){switch(t){case"select":if(!e)return;var n=this.convertEntityIdToBubbleId(e.entityId);if(!n)return;var o=null;this._bubbleChart&&(this._bubbleChart.selectAll("g").each(function(t){t.id===n&&(o=t)}),o&&this.onBubbleSelected(o))}},e.prototype.onBubbleMouseEnter=function(t){var e=this;if(t&&t.bubble){for(var n=t.bubble.id,o=this.entityBubbleIdMap[t.bubble.id],i=0;i<this.allBubbles.length;i++){var a=this.allBubbles[i];if(a.entity.id===o){this.currentHoverEntity=a.entity,this.currentHoverEntity.count=a.count;break}}this.bubblePopup&&(this.bubblePopup.hide(),this.bubblePopup.destroy(),this.bubblePopup=null),setTimeout(function(){var t=document.getElementById("bubble-popup-menu").cloneNode(!0);t.style.display="inline-block",e.bubblePopup=e.tippy("#"+n,{content:t,trigger:"manual",interactive:!0,arrow:!0,theme:"light-border no-padding",placement:"top-middle",maxWidth:500})[0],setTimeout(function(){e.bubblePopup&&e.bubblePopup.show()},800)})}},e.prototype.renderPreviewsFromApolloQuery=function(t){if(t&&t.itemsPagination){var e=t.itemsPagination.totalCount;if(e>0){for(var n=0;e>999;)e-=1e3,n+=1;var o=e+"";e<10?o="00"+e:e<100&&(o="0"+e),this.numOfItemsStr=n>0?n+"."+o:e+""}else this.numOfItemsStr=null;this.one("aw-home-item-preview-wrapper").update(t.itemsPagination.items),this._scrollBackgroundControl()}},e.prototype.onBubbleSelected=function(t){t&&(this.selectedBubbles.includes(t)||this.selectedBubbles.length<this.maxBubblesSelectable&&(this.selectedBubbles.push(t),this.updateBubblesAndItemPreviews()))},e.prototype.onBubbleDeselected=function(t){t&&t.bubble&&(this.selectedBubbles=this.selectedBubbles.filter(function(e){return e.id!==t.bubble.id}),t.bubble.hasCloseIcon&&(t.bubble.hasCloseIcon=!1,this.updateBubblesAndItemPreviews()))},e.prototype.updateBubblesAndItemPreviews=function(t){var e=this,n=[];this.entityBubbleIdMap&&this.selectedBubbles.forEach(function(t){var o=e.entityBubbleIdMap[t.id];o&&n.push(o)}),this.communication.request$("globalFilter",{onError:function(t){return console.error(t)},params:{selectedEntitiesIds:n,itemsPagination:{offset:0,limit:this.configuration.get("home-layout")["results-limit"]}}}).subscribe(function(n){t||(e.renderPreviewsFromApolloQuery(n),e.renderItemTags()),e.setAllBubblesFromApolloQuery(n,!0)})},e.prototype.convertEntityIdToBubbleId=function(t){return t?"B_"+t.replace(/-/g,"_"):null},e.prototype.setAllBubblesFromApolloQuery=function(t,e){var n=this;if(t&&t.entitiesData){this.allBubbles=[];for(var o=0;o<t.entitiesData.length;o++)for(var i=t.entitiesData[o],a=0;a<i.entitiesCountData.length;a++)this.allBubbles.push(b({},i.entitiesCountData[a],{color:this.configuration.get("config-keys")[i.countData.type.configKey].color.hex}));this.entityBubbleIdMap={},this.allBubbles.forEach(function(t){return t.id=n.convertEntityIdToBubbleId(t.entity.id),n.entityBubbleIdMap[t.id]=t.entity.id,t}),this.allBubbles.forEach(function(t){t.selected=!1;for(var e=0;e<n.selectedBubbles.length;e++)n.selectedBubbles[e].id===t.id&&(t.selected=!0)}),this.one("aw-home-bubble-chart").update({width:window.innerWidth/1.8,bubbles:this.filterBubblesBasedOnFacetsEnabled(),reset:e||!1,setBubbleChart:function(t){return n._bubbleChart=t}})}},e.prototype.filterBubblesBasedOnFacetsEnabled=function(){var t=this;return this.allBubbles.filter(function(e){for(var n=0;n<t.facetData.length;n++)if(e.entity.typeOfEntity.id===t.facetData[n].type.id&&!t.facetData[n].enabled)return!1;return!0})},e.prototype.handleFacetSearchChange=function(t){var e=t.inputPayload,n=t.value;this.facetInputs[e]=n},e.prototype.handleFacetSearchEnter=function(t){var e=t.inputPayload;this.facetInputs[e]},e.prototype.handleFacetHeaderClick=function(t){var e=this,n=!1,o=this.facetData.filter(function(t){return t.enabled}).length;if(this.facetData.forEach(function(e){e.type.id===t&&(e.enabled?o>1&&(e.enabled=!1,n=!0):(e.enabled=!0,n=!0))}),this.one("aw-home-facets-wrapper").update(this.facetData),n){var i=[];if(this.facetData.forEach(function(t){t.enabled||i.push(t.type.id)}),i){var a=this.selectedBubbles.filter(function(t){for(var n="",o=0;o<e.allBubbles.length;o++)if(e.allBubbles[o].id===t.id){n=e.allBubbles[o].entity.typeOfEntity.id;break}return!i.includes(n)});a.length!=this.selectedBubbles.length&&(this.selectedBubbles=a)}this.allBubbles.forEach(function(t){t.selected=!1;for(var n=0;n<e.selectedBubbles.length;n++)e.selectedBubbles[n].id===t.id&&(t.selected=!0)}),this.one("aw-home-bubble-chart").update({width:window.innerWidth/1.8,bubbles:this.filterBubblesBasedOnFacetsEnabled(),setBubbleChart:function(t){return e._bubbleChart=t},reset:!0})}},e.prototype.renderItemTags=function(){var t=this,e=[];this.selectedBubbles.forEach(function(n){for(var o="",i=0;i<t.allBubbles.length;i++)if(t.allBubbles[i].id===n.id){o=t.allBubbles[i].entity.label;break}e.push({label:o,icon:"n7-icon-close",payload:n.id,classes:"tag-"+t.allBubbles[i].entity.typeOfEntity.id})}),this.one("aw-home-item-tags-wrapper").update(e)},e.prototype.onTagClicked=function(t){if(t){var e=t;this._bubbleChart&&this._bubbleChart.selectAll("g").each(function(t){t.id===e&&(t.hasCloseIcon=!1)}),this.selectedBubbles=this.selectedBubbles.filter(function(e){return e.id!==t}),this.updateBubblesAndItemPreviews()}},e.prototype._getSubnav=function(){return["home","results","single"].map(function(t){return{text:t.toUpperCase(),payload:{source:"navigate",handler:"router",path:["aw/"+t],id:t},_meta:{id:t}}})},e.prototype._getBreadcrumbs=function(){return{items:[{label:"Arianna Web",payload:{source:"navigate",handler:"router",path:["aw/home"]}},{label:"Home Layout",payload:{source:"navigate",handler:"router",path:["aw/home"]}}]}},e.prototype._scrollBackgroundControl=function(){var t=this,e=document.getElementById("bubble-results-list"),n=a.fromEvent(document.getElementById("bubble-results-list"),"scroll");setTimeout(function(){t._setHasScrollBackground(e)},500),n.pipe(r.debounceTime(50)).subscribe(function(e){var n=e.target;t._setHasScrollBackground(n)})},e.prototype._setHasScrollBackground=function(t){var e=t.scrollTop,n=t.scrollHeight,o=t.clientHeight;this.hasScrollBackground=n>e+o},e}(l.LayoutDataSource);var It=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new a.Subject,e}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"aw-home-layout.init":t.dataSource.onInit(o);break;case"aw-home-layout.destroy":t.destroyed$.next();break;case"aw-home-layout.bubble-tooltip-close-click":t.dataSource.onBubbleTooltipClick("close",o);break;case"aw-home-layout.bubble-tooltip-goto-click":if(!o||!o.entityId)return;t.emitGlobal("navigate",{handler:"router",path:["aw/entita/"+o.entityId+"/overview"]});break;case"aw-home-layout.bubble-tooltip-select-click":t.dataSource.onBubbleTooltipClick("select",o)}}),this.outerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"aw-hero.change":o.inputPayload,o.value;break;case"aw-home-facets-wrapper.click":t.dataSource.handleFacetHeaderClick(o);break;case"aw-home-facets-wrapper.change":t.dataSource.handleFacetSearchChange(o);break;case"aw-home-facets-wrapper.enter":t.dataSource.handleFacetSearchEnter(o);break;case"aw-home-bubble-chart.mouse_enter":t.dataSource.onBubbleMouseEnter({bubblePayload:o.bubblePayload,bubble:o.bubble});break;case"aw-home-bubble-chart.mouse_leave":break;case"aw-home-bubble-chart.click":"bubble"===o.source?o.bubble&&t.dataSource.onBubbleSelected(o.bubble):"close"===o.source&&t.dataSource.onBubbleDeselected({bubblePayload:o.bubblePayload,bubble:o.bubble});break;case"aw-home-item-tags-wrapper.click":t.dataSource.onTagClicked(o)}})},e}(l.EventHandler);var Ht={layoutId:"aw-home-layout",widgets:[{id:"aw-hero"},{id:"aw-home-hero-patrimonio"},{id:"aw-home-bubble-chart"},{id:"aw-home-facets-wrapper"},{id:"aw-home-item-tags-wrapper"},{id:"aw-home-item-preview-wrapper"}],layoutDS:Et,layoutEH:It,widgetsDataSources:nt,widgetsEventHandlers:ht,options:{}},Dt=function(t){function n(e,n,o,i,a){var r=t.call(this,e.get("AwHomeLayoutConfig")||Ht)||this;return r.router=n,r.configuration=o,r.communication=i,r.mainState=a,r}return p(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,router:this.router,communication:this.communication,options:this.config.options||{},tippy:c}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.decorators=[{type:e.Component,args:[{selector:"aw-home-layout",template:'<div class="aw-home" *ngIf="lb.dataSource">\n    \x3c!-- Hero section at the top of the page --\x3e\n    <div class="aw-home__top-hero">\n        <n7-hero [data]="lb.widgets[\'aw-hero\'].ds.out$ | async" [emit]="lb.widgets[\'aw-hero\'].emit">\n        </n7-hero>\n    </div>\n\n    \x3c!-- hidden buttons and div used to implement the bubbles\' popups --\x3e\n    <button style="display: none;"\n            id="bubble-popup-menu_closebutton"\n            (click)="lb.eventHandler.emitInner(\'bubble-tooltip-close-click\',{entityId:(lb.dataSource.currentHoverEntity ? lb.dataSource.currentHoverEntity.id : null)} )"></button>\n    <button style="display: none;"\n            id="bubble-popup-menu_gotobutton"\n            (click)="lb.eventHandler.emitInner(\'bubble-tooltip-goto-click\',{entityId:(lb.dataSource.currentHoverEntity ? lb.dataSource.currentHoverEntity.id : null)} )"></button>\n    <button style="display: none;"\n            id="bubble-popup-menu_selectbutton"\n            (click)="lb.eventHandler.emitInner(\'bubble-tooltip-select-click\',{entityId:(lb.dataSource.currentHoverEntity ? lb.dataSource.currentHoverEntity.id : null)} )"></button>\n    <div id="bubble-popup-menu" style="display: none;">\n        <h2>{{ ( lb.dataSource.currentHoverEntity ? lb.dataSource.currentHoverEntity.label : \'\' ) }}</h2>\n        <span class="n7-icon-close" onclick="document.getElementById(\'bubble-popup-menu_closebutton\').click();"></span>\n        <p>\n                {{ ( lb.dataSource.currentHoverEntity ? \'È collegato a \'+lb.dataSource.currentHoverEntity.count+\' entità\' : \'\' ) }}\n        </p>\n        <span onclick="document.getElementById(\'bubble-popup-menu_gotobutton\').click();">Vai alla scheda</span> |\n        <span onclick="document.getElementById(\'bubble-popup-menu_selectbutton\').click();">Seleziona</span>\n    </div>\n\n    \x3c!-- Bubble chart --\x3e\n    <div class="aw-home__bubble-wrapper" [ngClass]="{ \'has-results\' : lb.dataSource.selectedBubbles.length>0 }">\n        <div class="aw-home__facets-wrapper">\n            <span class="aw-home__facet"\n                *ngFor="let widgetData of lb.widgets[\'aw-home-facets-wrapper\'].ds.out$ | async;">\n                <n7-facet-header [data]="widgetData.header" [emit]="lb.widgets[\'aw-home-facets-wrapper\'].emit">\n                </n7-facet-header>\n                <n7-facet [data]="widgetData.input" [emit]="lb.widgets[\'aw-home-facets-wrapper\'].emit">\n                </n7-facet>\n            </span>\n        </div>\n\n        <div id="bubble-chart-container">\n            <n7-bubble-chart [data]="lb.widgets[\'aw-home-bubble-chart\'].ds.out$ | async"\n                [emit]="lb.widgets[\'aw-home-bubble-chart\'].emit">\n            </n7-bubble-chart>\n        </div>\n\n        <ng-container *ngIf="lb.dataSource.selectedBubbles.length>0">\n            <div class="aw-home__bubble-results" [ngStyle]="{ \'display\': \'flex\' , \'flex-direction\': \'column\' }">\n                <div *ngIf="lb.dataSource.numOfItemsStr"> <h1 class="aw-home__bubble-results-title"><strong class="aw-home__bubble-results-title-counter">{{ lb.dataSource.numOfItemsStr }}</strong> <span> Oggetti culturali</span></h1></div>\n\n                <div class="aw-home__bubble-tags-wrapper">\n                    <h3 class="aw-home__bubble-tags-title">Collegati a </h3>\n                    <ng-container *ngFor="let widgetData of lb.widgets[\'aw-home-item-tags-wrapper\'].ds.out$ | async;">\n                        <n7-tag [data]="widgetData" [emit]="lb.widgets[\'aw-home-item-tags-wrapper\'].emit">\n                        </n7-tag>\n                        <br>\n                    </ng-container>\n                </div>\n                <div class="aw-home__bubble-results-list-wrapper">\n                    <div class="aw-home__bubble-results-list" [attr.id]="\'bubble-results-list\'">\n                        <ng-container *ngFor="let widgetData of lb.widgets[\'aw-home-item-preview-wrapper\'].ds.out$ | async;">\n                            <n7-item-preview\n                                [data]="widgetData"\n                                [emit]="lb.widgets[\'aw-home-item-preview-wrapper\'].emit">\n                            </n7-item-preview>\n                        </ng-container>\n                    </div>\n                    <div *ngIf="lb.dataSource.hasScrollBackground" class="aw-home__bubble-results-list-wrapper-with-scroll"></div>\n                </div>\n               \n            </div>\n        </ng-container>\n    </div>\n\n    \x3c!-- Hero section at the bottom of the page --\x3e\n    <div class="aw-home__bottom-hero">\n        <n7-hero [data]="lb.widgets[\'aw-home-hero-patrimonio\'].ds.out$ | async"\n            [emit]="lb.widgets[\'aw-home-hero-patrimonio\'].emit">\n        </n7-hero>\n    </div>\n</div>'}]}],n.ctorParameters=function(){return[{type:m},{type:s.Router},{type:f},{type:E},{type:y}]},n}(I);var Ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.onInit=function(t){var e=t.configuration,n=t.mainState,o=t.router,i=t.options,a=t.titleService,r=t.communication;this.configuration=e,this.mainState=n,this.router=o,this.titleService=a,this.communication=r,this.options=i,this.sidebarCollapsed=!1},e.prototype.getNavigation=function(t){return this.communication.request$("getTree",{onError:function(t){return console.error(t)},params:{treeId:t}})},e.prototype.updateNavigation=function(t){var e=this,n={items:[]};t.branches.forEach(function(t){n.items.push(e.parseTree(t,!1,[]))});var o={iconLeft:"n7-icon-tree-icon",text:t.label,iconRight:"n7-icon-angle-left",classes:"is-expanded",payload:"header"};this.one("aw-tree").update(n),this.one("aw-sidebar-header").update(o),this.one("aw-scheda-breadcrumbs").update(null)},e.prototype.loadItem=function(t){if(t)return this.communication.request$("getItemDetails",{onError:function(t){return console.error(t)},params:{itemId:t}});this.pageTitle="Collezione d'Arte",this.hasBreadcrumb=!1,this.contentParts=[{type:"text",title:"Collezione d'Arte",content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi gravida sagittis pulvinar. Etiam iaculis maximus metus, id tincidunt libero auctor et. Proin tempus turpis vel erat ultrices, id vestibulum ante cursus. Vestibulum lobortis, ante at eleifend consequat, massa libero bibendum justo, id fermentum magna odio ac nulla. Cras aliquet scelerisque malesuada. Mauris congue fermentum tristique. Nulla imperdiet accumsan dui, tristique lobortis metus eleifend non. Donec quis odio massa. Cras sit amet sem eu turpis molestie blandit vitae sed nibh. Pellentesque ornare enim nisl, et efficitur ante elementum a. Ut nec ex finibus, congue libero feugiat, aliquam ante. Cras sem neque, pellentesque eget mi at, auctor vulputate tellus. Sed aliquam mi a tortor ultricies interdum. Etiam tincidunt nunc commodo nulla porttitor semper. Etiam porta lacinia libero a mattis. Lorem ipsum dolor sit amet, consectetur adipiscing elit."},{type:"text",title:"Centro Archivi",content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi gravida sagittis pulvinar. Etiam iaculis maximus metus, id tincidunt libero auctor et. Proin tempus turpis vel erat ultrices, id vestibulum ante cursus. Vestibulum lobortis, ante at eleifend consequat, massa libero bibendum justo, id fermentum magna odio ac nulla. Cras aliquet scelerisque malesuada. Mauris congue fermentum tristique. Nulla imperdiet accumsan dui, tristique lobortis metus eleifend non. Donec quis odio massa. Cras sit amet sem eu turpis molestie blandit vitae sed nibh. Pellentesque ornare enim nisl, et efficitur ante elementum a. Ut nec ex finibus, congue libero feugiat, aliquam ante. Cras sem neque, pellentesque eget mi at, auctor vulputate tellus. Sed aliquam mi a tortor ultricies interdum. Etiam tincidunt nunc commodo nulla porttitor semper. Etiam porta lacinia libero a mattis. Lorem ipsum dolor sit amet, consectetur adipiscing elit."}]},e.prototype.loadContent=function(t){if(this.hasBreadcrumb=!0,t){this.contentParts=[],t.image&&this.contentParts.push({image:t.image,type:"image"}),this.contentParts.push({title:t.title,content:t.text,type:"text"});var e={items:[]},n={group:[]};t.fields&&t.fields.forEach(function(t){var e=[];t.fields.forEach(function(t){e.push({label:t.key,value:t.value})}),n.group.push({title:t.label,items:e})}),this.one("aw-scheda-metadata").update(n),t.breadcrumbs.forEach(function(t){e.items.push({label:t.label,payload:t.link})}),this.one("aw-scheda-breadcrumbs").update(e)}},e.prototype.parseTree=function(t,e,n){var o=this,i=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t}(n),a={};return Object.keys(t).forEach(function(n){if(e&&(a.toggle={icon:"n7-icon-angle-right",payload:{source:"toggle",id:t.id,parents:i}}),"branches"!=n){switch(n){case"label":a.text=t[n];break;case"icon":e&&(a.toggle.icon=t[n]);break;case"id":a._meta=t[n],a.payload={source:"menuItem",id:t.id};break;default:t[n]}a.classes="is-collapsed"}else null!=t.branches&&(i.push(t.id),e||(a.payload.source="ToggleMenuItem",a.payload.parents=i),a.items=[],t[n].forEach(function(t){a.items.push(o.parseTree(t,!0,i))}))}),a},e.prototype.collapseSidebar=function(){this.sidebarCollapsed=!this.sidebarCollapsed},e}(l.LayoutDataSource);var At=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed$=new a.Subject,e}return p(e,t),e.prototype.listen=function(){var t=this;this.innerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"aw-scheda-layout.init":t.dataSource.onInit(o),t.configuration=o.configuration,t.route=o.route;var i=t.route.snapshot.params.id||"";t.listenRoute(),t.loadNavigation(i);break;case"aw-scheda-layout.destroy":t.destroyed$.next()}}),this.outerEvents$.subscribe(function(e){var n=e.type,o=e.payload;switch(n){case"aw-tree.click":o&&t.emitGlobal("navigate",{path:[t.configuration.get("paths").schedaBasePath+o],handler:"router"});break;case"aw-sidebar-header.click":t.dataSource.collapseSidebar()}})},e.prototype.listenRoute=function(){var t=this;this.route.paramMap.subscribe(function(e){e.get("id")?t.dataSource.loadItem(e.get("id")).subscribe(function(e){e&&t.dataSource.loadContent(e)}):t.dataSource.loadItem()})},e.prototype.loadNavigation=function(t){var e=this;this.dataSource.getNavigation("patrimonio").subscribe(function(n){n&&e.dataSource.updateNavigation(n,t),t&&e.emitOuter("selectItem",t)})},e}(l.EventHandler);var _t={layoutId:"aw-scheda-layout",widgets:[{id:"aw-sidebar-header"},{id:"aw-tree"},{id:"aw-scheda-breadcrumbs"},{id:"aw-scheda-metadata"}],layoutDS:Ct,layoutEH:At,widgetsDataSources:nt,widgetsEventHandlers:ht,options:{}},kt=function(t){function n(e,n,o,i,a,r,s){var u=t.call(this,i.get("AwPatrimonioLayoutConfig")||_t)||this;return u.router=e,u.route=n,u.configuration=o,u.layoutsConfiguration=i,u.mainState=a,u.titleService=r,u.communication=s,u}return p(n,t),n.prototype.initPayload=function(){return{configuration:this.configuration,mainState:this.mainState,router:this.router,route:this.route,titleService:this.titleService,communication:this.communication,options:this.config.options||{}}},n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.decorators=[{type:e.Component,args:[{selector:"aw-scheda-layout",template:'<div class="aw-scheda" id="scheda-layout">\n    <div class="aw-scheda__content">\n        \x3c!-- Left sidebar: tree --\x3e\n        <div class="aw-scheda__tree">\n            <n7-sidebar-header\n                [data]="lb.widgets[\'aw-sidebar-header\'].ds.out$ | async"\n                [emit]="lb.widgets[\'aw-sidebar-header\'].emit"\n            ></n7-sidebar-header>\n            <n7-tree\n                [data]="lb.widgets[\'aw-tree\'].ds.out$ | async"\n                [emit]="lb.widgets[\'aw-tree\'].emit"\n                [hidden]="lb.dataSource.sidebarCollapsed"\n            ></n7-tree>\n        </div>\n\n        \x3c!-- Scheda details --\x3e\n        <div class="aw-scheda__scheda-wrapper">\n            <n7-breadcrumbs\n                *ngIf="lb.dataSource.hasBreadcrumb"\n                [data]="lb.widgets[\'aw-scheda-breadcrumbs\'].ds.out$ | async"\n                [emit]="lb.widgets[\'aw-scheda-breadcrumbs\'].emit"\n            ></n7-breadcrumbs>\n            <div *ngFor="let part of lb.dataSource.contentParts">\n                <div *ngIf="part.type == \'image\'">\n                    <div\n                    [ngStyle]="{\n                        \'background-image\': \'url(\' + part.image + \')\',\n                        \'width\': \'100%\',\n                        \'height\': \'200px\'\n                        }">\n                    </div>\n                </div>\n\n                <div>\n                    <h1>{{ part.title }}</h1>\n                    <div>\n                        <div [innerHTML]="part.content" >\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <n7-metadata-viewer\n                [data]="lb.widgets[\'aw-scheda-metadata\'].ds.out$ | async"\n            >\n            </n7-metadata-viewer>\n        </div>\n    </div>\n</div>\n'}]}],n.ctorParameters=function(){return[{type:s.Router},{type:s.ActivatedRoute},{type:f},{type:m},{type:y},{type:u.Title},{type:E}]},n}(I);var Bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.onInit=function(t){},e}(l.LayoutDataSource),Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.listen=function(){},e}(l.EventHandler),xt={layoutId:"aw-works-layout",widgets:[],layoutDS:Bt,layoutEH:Pt,widgetsDataSources:nt,widgetsEventHandlers:ht,layoutOptions:{}},Tt=function(t){function n(){return t.call(this,xt)||this}return p(n,t),n.prototype.ngOnInit=function(){this.onInit()},n.prototype.ngOnDestroy=function(){this.onDestroy()},n.decorators=[{type:e.Component,args:[{selector:"aw-works-layout",template:'<div class="" *ngIf="lb.dataSource">\n    Works page!\n</div>'}]}],n.ctorParameters=function(){return[]},n}(I),Ot=[mt,St,Dt,kt,Tt],jt=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:Ot,imports:[n.CommonModule,i.DvComponentsLibModule,W],providers:[],exports:Ot}]}],t}(),Lt=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],providers:[],exports:[W,jt]}]}],t}();t.AbstractLayout=I,t.ApolloProvider=v,t.ApolloProviderConfig=g,t.AwAboutLayoutComponent=mt,t.AwAboutLayoutConfig=ft,t.AwAboutLayoutDS=R,t.AwAboutLayoutEH=F,t.AwEntitaLayoutComponent=St,t.AwEntitaLayoutConfig=wt,t.AwEntitaLayoutDS=gt,t.AwEntitaLayoutEH=vt,t.AwEntitaNavDS=J,t.AwEntitaNavEH=lt,t.AwHeroDS=G,t.AwHeroEH=ot,t.AwHomeBubbleChartDS=z,t.AwHomeBubbleChartEH=it,t.AwHomeFacetsWrapperDS=V,t.AwHomeFacetsWrapperEH=at,t.AwHomeHeroPatrimonioDS=K,t.AwHomeHeroPatrimonioEH=rt,t.AwHomeItemPreviewWrapperDS=Q,t.AwHomeItemPreviewWrapperEH=st,t.AwHomeItemTagsWrapperDS=X,t.AwHomeItemTagsWrapperEH=ut,t.AwHomeLayoutComponent=Dt,t.AwHomeLayoutConfig=Ht,t.AwHomeLayoutDS=Et,t.AwHomeLayoutEH=It,t.AwPatrimonioLayoutConfig=_t,t.AwSchedaBreadcrumbsDS=tt,t.AwSchedaLayoutComponent=kt,t.AwSchedaLayoutDS=Ct,t.AwSchedaLayoutEH=At,t.AwSchedaMetadataDS=et,t.AwSchedaSidebarEH=ct,t.AwSidebarHeaderDS=Z,t.AwSidebarHeaderEH=dt,t.AwTableDS=U,t.AwTableEH=bt,t.AwTreeDS=Y,t.AwTreeEH=pt,t.AwWorksLayoutComponent=Tt,t.AwWorksLayoutConfig=xt,t.AwWorksLayoutDS=Bt,t.AwWorksLayoutEH=Pt,t.BreadcrumbsDS=_,t.BreadcrumbsEH=x,t.CommunicationService=E,t.ConfigurationService=f,t.HeaderDS=C,t.HeaderEH=B,t.JsonConfigService=yt,t.LayoutsConfigurationService=m,t.MainLayoutComponent=j,t.MainLayoutConfig=O,t.MainLayoutDS=H,t.MainLayoutEH=D,t.MainStateService=y,t.N7BoilerplateAriannaWebModule=jt,t.N7BoilerplateCommonModule=W,t.N7BoilerplateLibModule=Lt,t.Page404LayoutComponent=M,t.Page404LayoutConfig=q,t.Page404LayoutDS=L,t.Page404LayoutEH=$,t.RestProvider=S,t.RestProviderConfig=w,t.SubnavDS=A,t.SubnavEH=P,t.ɵa=E,t.ɵb=y,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=n7-frontend-boilerplate.umd.min.js.map